var SlimTabV2=function(t){var e={};function i(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(n,s,function(e){return t[e]}.bind(null,s));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=2)}([function(t,e,i){"use strict";var n;i.d(e,"b",function(){return n}),i.d(e,"a",function(){return l}),function(t){t.setAttributes=function(t,e){for(let i in e)t.setAttribute(i,e[i])},t.setStyle=function(t,e){for(let i in e)t.style.setProperty(i,e[i])};const e={C:0,"C#":1,D:2,"D#":3,E:4,F:5,"F#":6,G:7,"G#":8,A:9,"A#":10,B:11},i=/^([CDEFGAB]#?)([0-9])$/;t.noteToDecimal=function(t){let n=i.exec(t);return 3!=n.length?-1:e[n[1]]+12*(Number(n[2])+1)}}(n||(n={}));class s{constructor(){this.funcs=[]}callAll(...t){this.funcs.forEach(e=>{e(...t)})}push(t){this.funcs.push(t)}}class l{constructor(t){t.forEach(t=>{this[t]=new s})}}},,function(t,e,i){"use strict";i.r(e),i.d(e,"SLTab",function(){return s});var n=i(0);class s{constructor(t){this.lengthPerBeat=4,this.beatPerSection=4,this.lineWidth=800,this.sectionPerLine=2,this.stringPadding=16,this.linePerPage=20,this.lineMargin=42,this.linePadding=[32,14],this.lineDistance=90,this.sectionAddNoteNumber=16,this.noteElement=[],this.linkerElement=[],this.sectionBarElement=[],this.lineElement=[],this.sectionIndicatorElement=[],this.startPosition=[this.lineMargin+this.linePadding[0]+20,120+this.linePadding[1]],this.lineInfo=[0,this.lineMargin,120],Object.assign(this,t)}setNoteData(t){this.notes=t}instrumentNoteInput(t,e=-1,i=-1){-1==e&&(e=this.notes.length-1),-1==i&&(i=this.notes[e].length-1),this.notes[e]=this.notes[e].slice(0,i+1);let n=0;for(let t=0;t<=i;t++)n+=this.lengthPerBeat/this.notes[e][t][0];if(n>=this.beatPerSection)this.notes.splice(e+1,0,[]),this.notes[e+1].push(t);else if(n+this.lengthPerBeat/t[0]>this.beatPerSection){let i=this.beatPerSection-n,s=this.lengthPerBeat/(this.lengthPerBeat/t[0]-i);i=this.lengthPerBeat/i,this.notes[e].push([i,t[1],"linkStart"]),this.notes.splice(e+1,0,[]),this.notes[e+1].push([s,t[1],"linkEnd"])}else{let i=1-n%1;if(i>=this.lengthPerBeat/t[0])this.notes[e].push(t);else{let n=this.lengthPerBeat/t[0]-i;this.notes[e].push([this.lengthPerBeat/i,t[1],"linkStart"]),this.notes[e].push([this.lengthPerBeat/n,t[1],"linkEnd"])}}this.render()}render(t){if(!this.svgElement){let e=document.createElement("div"),i=this.lineWidth+2*this.linePadding[0]+84;e.setAttribute("style","position: relative; background: radial-gradient(#3E3E3E, #000) ; width: fit-content;"),this.svgElement=document.createElementNS("http://www.w3.org/2000/svg","svg"),n.b.setAttributes(this.svgElement,{width:`${i}`,height:"600"}),this.svgElement.innerHTML="<g></g><g></g><g></g><g></g>",e.append(this.svgElement),t.appendChild(e)}this.setAllLine();let[e,i,s]=this.calNoteRawData();this.setSectionIndicator(s),this.setAllNoteElementData(e),this.setLinker(i)}setAllLine(){let t=Math.ceil(this.notes.length/this.sectionPerLine);if(t>this.lineInfo[0])for(let e=0;e<t-this.lineInfo[0];e++){let t=this.createLine(this.lineInfo[1],this.lineInfo[2],e);this.lineElement.push(t),this.svgElement.children[0].appendChild(t),this.lineInfo[2]+=5*this.stringPadding+this.lineDistance}this.lineInfo[0]=t}setSectionIndicator(t){if(t.length>this.sectionIndicatorElement.length){let e=t.length-this.sectionIndicatorElement.length;for(let t=0;t<e;t++){let t=this.createSectionIndicator();this.svgElement.children[1].appendChild(t),this.sectionIndicatorElement.push(t)}}for(let e=0;e<t.length;e++){let i=t[e][1][0]-t[e][0][0],s=5*this.stringPadding;n.b.setAttributes(this.sectionIndicatorElement[e],{x:`${t[e][0][0]}`,y:`${t[e][0][1]}`,width:`${i}`,height:`${s}`})}}createSectionIndicator(){let t=document.createElementNS("http://www.w3.org/2000/svg","rect");return n.b.setAttributes(t,{"stroke-width":"0",fill:"rgba(0, 255, 255, 0)"}),t}createLine(t,e,i){let s=document.createElementNS("http://www.w3.org/2000/svg","g"),l=document.createElementNS("http://www.w3.org/2000/svg","rect");n.b.setAttributes(l,{x:`${t}`,y:`${e}`,style:"fill: rgba(255, 255, 255, 0.09)",width:`${2*this.linePadding[0]+this.lineWidth}`,height:`${2*this.linePadding[1]+5*this.stringPadding}`}),s.appendChild(l),t+=this.linePadding[0],e+=this.linePadding[1];for(let i=0;i<6;i++){let l=this.lineWidth,r=document.createElementNS("http://www.w3.org/2000/svg","line");n.b.setAttributes(r,{x1:`${t}`,y1:`${e+i*this.stringPadding}`,x2:`${t+l}`,y2:`${e+i*this.stringPadding}`,style:"stroke:rgba(255, 255, 255, 0.24) ;stroke-width:2"}),s.appendChild(r)}s.appendChild(this.drawLineTitle(t-30,e)),s.appendChild(this.createBar(t,e));for(let t=0;t<this.sectionPerLine;t++){let t=this.createBar(0,0);this.sectionBarElement.push(t),s.appendChild(t)}return s}drawLineTitle(t,e){let i=document.createElementNS("http://www.w3.org/2000/svg","g");return i.innerHTML=`\n        <text style="fill:#959595;font:17px arial;">\n            <tspan x='${t+10}' y='${e+26}'>T</tspan>\n            <tspan x='${t+10}' y='${e+22+26}'>A</tspan>\n            <tspan x='${t+10}' y='${e+44+26}'>B</tspan>\n        </text>\n        `,i}createBar(t,e){let i=document.createElementNS("http://www.w3.org/2000/svg","line");return n.b.setAttributes(i,{style:"stroke:rgba(255, 255, 255, 0.24) ;stroke-width:2"}),n.b.setAttributes(i,{x1:`${t}`,y1:`${e}`,x2:`${t}`,y2:`${e+5*this.stringPadding}`}),i}setBarPosition(t,e,i){n.b.setAttributes(t,{x1:`${e}`,y1:`${i}`,x2:`${e}`,y2:`${i+5*this.stringPadding}`})}createNoteElement(t=200,e=20){let i=document.createElementNS("http://www.w3.org/2000/svg","g"),n=`<g>\n        <line style="stroke:white;stroke-width:1" x1="${t}" y1="140" x2="${t}" y2="${e}"></line>\n        <line style="stroke:white;stroke-width:2" x1="${t}" y1="138" x2="${t+10}" y2="138"></line>\n        <line style="stroke:white;stroke-width:2" x1="${t}" y1="130" x2="${t+10}" y2="130"></line>\n        <line style="stroke:white;stroke-width:2"></line>\n        </g>`;for(let i=0;i<6;i++)n+=`\n                <g>\n                <ellipse cx='${t}' cy='${e+this.stringPadding*i}' rx='4' ry='6' fill='#444' stroke-width='0' stroke='black' style='cursor:pointer;'></ellipse>\n                <text x='${t}' y='${e+this.stringPadding*i+4}' text-anchor="middle" style="font:12px Sans-serif; fill:#fff">3</text>\n                </g>\n            `;i.innerHTML=n,this.svgElement.children[2].appendChild(i),this.noteElement.push(i)}calNoteRawData(){let[t,e]=this.startPosition,i=[],n=(this.beatPerSection,this.lengthPerBeat,[]),s=[],l=0;i.push([0,0,0,null,null,0,0]);for(let r=0;r<this.notes.length;r++){let h=Math.floor(r/this.sectionPerLine),o=0;for(let t=0;t<this.sectionPerLine;t++)this.notes[h*this.sectionPerLine+t]?o+=this.notes[h*this.sectionPerLine+t].length+this.sectionAddNoteNumber:o+=this.sectionAddNoteNumber;let a=this.lineWidth*(this.notes[r].length+this.sectionAddNoteNumber)/o,d=0;for(let t=0;t<this.notes[r].length;t++)d+=this.lengthPerBeat/this.notes[r][t][0];let c=(a-20)/d;r%this.sectionPerLine==0&&(t=this.startPosition[0],0!=r&&(e+=5*this.stringPadding+this.lineDistance));let g=[[t-20,e],[0,e]],u=t+a;g[1][0]=u-20,this.setBarPosition(this.sectionBarElement[r],u-20,e),s.push(g);for(let s=0;s<this.notes[r].length;s++){let h,o=this.notes[r][s],a=this.lengthPerBeat/o[0];l+a/this.lengthPerBeat>=.25?(h=this.calculateTail(i[i.length-1][2],o[0],-1,c),l=0):(h=this.calculateTail(i[i.length-1][2],o[0],l,c),l+=a/this.lengthPerBeat);let d=c*this.lengthPerBeat/o[0];i.push([t,e,o[0],o[1],h,r,s]),"linkStart"!==o[2]&&"linkEnd"!==o[2]||n.push([t,e]),t+=d}t=u}return i.shift(),[i,n,s]}calculateTail(t,e,i,n){let s=n*this.lengthPerBeat/t*-1,l=8;if(-1==i&&(l=-8),0==i){if(8==e)return[8,0,0];if(16==e)return[8,8,0];if(32==e)return[8,8,8]}else if(8==e){if(8==t||16==t||32==t)return[s,0,0]}else if(16==e){if(8==t)return[s,l,0];if(16==t||32==t)return[s,s,0]}else if(32==e){if(8==t)return[s,l,l];if(16==t)return[s,s,l];if(32==t)return[s,s,s]}return[0,0,0]}setAllNoteElementData(t){let e=t.length-this.noteElement.length;for(let t=0;t<e;t++)this.createNoteElement();for(let e=0;e<t.length;e++)n.b.setStyle(this.noteElement[e],{display:"unset"}),this.setNoteElementData(this.noteElement[e],t[e]);for(let e=t.length;e<this.noteElement.length;e++)n.b.setStyle(this.noteElement[e],{display:"none"})}setNoteElementData(t,e){this.setElementPosition(t,e[0],e[1],e[4],e[5],e[6]),this.setChordVisiable(t,e[1],e[3])}setElementPosition(t,e,i,s,l,r){n.b.setAttributes(t.children[0].children[0],{x1:`${e}`,y1:`${26+i+5*this.stringPadding}`,x2:`${e}`,y2:`${i}`}),n.b.setAttributes(t.children[0].children[1],{x1:`${e}`,y1:`${25+i+5*this.stringPadding}`,x2:`${e+s[0]}`,y2:`${25+i+5*this.stringPadding}`}),n.b.setAttributes(t.children[0].children[2],{x1:`${e}`,y1:`${21+i+5*this.stringPadding}`,x2:`${e+s[1]}`,y2:`${21+i+5*this.stringPadding}`}),n.b.setAttributes(t.children[0].children[3],{x1:`${e}`,y1:`${17+i+5*this.stringPadding}`,x2:`${e+s[2]}`,y2:`${17+i+5*this.stringPadding}`});for(let s=1;s<=6;s++)n.b.setAttributes(t.children[s].children[0],{cx:`${e}`,cy:`${i+this.stringPadding*(s-1)}`}),n.b.setAttributes(t.children[s].children[1],{x:`${e}`,y:`${i+this.stringPadding*(s-1)+4}`});n.b.setAttributes(t,{"data-section":`${l}`,"data-note":`${r}`})}setChordVisiable(t,e,i){for(let e=1;e<=6;e++)t.children[e].children[1].innerHTML=`${i[e-1]}`,-1==i[e-1]?(n.b.setStyle(t.children[e].children[0],{display:"none"}),n.b.setStyle(t.children[e].children[1],{display:"none"})):(n.b.setStyle(t.children[e].children[0],{display:"block"}),n.b.setStyle(t.children[e].children[1],{display:"block"}));let s=-1;for(let t=0;t<6;t++)if(-1!=i[t]){s=t;break}-1!=s?(n.b.setAttributes(t.children[0].children[0],{y2:`${e+this.stringPadding*s}`}),n.b.setStyle(t.children[0].children[0],{display:"block"})):n.b.setStyle(t.children[0].children[0],{display:"none"})}setLinker(t){let e=Math.floor(t.length/2),i=this.linkerElement.length;for(let t=0;t<e-i;t++)this.createLinkerElement();for(let i=0;i<e;i++)this.setLinkerData(this.linkerElement[i],t[2*i],t[2*i+1])}createLinkerElement(){let t=document.createElementNS("http://www.w3.org/2000/svg","path");this.svgElement.children[3].appendChild(t),n.b.setAttributes(t,{fill:"white"}),this.linkerElement.push(t)}setLinkerData(t,e,i){let s=e[1]+31+5*this.stringPadding;if(e[1]!==i[1]){let l=e[0]+30,r=e[0],h=`M ${r} ${s} C ${r+4} ${s+15}, ${l-4} ${s+15}, ${l} ${s} C ${l-4} ${s+12}, ${r+4} ${s+12}, ${r} ${s} `;s=i[1]+31+5*this.stringPadding,h+=`M ${r=i[0]-30} ${s} C ${r+4} ${s+15}, ${(l=i[0])-4} ${s+15}, ${l} ${s} C ${l-4} ${s+12}, ${r+4} ${s+12}, ${r} ${s}`,n.b.setAttributes(t,{d:h})}else n.b.setAttributes(t,{d:`M ${e[0]} ${s} C ${e[0]+4} ${s+15}, ${i[0]-4} ${s+15}, ${i[0]} ${s} C ${i[0]-4} ${s+12}, ${e[0]+4} ${s+12}, ${e[0]} ${s}`})}}}]);
//# sourceMappingURL=SlimTabV2.js.map