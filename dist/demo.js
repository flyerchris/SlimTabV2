var demo =
/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./src/demo.ts");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./src/DataAdapter.ts":
/*!****************************!*\
  !*** ./src/DataAdapter.ts ***!
  \****************************/
/*! exports provided: DataAdapter */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"DataAdapter\", function() { return DataAdapter; });\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./utils */ \"./src/utils.ts\");\n/* harmony import */ var _SlimTabV2Types__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./SlimTabV2Types */ \"./src/SlimTabV2Types.ts\");\n\r\n\r\nclass DataAdapter {\r\n    constructor(bpm) {\r\n        this.startTimeOffset = 0;\r\n        this.timeOffset = 0;\r\n        this.bpm = 120;\r\n        this.rawData = [];\r\n        this.lengthPerBeat = 4;\r\n        this.chordInterval = -0.2 * this.bpm + 84; //120=>60, 420=>0\r\n        this.beatInnerCount = [0, 0];\r\n        this.isWorking = false;\r\n        if (bpm) {\r\n            this.bpm = bpm;\r\n        }\r\n        this.callbacks = new _utils__WEBPACK_IMPORTED_MODULE_0__[\"Callbacks\"]([\"packNote\", \"data\"]);\r\n    }\r\n    receiveData(stringIndex, note, amp, time) {\r\n        if (!this.isWorking)\r\n            return;\r\n        this.rawData.push([stringIndex, note, time + 40 + this.timeOffset]);\r\n        if (!this.receiveInterval) {\r\n            this.receiveInterval = setTimeout(this.packNote.bind(this), this.chordInterval);\r\n        }\r\n        this.callbacks[\"data\"].callAll(stringIndex, note, time);\r\n    }\r\n    addPackListener(cb) {\r\n        this.callbacks[\"packNote\"].push(cb);\r\n    }\r\n    addDataListener(cb) {\r\n        this.callbacks[\"data\"].push(cb);\r\n    }\r\n    getTime() {\r\n        return performance.now();\r\n    }\r\n    get milliSecondPerBeat() {\r\n        return 60 * 1000 / this.bpm;\r\n    }\r\n    setBpm(val) {\r\n        this.bpm = val;\r\n    }\r\n    activate() {\r\n        this.isWorking = true;\r\n    }\r\n    deactivate() {\r\n        this.init();\r\n        this.isWorking = false;\r\n    }\r\n    init() {\r\n        this.rawData = [];\r\n        this.beatInnerCount = [0, 0];\r\n        this.noteRawData = null;\r\n    }\r\n    packNote() {\r\n        let notes = [-1, -1, -1, -1, -1, -1];\r\n        for (let i = 0; i < this.rawData.length; i++) {\r\n            notes[this.rawData[i][0]] = this.rawData[i][1];\r\n        }\r\n        let rbc = this.timeToBeatCount(this.rawData[0][2] + this.startTimeOffset);\r\n        if (this.beatInnerCount[0] != Math.floor(rbc / 0.5) * 0.5) {\r\n            this.beatInnerCount[0] = Math.floor(rbc / 0.5) * 0.5;\r\n            if (rbc !== Math.floor(rbc / 0.5) * 0.5) {\r\n                this.beatInnerCount[1] = 1;\r\n            }\r\n            else {\r\n                this.beatInnerCount[1] = 0;\r\n            }\r\n        }\r\n        this.beatInnerCount[1]++;\r\n        if (this.beatInnerCount[1] > 2) {\r\n            this.preTime = (this.beatInnerCount[0] + 0.25) * this.milliSecondPerBeat - this.startTimeOffset;\r\n            this.receiveInterval = null;\r\n            this.rawData = [];\r\n            return;\r\n        }\r\n        if (this.noteRawData) {\r\n            let bc = rbc - this.timeToBeatCount(this.preTime + this.startTimeOffset);\r\n            let nv;\r\n            if (bc <= 0) {\r\n                nv = 16;\r\n                this.preTime = (this.timeToBeatCount(this.rawData[0][2] + this.startTimeOffset) + 0.25) * this.milliSecondPerBeat - this.startTimeOffset;\r\n            }\r\n            else {\r\n                nv = this.lengthPerBeat / bc;\r\n                this.preTime = this.rawData[0][2];\r\n            }\r\n            this.noteRawData.noteValue = nv;\r\n            this.noteRawData.userData = null;\r\n            this.callbacks[\"packNote\"].callAll(this.noteRawData);\r\n        }\r\n        else {\r\n            if (rbc !== 0) {\r\n                let bc = rbc;\r\n                let nv = this.lengthPerBeat / bc;\r\n                this.noteRawData = new _SlimTabV2Types__WEBPACK_IMPORTED_MODULE_1__[\"Note\"]({ noteValue: nv, stringContent: [-1, -1, -1, -1, -1, -1] });\r\n                this.callbacks[\"packNote\"].callAll(this.noteRawData);\r\n            }\r\n            this.preTime = this.rawData[0][2];\r\n        }\r\n        this.noteRawData = new _SlimTabV2Types__WEBPACK_IMPORTED_MODULE_1__[\"Note\"]({ noteValue: 4, stringContent: notes, userData: \"undefined-value\" });\r\n        this.rawData = [];\r\n        this.receiveInterval = null;\r\n        this.callbacks[\"packNote\"].callAll(this.noteRawData);\r\n    }\r\n    timeToBeatCount(time) {\r\n        let ratio = [3, 1];\r\n        let unit = this.milliSecondPerBeat / (2 * (ratio[0] + ratio[1]));\r\n        let range = [unit * ratio[0] / 2];\r\n        for (let i = 0; i < 3; i++)\r\n            range.push(range[i] + ratio[(i + 1) % 2] * unit);\r\n        let beat = time / this.milliSecondPerBeat;\r\n        let bd = Math.floor(beat);\r\n        let bcs = (beat - bd) * this.milliSecondPerBeat;\r\n        let bc = 4;\r\n        for (let i = 0; i < 4; i++) {\r\n            if (bcs < range[i]) {\r\n                bc = i;\r\n                break;\r\n            }\r\n        }\r\n        return bd + bc * 0.25;\r\n    }\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRGF0YUFkYXB0ZXIudHMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvRGF0YUFkYXB0ZXIudHM/MjUyMSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDYWxsYmFja3MgfSBmcm9tIFwiLi91dGlsc1wiXHJcbmltcG9ydCB7IE5vdGUgfSBmcm9tIFwiLi9TbGltVGFiVjJUeXBlc1wiXHJcbmV4cG9ydCBjbGFzcyBEYXRhQWRhcHRlcntcclxuICAgIHN0YXJ0VGltZU9mZnNldDogbnVtYmVyID0gMDtcclxuICAgIHRpbWVPZmZzZXQ6IG51bWJlciA9IDA7XHJcbiAgICBwcml2YXRlIGJwbTogbnVtYmVyID0gMTIwO1xyXG4gICAgcHJpdmF0ZSByYXdEYXRhOiBbbnVtYmVyLCBudW1iZXIsIG51bWJlcl1bXSA9IFtdO1xyXG4gICAgcHJpdmF0ZSBwcmVUaW1lOiBudW1iZXI7XHJcbiAgICBwcml2YXRlIG5vdGVSYXdEYXRhOiBOb3RlO1xyXG4gICAgcHJpdmF0ZSByZWNlaXZlSW50ZXJ2YWw6bnVtYmVyO1xyXG4gICAgcHJpdmF0ZSBsZW5ndGhQZXJCZWF0OiBudW1iZXIgPSA0O1xyXG4gICAgcHJpdmF0ZSBjYWxsYmFja3M6IENhbGxiYWNrcztcclxuICAgIHByaXZhdGUgY2hvcmRJbnRlcnZhbDogbnVtYmVyID0gLTAuMiAqIHRoaXMuYnBtICsgODQ7Ly8xMjA9PjYwLCA0MjA9PjBcclxuICAgIHByaXZhdGUgYmVhdElubmVyQ291bnQgPSBbMCwgMF07XHJcbiAgICBwcml2YXRlIGlzV29ya2luZyA9IGZhbHNlO1xyXG4gICAgXHJcbiAgICBjb25zdHJ1Y3RvcihicG0/OiBudW1iZXIpe1xyXG4gICAgICAgIGlmKGJwbSl7XHJcbiAgICAgICAgICAgIHRoaXMuYnBtID0gYnBtO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmNhbGxiYWNrcyA9IG5ldyBDYWxsYmFja3MoW1wicGFja05vdGVcIiwgXCJkYXRhXCJdKTtcclxuICAgIH1cclxuICAgIHJlY2VpdmVEYXRhKHN0cmluZ0luZGV4OiBudW1iZXIsIG5vdGU6IG51bWJlciwgYW1wOiBudW1iZXIsIHRpbWU6IG51bWJlcil7XHJcbiAgICAgICAgaWYoIXRoaXMuaXNXb3JraW5nKXJldHVybjtcclxuICAgICAgICB0aGlzLnJhd0RhdGEucHVzaChbc3RyaW5nSW5kZXgsIG5vdGUsIHRpbWUgKyA0MCArIHRoaXMudGltZU9mZnNldF0pO1xyXG4gICAgICAgIGlmKCF0aGlzLnJlY2VpdmVJbnRlcnZhbCl7XHJcbiAgICAgICAgICAgIHRoaXMucmVjZWl2ZUludGVydmFsID0gc2V0VGltZW91dCh0aGlzLnBhY2tOb3RlLmJpbmQodGhpcyksIHRoaXMuY2hvcmRJbnRlcnZhbCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY2FsbGJhY2tzW1wiZGF0YVwiXS5jYWxsQWxsKHN0cmluZ0luZGV4LCBub3RlLCB0aW1lKTtcclxuICAgIH1cclxuICAgIGFkZFBhY2tMaXN0ZW5lcihjYjogKGRhdGE6IE5vdGUpID0+IGFueSl7XHJcbiAgICAgICAgdGhpcy5jYWxsYmFja3NbXCJwYWNrTm90ZVwiXS5wdXNoKGNiKTtcclxuICAgIH1cclxuICAgIGFkZERhdGFMaXN0ZW5lcihjYjogKHN0cmluZzogbnVtYmVyLCBub3RlOiBudW1iZXIsIHRpbWU6IG51bWJlcikgPT4gYW55KXtcclxuICAgICAgICB0aGlzLmNhbGxiYWNrc1tcImRhdGFcIl0ucHVzaChjYik7XHJcbiAgICB9XHJcbiAgICBnZXRUaW1lKCk6IG51bWJlcntcclxuICAgICAgICByZXR1cm4gcGVyZm9ybWFuY2Uubm93KCk7XHJcbiAgICB9XHJcbiAgICBnZXQgbWlsbGlTZWNvbmRQZXJCZWF0KCl7XHJcbiAgICAgICAgcmV0dXJuIDYwICoxMDAwIC8gdGhpcy5icG07XHJcbiAgICB9XHJcbiAgICBzZXRCcG0odmFsOiBudW1iZXIpe1xyXG4gICAgICAgIHRoaXMuYnBtID0gdmFsO1xyXG4gICAgfVxyXG4gICAgYWN0aXZhdGUoKXtcclxuICAgICAgICB0aGlzLmlzV29ya2luZyA9IHRydWU7XHJcbiAgICB9XHJcbiAgICBkZWFjdGl2YXRlKCl7XHJcbiAgICAgICAgdGhpcy5pbml0KCk7XHJcbiAgICAgICAgdGhpcy5pc1dvcmtpbmcgPSBmYWxzZTtcclxuICAgIH1cclxuICAgIHByaXZhdGUgaW5pdCgpe1xyXG4gICAgICAgIHRoaXMucmF3RGF0YSA9IFtdO1xyXG4gICAgICAgIHRoaXMuYmVhdElubmVyQ291bnQgPSBbMCwgMF07XHJcbiAgICAgICAgdGhpcy5ub3RlUmF3RGF0YSA9IG51bGw7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIHBhY2tOb3RlKCl7XHJcbiAgICAgICAgbGV0IG5vdGVzID0gWy0xLCAtMSwgLTEsIC0xLCAtMSwgLTFdO1xyXG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCB0aGlzLnJhd0RhdGEubGVuZ3RoOyBpKyspe1xyXG4gICAgICAgICAgICBub3Rlc1t0aGlzLnJhd0RhdGFbaV1bMF1dID0gdGhpcy5yYXdEYXRhW2ldWzFdO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgcmJjID0gdGhpcy50aW1lVG9CZWF0Q291bnQodGhpcy5yYXdEYXRhWzBdWzJdICsgdGhpcy5zdGFydFRpbWVPZmZzZXQpO1xyXG4gICAgICAgIGlmKHRoaXMuYmVhdElubmVyQ291bnRbMF0gIT0gTWF0aC5mbG9vcihyYmMgLyAwLjUpICogMC41KXtcclxuICAgICAgICAgICAgdGhpcy5iZWF0SW5uZXJDb3VudFswXSA9IE1hdGguZmxvb3IocmJjIC8gMC41KSAqIDAuNTtcclxuICAgICAgICAgICAgaWYocmJjICE9PSBNYXRoLmZsb29yKHJiYyAvIDAuNSkgKiAwLjUpe1xyXG4gICAgICAgICAgICAgICAgdGhpcy5iZWF0SW5uZXJDb3VudFsxXSA9IDE7XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgdGhpcy5iZWF0SW5uZXJDb3VudFsxXSA9IDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5iZWF0SW5uZXJDb3VudFsxXSsrO1xyXG4gICAgICAgIGlmKHRoaXMuYmVhdElubmVyQ291bnRbMV0gPiAyKXtcclxuICAgICAgICAgICAgdGhpcy5wcmVUaW1lID0gKHRoaXMuYmVhdElubmVyQ291bnRbMF0gKyAwLjI1KSAqIHRoaXMubWlsbGlTZWNvbmRQZXJCZWF0IC0gdGhpcy5zdGFydFRpbWVPZmZzZXQ7XHJcbiAgICAgICAgICAgIHRoaXMucmVjZWl2ZUludGVydmFsID0gbnVsbDtcclxuICAgICAgICAgICAgdGhpcy5yYXdEYXRhID0gW107XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYodGhpcy5ub3RlUmF3RGF0YSl7XHJcbiAgICAgICAgICAgIGxldCBiYyA9IHJiYyAtIHRoaXMudGltZVRvQmVhdENvdW50KHRoaXMucHJlVGltZSArIHRoaXMuc3RhcnRUaW1lT2Zmc2V0KTtcclxuICAgICAgICAgICAgbGV0IG52O1xyXG4gICAgICAgICAgICBpZihiYyA8PSAwKXtcclxuICAgICAgICAgICAgICAgIG52ID0gMTY7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnByZVRpbWUgPSAodGhpcy50aW1lVG9CZWF0Q291bnQodGhpcy5yYXdEYXRhWzBdWzJdICsgdGhpcy5zdGFydFRpbWVPZmZzZXQpICsgMC4yNSkgKiB0aGlzLm1pbGxpU2Vjb25kUGVyQmVhdCAtIHRoaXMuc3RhcnRUaW1lT2Zmc2V0O1xyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIG52ID0gdGhpcy5sZW5ndGhQZXJCZWF0IC8gYmM7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnByZVRpbWUgPSB0aGlzLnJhd0RhdGFbMF1bMl07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5ub3RlUmF3RGF0YS5ub3RlVmFsdWUgPSBudjtcclxuICAgICAgICAgICAgdGhpcy5ub3RlUmF3RGF0YS51c2VyRGF0YSA9IG51bGw7XHJcbiAgICAgICAgICAgIHRoaXMuY2FsbGJhY2tzW1wicGFja05vdGVcIl0uY2FsbEFsbCh0aGlzLm5vdGVSYXdEYXRhKTtcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgaWYocmJjICE9PSAwKXtcclxuICAgICAgICAgICAgICAgIGxldCBiYyA9IHJiYztcclxuICAgICAgICAgICAgICAgIGxldCBudiA9IHRoaXMubGVuZ3RoUGVyQmVhdCAvIGJjO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5ub3RlUmF3RGF0YSA9IG5ldyBOb3RlKHtub3RlVmFsdWU6IG52LCBzdHJpbmdDb250ZW50OiBbLTEsIC0xLCAtMSwgLTEsIC0xLCAtMV19KTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2FsbGJhY2tzW1wicGFja05vdGVcIl0uY2FsbEFsbCh0aGlzLm5vdGVSYXdEYXRhKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnByZVRpbWUgPSB0aGlzLnJhd0RhdGFbMF1bMl07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMubm90ZVJhd0RhdGEgPSBuZXcgTm90ZSh7bm90ZVZhbHVlOiA0LCBzdHJpbmdDb250ZW50OiBub3RlcywgdXNlckRhdGE6IFwidW5kZWZpbmVkLXZhbHVlXCJ9KTtcclxuICAgICAgICB0aGlzLnJhd0RhdGEgPSBbXTtcclxuICAgICAgICB0aGlzLnJlY2VpdmVJbnRlcnZhbCA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5jYWxsYmFja3NbXCJwYWNrTm90ZVwiXS5jYWxsQWxsKHRoaXMubm90ZVJhd0RhdGEpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgdGltZVRvQmVhdENvdW50KHRpbWU6IG51bWJlcil7XHJcbiAgICAgICAgbGV0IHJhdGlvID0gWzMsIDFdO1xyXG4gICAgICAgIGxldCB1bml0ID0gdGhpcy5taWxsaVNlY29uZFBlckJlYXQvKDIqKHJhdGlvWzBdICsgcmF0aW9bMV0pKTtcclxuICAgICAgICBsZXQgcmFuZ2UgPSBbdW5pdCAqIHJhdGlvWzBdLzJdO1xyXG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCAzOyBpKyspcmFuZ2UucHVzaChyYW5nZVtpXSArIHJhdGlvWyhpKzEpJTJdKnVuaXQpO1xyXG5cclxuICAgICAgICBsZXQgYmVhdCA9IHRpbWUgLyB0aGlzLm1pbGxpU2Vjb25kUGVyQmVhdDtcclxuICAgICAgICBsZXQgYmQgPSBNYXRoLmZsb29yKGJlYXQpO1xyXG4gICAgICAgIGxldCBiY3MgPSAoYmVhdCAtIGJkKSAqIHRoaXMubWlsbGlTZWNvbmRQZXJCZWF0O1xyXG4gICAgICAgIGxldCBiYyA9IDQ7XHJcbiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IDQ7IGkrKyl7XHJcbiAgICAgICAgICAgIGlmKGJjcyA8IHJhbmdlW2ldKXtcclxuICAgICAgICAgICAgICAgIGJjID0gaTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBiZCArIGJjICogMC4yNTtcclxuICAgIH1cclxufSJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFjQTtBQWJBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFFQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/DataAdapter.ts\n");

/***/ }),

/***/ "./src/KeyBoardAdapter.ts":
/*!********************************!*\
  !*** ./src/KeyBoardAdapter.ts ***!
  \********************************/
/*! exports provided: KeyBoardAdapter */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"KeyBoardAdapter\", function() { return KeyBoardAdapter; });\n//A4 = midi note key 69, frequence 440HZ, 12 for a Octave\r\nlet stringFrequency = [329.63, 246.94, 196, 146.83, 110, 82.41];\r\nlet A4Key = 69;\r\nlet A4Frequency = 440;\r\nlet octaveSetp = 12;\r\nclass KeyBoardAdapter {\r\n    constructor() {\r\n        this.unit = Math.pow(Math.E, Math.log(2) / octaveSetp);\r\n    }\r\n    noteKeyToFrequency(noteKey) {\r\n        let dif = noteKey - A4Key;\r\n        return Math.pow(this.unit, dif) * A4Frequency;\r\n    }\r\n    /**\r\n     * convert freqency to string index and block index\r\n     * @param freq frequency\r\n     * @returns [ string index, block index]\r\n     */\r\n    frequencyToStringData(freq) {\r\n        let string = stringFrequency.length - 1;\r\n        for (let i = 0; i < stringFrequency.length; i++) {\r\n            if (freq >= stringFrequency[i]) {\r\n                string = i;\r\n                break;\r\n            }\r\n        }\r\n        let block = Math.floor(Math.log(freq / stringFrequency[string]) / Math.log(this.unit));\r\n        return [string, block];\r\n    }\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvS2V5Qm9hcmRBZGFwdGVyLnRzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vc3JjL0tleUJvYXJkQWRhcHRlci50cz83ZWQ1Il0sInNvdXJjZXNDb250ZW50IjpbIi8vQTQgPSBtaWRpIG5vdGUga2V5IDY5LCBmcmVxdWVuY2UgNDQwSFosIDEyIGZvciBhIE9jdGF2ZVxyXG5sZXQgc3RyaW5nRnJlcXVlbmN5ID0gWzMyOS42MywgMjQ2Ljk0LCAxOTYsIDE0Ni44MywgMTEwLCA4Mi40MV07XHJcbmxldCBBNEtleSA9IDY5O1xyXG5sZXQgQTRGcmVxdWVuY3kgPSA0NDA7XHJcbmxldCBvY3RhdmVTZXRwID0gMTI7XHJcblxyXG5leHBvcnQgY2xhc3MgS2V5Qm9hcmRBZGFwdGVyIHtcclxuICAgIHByaXZhdGUgdW5pdCA9IE1hdGgucG93KE1hdGguRSwgTWF0aC5sb2coMikgLyBvY3RhdmVTZXRwKTtcclxuICAgIG5vdGVLZXlUb0ZyZXF1ZW5jeShub3RlS2V5OiBudW1iZXIpOiBudW1iZXJ7XHJcbiAgICAgICAgbGV0IGRpZiA9IG5vdGVLZXkgLSBBNEtleTtcclxuICAgICAgICByZXR1cm4gTWF0aC5wb3codGhpcy51bml0LCBkaWYpICogQTRGcmVxdWVuY3k7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIGNvbnZlcnQgZnJlcWVuY3kgdG8gc3RyaW5nIGluZGV4IGFuZCBibG9jayBpbmRleFxyXG4gICAgICogQHBhcmFtIGZyZXEgZnJlcXVlbmN5XHJcbiAgICAgKiBAcmV0dXJucyBbIHN0cmluZyBpbmRleCwgYmxvY2sgaW5kZXhdXHJcbiAgICAgKi9cclxuICAgIGZyZXF1ZW5jeVRvU3RyaW5nRGF0YShmcmVxOiBudW1iZXIpOiBbbnVtYmVyLCBudW1iZXJde1xyXG4gICAgICAgIGxldCBzdHJpbmcgPSBzdHJpbmdGcmVxdWVuY3kubGVuZ3RoIC0gMTtcclxuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgc3RyaW5nRnJlcXVlbmN5Lmxlbmd0aDsgaSsrKXtcclxuICAgICAgICAgICAgaWYoZnJlcSA+PSBzdHJpbmdGcmVxdWVuY3lbaV0pe1xyXG4gICAgICAgICAgICAgICAgc3RyaW5nID0gaTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBibG9jayA9IE1hdGguZmxvb3IoTWF0aC5sb2coZnJlcS9zdHJpbmdGcmVxdWVuY3lbc3RyaW5nXSkvTWF0aC5sb2codGhpcy51bml0KSk7XHJcbiAgICAgICAgcmV0dXJuIFtzdHJpbmcsIGJsb2NrXTtcclxuICAgIH1cclxufSJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUFBO0FBQ0E7QUFxQkE7QUFwQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/KeyBoardAdapter.ts\n");

/***/ }),

/***/ "./src/LiCAP.ts":
/*!**********************!*\
  !*** ./src/LiCAP.ts ***!
  \**********************/
/*! exports provided: LiCAP */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"LiCAP\", function() { return LiCAP; });\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./utils */ \"./src/utils.ts\");\n\r\nclass LiCAP {\r\n    /**\r\n     * ctor\r\n     * @param device valid MIDIInput\r\n     */\r\n    constructor(device) {\r\n        this.device = device;\r\n        this.callbacks = new _utils__WEBPACK_IMPORTED_MODULE_0__[\"Callbacks\"]([\"pick\", \"message\"]);\r\n        this.startTime = performance.now();\r\n        this.device.onmidimessage = this.onMessage.bind(this);\r\n    }\r\n    on(ename, cbk) {\r\n        if (ename in this.callbacks) {\r\n            this.callbacks[ename].push(cbk);\r\n        }\r\n    }\r\n    resetTimer() {\r\n        this.startTime = performance.now();\r\n    }\r\n    /**\r\n     * isSupported\r\n     * Check if LiCAP is supported by computer or not\r\n     */\r\n    static isSupported() {\r\n        return navigator.requestMIDIAccess;\r\n    }\r\n    /**\r\n     * enumerate\r\n     * Enumerate available LiCAP devices\r\n     */\r\n    static async enumerate() {\r\n        let ret = [];\r\n        if (LiCAP.isSupported()) {\r\n            let access = await navigator.requestMIDIAccess();\r\n            for (let input of access.inputs.values()) {\r\n                // console.log(input.name);\r\n                // chage this for normal midi device, chage this and LiCAPName for LiCAP device\r\n                if (input.name.match(/LiCAP MIDI Device/)) {\r\n                    ret.push(new LiCAP(input));\r\n                    console.log(`use ${input.name}`);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n    onMessage(e) {\r\n        // Simply parse the data\r\n        let stringIdx = e.data[0] & 0xF;\r\n        // TODO: \r\n        let string_base_id = [40, 45, 50, 55, 59, 64].reverse();\r\n        switch ((e.data[0] >> 4) & 0xF) {\r\n            case 8:\r\n                // note off\r\n                break;\r\n            case 9:\r\n                // note on\r\n                if (this.device.name !== LiCAP.LiCAPName) {\r\n                    this.callbacks[\"message\"].callAll(e);\r\n                }\r\n                else {\r\n                    this.callbacks[\"pick\"].callAll(stringIdx, e.data[1] - string_base_id[stringIdx], e.data[2] / 255, e.timeStamp); // string idex, note, amp, time stamp\r\n                }\r\n                break;\r\n        }\r\n    }\r\n}\r\nLiCAP.LiCAPName = \"LiCAP MIDI Device\";\r\n/*\r\n\r\n if(LiCAP.isSupported()) {\r\n     console.log(\"Your browser supports LiCAP\");\r\n\r\n     LiCAP.enumerate().then((devs) => {\r\n         if(devs.length > 0) {\r\n            \r\n             devs[0].on(\"pick\",\r\n                 (stringIdx, note, amp, time) => {\r\n                     console.log(stringIdx, note, time);\r\n             });\r\n         }\r\n     })\r\n } else {\r\n     console.log(\"Your browser does not support LiCAP\");\r\n}\r\n*/ \r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvTGlDQVAudHMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvTGlDQVAudHM/MTkxMiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0NhbGxiYWNrc30gZnJvbSAnLi91dGlscyc7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIExpQ0FQRGV2aWNlIHtcclxuICAgIC8qKlxyXG4gICAgICogb25cclxuICAgICAqIEV2ZW50IHJlZ2lzdGVyYXRpb24oc3VwcG9ydCBtdWx0aXBsZSBldmVudCByZWdpc3RlcmF0aW9uKVxyXG4gICAgICogQHBhcmFtIGVuYW1lIG5hbWUgb2YgdGhlIGV2ZW50XHJcbiAgICAgKiBAcGFyYW0gY2JrIGNhbGxiYWNrXHJcbiAgICAgKi9cclxuICAgIG9uKGVuYW1lOiBzdHJpbmcsIGNiazogKC4uLmFyZ3M6IGFueVtdKSA9PiB2b2lkKTogdm9pZDtcclxuICAgIHJlc2V0VGltZXIoKTogdm9pZDtcclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIExpQ0FQIGltcGxlbWVudHMgTGlDQVBEZXZpY2Uge1xyXG4gICAgcHJpdmF0ZSBkZXZpY2U6IFdlYk1pZGkuTUlESUlucHV0O1xyXG4gICAgcHJpdmF0ZSBjYWxsYmFja3M6IENhbGxiYWNrcztcclxuICAgIHN0YXRpYyBMaUNBUE5hbWU6IHN0cmluZyA9IFwiTGlDQVAgTUlESSBEZXZpY2VcIjtcclxuICAgIHByaXZhdGUgc3RhcnRUaW1lOiBudW1iZXI7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBjdG9yXHJcbiAgICAgKiBAcGFyYW0gZGV2aWNlIHZhbGlkIE1JRElJbnB1dFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGNvbnN0cnVjdG9yKGRldmljZTogV2ViTWlkaS5NSURJSW5wdXQpIHtcclxuICAgICAgICB0aGlzLmRldmljZSA9IGRldmljZTtcclxuICAgICAgICB0aGlzLmNhbGxiYWNrcyA9IG5ldyBDYWxsYmFja3MoW1wicGlja1wiLCBcIm1lc3NhZ2VcIl0pO1xyXG4gICAgICAgIHRoaXMuc3RhcnRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdGhpcy5kZXZpY2Uub25taWRpbWVzc2FnZSA9IHRoaXMub25NZXNzYWdlLmJpbmQodGhpcyk7XHJcbiAgICB9XHJcblxyXG4gICAgb24oZW5hbWU6IHN0cmluZywgY2JrOiAoLi4uYXJnczogYW55W10pID0+IHZvaWQpOiB2b2lkIHtcclxuICAgICAgICBpZihlbmFtZSBpbiB0aGlzLmNhbGxiYWNrcykge1xyXG4gICAgICAgICAgICB0aGlzLmNhbGxiYWNrc1tlbmFtZV0ucHVzaChjYmspO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXNldFRpbWVyKCl7XHJcbiAgICAgICAgdGhpcy5zdGFydFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogaXNTdXBwb3J0ZWRcclxuICAgICAqIENoZWNrIGlmIExpQ0FQIGlzIHN1cHBvcnRlZCBieSBjb21wdXRlciBvciBub3RcclxuICAgICAqL1xyXG4gICAgc3RhdGljIGlzU3VwcG9ydGVkKCk6IGJvb2xlYW4gfCBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiAobmF2aWdhdG9yIGFzIGFueSkucmVxdWVzdE1JRElBY2Nlc3MgYXMgYm9vbGVhbjtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIGVudW1lcmF0ZVxyXG4gICAgICogRW51bWVyYXRlIGF2YWlsYWJsZSBMaUNBUCBkZXZpY2VzXHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBhc3luYyBlbnVtZXJhdGUoKTogUHJvbWlzZTxBcnJheTxMaUNBUERldmljZT4+IHtcclxuICAgICAgICBsZXQgcmV0OiBBcnJheTxMaUNBUERldmljZT4gPSBbXTtcclxuXHJcbiAgICAgICAgaWYoTGlDQVAuaXNTdXBwb3J0ZWQoKSkge1xyXG4gICAgICAgICAgICBsZXQgYWNjZXNzID0gYXdhaXQgbmF2aWdhdG9yLnJlcXVlc3RNSURJQWNjZXNzKCk7XHJcblxyXG4gICAgICAgICAgICBmb3IobGV0IGlucHV0IG9mIGFjY2Vzcy5pbnB1dHMudmFsdWVzKCkpIHtcclxuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGlucHV0Lm5hbWUpO1xyXG4gICAgICAgICAgICAgICAgLy8gY2hhZ2UgdGhpcyBmb3Igbm9ybWFsIG1pZGkgZGV2aWNlLCBjaGFnZSB0aGlzIGFuZCBMaUNBUE5hbWUgZm9yIExpQ0FQIGRldmljZVxyXG4gICAgICAgICAgICAgICAgaWYoaW5wdXQubmFtZS5tYXRjaCgvTGlDQVAgTUlESSBEZXZpY2UvKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldC5wdXNoKG5ldyBMaUNBUChpbnB1dCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGB1c2UgJHtpbnB1dC5uYW1lfWApO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXQ7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBvbk1lc3NhZ2UoZTogV2ViTWlkaS5NSURJTWVzc2FnZUV2ZW50KTogdm9pZCB7XHJcbiAgICAgICAgLy8gU2ltcGx5IHBhcnNlIHRoZSBkYXRhXHJcbiAgICAgICAgbGV0IHN0cmluZ0lkeCA9IGUuZGF0YVswXSAmIDB4RjtcclxuICAgICAgICAvLyBUT0RPOiBcclxuICAgICAgICBsZXQgc3RyaW5nX2Jhc2VfaWQgPSBbNDAsIDQ1LCA1MCwgNTUsIDU5LCA2NF0ucmV2ZXJzZSgpO1xyXG4gICAgICAgIHN3aXRjaCgoZS5kYXRhWzBdPj40KSAmIDB4Rikge1xyXG4gICAgICAgICAgICBjYXNlIDg6XHJcbiAgICAgICAgICAgICAgICAvLyBub3RlIG9mZlxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgOTpcclxuICAgICAgICAgICAgICAgIC8vIG5vdGUgb25cclxuICAgICAgICAgICAgICAgIGlmKHRoaXMuZGV2aWNlLm5hbWUgIT09IExpQ0FQLkxpQ0FQTmFtZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jYWxsYmFja3NbXCJtZXNzYWdlXCJdLmNhbGxBbGwoZSk7XHJcbiAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNhbGxiYWNrc1tcInBpY2tcIl0uY2FsbEFsbChzdHJpbmdJZHgsIGUuZGF0YVsxXS1zdHJpbmdfYmFzZV9pZFtzdHJpbmdJZHhdLCBlLmRhdGFbMl0gLyAyNTUsIGUudGltZVN0YW1wKTsvLyBzdHJpbmcgaWRleCwgbm90ZSwgYW1wLCB0aW1lIHN0YW1wXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICB9XHJcbn1cclxuLypcclxuXHJcbiBpZihMaUNBUC5pc1N1cHBvcnRlZCgpKSB7XHJcbiAgICAgY29uc29sZS5sb2coXCJZb3VyIGJyb3dzZXIgc3VwcG9ydHMgTGlDQVBcIik7XHJcblxyXG4gICAgIExpQ0FQLmVudW1lcmF0ZSgpLnRoZW4oKGRldnMpID0+IHtcclxuICAgICAgICAgaWYoZGV2cy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgZGV2c1swXS5vbihcInBpY2tcIiwgXHJcbiAgICAgICAgICAgICAgICAgKHN0cmluZ0lkeCwgbm90ZSwgYW1wLCB0aW1lKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHN0cmluZ0lkeCwgbm90ZSwgdGltZSk7XHJcbiAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgfVxyXG4gICAgIH0pXHJcbiB9IGVsc2Uge1xyXG4gICAgIGNvbnNvbGUubG9nKFwiWW91ciBicm93c2VyIGRvZXMgbm90IHN1cHBvcnQgTGlDQVBcIik7XHJcbn1cclxuKi8iXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBYUE7QUFNQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7OztBQUdBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBOztBQTFFQTtBQTRFQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7O0FBZ0JBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/LiCAP.ts\n");

/***/ }),

/***/ "./src/LiCAPStream.ts":
/*!****************************!*\
  !*** ./src/LiCAPStream.ts ***!
  \****************************/
/*! exports provided: LiCAPStream */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"LiCAPStream\", function() { return LiCAPStream; });\nclass LiCAPStream {\r\n    constructor() {\r\n        this.ctx = new AudioContext();\r\n        this.sampleRate = 32000;\r\n        this.startAt = 0;\r\n        this.wsL = new WebSocket(\"ws://localhost:9002/LiCAP/L/subscribe\");\r\n        this.wsR = new WebSocket(\"ws://localhost:9002/LiCAP/R/subscribe\");\r\n        this.wsL.binaryType = \"arraybuffer\";\r\n        this.wsR.binaryType = \"arraybuffer\";\r\n    }\r\n    play() {\r\n        this.wsL.onmessage = (event) => {\r\n            let floats = new Float32Array(event.data);\r\n            let source = this.ctx.createBufferSource();\r\n            let buffer = this.ctx.createBuffer(1, floats.length, this.sampleRate);\r\n            buffer.getChannelData(0).set(floats);\r\n            source.buffer = buffer;\r\n            source.connect(this.ctx.destination);\r\n            this.startAt = Math.max(this.ctx.currentTime, this.startAt);\r\n            source.start(this.startAt);\r\n            this.startAt += buffer.duration;\r\n        };\r\n    }\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvTGlDQVBTdHJlYW0udHMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvTGlDQVBTdHJlYW0udHM/MzdjYSJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY2xhc3MgTGlDQVBTdHJlYW0ge1xyXG4gICAgcHJpdmF0ZSBjdHg6IEF1ZGlvQ29udGV4dDtcclxuICAgIHByaXZhdGUgd3NMOiBXZWJTb2NrZXQ7XHJcbiAgICBwcml2YXRlIHdzUjogV2ViU29ja2V0O1xyXG4gICAgcHJpdmF0ZSBzYW1wbGVSYXRlOiBudW1iZXI7XHJcbiAgICBwcml2YXRlIHN0YXJ0QXQ6IG51bWJlcjtcclxuXHJcblxyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy5jdHggPSBuZXcgQXVkaW9Db250ZXh0KCk7XHJcbiAgICAgICAgdGhpcy5zYW1wbGVSYXRlID0gMzIwMDA7XHJcbiAgICAgICAgdGhpcy5zdGFydEF0ID0gMDtcclxuXHJcbiAgICAgICAgdGhpcy53c0wgPSBuZXcgV2ViU29ja2V0KFwid3M6Ly9sb2NhbGhvc3Q6OTAwMi9MaUNBUC9ML3N1YnNjcmliZVwiKTtcclxuICAgICAgICB0aGlzLndzUiA9IG5ldyBXZWJTb2NrZXQoXCJ3czovL2xvY2FsaG9zdDo5MDAyL0xpQ0FQL1Ivc3Vic2NyaWJlXCIpO1xyXG5cclxuICAgICAgICB0aGlzLndzTC5iaW5hcnlUeXBlID0gXCJhcnJheWJ1ZmZlclwiO1xyXG4gICAgICAgIHRoaXMud3NSLmJpbmFyeVR5cGUgPSBcImFycmF5YnVmZmVyXCI7XHJcbiAgICB9XHJcblxyXG4gICAgcGxheSgpIHtcclxuXHJcbiAgICAgICAgdGhpcy53c0wub25tZXNzYWdlID0gKGV2ZW50KSA9PiB7XHJcblxyXG4gICAgICAgICAgICBsZXQgZmxvYXRzID0gbmV3IEZsb2F0MzJBcnJheShldmVudC5kYXRhKTtcclxuICAgICAgICAgICAgbGV0IHNvdXJjZSA9IHRoaXMuY3R4LmNyZWF0ZUJ1ZmZlclNvdXJjZSgpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgbGV0IGJ1ZmZlciA9IHRoaXMuY3R4LmNyZWF0ZUJ1ZmZlcigxLCBmbG9hdHMubGVuZ3RoLCB0aGlzLnNhbXBsZVJhdGUpO1xyXG4gICAgICAgICAgICBidWZmZXIuZ2V0Q2hhbm5lbERhdGEoMCkuc2V0KGZsb2F0cyk7XHJcbiAgICAgICAgICAgIHNvdXJjZS5idWZmZXIgPSBidWZmZXI7XHJcbiAgICAgICAgICAgIHNvdXJjZS5jb25uZWN0KHRoaXMuY3R4LmRlc3RpbmF0aW9uKTtcclxuICAgICAgICAgICAgdGhpcy5zdGFydEF0ID0gTWF0aC5tYXgodGhpcy5jdHguY3VycmVudFRpbWUsIHRoaXMuc3RhcnRBdCk7XHJcbiAgICAgICAgICAgIHNvdXJjZS5zdGFydCh0aGlzLnN0YXJ0QXQpO1xyXG4gICAgICAgICAgICB0aGlzLnN0YXJ0QXQgKz0gYnVmZmVyLmR1cmF0aW9uO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbn0iXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/LiCAPStream.ts\n");

/***/ }),

/***/ "./src/Metronome.ts":
/*!**************************!*\
  !*** ./src/Metronome.ts ***!
  \**************************/
/*! exports provided: Metronome */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Metronome\", function() { return Metronome; });\nclass Metronome {\r\n    constructor(bpm) {\r\n        this.bpm = 120;\r\n        this.timeOffset = 0.05;\r\n        this.audioStartTime = -1; // start time in audioContext, unit in milli second\r\n        this.startTime = -1; // start time in performance.now(), unit in milli second\r\n        this.mode = \"\";\r\n        this.scheduleOsc = [];\r\n        this.beatCount = 0;\r\n        this.startTimeOffset = 0.1; // unit in second\r\n        this.audioContext = new AudioContext();\r\n        if (bpm)\r\n            this.bpm = bpm;\r\n        this.gainNode = this.audioContext.createGain();\r\n        this.gainNode.gain.value = 1.5;\r\n        this.gainNode.connect(this.audioContext.destination);\r\n        this.base64toAudioBuffer(beep).then(decodeBuffer => this.sound = decodeBuffer);\r\n        this.base64toAudioBuffer(beep2).then(decodeBuffer => this.sound2 = decodeBuffer);\r\n    }\r\n    startTick() {\r\n        this.clearScheduleOsc();\r\n        this.mode = \"click\";\r\n        if (!this.tickTimer) {\r\n            let cycleTime = 60 / this.bpm;\r\n            this.audioContext.suspend();\r\n            let at = this.audioContext.currentTime + this.startTimeOffset;\r\n            this.nextTime = at + cycleTime;\r\n            this.tickTimer = -1 * setTimeout(() => {\r\n                this.tick();\r\n                this.tickTimer = setInterval(() => this.tick(), cycleTime * 1000);\r\n            }, cycleTime * 1000 - this.timeOffset * 1000);\r\n            this.makeSound(at);\r\n            this.audioContext.resume();\r\n        }\r\n    }\r\n    stopTick() {\r\n        if (this.tickTimer < 0) {\r\n            clearTimeout(-1 * this.tickTimer);\r\n        }\r\n        else {\r\n            clearInterval(this.tickTimer);\r\n        }\r\n        this.audioContext.suspend();\r\n        this.clearScheduleOsc();\r\n        this.tickTimer = null;\r\n        this.startTime = -1;\r\n        this.audioStartTime = -1;\r\n        this.beatCount = 0;\r\n    }\r\n    setBpm(bpm) {\r\n        this.bpm = bpm;\r\n    }\r\n    scheduleTick(time, type = \"normal\") {\r\n        if (this.mode === \"click\") {\r\n            this.stopTick();\r\n            this.mode = \"schedule\";\r\n        }\r\n        if (this.startTime >= 0) {\r\n            console.warn(\"Cannot schedule tick before stop tick(call stopTick())\");\r\n            return;\r\n        }\r\n        let scheduleTime = this.audioContext.currentTime * 1000 + time;\r\n        if (this.audioStartTime < 0)\r\n            this.audioStartTime = scheduleTime;\r\n        if (type === \"normal\") {\r\n            this.makeSound(scheduleTime / 1000);\r\n        }\r\n        else {\r\n            this.makeSound(scheduleTime / 1000, this.sound2);\r\n        }\r\n    }\r\n    play() {\r\n        if (this.startTime >= 0)\r\n            return -1;\r\n        if (this.scheduleOsc.length < 1) {\r\n            console.warn(\"no tick is scheduled\");\r\n            return -1;\r\n        }\r\n        this.startTime = this.audioStartTime - this.audioContext.currentTime * 1000 + performance.now();\r\n        this.audioContext.resume();\r\n        return this.startTime;\r\n    }\r\n    getStartTime() {\r\n        return this.startTime;\r\n    }\r\n    base64toAudioBuffer(b64string) {\r\n        return fetch(b64string)\r\n            .then(res => res.arrayBuffer())\r\n            .then(buffer => this.audioContext.decodeAudioData(buffer));\r\n    }\r\n    clearScheduleOsc() {\r\n        for (let i = 0; i < this.scheduleOsc.length; i++) {\r\n            this.scheduleOsc[i].disconnect();\r\n        }\r\n        this.scheduleOsc = [];\r\n    }\r\n    tick() {\r\n        let at = this.audioContext.currentTime;\r\n        let cycleTime = 60 / this.bpm;\r\n        if (at > this.nextTime) {\r\n            this.timeOffset += 0.05;\r\n            this.makeSound(at + this.timeOffset);\r\n            this.nextTime = at + this.timeOffset + cycleTime;\r\n        }\r\n        else {\r\n            this.makeSound(this.nextTime);\r\n            this.nextTime += cycleTime;\r\n        }\r\n        at = this.audioContext.currentTime;\r\n        if (this.beatCount === 4) {\r\n            // there, this.nextTime is the time of 5th beat after above process\r\n            this.startTime = performance.now() + (this.nextTime - at) * 1000;\r\n        }\r\n        if (this.scheduleOsc.length > 10)\r\n            this.scheduleOsc.shift();\r\n    }\r\n    makeSound(startTime, sound = this.sound) {\r\n        let osc = this.audioContext.createBufferSource();\r\n        if (this.beatCount % 4 === 0 && this.mode === \"click\") {\r\n            sound = this.sound2;\r\n        }\r\n        osc.buffer = sound;\r\n        osc.connect(this.gainNode);\r\n        osc.start(startTime);\r\n        osc.stop(startTime + 0.05);\r\n        this.beatCount++;\r\n        this.scheduleOsc.push(osc);\r\n        return osc;\r\n    }\r\n}\r\nlet beep = \"data:audio/wav;base64,UklGRhAHAABXQVZFZm10IBAAAAABAAIARKwAABCxAgAEABAAZGF0YegGAAD6/wQA+v8AADoA6v8k/1YAMgB+/koD6gAuAJQEFPu0/Yr+0vkYAVb/VgB4AQYClgFuBfIERATsBvj9GAPQ+fT6oPoo9xL94Pd+/h77mv/s/5QBVgPWA84DJAUcBOAFngZoBkwILgOYBtT+jgB6/Fb6evhm+wrzBv7Y8yz40vxm8z4D8vKIA071lgT0/IgHeAl0CfIUsgpQHMYK+h+KCwIZTAkqCIQBJvd+9qjpVOoI38TfkNqa2sTdtt0k4troGuCg96TgWAdG7XIUfgL0GtwZJiFcLsIsKjx4MyY/tC/sQaIkzkK0EmQ1YP4WH8zyvgUy8S7oWO2E1XrkHNXq35TWDOFI1DrgatV64IjUtuc60QjqKNhQ6VrlmvFK7Sr8uPLE+mb7Du+CAATlIPtO5J7vIOpc31T2uNOKBHrcAguW9fIKdhBUEsgsrimyR8hEGlSYVNBWxlVkWg9LXVz/OUBXGitpSBgjRS/ZHcoSAhIy/ZL/zvNi7gXy4+HQ7oXZYejt1eLinNWH3IDTbdDm0UHFxdVTxUXXS8wAzlrQL8LOzgW+zMHlwFSoCcW+mFTKiKFn0jK7ttui2sjm8/bN93IM8gN1Bz0KHgs1DtsNjg85EKYQaRKMEvETuxPnE80S1xFYEOoOzQ1KDT4MVQ1iDKQNzg3cDX8Otw7sDE0PjglDDVIFZwi2AbkCYv+u/vH8dfxw+b/5SPVt9UDw1O/R6n7q3+at58rleud85ovokOc56mXpAOwJ7HjtAe9E7hLyY++J9T/y1flP9rz+z/koA3D8RAZY/0wIywLCCSgGUAsQCkQO5w6dEkcTKBaiFngXBxpGF9wcsRbSHLwVrxlFFL8VsRKSEvwQsg9+DnQMqAoYCbMF9QXZAAYDifwPAGL4zfyy9HX5oPFb9nXuWfM36yHwhui27Bjndekw55bmBOiX5OLoUORK6rDlbOyy57vuyOkW8p3sOvfC8Bn9SvZJAi79LgYpBBoJQwmgC6cM7g0SD+EP8g9HEdIPXBJsEFsT0RGwExMTRRMjFPASLhUcE9QVORP6FYISkxV6EBkU1QyMEQMIRw4nA90JpP4eBEb6xv079tj3fPIB88jui+/a61TtZOpi6wfqC+l66lHn2euE57LtXulT79Xrz/Ci7rTyhvEo9Zzzjvdz9K359/Qr/Jj2NP+q+VUCef2hBbEBHAlWBkYM/ArMDgYP/hBUEigTIBXeFFoXbRWdGJ8UqBjHEm0XKhDlFCoNbBFOCswNtQejCiMFDQidArsFOAA2A9T9OwBx++L8Dvmd+Y/27fY/9Nf0hPLe8iPx3fCx7+HuTe7S7HDt8ep17fPpk+5l6rDwROxp8/buV/br8UP5FfVH/Mj4Vv/z/DgC9wAbBWgE+wcjB14KHwnVC6kKhAw3DO8M3A1jDU4P0w1VEAsO4RDmDf8QgQ3TENUMbxC3C7EPTwplDr4IZwzIBrAJQASCBkABFgMe/of/H/sY/Gf4/fgp9kD2iPT68zjzH/IP8rTwefHE753xVu8j8nbv7vIY8AP0DvFS9VDy5fbH87b4ZvWq+kP3s/xy+d7+DfwwAQn/egMDAoYFugRHBz4HxAiCCQAKVQsQC7MMAwy4DbUMeg7LDOcONgzlDjwLcg4TCo0N0AgvDH0HbQr2BX8IDQR+BtkBXQSq/wsCrf2E/9T79fwa+on6l/hM+Er3X/Y59vf0ifUS9D/1evNN9TDzt/VF82v2nvNK9070WviA9a35H/ck++z4r/yf+lT+IPz4/6r9hwF5//UCYgE1BEIDTAUWBUgGvgYhBwcIvgfvCBYIlgknCPwJ6wcACnUHqwnNBiYJ+AVwCAEFcAfsAyIGuAKpBHkBJANLALcBPP9uAEz+L/91/eX9o/yl/Nb7k/sn+8z6p/pD+mP63vlf+o/5ifpW+cz6TPko+4n5ofsG+jr8sPr//H775/1i/NX+VP2y/1j+dQBr/x0BfgC1AXcBQAJDArwC1gIcAzsDTwOEA1YDuwNEA+UDKwP5AwwD6gPbArcDlQJjAz4C+wLZAY0CbAEhAv8AtAGSAEABHgC6AKf/JwA2/5T/1f4N/4f+of5N/lL+K/4a/hv+9/0b/uP9Kv7f/Un+7v10/hL+pv5E/t3+ev4W/7b+U//4/pD/PP/H/3v/+f+1/ycA6/9RACAAdABRAI8AewCiAJoArgCvALQAvQC0AMUAsADGAKgAwQCYALUAhACjAG0AjABVAHQAPgBaACkAQAAWACkABQAVAPf/BADs//j/5P/u/9//5//d/+L/3f/f/97/3//h/+D/5f/j/+n/5//u/+v/8v/v//b/9P/5//f//P/6//7//f////7/AAD//wAAAAAAAAAA\";\r\nlet beep2 = \"data:audio/wav;base64,UklGRuYDAABXQVZFZm10IBAAAAABAAEAgLsAAAB3AQACABAAZGF0Yb4DAADw/wAAGAAgAOD+AP0I/Bj7OPr4+Uj5gPhw+BD4gPeQ96j5qPyo/vj9GPwo++j8wP9oAbAC6AOIBBADgADI/kj96PtI+9AB0AtgEYAZyCK4JlAimBkgBmjwAOUI3gDZKNco3LjlEO2o/CAQqBr4FqAM2ASw+njvCOpA+JAPOBzYDejzUOYw8PACmA1IEGAQkA8IC2AE8P44+rj2iPnQ7iDaQNOQ3QjscO6g57DjCOlA8qDzQPHY8QjzGPswBoANSBfAIGgooD52V+Ze1lDAOmgoFyAnHqYgpSCVG7YQ3wJp+br5vfEb4kHZ7tNr0JfP6sQWtxizELpLwR/KP9Wy4ZfwtfwLA+IPax58I1QaagxnA/AIoRXaFngM4wPRAc4EbwYrBQv4COl447jfxN604WfpJfRs+zD85Pzn/tcG/hXtILYm2S6MM8s0QStrH58fDiZgKXkm+R1yFEAPigbL/2H9Afvz9+D0mei/3XHX29cS3pfhzuYu7FbqU+i06cXshfNp+w8AcAl6E4oXdRIsDqEN7A09Do4OhAnmDh0ZnxqUFMgMWgNH8QjjNuBi5LbrH/G98bbxvfJ99pL+PgUqAtr5LPRF+0AJsxKtGnAd8hqTEtQKoAeXEoUcDh0TGsQTJg5OB+gBtADY/zEBQQPIAon88fU48rzsF+mJ6VbtH/Iy9fT5u/74AHcILBHCFJATnQ8IDKYVwiLxJ7keYBCoB/kCCQIqAzkD2ADm/Sr5CvUu9CjuuOeo4mLhsuQB7p/3T/x7/Qb+nP7wAysK2gxzDEgNLA4KEN4QQw9pCjECzvve+nz9zgCM/2n70/hn/SEFxAo3Cz8GyP/q/VUCeghMDbwPTw4wCjgF9gJNAwkH1wt4DWULBwhQBdkC5/3o+Rj5j/q//G/+H/kG8qPvHfKi9ur6LP45/37+6PnG9Zr1aPkF/rEABACJ/cT7QwDzBgQKyghbBfwATv7Q+277Mf2F//QAawEFA4YFugaiBaADmgKoAEP/Vf9B/j78xPrU+0/+UQBxAdsASP+j/g8ABQJhA10D8gHh//z+3P8OAd8BQAJjA0YEEgRDAzwBK/8n/S/8qvzI/eH+iv+D/3T+h/1P/g8ASQF0AJ/+a/0g/osApgJ3A/QCsgGRAC4A+f9UAN8AFwHNAGcAcwAjAKb/av/W/mL+SP57/g//tv/t/1j/of5q/k3+Tv6f/rb+mv6U/uf+ZP/I/xkASQBCAEgAYwB2AHgAZwBJADwAOwAzAAYA0v/B/83/3//w/wIADgAOAAcA\";\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvTWV0cm9ub21lLnRzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vc3JjL01ldHJvbm9tZS50cz9iY2E4Il0sInNvdXJjZXNDb250ZW50IjpbInR5cGUgdGlja1dlaWdodCA9IFwibm9ybWFsXCIgfCBcInN0cm9uZ1wiO1xyXG50eXBlIG1vZGUgPSBcImNsaWNrXCIgfCBcInNjaGVkdWxlXCIgfCBcIlwiO1xyXG5leHBvcnQgY2xhc3MgTWV0cm9ub21lIHtcclxuICAgIHByaXZhdGUgYXVkaW9Db250ZXh0OiBBdWRpb0NvbnRleHQ7XHJcbiAgICBwcml2YXRlIG5leHRUaW1lOiBudW1iZXI7XHJcbiAgICBwcml2YXRlIGdhaW5Ob2RlOiBHYWluTm9kZTtcclxuICAgIHByaXZhdGUgdGlja1RpbWVyOiBudW1iZXI7XHJcbiAgICBwcml2YXRlIGJwbTogbnVtYmVyID0gMTIwO1xyXG4gICAgcHJpdmF0ZSB0aW1lT2Zmc2V0ID0gMC4wNTtcclxuICAgIHByaXZhdGUgc291bmQ6IEF1ZGlvQnVmZmVyO1xyXG4gICAgcHJpdmF0ZSBzb3VuZDI6IEF1ZGlvQnVmZmVyO1xyXG4gICAgcHJpdmF0ZSBhdWRpb1N0YXJ0VGltZTogbnVtYmVyID0gLTE7IC8vIHN0YXJ0IHRpbWUgaW4gYXVkaW9Db250ZXh0LCB1bml0IGluIG1pbGxpIHNlY29uZFxyXG4gICAgcHJpdmF0ZSBzdGFydFRpbWU6IG51bWJlciA9IC0xOyAvLyBzdGFydCB0aW1lIGluIHBlcmZvcm1hbmNlLm5vdygpLCB1bml0IGluIG1pbGxpIHNlY29uZFxyXG4gICAgcHJpdmF0ZSBtb2RlOiBtb2RlID0gXCJcIjtcclxuICAgIHByaXZhdGUgc2NoZWR1bGVPc2M6IEF1ZGlvQnVmZmVyU291cmNlTm9kZVtdID0gW107XHJcbiAgICBwcml2YXRlIGJlYXRDb3VudCA9IDA7XHJcbiAgICBwcml2YXRlIHN0YXJ0VGltZU9mZnNldCA9IDAuMTsvLyB1bml0IGluIHNlY29uZFxyXG4gICAgY29uc3RydWN0b3IoYnBtOiBudW1iZXIpe1xyXG4gICAgICAgIHRoaXMuYXVkaW9Db250ZXh0ID0gbmV3IEF1ZGlvQ29udGV4dCgpO1xyXG4gICAgICAgIGlmKGJwbSl0aGlzLmJwbSA9IGJwbTtcclxuICAgICAgICB0aGlzLmdhaW5Ob2RlID0gdGhpcy5hdWRpb0NvbnRleHQuY3JlYXRlR2FpbigpO1xyXG4gICAgICAgIHRoaXMuZ2Fpbk5vZGUuZ2Fpbi52YWx1ZSA9IDEuNTtcclxuICAgICAgICB0aGlzLmdhaW5Ob2RlLmNvbm5lY3QodGhpcy5hdWRpb0NvbnRleHQuZGVzdGluYXRpb24pO1xyXG4gICAgICAgIHRoaXMuYmFzZTY0dG9BdWRpb0J1ZmZlcihiZWVwKS50aGVuKGRlY29kZUJ1ZmZlciA9PiB0aGlzLnNvdW5kID0gZGVjb2RlQnVmZmVyKTtcclxuICAgICAgICB0aGlzLmJhc2U2NHRvQXVkaW9CdWZmZXIoYmVlcDIpLnRoZW4oZGVjb2RlQnVmZmVyID0+IHRoaXMuc291bmQyID0gZGVjb2RlQnVmZmVyKTtcclxuICAgIH1cclxuICAgIHN0YXJ0VGljaygpe1xyXG4gICAgICAgIHRoaXMuY2xlYXJTY2hlZHVsZU9zYygpO1xyXG4gICAgICAgIHRoaXMubW9kZSA9IFwiY2xpY2tcIjtcclxuICAgICAgICBpZighdGhpcy50aWNrVGltZXIpe1xyXG4gICAgICAgICAgICBsZXQgY3ljbGVUaW1lID0gNjAgLyB0aGlzLmJwbTtcclxuICAgICAgICAgICAgdGhpcy5hdWRpb0NvbnRleHQuc3VzcGVuZCgpO1xyXG4gICAgICAgICAgICBsZXQgYXQgPSB0aGlzLmF1ZGlvQ29udGV4dC5jdXJyZW50VGltZSArIHRoaXMuc3RhcnRUaW1lT2Zmc2V0O1xyXG4gICAgICAgICAgICB0aGlzLm5leHRUaW1lID0gYXQgKyBjeWNsZVRpbWU7XHJcbiAgICAgICAgICAgIHRoaXMudGlja1RpbWVyID0gLTEgKiBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMudGljaygpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy50aWNrVGltZXIgPSBzZXRJbnRlcnZhbCgoKSA9PiB0aGlzLnRpY2soKSwgY3ljbGVUaW1lICogMTAwMCk7XHJcbiAgICAgICAgICAgIH0sIGN5Y2xlVGltZSAqIDEwMDAgLSB0aGlzLnRpbWVPZmZzZXQqMTAwMCk7XHJcbiAgICAgICAgICAgIHRoaXMubWFrZVNvdW5kKGF0KTtcclxuICAgICAgICAgICAgdGhpcy5hdWRpb0NvbnRleHQucmVzdW1lKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgc3RvcFRpY2soKXtcclxuICAgICAgICBpZih0aGlzLnRpY2tUaW1lciA8IDApe1xyXG4gICAgICAgICAgICBjbGVhclRpbWVvdXQoLTEgKiB0aGlzLnRpY2tUaW1lcik7XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy50aWNrVGltZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmF1ZGlvQ29udGV4dC5zdXNwZW5kKCk7XHJcbiAgICAgICAgdGhpcy5jbGVhclNjaGVkdWxlT3NjKCk7XHJcbiAgICAgICAgdGhpcy50aWNrVGltZXIgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuc3RhcnRUaW1lID0gLTE7XHJcbiAgICAgICAgdGhpcy5hdWRpb1N0YXJ0VGltZSA9IC0xO1xyXG4gICAgICAgIHRoaXMuYmVhdENvdW50ID0gMDtcclxuICAgIH1cclxuICAgIHNldEJwbShicG06IG51bWJlcil7XHJcbiAgICAgICAgdGhpcy5icG0gPSBicG07XHJcbiAgICB9XHJcbiAgICBzY2hlZHVsZVRpY2sodGltZTogbnVtYmVyLCB0eXBlOiB0aWNrV2VpZ2h0ID0gXCJub3JtYWxcIil7IC8vIHRpbWUgaW4gbWlsbGkgc2Vjb25kXHJcbiAgICAgICAgaWYodGhpcy5tb2RlID09PSBcImNsaWNrXCIpe1xyXG4gICAgICAgICAgICB0aGlzLnN0b3BUaWNrKCk7XHJcbiAgICAgICAgICAgIHRoaXMubW9kZSA9IFwic2NoZWR1bGVcIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYodGhpcy5zdGFydFRpbWUgPj0gMCl7XHJcbiAgICAgICAgICAgIGNvbnNvbGUud2FybihcIkNhbm5vdCBzY2hlZHVsZSB0aWNrIGJlZm9yZSBzdG9wIHRpY2soY2FsbCBzdG9wVGljaygpKVwiKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgc2NoZWR1bGVUaW1lID0gdGhpcy5hdWRpb0NvbnRleHQuY3VycmVudFRpbWUgKiAxMDAwICsgdGltZTtcclxuICAgICAgICBpZih0aGlzLmF1ZGlvU3RhcnRUaW1lIDwgMCl0aGlzLmF1ZGlvU3RhcnRUaW1lID0gc2NoZWR1bGVUaW1lO1xyXG4gICAgICAgIGlmKHR5cGUgPT09IFwibm9ybWFsXCIpe1xyXG4gICAgICAgICAgICB0aGlzLm1ha2VTb3VuZChzY2hlZHVsZVRpbWUvMTAwMCk7XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIHRoaXMubWFrZVNvdW5kKHNjaGVkdWxlVGltZS8xMDAwLCB0aGlzLnNvdW5kMik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcGxheSgpOiBudW1iZXJ7XHJcbiAgICAgICAgaWYodGhpcy5zdGFydFRpbWUgPj0gMClyZXR1cm4gLTE7XHJcbiAgICAgICAgaWYodGhpcy5zY2hlZHVsZU9zYy5sZW5ndGggPCAxKXtcclxuICAgICAgICAgICAgY29uc29sZS53YXJuKFwibm8gdGljayBpcyBzY2hlZHVsZWRcIik7XHJcbiAgICAgICAgICAgIHJldHVybiAtMTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zdGFydFRpbWUgPSB0aGlzLmF1ZGlvU3RhcnRUaW1lIC0gdGhpcy5hdWRpb0NvbnRleHQuY3VycmVudFRpbWUqMTAwMCArIHBlcmZvcm1hbmNlLm5vdygpO1xyXG4gICAgICAgIHRoaXMuYXVkaW9Db250ZXh0LnJlc3VtZSgpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLnN0YXJ0VGltZTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRTdGFydFRpbWUoKTogbnVtYmVye1xyXG4gICAgICAgIHJldHVybiB0aGlzLnN0YXJ0VGltZTtcclxuICAgIH1cclxuICAgIHByaXZhdGUgYmFzZTY0dG9BdWRpb0J1ZmZlcihiNjRzdHJpbmc6IHN0cmluZyk6IFByb21pc2U8QXVkaW9CdWZmZXI+e1xyXG4gICAgICAgIHJldHVybiBmZXRjaChiNjRzdHJpbmcpXHJcbiAgICAgICAgLnRoZW4ocmVzID0+IHJlcy5hcnJheUJ1ZmZlcigpKVxyXG4gICAgICAgIC50aGVuKGJ1ZmZlciA9PiB0aGlzLmF1ZGlvQ29udGV4dC5kZWNvZGVBdWRpb0RhdGEoYnVmZmVyKSlcclxuICAgIH1cclxuICAgIHByaXZhdGUgY2xlYXJTY2hlZHVsZU9zYygpe1xyXG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCB0aGlzLnNjaGVkdWxlT3NjLmxlbmd0aDsgaSsrKXtcclxuICAgICAgICAgICAgdGhpcy5zY2hlZHVsZU9zY1tpXS5kaXNjb25uZWN0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc2NoZWR1bGVPc2MgPSBbXTtcclxuICAgIH1cclxuICAgIHByaXZhdGUgdGljaygpe1xyXG4gICAgICAgIGxldCBhdCA9IHRoaXMuYXVkaW9Db250ZXh0LmN1cnJlbnRUaW1lO1xyXG4gICAgICAgIGxldCBjeWNsZVRpbWUgPSA2MCAvIHRoaXMuYnBtO1xyXG4gICAgICAgIGlmKGF0ID4gdGhpcy5uZXh0VGltZSl7XHJcbiAgICAgICAgICAgIHRoaXMudGltZU9mZnNldCArPSAwLjA1O1xyXG4gICAgICAgICAgICB0aGlzLm1ha2VTb3VuZChhdCArIHRoaXMudGltZU9mZnNldCk7XHJcbiAgICAgICAgICAgIHRoaXMubmV4dFRpbWUgPSBhdCArIHRoaXMudGltZU9mZnNldCArIGN5Y2xlVGltZTtcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgdGhpcy5tYWtlU291bmQodGhpcy5uZXh0VGltZSk7XHJcbiAgICAgICAgICAgIHRoaXMubmV4dFRpbWUgKz0gY3ljbGVUaW1lO1xyXG4gICAgICAgIH1cclxuICAgICAgICBhdCA9IHRoaXMuYXVkaW9Db250ZXh0LmN1cnJlbnRUaW1lO1xyXG4gICAgICAgIGlmKHRoaXMuYmVhdENvdW50ID09PSA0KXtcclxuICAgICAgICAgICAgLy8gdGhlcmUsIHRoaXMubmV4dFRpbWUgaXMgdGhlIHRpbWUgb2YgNXRoIGJlYXQgYWZ0ZXIgYWJvdmUgcHJvY2Vzc1xyXG4gICAgICAgICAgICB0aGlzLnN0YXJ0VGltZSA9IHBlcmZvcm1hbmNlLm5vdygpICsgKHRoaXMubmV4dFRpbWUgLSBhdCkgKiAxMDAwO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZih0aGlzLnNjaGVkdWxlT3NjLmxlbmd0aCA+IDEwKXRoaXMuc2NoZWR1bGVPc2Muc2hpZnQoKTtcclxuICAgIH1cclxuICAgIHByaXZhdGUgbWFrZVNvdW5kKCBzdGFydFRpbWU6IG51bWJlciwgc291bmQ6IEF1ZGlvQnVmZmVyID0gdGhpcy5zb3VuZCk6IEF1ZGlvQnVmZmVyU291cmNlTm9kZXtcclxuICAgICAgICBsZXQgb3NjID0gdGhpcy5hdWRpb0NvbnRleHQuY3JlYXRlQnVmZmVyU291cmNlKCk7XHJcbiAgICAgICAgaWYodGhpcy5iZWF0Q291bnQgJSA0ID09PSAwICYmIHRoaXMubW9kZSA9PT0gXCJjbGlja1wiKXtcclxuICAgICAgICAgICAgc291bmQgPSB0aGlzLnNvdW5kMjtcclxuICAgICAgICB9XHJcbiAgICAgICAgb3NjLmJ1ZmZlciA9IHNvdW5kO1xyXG4gICAgICAgIG9zYy5jb25uZWN0KHRoaXMuZ2Fpbk5vZGUpO1xyXG4gICAgICAgIG9zYy5zdGFydChzdGFydFRpbWUpO1xyXG4gICAgICAgIG9zYy5zdG9wKHN0YXJ0VGltZSArIDAuMDUpO1xyXG4gICAgICAgIHRoaXMuYmVhdENvdW50ICsrO1xyXG4gICAgICAgIHRoaXMuc2NoZWR1bGVPc2MucHVzaChvc2MpO1xyXG4gICAgICAgIHJldHVybiBvc2M7XHJcbiAgICB9XHJcbn1cclxuXHJcbmxldCBiZWVwID0gXCJkYXRhOmF1ZGlvL3dhdjtiYXNlNjQsVWtsR1JoQUhBQUJYUVZaRlptMTBJQkFBQUFBQkFBSUFSS3dBQUJDeEFnQUVBQkFBWkdGMFllZ0dBQUQ2L3dRQSt2OEFBRG9BNnY4ay8xWUFNZ0IrL2tvRDZnQXVBSlFFRlB1MC9ZciswdmtZQVZiL1ZnQjRBUVlDbGdGdUJmSUVSQVRzQnZqOUdBUFErZlQ2b1Bvbzl4TDk0UGQrL2g3N212L3MvNVFCVmdQV0E4NERKQVVjQk9BRm5nWm9Ca3dJTGdPWUJ0VCtqZ0I2L0ZiNmV2aG0rd3J6QnY3WTh5ejQwdnhtOHo0RDh2S0lBMDcxbGdUMC9JZ0hlQWwwQ2ZJVXNncFFITVlLK2grS0N3SVpUQWtxQ0lRQkp2ZCs5cWpwVk9vSTM4VGZrTnFhMnNUZHR0MGs0dHJvR3VDZzk2VGdXQWRHN1hJVWZnTDBHdHdaSmlGY0xzSXNLang0TXlZL3RDL3NRYUlremtLMEVtUTFZUDRXSDh6eXZnVXk4UzdvV08yRTFYcmtITlhxMzVUV0RPRkkxRHJnYXRWNjRJalV0dWM2MFFqcUtOaFE2VnJsbXZGSzdTcjh1UExFK21iN0R1K0NBQVRsSVB0TzVKN3ZJT3BjMzFUMnVOT0tCSHJjQWd1VzlmSUtkaEJVRXNnc3JpbXlSOGhFR2xTWVZOQld4bFZrV2c5TFhWei9PVUJYR2l0cFNCZ2pSUy9aSGNvU0FoSXkvWkwvenZOaTdnWHk0K0hRN29YWlllanQxZUxpbk5XSDNJRFRiZERtMFVIRnhkVlR4VVhYUzh3QXpsclFMOExPemdXK3pNSGx3RlNvQ2NXK21GVEtpS0ZuMGpLN3R0dWkyc2ptOC9iTjkzSU04Z04xQnowS0hnczFEdHNOamc4NUVLWVFhUktNRXZFVHV4UG5FODBTMXhGWUVPb096UTFLRFQ0TVZRMWlES1FOemczY0RYOE90dzdzREUwUGpnbEREVklGWndpMkFia0NZdit1L3ZIOGRmeHcrYi81U1BWdDlVRHcxTy9SNm43cTMrYXQ1OHJsZXVkODVvdm9rT2M1Nm1YcEFPd0o3SGp0QWU5RTdoTHlZKytKOVQveTFmbFA5cnorei9rb0EzRDhSQVpZLzB3SXl3TENDU2dHVUFzUUNrUU81dzZkRWtjVEtCYWlGbmdYQnhwR0Y5d2NzUmJTSEx3VnJ4bEZGTDhWc1JLU0V2d1FzZzkrRG5RTXFBb1lDYk1GOVFYWkFBWURpZndQQUdMNHpmeXk5SFg1b1BGYjluWHVXZk0zNnlId2h1aTI3QmpuZGVrdzU1Ym1CT2lYNU9Mb1VPUks2ckRsYk95eTU3dnV5T2tXOHAzc092ZkM4Qm45U3ZaSkFpNzlMZ1lwQkJvSlF3bWdDNmNNN2cwU0QrRVA4ZzlIRWRJUFhCSnNFRnNUMFJHd0V4TVRSUk1qRlBBU0xoVWNFOVFWT1JQNkZZSVNreFY2RUJrVTFReU1FUU1JUnc0bkE5MEpwUDRlQkViNnh2MDc5dGozZlBJQjg4anVpKy9hNjFUdFpPcGk2d2ZxQytsNjZsSG4yZXVFNTdMdFh1bFQ3OVhyei9DaTdyVHlodkVvOVp6emp2ZHo5SzM1OS9Rci9KajJOUCtxK1ZVQ2VmMmhCYkVCSEFsV0JrWU0vQXJNRGdZUC9oQlVFaWdUSUJYZUZGb1hiUldkR0o4VXFCakhFbTBYS2hEbEZDb05iQkZPQ3N3TnRRZWpDaU1GRFFpZEFyc0ZPQUEyQTlUOU93QngrK0w4RHZtZCtZLzI3ZlkvOU5mMGhQTGU4aVB4M2ZDeDcrSHVUZTdTN0hEdDhlcDE3ZlBways1bDZyRHdST3hwOC9idVYvYnI4VVA1RmZWSC9NajRWdi96L0RnQzl3QWJCV2dFK3djakIxNEtId25WQzZrS2hBdzNETzhNM0ExakRVNFAwdzFWRUFzTzRSRG1EZjhRZ1EzVEVOVU1ieEMzQzdFUFR3cGxEcjRJWnd6SUJyQUpRQVNDQmtBQkZnTWUvb2YvSC9zWS9HZjQvZmdwOWtEMmlQVDY4emp6SC9JUDhyVHdlZkhFNzUzeFZ1OGo4bmJ2N3ZJWThBUDBEdkZTOVZEeTVmYkg4N2I0WnZXcStrUDNzL3h5K2Q3K0Rmd3dBUW4vZWdNREFvWUZ1Z1JIQno0SHhBaUNDUUFLVlFzUUM3TU1Bd3k0RGJVTWVnN0xET2NPTmd6bERqd0xjZzRUQ28wTjBBZ3ZESDBIYlFyMkJYOElEUVIrQnRrQlhRU3Evd3NDcmYyRS85VDc5ZndhK29uNmwvaE0rRXIzWC9ZNTl2ZjBpZlVTOUQvMWV2Tk45VER6dC9WRjgydjJudk5LOTA3MFd2aUE5YTM1SC9jaysrejRyL3lmK2xUK0lQejQvNnI5aHdGNS8vVUNZZ0UxQkVJRFRBVVdCVWdHdmdZaEJ3Y0l2Z2Z2Q0JZSWxna25DUHdKNndjQUNuVUhxd25OQmlZSitBVndDQUVGY0Fmc0F5SUd1QUtwQkhrQkpBTkxBTGNCUFA5dUFFeitMLzkxL2VYOW8veWwvTmI3ay9zbis4ejZwL3BEK21QNjN2bGYrby81aWZwVytjejZUUGtvKzRuNW9mc0cranI4c1ByLy9INzc1LzFpL05YK1ZQMnkvMWorZFFCci94MEJmZ0MxQVhjQlFBSkRBcndDMWdJY0F6c0RUd09FQTFZRHV3TkVBK1VES3dQNUF3d0Q2Z1BiQXJjRGxRSmpBejRDK3dMWkFZMENiQUVoQXY4QXRBR1NBRUFCSGdDNkFLZi9Kd0EyLzVULzFmNE4vNGYrb2Y1Ti9sTCtLLzRhL2h2KzkvMGIvdVA5S3Y3Zi9Vbis3djEwL2hMK3B2NUUvdDMrZXY0Vy83YitVLy80L3BEL1BQL0gvM3YvK2YrMS95Y0E2LzlSQUNBQWRBQlJBSThBZXdDaUFKb0FyZ0N2QUxRQXZRQzBBTVVBc0FER0FLZ0F3UUNZQUxVQWhBQ2pBRzBBakFCVkFIUUFQZ0JhQUNrQVFBQVdBQ2tBQlFBVkFQZi9CQURzLy9qLzVQL3UvOS8vNS8vZC8rTC8zZi9mLzk3LzMvL2gvK0QvNWYvai8rbi81Ly91Lyt2Lzh2L3YvL2IvOVAvNS8vZi8vUC82Ly83Ly9mLy8vLzcvQUFELy93QUFBQUFBQUFBQVwiO1xyXG5sZXQgYmVlcDI9IFwiZGF0YTphdWRpby93YXY7YmFzZTY0LFVrbEdSdVlEQUFCWFFWWkZabTEwSUJBQUFBQUJBQUVBZ0xzQUFBQjNBUUFDQUJBQVpHRjBZYjREQUFEdy93QUFHQUFnQU9EK0FQMEkvQmo3T1ByNCtVajVnUGh3K0JENGdQZVE5Nmo1cVB5by92ajlHUHdvKytqOHdQOW9BYkFDNkFPSUJCQURnQURJL2tqOTZQdEkrOUFCMEF0Z0VZQVp5Q0s0SmxBaW1Ca2dCbWp3QU9VSTNnRFpLTmNvM0xqbEVPMm8vQ0FRcUJyNEZxQU0yQVN3K25qdkNPcEErSkFQT0J6WURlanpVT1l3OFBBQ21BMUlFR0FRa0E4SUMyQUU4UDQ0K3JqMmlQblE3aURhUU5PUTNRanNjTzZnNTdEakNPbEE4cUR6UVBIWThRanpHUHN3Qm9BTlNCZkFJR2dvb0Q1MlYrWmUxbERBT21nb0Z5QW5IcVlncFNDVkc3WVEzd0pwK2JyNXZmRWI0a0haN3ROcjBKZlA2c1FXdHhpekVMcEx3Ui9LUDlXeTRaZnd0ZndMQStJUGF4NThJMVFhYWd4bkEvQUlvUlhhRm5nTTR3UFJBYzRFYndZckJRdjRDT2w0NDdqZnhONjA0V2ZwSmZScyt6RDg1UHpuL3RjRy9oWHRJTFltMlM2TU04czBRU3RySDU4ZkRpWmdLWGttK1IxeUZFQVBpZ2JMLzJIOUFmdno5K0QwbWVpLzNYSFgyOWNTM3BmaHp1WXU3RmJxVStpMDZjWHNoZk5wK3c4QWNBbDZFNG9YZFJJc0RxRU43QTA5RG80T2hBbm1EaDBabnhxVUZNZ01XZ05IOFFqak51Qmk1TGJySC9HOThiYnh2Zko5OXBMK1BnVXFBdHI1TFBSRiswQUpzeEt0R25BZDhocVRFdFFLb0FlWEVvVWNEaDBUR3NRVEpnNU9CK2dCdEFEWS96RUJRUVBJQW9uODhmVTQ4cnpzRittSjZWYnRIL0l5OWZUNXUvNzRBSGNJTEJIQ0ZKQVRuUThJREtZVndpTHhKN2tlWUJDb0Iva0NDUUlxQXprRDJBRG0vU3I1Q3ZVdTlDanV1T2VvNG1MaHN1UUI3cC8zVC94Ny9RYituUDd3QXlzSzJneHpERWdOTEE0S0VONFFRdzlwQ2pFQ3p2dmUrbno5emdDTS8ybjcwL2huL1NFRnhBbzNDejhHeVAvcS9WVUNlZ2hNRGJ3UFR3NHdDamdGOWdKTkF3a0gxd3Q0RFdVTEJ3aFFCZGtDNS8zbytSajVqL3EvL0cvK0gva0c4cVB2SGZLaTl1cjZMUDQ1LzM3KzZQbkc5WnIxYVBrRi9yRUFCQUNKL2NUN1F3RHpCZ1FLeWdoYkJmd0FUdjdRKzI3N01mMkYvL1FBYXdFRkE0WUZ1Z2FpQmFBRG1nS29BRVAvVmY5Qi9qNzh4UHJVKzAvK1VRQnhBZHNBU1Arai9nOEFCUUpoQTEwRDhnSGgvL3orM1A4T0FkOEJRQUpqQTBZRUVnUkRBendCSy84bi9TLzhxdnpJL2VIK2l2K0QvM1QraC8xUC9nOEFTUUYwQUovK2EvMGcvb3NBcGdKM0EvUUNzZ0dSQUM0QStmOVVBTjhBRndITkFHY0Fjd0FqQUtiL2F2L1cvbUwrU1A1Ny9nLy90di90LzFqL29mNXEvazMrVHY2Zi9yYittdjZVL3VmK1pQL0kveGtBU1FCQ0FFZ0FZd0IyQUhnQVp3QkpBRHdBT3dBekFBWUEwdi9CLzgzLzMvL3cvd0lBRGdBT0FBY0FcIjsiXSwibWFwcGluZ3MiOiJBQUVBO0FBQUE7QUFBQTtBQWVBO0FBVkE7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/Metronome.ts\n");

/***/ }),

/***/ "./src/SLPract.ts":
/*!************************!*\
  !*** ./src/SLPract.ts ***!
  \************************/
/*! exports provided: SLPract */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"SLPract\", function() { return SLPract; });\n/* harmony import */ var _Timer__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Timer */ \"./src/Timer.ts\");\n\r\nclass SLPract {\r\n    constructor(controlTab, editor, metronome) {\r\n        this.bpm = 120;\r\n        this.timeSignature = { upper: 4, lower: 4 };\r\n        this.isRepeat = false;\r\n        this.indicatorShapes = [];\r\n        this.resultUIElements = [];\r\n        //Color configs \r\n        this.indicatorColor = \"rgba(255, 209, 81, 0.6)\";\r\n        this.correctResultColor = \"rgba(0, 163, 250, 0.9)\";\r\n        this.wrongResultColor = \"rgba(250, 80, 0, 0.9)\";\r\n        this.whiteColor = \"rgba(255, 255, 255, 0.9)\";\r\n        this.playFlag = false;\r\n        this.startFlag = false;\r\n        this.timer = new _Timer__WEBPACK_IMPORTED_MODULE_0__[\"Timer\"]();\r\n        this.playLag = 50 / 1000;\r\n        this.selectedTimeSum = 0;\r\n        this.metronomeOn = false;\r\n        this.playIter = 0;\r\n        this.maxPracticeTimes = 1;\r\n        this.openStringTunes = [40, 45, 50, 55, 59, 64]; //E2, A2, D3, G3, B3, E4\r\n        this.deviceStartTime = 0;\r\n        this.collectPractContent = [];\r\n        this.anlyzeMethod = \"pluck\";\r\n        this.loadedSheet = [];\r\n        this.preMetronome = true;\r\n        this.correctTolerance = 100;\r\n        this.devices = [];\r\n        this.controlTab = controlTab;\r\n        this.editor = editor;\r\n        this.metronome = metronome;\r\n        this.setEvents();\r\n    }\r\n    play() {\r\n        this.startFlag = true;\r\n        this.controlTab.inEdit = false;\r\n        if (this.playIter == this.maxPracticeTimes || (this.playIter > 0 && !this.isRepeat)) {\r\n            this.stop();\r\n            return;\r\n        }\r\n        //Load the sheet from sltab \r\n        this.loadedSheet = this.loadSheetNote();\r\n        //Clear practice UI\r\n        this.clearAnalyzeUI();\r\n        if (this.playIter > 0) {\r\n            // let result = this.practiceAnalyze(this.collectPractContent,this.deviceStartTime, new Date().getTime());\r\n            if (this.anlyzeMethod == \"whole\") {\r\n                let result = this.practiceAnalyze(this.collectPractContent);\r\n            }\r\n        }\r\n        if (this.playIter == 0) {\r\n            this.metronome.stopTick();\r\n            this.timer.stop();\r\n        }\r\n        let sectionNotes;\r\n        if (this.editor.SelectedNotes.length > 0) { //If selected more then one note swap to repeat playing mode\r\n            this.isRepeat = true;\r\n            sectionNotes = this.sortBySectionId(this.editor.SelectedNotes);\r\n        }\r\n        else {\r\n            this.isRepeat = false;\r\n            let selection = this.controlTab.headToEndSelect(this.controlTab.noteIndex(this.editor.selectedNote));\r\n            sectionNotes = this.sortBySectionId(selection);\r\n        }\r\n        let sectionLenSum = 0;\r\n        let preBeat = 0;\r\n        let sectionMetronomeBeats = [];\r\n        this.editor.undisplayIndicator();\r\n        /**\r\n         * setPracticeSectionIndicator(whole selected note info)\r\n         */\r\n        //////////////////////////////\r\n        sectionNotes.forEach((elem, index, self) => {\r\n            let sectionEnds = this.sectionTwoEnds(elem);\r\n            let sectionBeats = 0;\r\n            if (index == 0) {\r\n                if (this.nowPlaySectionIndicator == null) {\r\n                    this.nowPlaySectionIndicator = this.controlTab.tabCanvas.layers.ui.createRect(sectionEnds.x1, sectionEnds.y1, sectionEnds.x2 - sectionEnds.x1, sectionEnds.y2 - sectionEnds.y1, 2, this.indicatorColor);\r\n                }\r\n                else {\r\n                    this.nowPlaySectionIndicator.setPos(sectionEnds.x1, sectionEnds.y1);\r\n                    this.nowPlaySectionIndicator.setShape(sectionEnds.x2 - sectionEnds.x1, sectionEnds.y2 - sectionEnds.y1);\r\n                }\r\n                //If the first note selected is note on the beat, calc a prebeat note value.\r\n                if (elem[0].note != 0) {\r\n                    let preSum = 0;\r\n                    let firstSection = this.controlTab.getSectionData(elem[0].section);\r\n                    for (let i = 0; i < elem[0].note; i++) {\r\n                        preSum += this.timeSignature.lower / firstSection[i][0];\r\n                    }\r\n                    if (preSum % 1 != 0) {\r\n                        preBeat = this.timeSignature.lower / (1 - (preSum % 1));\r\n                    }\r\n                }\r\n            }\r\n            let sectionLen = 0;\r\n            elem.forEach((note, i, s) => {\r\n                // console.log(note)\r\n                let thisNote = this.controlTab.getNoteData(note.section, note.note);\r\n                // console.log(thisNote)\r\n                sectionLen += this.noteValeu2Time(thisNote.noteValue);\r\n                sectionBeats += this.timeSignature.lower / thisNote.noteValue;\r\n            });\r\n            sectionLenSum += sectionLen;\r\n            sectionMetronomeBeats.push(sectionBeats);\r\n            if (self.length == 1) {\r\n                this.timer.registerDelay(this.stopNowPlaySectionIndicator.bind(this), sectionLen * 1000, 1);\r\n            }\r\n            else if (self.length > 1 && index < self.length - 1) {\r\n                let nextSectionEnds = this.sectionTwoEnds(self[index + 1]);\r\n                this.indicatorShapes.push({ x: nextSectionEnds.x1, y: nextSectionEnds.y1, width: nextSectionEnds.x2 - nextSectionEnds.x1, height: nextSectionEnds.y2 - nextSectionEnds.y1 });\r\n                this.timer.registerDelay(this.pushNowPlaySectionIndicator.bind(this), sectionLenSum * 1000, 1);\r\n            }\r\n            if (index == self.length - 1) {\r\n                this.timer.registerDelay(this.play.bind(this), sectionLenSum * 1000, 1);\r\n            }\r\n        });\r\n        let sectionStartTime = 0;\r\n        if (this.playIter == 0) {\r\n            let repeatTime = 1;\r\n            if (this.isRepeat)\r\n                repeatTime = this.maxPracticeTimes;\r\n            for (let i = 0; i < repeatTime; i++) {\r\n                sectionMetronomeBeats.forEach((el, i, self) => {\r\n                    if (this.selectedTimeSum == 0 && sectionStartTime == 0)\r\n                        sectionStartTime += this.playLag;\r\n                    let sectionDuration = el * 60 / this.bpm;\r\n                    console.log(el);\r\n                    this.registerSectionMetronome(this.selectedTimeSum + sectionStartTime, el, sectionNotes[i][0].note == 0, preBeat);\r\n                    sectionStartTime += sectionDuration;\r\n                });\r\n            }\r\n        }\r\n        this.selectedTimeSum += sectionStartTime;\r\n        this.playIter += 1;\r\n        //////////////////////////\r\n        this.timer.start();\r\n        if (!this.metronomeOn) {\r\n            this.metronome.play();\r\n            this.metronomeOn = true;\r\n        }\r\n        //Start practicer analyze section.\r\n        this.deviceStartTime = performance.now();\r\n    }\r\n    stop() {\r\n        this.timer.stop();\r\n        this.stopNowPlaySectionIndicator();\r\n        this.indicatorShapes = [];\r\n        this.metronome.stopTick();\r\n        this.metronomeOn = false;\r\n        this.selectedTimeSum = 0;\r\n        this.playIter = 0;\r\n        this.editor.displayIndicator();\r\n        this.playFlag = false;\r\n        this.startFlag = false;\r\n        this.controlTab.inEdit = true;\r\n        // let result = this.practiceAnalyze(this.collectPractContent,this.deviceStartTime, new Date().getTime());\r\n        if (this.anlyzeMethod == \"whole\") {\r\n            let result = this.practiceAnalyze(this.collectPractContent);\r\n            this.drawAnalyzeUI(this.controlTab.tabCanvas.layers.ui, result);\r\n        }\r\n    }\r\n    bindDevice() {\r\n    }\r\n    // onPluck(input: MidiInput){\r\n    //     if(this.playFlag){\r\n    //         this.collectPractContent.push(input);\r\n    //     }\r\n    // }\r\n    onPluck(channel, note, time) {\r\n        let input = { \"channel\": channel, \"note\": note, \"time\": time };\r\n        if (this.startFlag) {\r\n            this.collectPractContent.push(input);\r\n            if (this.anlyzeMethod == \"pluck\") {\r\n                let results = this.practiceAnalyze([input]);\r\n                this.drawAnalyzeUI(this.controlTab.tabCanvas.layers.ui, results);\r\n            }\r\n        }\r\n    }\r\n    loadSheetNote() {\r\n        let loadedSheet = [];\r\n        let noteTime = 0;\r\n        let noteId = 0;\r\n        this.controlTab.notes.forEach((elem, i, self) => {\r\n            elem.forEach((el, j, s) => {\r\n                loadedSheet.push({ \"section\": i, \"note\": j, \"noteId\": noteId, \"noteValue\": el.noteValue, 'noteTime': noteTime, 'stringContent': el[1], \"style\": el[2] });\r\n                noteTime += this.noteValeu2Time(el.noteValue) * 1000;\r\n                noteId += 1;\r\n            });\r\n        });\r\n        return loadedSheet;\r\n    }\r\n    playPracticeSectionIndicator() {\r\n        this.timer.start();\r\n    }\r\n    setPracticeSectionIndicator(sectionNotes) {\r\n        let sectionLenSum = 0;\r\n        sectionNotes.forEach((elem, index, self) => {\r\n            let sectionEnds = this.sectionTwoEnds(elem);\r\n            let sectionBeats = 0;\r\n            if (index == 0) {\r\n                if (this.nowPlaySectionIndicator == null) {\r\n                    this.nowPlaySectionIndicator = this.controlTab.tabCanvas.layers.ui.createRect(sectionEnds.x1, sectionEnds.y1, sectionEnds.x2 - sectionEnds.x1, sectionEnds.y2 - sectionEnds.y1, 2, this.indicatorColor);\r\n                }\r\n                else {\r\n                    this.nowPlaySectionIndicator.setPos(sectionEnds.x1, sectionEnds.y1);\r\n                    this.nowPlaySectionIndicator.setShape(sectionEnds.x2 - sectionEnds.x1, sectionEnds.y2 - sectionEnds.y1);\r\n                }\r\n            }\r\n            let sectionLen = 0;\r\n            elem.forEach((note, i, s) => {\r\n                let thisNote = this.controlTab.getNoteData(note.section, note.note);\r\n                sectionLen += this.noteValeu2Time(thisNote.noteValue);\r\n                sectionBeats += this.timeSignature.lower / thisNote.noteValue;\r\n            });\r\n            sectionLenSum += sectionLen;\r\n            if (self.length == 1) {\r\n                this.timer.registerDelay(this.stopNowPlaySectionIndicator.bind(this), sectionLen * 1000, 1);\r\n            }\r\n            else if (self.length > 1 && index < self.length - 1) {\r\n                let nextSectionEnds = this.sectionTwoEnds(self[index + 1]);\r\n                this.indicatorShapes.push({ x: nextSectionEnds.x1, y: nextSectionEnds.y1, width: nextSectionEnds.x2 - nextSectionEnds.x1, height: nextSectionEnds.y2 - nextSectionEnds.y1 });\r\n                this.timer.registerDelay(this.pushNowPlaySectionIndicator.bind(this), sectionLenSum * 1000, 1);\r\n            }\r\n            if (index == self.length - 1) {\r\n                this.timer.registerDelay(this.play.bind(this), sectionLenSum * 1000, 1);\r\n            }\r\n        });\r\n    }\r\n    pushNowPlaySectionIndicator() {\r\n        let nextShape = this.indicatorShapes.shift();\r\n        this.nowPlaySectionIndicator.setPos(nextShape.x, nextShape.y);\r\n        this.nowPlaySectionIndicator.setShape(nextShape.width, nextShape.height);\r\n    }\r\n    stopNowPlaySectionIndicator() {\r\n        if (this.nowPlaySectionIndicator != null) {\r\n            this.nowPlaySectionIndicator.remove();\r\n            this.nowPlaySectionIndicator = null;\r\n        }\r\n    }\r\n    getSetionBeats(sectionNotes) {\r\n        // If the first note selected is note on the beat, calc a prebeat note value.\r\n        let preBeat = 0;\r\n        if (sectionNotes[0].note != 0) {\r\n            let preSum = 0;\r\n            let sectionNoteRaw = this.controlTab.getSectionData(sectionNotes[0].section);\r\n            for (let i = 0; i < sectionNotes[0].note; i++) {\r\n                preSum += this.timeSignature.lower / sectionNoteRaw[i][0];\r\n            }\r\n            if (preSum % 1 != 0) {\r\n                preBeat = this.timeSignature.lower / (1 - (preSum % 1));\r\n            }\r\n        }\r\n    }\r\n    noteValeu2Time(noteValue) {\r\n        if (noteValue == 0)\r\n            return 0;\r\n        else\r\n            return (this.timeSignature.lower / noteValue) / (this.bpm / 60);\r\n    }\r\n    registerSectionMetronome(startTime, sectionBeats, firstClick, preBeat) {\r\n        if (preBeat == null) {\r\n            preBeat = 0;\r\n        }\r\n        let pre = this.timeSignature.lower / preBeat;\r\n        if (pre == Infinity)\r\n            pre = 0;\r\n        //Metronome click first beat on the section\r\n        if (firstClick) {\r\n            this.metronome.scheduleTick(startTime * 1000, 'strong');\r\n        }\r\n        else {\r\n            this.metronome.scheduleTick((startTime + this.noteValeu2Time(preBeat)) * 1000, 'normal');\r\n        }\r\n        console.log(sectionBeats - pre);\r\n        for (let i = 1; i < Math.floor(sectionBeats - pre); i++) {\r\n            this.metronome.scheduleTick((startTime + i * this.noteValeu2Time(this.timeSignature.lower) + this.noteValeu2Time(preBeat)) * 1000, 'normal');\r\n        }\r\n    }\r\n    setEvents() {\r\n        this.controlTab.on(\"keydown\", (key) => {\r\n            if (key.toLowerCase() === \" \") {\r\n                this.controlTab.inEdit = false;\r\n                this.playFlag = !this.playFlag;\r\n                if (this.playFlag) {\r\n                    this.editor.undisplayIndicator();\r\n                    if (this.preMetronome) {\r\n                        this.registerSectionMetronome(this.playLag, this.timeSignature.upper, true);\r\n                        this.timer.registerDelay(this.play.bind(this), this.timeSignature.upper * this.noteValeu2Time(this.timeSignature.lower) * 1000);\r\n                        this.metronome.play();\r\n                        this.timer.start();\r\n                    }\r\n                    else {\r\n                        this.play();\r\n                    }\r\n                }\r\n                else {\r\n                    this.stop();\r\n                }\r\n                this.clearAnalyzeUI();\r\n            }\r\n            if (key.toLowerCase() === \"q\") {\r\n                // this.onPluck({\"channel\": 0, \"note\": 0, \"time\": new Date().getTime()})\r\n                this.onPluck(0, 0, performance.now());\r\n            }\r\n        });\r\n        this.controlTab.on(\"mousedown\", (x, y) => {\r\n            this.clearAnalyzeUI();\r\n        });\r\n    }\r\n    sortBySectionId(notes) {\r\n        let selectedSections = [];\r\n        for (let i = 0; i < notes.length; i++) {\r\n            selectedSections.push(notes[i].section);\r\n        }\r\n        let uniqueSelectedSections = selectedSections.filter(function (elem, index, self) {\r\n            return index == self.indexOf(elem);\r\n        });\r\n        let ret = [];\r\n        for (let i = 0; i < uniqueSelectedSections.length; i++) {\r\n            let pushNotes = notes.filter(function (elem, index, self) {\r\n                return elem.section == uniqueSelectedSections[i];\r\n            });\r\n            ret.push(pushNotes);\r\n        }\r\n        return ret;\r\n    }\r\n    sectionTwoEnds(section) {\r\n        let strings = section[0].blockGroup.length;\r\n        let leftTopEnd = { x: section[0].blockGroup[0].x, y: section[0].blockGroup[0].y };\r\n        let rightBotEnd = { x: section[section.length - 1].blockGroup[strings - 1].x, y: section[section.length - 1].blockGroup[strings - 1].y };\r\n        if (section[0].note == 0) {\r\n            let thisSection = this.controlTab.tabCanvas.layers.ui.sectionIndicator[section[0].section];\r\n            leftTopEnd = { x: thisSection.x, y: thisSection.y };\r\n        }\r\n        if (section[section.length - 1].note == this.controlTab.notes[section[section.length - 1].section].length - 1) {\r\n            let thisSection = this.controlTab.tabCanvas.layers.ui.sectionIndicator[section[section.length - 1].section];\r\n            rightBotEnd = { x: thisSection.x + thisSection.width, y: thisSection.y + thisSection.height };\r\n        }\r\n        return { x1: leftTopEnd.x, y1: leftTopEnd.y, x2: rightBotEnd.x, y2: rightBotEnd.y };\r\n    }\r\n    // private practiceAnalyze(input: MidiInput[], devicePlayTime: number, deviceEndTime: number): AnalyzeResult[]{\r\n    practiceAnalyze(input) {\r\n        // let loadedSheetMusic: NoteInfo[] = this.loadSheetNote();\r\n        // let sheetMusic: NoteInfo[] = loadedSheetMusic.filter((elem, index, self) =>{\r\n        //     return elem.noteTime>= devicePlayTime - this.deviceStartTime && elem.noteTime <= deviceEndTime -this.deviceStartTime;\r\n        // });\r\n        if (input.length < 1)\r\n            return [];\r\n        if (this.loadedSheet.length < 1)\r\n            return [];\r\n        let rets = [];\r\n        input.forEach((elem, index, self) => {\r\n            let ret;\r\n            // if(elem.time < devicePlayTime || elem.time > deviceEndTime){\r\n            //     return\r\n            // }\r\n            let mappedNote = this.timeNoteMapping(elem.time - this.deviceStartTime, this.loadedSheet);\r\n            let timeResult;\r\n            let noteResult;\r\n            //Check if playing input is correct and return results.\r\n            console.log(elem.time - this.deviceStartTime);\r\n            console.log(performance.now() - this.deviceStartTime);\r\n            if (Math.abs((elem.time - this.deviceStartTime) - (this.loadedSheet[mappedNote].noteTime + this.playLag)) <= this.correctTolerance) {\r\n                timeResult = \"correct\";\r\n            }\r\n            else if ((elem.time - this.deviceStartTime) - (this.loadedSheet[mappedNote].noteTime + this.playLag) > 0) {\r\n                timeResult = \"drag\";\r\n            }\r\n            else {\r\n                timeResult = 'rush';\r\n            }\r\n            if (elem.note == this.loadedSheet[mappedNote].stringContent[elem.channel]) {\r\n                noteResult = true;\r\n            }\r\n            else {\r\n                noteResult = false;\r\n            }\r\n            ret = {\r\n                \"section\": this.loadedSheet[mappedNote].section,\r\n                \"note\": this.loadedSheet[mappedNote].note,\r\n                \"channel\": elem.channel,\r\n                \"playedNote\": elem.note,\r\n                \"sheetNote\": this.loadedSheet[mappedNote].stringContent[elem.channel],\r\n                \"playedTime\": elem.time - this.deviceStartTime,\r\n                \"sheetTime\": this.loadedSheet[mappedNote].noteTime,\r\n                \"noteId\": this.loadedSheet[mappedNote].noteId,\r\n                \"timeResult\": timeResult,\r\n                \"noteResult\": noteResult\r\n            };\r\n            rets.push(ret);\r\n        });\r\n        return rets;\r\n    }\r\n    drawAnalyzeUI(target, playResults) {\r\n        playResults.forEach((result, index, self) => {\r\n            let [x, y] = this.controlTab.getNotePosition(result.section, result.note, result.channel);\r\n            let noteValue = this.controlTab.getNoteData(result.section, result.note).noteValue;\r\n            let resultPosBias = 0;\r\n            if (result.timeResult == \"drag\") {\r\n                resultPosBias = 1 / (noteValue / this.timeSignature.lower) * 30;\r\n            }\r\n            else if (result.timeResult == \"rush\") {\r\n                resultPosBias = 1 / (noteValue / this.timeSignature.lower) * (-30);\r\n            }\r\n            let resultEllipse = target.createEllipse(x + resultPosBias, y, 8, 8);\r\n            let resultText = target.createText(x + resultPosBias, y + 5, result.playedNote.toString(), \"middle\");\r\n            if (result.timeResult == \"correct\" && result.noteResult) {\r\n                resultText.fill = this.correctResultColor;\r\n                resultEllipse.fill = this.correctResultColor;\r\n            }\r\n            else {\r\n                // resultText.fill = this.wrongResultColor;\r\n                resultText.fill = this.whiteColor;\r\n                resultEllipse.fill = this.wrongResultColor;\r\n            }\r\n            // console.log(resultEllipse.cx)\r\n            // resultText.x += resultPosBias;\r\n            // resultEllipse.cx += resultPosBias;\r\n            // console.log(resultEllipse.cx)\r\n            this.resultUIElements.push(resultText);\r\n            this.resultUIElements.push(resultEllipse);\r\n        });\r\n    }\r\n    clearAnalyzeUI() {\r\n        this.resultUIElements.forEach((elem, index, self) => {\r\n            elem.remove();\r\n        });\r\n    }\r\n    timeNoteMapping(time, sheetMusic) {\r\n        let lastTime = 0;\r\n        for (let i = 0; i < sheetMusic.length; i++) {\r\n            if (time > lastTime && time <= sheetMusic[i].noteTime) {\r\n                if (Math.abs(time - lastTime) > Math.abs(time - sheetMusic[i].noteTime)) {\r\n                    return i;\r\n                }\r\n                else\r\n                    return i - 1;\r\n            }\r\n            else if (time > sheetMusic[sheetMusic.length - 1].noteTime) {\r\n                return sheetMusic.length - 1;\r\n            }\r\n            lastTime = sheetMusic[i].noteTime;\r\n        }\r\n    }\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvU0xQcmFjdC50cy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovL1tuYW1lXS8uL3NyYy9TTFByYWN0LnRzPzdmZjYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTm90ZSB9IGZyb20gXCIuL1NsaW1UYWJWMlR5cGVzXCJcclxuaW1wb3J0IHsgU0xUYWIgfSBmcm9tIFwiLi9TbGltVGFiVjJcIlxyXG5pbXBvcnQgeyBSZWN0LCBFbGxpcHNlLCBUZXh0LCBMaW5lLCBTVkdOb3RlLCBOb3RlQmxvY2ssIFNMQ2FudmFzLCBTTExheWVyLCBMYXllciwgU1ZHU2hhcGV9IGZyb20gXCIuL1NsaW1UYWJWMkNhbnZhc1wiXHJcbmltcG9ydCB7VGltZXJ9IGZyb20gXCIuL1RpbWVyXCJcclxuaW1wb3J0IHtTTEVkaXRvcn0gZnJvbSBcIi4vU2xpbVRhYlYyRWRpdG9yXCJcclxuaW1wb3J0IHtNZXRyb25vbWV9IGZyb20gXCIuL01ldHJvbm9tZVwiXHJcblxyXG4vLyBBc3N1bWUgTGljYXAgd2lsbCBnaXZlIHRpbWVzdGFtcCwgc3RyaW5nKGNoYW5uZWwpLCBub3RlLCBzdHlsZS4gXHJcbmludGVyZmFjZSBUaW1lU2lnbmF0dXJle1xyXG4gICAgdXBwZXI6IG51bWJlcixcclxuICAgIGxvd2VyOiBudW1iZXJcclxufVxyXG5cclxuaW50ZXJmYWNlIEluZGljYXRvclNoYXBle1xyXG4gICAgeDogbnVtYmVyLFxyXG4gICAgeTogbnVtYmVyLFxyXG4gICAgd2lkdGg6IG51bWJlcixcclxuICAgIGhlaWdodDogbnVtYmVyXHJcbn1cclxuXHJcbmludGVyZmFjZSBNaWRpSW5wdXR7XHJcbiAgICB0aW1lOiBudW1iZXIsXHJcbiAgICBjaGFubmVsOiBudW1iZXIsXHJcbiAgICBub3RlOiBudW1iZXIsXHJcbiAgICBzdHlsZT86IHN0cmluZ1xyXG59XHJcblxyXG5pbnRlcmZhY2UgQW5hbHl6ZVJlc3VsdHtcclxuICAgIHNlY3Rpb246IG51bWJlcixcclxuICAgIG5vdGU6IG51bWJlcixcclxuICAgIG5vdGVJZDogbnVtYmVyLFxyXG4gICAgY2hhbm5lbDogbnVtYmVyLFxyXG4gICAgcGxheWVkTm90ZTogbnVtYmVyLFxyXG4gICAgc2hlZXROb3RlOiBudW1iZXIsXHJcbiAgICBwbGF5ZWRUaW1lOiBudW1iZXIsXHJcbiAgICBzaGVldFRpbWU6IG51bWJlcixcclxuICAgIHRpbWVSZXN1bHQ6IFRpbWVSZXN1bHQsXHJcbiAgICBub3RlUmVzdWx0OiBib29sZWFuLFxyXG4gICAgcGxheWVkU3R5bGU/OiBzdHJpbmcsXHJcbiAgICBzaGVldFN0eWxlPzogc3RyaW5nLFxyXG4gICAgcGxheWVkQW1wbGl0dWRlPzogbnVtYmVyLFxyXG4gICAgc2hlZXRQbGF5ZWRBbXBsaXR1ZGU/OiBudW1iZXJcclxufVxyXG5cclxuaW50ZXJmYWNlIFNlY3Rpb25CZWF0SW5mb3tcclxuICAgIGJlYXRDb3VudDogbnVtYmVyLFxyXG4gICAgcHJlQmVhdDogbnVtYmVyXHJcbn1cclxuXHJcbmludGVyZmFjZSBOb3RlSW5mb3tcclxuICAgIHNlY3Rpb246IG51bWJlcixcclxuICAgIG5vdGU6IG51bWJlcixcclxuICAgIG5vdGVJZDogbnVtYmVyLFxyXG4gICAgbm90ZVZhbHVlOiBudW1iZXIsXHJcbiAgICBub3RlVGltZTogbnVtYmVyLFxyXG4gICAgc3RyaW5nQ29udGVudDogbnVtYmVyW10sXHJcbiAgICBzdHlsZT86IGFueVxyXG59XHJcblxyXG50eXBlIEFubHl6ZU1ldGhvZCA9IFwicGx1Y2tcInxcInNlY3Rpb25cIiB8IFwid2hvbGVcIjtcclxudHlwZSBUaW1lUmVzdWx0ID0gXCJjb3JyZWN0XCIgfCBcInJ1c2hcIiB8IFwiZHJhZ1wiO1xyXG5cclxuZXhwb3J0IGNsYXNzIFNMUHJhY3Qge1xyXG4gICAgcHJpdmF0ZSBjb250cm9sVGFiOiBTTFRhYjtcclxuICAgIHByaXZhdGUgZWRpdG9yOiBTTEVkaXRvcjtcclxuICAgIHByaXZhdGUgbm93UGxheVNlY3Rpb25JbmRpY2F0b3I6IFJlY3Q7XHJcbiAgICBwcml2YXRlIGJwbTogbnVtYmVyID0gMTIwO1xyXG4gICAgcHJpdmF0ZSB0aW1lU2lnbmF0dXJlOiBUaW1lU2lnbmF0dXJlID0ge3VwcGVyOiA0LCBsb3dlcjogNH07XHJcbiAgICBwcml2YXRlIGlzUmVwZWF0OiBib29sZWFuID0gZmFsc2U7XHJcbiAgICBwcml2YXRlIGluZGljYXRvclNoYXBlczogSW5kaWNhdG9yU2hhcGVbXSA9IFtdO1xyXG4gICAgcHJpdmF0ZSByZXN1bHRVSUVsZW1lbnRzOiBTVkdTaGFwZVtdID0gW107XHJcblxyXG4gICAgLy9Db2xvciBjb25maWdzIFxyXG4gICAgcHJpdmF0ZSBpbmRpY2F0b3JDb2xvcjogc3RyaW5nID0gXCJyZ2JhKDI1NSwgMjA5LCA4MSwgMC42KVwiO1xyXG4gICAgcHJpdmF0ZSBjb3JyZWN0UmVzdWx0Q29sb3I6IHN0cmluZyA9IFwicmdiYSgwLCAxNjMsIDI1MCwgMC45KVwiO1xyXG4gICAgcHJpdmF0ZSB3cm9uZ1Jlc3VsdENvbG9yOiBzdHJpbmcgPSBcInJnYmEoMjUwLCA4MCwgMCwgMC45KVwiO1xyXG4gICAgcHJpdmF0ZSB3aGl0ZUNvbG9yOiBzdHJpbmcgPSBcInJnYmEoMjU1LCAyNTUsIDI1NSwgMC45KVwiO1xyXG5cclxuICAgIHByaXZhdGUgcGxheUZsYWc6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgIHByaXZhdGUgc3RhcnRGbGFnOiBib29sZWFuID0gZmFsc2U7XHJcbiAgICBwcml2YXRlIHRpbWVyOiBUaW1lciA9IG5ldyBUaW1lcigpO1xyXG4gICAgcHJpdmF0ZSBtZXRyb25vbWU6IE1ldHJvbm9tZTtcclxuICAgIHByaXZhdGUgcGxheUxhZzogbnVtYmVyID0gNTAvMTAwMDtcclxuICAgIHByaXZhdGUgc2VsZWN0ZWRUaW1lU3VtID0gMDtcclxuICAgIHByaXZhdGUgbWV0cm9ub21lT246IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgIHByaXZhdGUgcGxheUl0ZXI6IG51bWJlciA9IDA7XHJcbiAgICBwcml2YXRlIG1heFByYWN0aWNlVGltZXM6IG51bWJlciA9IDE7XHJcbiAgICBcclxuICAgIHByaXZhdGUgb3BlblN0cmluZ1R1bmVzOiBudW1iZXJbXSA9IFs0MCwgNDUsIDUwLCA1NSwgNTksIDY0XTsgLy9FMiwgQTIsIEQzLCBHMywgQjMsIEU0XHJcbiAgICBwcml2YXRlIGRldmljZVN0YXJ0VGltZTogbnVtYmVyID0gMDtcclxuICAgIHByaXZhdGUgY29sbGVjdFByYWN0Q29udGVudDogTWlkaUlucHV0W10gPSBbXTtcclxuXHJcbiAgICBwcml2YXRlIGFubHl6ZU1ldGhvZDogQW5seXplTWV0aG9kID0gXCJwbHVja1wiO1xyXG4gICAgcHJpdmF0ZSBsb2FkZWRTaGVldDogTm90ZUluZm9bXSA9IFtdO1xyXG4gICAgcHJpdmF0ZSBwcmVNZXRyb25vbWU6IGJvb2xlYW4gPSB0cnVlO1xyXG4gICAgcHJpdmF0ZSBjb3JyZWN0VG9sZXJhbmNlOiBudW1iZXIgPSAxMDA7XHJcblxyXG4gICAgcHJpdmF0ZSBkZXZpY2VzOiBudW1iZXJbXSA9IFtdO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKGNvbnRyb2xUYWI6IFNMVGFiLCBlZGl0b3I6IFNMRWRpdG9yLCBtZXRyb25vbWU6IE1ldHJvbm9tZSl7XHJcbiAgICAgICAgdGhpcy5jb250cm9sVGFiID0gY29udHJvbFRhYjtcclxuICAgICAgICB0aGlzLmVkaXRvciA9IGVkaXRvcjtcclxuICAgICAgICB0aGlzLm1ldHJvbm9tZSA9IG1ldHJvbm9tZTtcclxuICAgICAgICB0aGlzLnNldEV2ZW50cygpO1xyXG4gICAgfVxyXG5cclxuICAgIHBsYXkgKCl7XHJcbiAgICAgICAgdGhpcy5zdGFydEZsYWcgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuY29udHJvbFRhYi5pbkVkaXQgPSBmYWxzZTtcclxuICAgICAgICBpZih0aGlzLnBsYXlJdGVyID09IHRoaXMubWF4UHJhY3RpY2VUaW1lcyB8fCAodGhpcy5wbGF5SXRlcj4wICYmICF0aGlzLmlzUmVwZWF0KSkge1xyXG4gICAgICAgICAgICB0aGlzLnN0b3AoKTtcclxuICAgICAgICAgICAgcmV0dXJuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIC8vTG9hZCB0aGUgc2hlZXQgZnJvbSBzbHRhYiBcclxuICAgICAgICB0aGlzLmxvYWRlZFNoZWV0ID0gdGhpcy5sb2FkU2hlZXROb3RlKCk7XHJcblxyXG4gICAgICAgIC8vQ2xlYXIgcHJhY3RpY2UgVUlcclxuICAgICAgICB0aGlzLmNsZWFyQW5hbHl6ZVVJKCk7XHJcbiAgICAgICAgaWYodGhpcy5wbGF5SXRlciA+IDApe1xyXG4gICAgICAgICAgICAvLyBsZXQgcmVzdWx0ID0gdGhpcy5wcmFjdGljZUFuYWx5emUodGhpcy5jb2xsZWN0UHJhY3RDb250ZW50LHRoaXMuZGV2aWNlU3RhcnRUaW1lLCBuZXcgRGF0ZSgpLmdldFRpbWUoKSk7XHJcbiAgICAgICAgICAgIGlmKHRoaXMuYW5seXplTWV0aG9kID09IFwid2hvbGVcIil7XHJcbiAgICAgICAgICAgICAgICBsZXQgcmVzdWx0ID0gdGhpcy5wcmFjdGljZUFuYWx5emUodGhpcy5jb2xsZWN0UHJhY3RDb250ZW50KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZih0aGlzLnBsYXlJdGVyID09IDApe1xyXG4gICAgICAgICAgICB0aGlzLm1ldHJvbm9tZS5zdG9wVGljaygpO1xyXG4gICAgICAgICAgICB0aGlzLnRpbWVyLnN0b3AoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBzZWN0aW9uTm90ZXM6IFNWR05vdGVbXVtdO1xyXG4gICAgICAgIGlmKHRoaXMuZWRpdG9yLlNlbGVjdGVkTm90ZXMubGVuZ3RoPjApey8vSWYgc2VsZWN0ZWQgbW9yZSB0aGVuIG9uZSBub3RlIHN3YXAgdG8gcmVwZWF0IHBsYXlpbmcgbW9kZVxyXG4gICAgICAgICAgICB0aGlzLmlzUmVwZWF0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgc2VjdGlvbk5vdGVzID0gdGhpcy5zb3J0QnlTZWN0aW9uSWQodGhpcy5lZGl0b3IuU2VsZWN0ZWROb3Rlcyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2V7XHJcbiAgICAgICAgICAgIHRoaXMuaXNSZXBlYXQgPSBmYWxzZTtcclxuICAgICAgICAgICAgbGV0IHNlbGVjdGlvbiA9IHRoaXMuY29udHJvbFRhYi5oZWFkVG9FbmRTZWxlY3QodGhpcy5jb250cm9sVGFiLm5vdGVJbmRleCh0aGlzLmVkaXRvci5zZWxlY3RlZE5vdGUpKTtcclxuICAgICAgICAgICAgc2VjdGlvbk5vdGVzID0gdGhpcy5zb3J0QnlTZWN0aW9uSWQoc2VsZWN0aW9uKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IHNlY3Rpb25MZW5TdW06IG51bWJlciA9IDA7XHJcbiAgICAgICAgbGV0IHByZUJlYXQ6IG51bWJlciA9IDA7XHJcbiAgICAgICAgXHJcbiAgICAgICAgbGV0IHNlY3Rpb25NZXRyb25vbWVCZWF0czogbnVtYmVyW10gPSBbXTtcclxuXHJcbiAgICAgICAgdGhpcy5lZGl0b3IudW5kaXNwbGF5SW5kaWNhdG9yKCk7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogc2V0UHJhY3RpY2VTZWN0aW9uSW5kaWNhdG9yKHdob2xlIHNlbGVjdGVkIG5vdGUgaW5mbylcclxuICAgICAgICAgKi9cclxuXHJcbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcbiAgICAgICAgc2VjdGlvbk5vdGVzLmZvckVhY2goKGVsZW0sIGluZGV4LCBzZWxmKSA9PntcclxuICAgICAgICAgICAgbGV0IHNlY3Rpb25FbmRzID0gdGhpcy5zZWN0aW9uVHdvRW5kcyhlbGVtKTtcclxuICAgICAgICAgICAgbGV0IHNlY3Rpb25CZWF0czogbnVtYmVyID0gMDtcclxuICAgICAgICAgICAgaWYoaW5kZXggPT0gMCl7XHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLm5vd1BsYXlTZWN0aW9uSW5kaWNhdG9yICA9PSBudWxsKXtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm5vd1BsYXlTZWN0aW9uSW5kaWNhdG9yID0gdGhpcy5jb250cm9sVGFiLnRhYkNhbnZhcy5sYXllcnMudWkuY3JlYXRlUmVjdChzZWN0aW9uRW5kcy54MSwgc2VjdGlvbkVuZHMueTEsIHNlY3Rpb25FbmRzLngyIC0gc2VjdGlvbkVuZHMueDEsIHNlY3Rpb25FbmRzLnkyIC0gc2VjdGlvbkVuZHMueTEsIDIsIHRoaXMuaW5kaWNhdG9yQ29sb3IpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm5vd1BsYXlTZWN0aW9uSW5kaWNhdG9yLnNldFBvcyhzZWN0aW9uRW5kcy54MSwgc2VjdGlvbkVuZHMueTEpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubm93UGxheVNlY3Rpb25JbmRpY2F0b3Iuc2V0U2hhcGUoc2VjdGlvbkVuZHMueDIgLSBzZWN0aW9uRW5kcy54MSwgc2VjdGlvbkVuZHMueTIgLSBzZWN0aW9uRW5kcy55MSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvL0lmIHRoZSBmaXJzdCBub3RlIHNlbGVjdGVkIGlzIG5vdGUgb24gdGhlIGJlYXQsIGNhbGMgYSBwcmViZWF0IG5vdGUgdmFsdWUuXHJcbiAgICAgICAgICAgICAgICBpZihlbGVtWzBdLm5vdGUgIT0gMCl7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHByZVN1bTogbnVtYmVyID0gMDtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgZmlyc3RTZWN0aW9uOiBOb3RlW10gPSB0aGlzLmNvbnRyb2xUYWIuZ2V0U2VjdGlvbkRhdGEoZWxlbVswXS5zZWN0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IobGV0IGkgPSAwO2k8IGVsZW1bMF0ubm90ZTsgaSsrKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcHJlU3VtICs9IHRoaXMudGltZVNpZ25hdHVyZS5sb3dlci9maXJzdFNlY3Rpb25baV1bMF07XHJcbiAgICAgICAgICAgICAgICAgICAgfSBcclxuICAgICAgICAgICAgICAgICAgICBpZihwcmVTdW0gJTEgIT0gMCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByZUJlYXQgPSB0aGlzLnRpbWVTaWduYXR1cmUubG93ZXIvKDEgLSAocHJlU3VtJTEpKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGxldCBzZWN0aW9uTGVuOiBudW1iZXIgPSAwO1xyXG5cclxuICAgICAgICAgICAgZWxlbS5mb3JFYWNoKChub3RlLCBpLCBzKSA9PntcclxuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKG5vdGUpXHJcbiAgICAgICAgICAgICAgICBsZXQgdGhpc05vdGU6IE5vdGUgPSB0aGlzLmNvbnRyb2xUYWIuZ2V0Tm90ZURhdGEobm90ZS5zZWN0aW9uLCBub3RlLm5vdGUpO1xyXG4gICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2codGhpc05vdGUpXHJcbiAgICAgICAgICAgICAgICBzZWN0aW9uTGVuICs9IHRoaXMubm90ZVZhbGV1MlRpbWUodGhpc05vdGUubm90ZVZhbHVlKTtcclxuICAgICAgICAgICAgICAgIHNlY3Rpb25CZWF0cyArPSB0aGlzLnRpbWVTaWduYXR1cmUubG93ZXIvdGhpc05vdGUubm90ZVZhbHVlO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgc2VjdGlvbkxlblN1bSArPSBzZWN0aW9uTGVuO1xyXG4gICAgICAgICAgICBzZWN0aW9uTWV0cm9ub21lQmVhdHMucHVzaChzZWN0aW9uQmVhdHMpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgaWYoc2VsZi5sZW5ndGggPT0gMSl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRpbWVyLnJlZ2lzdGVyRGVsYXkodGhpcy5zdG9wTm93UGxheVNlY3Rpb25JbmRpY2F0b3IuYmluZCh0aGlzKSwgc2VjdGlvbkxlbioxMDAwLCAxKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmKHNlbGYubGVuZ3RoID4gMSAmJiBpbmRleCA8IHNlbGYubGVuZ3RoIC0xKXtcclxuICAgICAgICAgICAgICAgIGxldCBuZXh0U2VjdGlvbkVuZHMgPSB0aGlzLnNlY3Rpb25Ud29FbmRzKHNlbGZbaW5kZXgrMV0pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbmRpY2F0b3JTaGFwZXMucHVzaCh7eDogbmV4dFNlY3Rpb25FbmRzLngxLCB5OiBuZXh0U2VjdGlvbkVuZHMueTEsIHdpZHRoOiBuZXh0U2VjdGlvbkVuZHMueDIgLSBuZXh0U2VjdGlvbkVuZHMueDEsIGhlaWdodDogbmV4dFNlY3Rpb25FbmRzLnkyIC0gbmV4dFNlY3Rpb25FbmRzLnkxfSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRpbWVyLnJlZ2lzdGVyRGVsYXkodGhpcy5wdXNoTm93UGxheVNlY3Rpb25JbmRpY2F0b3IuYmluZCh0aGlzKSwgc2VjdGlvbkxlblN1bSoxMDAwLCAxKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZihpbmRleCA9PSBzZWxmLmxlbmd0aCAtMSl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRpbWVyLnJlZ2lzdGVyRGVsYXkodGhpcy5wbGF5LmJpbmQodGhpcyksIHNlY3Rpb25MZW5TdW0qMTAwMCwgMSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBsZXQgc2VjdGlvblN0YXJ0VGltZTogbnVtYmVyID0gMDtcclxuXHJcbiAgICAgICAgaWYodGhpcy5wbGF5SXRlciA9PSAwKXtcclxuICAgICAgICAgICAgbGV0IHJlcGVhdFRpbWUgPSAxO1xyXG4gICAgICAgICAgICBpZih0aGlzLmlzUmVwZWF0KSByZXBlYXRUaW1lID10aGlzLm1heFByYWN0aWNlVGltZXM7XHJcbiAgICAgICAgICAgIGZvcihsZXQgaSA9IDAgOyBpIDwgcmVwZWF0VGltZTsgaSsrKXtcclxuICAgICAgICAgICAgICAgIHNlY3Rpb25NZXRyb25vbWVCZWF0cy5mb3JFYWNoKChlbCwgaSwgc2VsZikgPT57XHJcbiAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5zZWxlY3RlZFRpbWVTdW0gPT0gMCAmJiBzZWN0aW9uU3RhcnRUaW1lID09IDApIHNlY3Rpb25TdGFydFRpbWUgKz0gdGhpcy5wbGF5TGFnO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBzZWN0aW9uRHVyYXRpb24gPSBlbCAqIDYwIC90aGlzLmJwbTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlbClcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlZ2lzdGVyU2VjdGlvbk1ldHJvbm9tZSh0aGlzLnNlbGVjdGVkVGltZVN1bSArIHNlY3Rpb25TdGFydFRpbWUsIGVsLCBzZWN0aW9uTm90ZXNbaV1bMF0ubm90ZSA9PSAwLCBwcmVCZWF0KTtcclxuICAgICAgICAgICAgICAgICAgICBzZWN0aW9uU3RhcnRUaW1lICs9IHNlY3Rpb25EdXJhdGlvbjtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zZWxlY3RlZFRpbWVTdW0gKz0gc2VjdGlvblN0YXJ0VGltZTtcclxuICAgICAgICB0aGlzLnBsYXlJdGVyICs9IDE7XHJcbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuICAgICAgICB0aGlzLnRpbWVyLnN0YXJ0KCk7XHJcbiAgICAgICAgaWYoIXRoaXMubWV0cm9ub21lT24pe1xyXG4gICAgICAgICAgICB0aGlzLm1ldHJvbm9tZS5wbGF5KCk7XHJcbiAgICAgICAgICAgIHRoaXMubWV0cm9ub21lT24gPSB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy9TdGFydCBwcmFjdGljZXIgYW5hbHl6ZSBzZWN0aW9uLlxyXG4gICAgICAgIHRoaXMuZGV2aWNlU3RhcnRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XHJcblxyXG5cclxuICAgIH1cclxuICAgIHN0b3AoKXtcclxuICAgICAgICB0aGlzLnRpbWVyLnN0b3AoKTtcclxuICAgICAgICB0aGlzLnN0b3BOb3dQbGF5U2VjdGlvbkluZGljYXRvcigpO1xyXG4gICAgICAgIHRoaXMuaW5kaWNhdG9yU2hhcGVzID0gW107XHJcbiAgICAgICAgdGhpcy5tZXRyb25vbWUuc3RvcFRpY2soKTtcclxuICAgICAgICB0aGlzLm1ldHJvbm9tZU9uID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5zZWxlY3RlZFRpbWVTdW0gPSAwO1xyXG4gICAgICAgIHRoaXMucGxheUl0ZXIgPSAwO1xyXG4gICAgICAgIHRoaXMuZWRpdG9yLmRpc3BsYXlJbmRpY2F0b3IoKTtcclxuICAgICAgICB0aGlzLnBsYXlGbGFnID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5zdGFydEZsYWcgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmNvbnRyb2xUYWIuaW5FZGl0ID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgLy8gbGV0IHJlc3VsdCA9IHRoaXMucHJhY3RpY2VBbmFseXplKHRoaXMuY29sbGVjdFByYWN0Q29udGVudCx0aGlzLmRldmljZVN0YXJ0VGltZSwgbmV3IERhdGUoKS5nZXRUaW1lKCkpO1xyXG4gICAgICAgIGlmKHRoaXMuYW5seXplTWV0aG9kID09IFwid2hvbGVcIil7XHJcbiAgICAgICAgICAgIGxldCByZXN1bHQgPSB0aGlzLnByYWN0aWNlQW5hbHl6ZSh0aGlzLmNvbGxlY3RQcmFjdENvbnRlbnQpO1xyXG4gICAgICAgICAgICB0aGlzLmRyYXdBbmFseXplVUkodGhpcy5jb250cm9sVGFiLnRhYkNhbnZhcy5sYXllcnMudWksIHJlc3VsdCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGJpbmREZXZpY2UoKXtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgLy8gb25QbHVjayhpbnB1dDogTWlkaUlucHV0KXtcclxuICAgIC8vICAgICBpZih0aGlzLnBsYXlGbGFnKXtcclxuICAgIC8vICAgICAgICAgdGhpcy5jb2xsZWN0UHJhY3RDb250ZW50LnB1c2goaW5wdXQpO1xyXG4gICAgLy8gICAgIH1cclxuICAgIC8vIH1cclxuICAgIG9uUGx1Y2soY2hhbm5lbDogbnVtYmVyLCBub3RlOiBudW1iZXIsIHRpbWU6IG51bWJlcil7XHJcbiAgICAgICAgbGV0IGlucHV0OiBNaWRpSW5wdXQgPSB7XCJjaGFubmVsXCI6IGNoYW5uZWwsIFwibm90ZVwiOiBub3RlLCBcInRpbWVcIjogdGltZX07XHJcbiAgICAgICAgaWYodGhpcy5zdGFydEZsYWcpe1xyXG4gICAgICAgICAgICB0aGlzLmNvbGxlY3RQcmFjdENvbnRlbnQucHVzaChpbnB1dCk7XHJcbiAgICAgICAgICAgIGlmKHRoaXMuYW5seXplTWV0aG9kID09IFwicGx1Y2tcIil7XHJcbiAgICAgICAgICAgICAgICBsZXQgcmVzdWx0czogQW5hbHl6ZVJlc3VsdFtdID0gdGhpcy5wcmFjdGljZUFuYWx5emUoW2lucHV0XSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRyYXdBbmFseXplVUkodGhpcy5jb250cm9sVGFiLnRhYkNhbnZhcy5sYXllcnMudWksIHJlc3VsdHMpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGxvYWRTaGVldE5vdGUoKTogTm90ZUluZm9bXXtcclxuICAgICAgICBsZXQgbG9hZGVkU2hlZXQ6IE5vdGVJbmZvW10gPSBbXVxyXG4gICAgICAgIGxldCBub3RlVGltZSA9IDA7XHJcbiAgICAgICAgbGV0IG5vdGVJZCA9IDA7XHJcbiAgICAgICAgdGhpcy5jb250cm9sVGFiLm5vdGVzLmZvckVhY2goKGVsZW0sIGksIHNlbGYpID0+e1xyXG4gICAgICAgICAgICBlbGVtLmZvckVhY2goKGVsLCBqLCBzKSA9PntcclxuICAgICAgICAgICAgICAgIGxvYWRlZFNoZWV0LnB1c2goe1wic2VjdGlvblwiOmksIFwibm90ZVwiOiBqLFwibm90ZUlkXCI6IG5vdGVJZCwgXCJub3RlVmFsdWVcIjogZWwubm90ZVZhbHVlLCAnbm90ZVRpbWUnOiBub3RlVGltZSwgJ3N0cmluZ0NvbnRlbnQnOiBlbFsxXSwgXCJzdHlsZVwiOiBlbFsyXX0pO1xyXG4gICAgICAgICAgICAgICAgbm90ZVRpbWUgKz0gdGhpcy5ub3RlVmFsZXUyVGltZShlbC5ub3RlVmFsdWUpICogMTAwMDtcclxuICAgICAgICAgICAgICAgIG5vdGVJZCArPSAxO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gbG9hZGVkU2hlZXQ7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIHBsYXlQcmFjdGljZVNlY3Rpb25JbmRpY2F0b3IoKXtcclxuICAgICAgICB0aGlzLnRpbWVyLnN0YXJ0KCk7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIHNldFByYWN0aWNlU2VjdGlvbkluZGljYXRvcihzZWN0aW9uTm90ZXM6IFNWR05vdGVbXVtdKXtcclxuICAgICAgICBsZXQgc2VjdGlvbkxlblN1bTogbnVtYmVyID0gMDtcclxuICAgICAgICBzZWN0aW9uTm90ZXMuZm9yRWFjaCgoZWxlbSwgaW5kZXgsIHNlbGYpID0+e1xyXG4gICAgICAgICAgICBsZXQgc2VjdGlvbkVuZHMgPSB0aGlzLnNlY3Rpb25Ud29FbmRzKGVsZW0pO1xyXG4gICAgICAgICAgICBsZXQgc2VjdGlvbkJlYXRzOiBudW1iZXIgPSAwO1xyXG4gICAgICAgICAgICBpZihpbmRleCA9PSAwKXtcclxuICAgICAgICAgICAgICAgIGlmKHRoaXMubm93UGxheVNlY3Rpb25JbmRpY2F0b3IgID09IG51bGwpe1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubm93UGxheVNlY3Rpb25JbmRpY2F0b3IgPSB0aGlzLmNvbnRyb2xUYWIudGFiQ2FudmFzLmxheWVycy51aS5jcmVhdGVSZWN0KHNlY3Rpb25FbmRzLngxLCBzZWN0aW9uRW5kcy55MSwgc2VjdGlvbkVuZHMueDIgLSBzZWN0aW9uRW5kcy54MSwgc2VjdGlvbkVuZHMueTIgLSBzZWN0aW9uRW5kcy55MSwgMiwgdGhpcy5pbmRpY2F0b3JDb2xvcik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNle1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubm93UGxheVNlY3Rpb25JbmRpY2F0b3Iuc2V0UG9zKHNlY3Rpb25FbmRzLngxLCBzZWN0aW9uRW5kcy55MSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ub3dQbGF5U2VjdGlvbkluZGljYXRvci5zZXRTaGFwZShzZWN0aW9uRW5kcy54MiAtIHNlY3Rpb25FbmRzLngxLCBzZWN0aW9uRW5kcy55MiAtIHNlY3Rpb25FbmRzLnkxKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBsZXQgc2VjdGlvbkxlbjogbnVtYmVyID0gMDtcclxuICAgICAgICAgICAgZWxlbS5mb3JFYWNoKChub3RlLCBpLCBzKSA9PntcclxuICAgICAgICAgICAgICAgIGxldCB0aGlzTm90ZTogTm90ZSA9IHRoaXMuY29udHJvbFRhYi5nZXROb3RlRGF0YShub3RlLnNlY3Rpb24sIG5vdGUubm90ZSk7XHJcbiAgICAgICAgICAgICAgICBzZWN0aW9uTGVuICs9IHRoaXMubm90ZVZhbGV1MlRpbWUodGhpc05vdGUubm90ZVZhbHVlKTtcclxuICAgICAgICAgICAgICAgIHNlY3Rpb25CZWF0cyArPSB0aGlzLnRpbWVTaWduYXR1cmUubG93ZXIvdGhpc05vdGUubm90ZVZhbHVlO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgc2VjdGlvbkxlblN1bSArPSBzZWN0aW9uTGVuO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgaWYoc2VsZi5sZW5ndGggPT0gMSl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRpbWVyLnJlZ2lzdGVyRGVsYXkodGhpcy5zdG9wTm93UGxheVNlY3Rpb25JbmRpY2F0b3IuYmluZCh0aGlzKSwgc2VjdGlvbkxlbioxMDAwLCAxKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmKHNlbGYubGVuZ3RoID4gMSAmJiBpbmRleCA8IHNlbGYubGVuZ3RoIC0xKXtcclxuICAgICAgICAgICAgICAgIGxldCBuZXh0U2VjdGlvbkVuZHMgPSB0aGlzLnNlY3Rpb25Ud29FbmRzKHNlbGZbaW5kZXgrMV0pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbmRpY2F0b3JTaGFwZXMucHVzaCh7eDogbmV4dFNlY3Rpb25FbmRzLngxLCB5OiBuZXh0U2VjdGlvbkVuZHMueTEsIHdpZHRoOiBuZXh0U2VjdGlvbkVuZHMueDIgLSBuZXh0U2VjdGlvbkVuZHMueDEsIGhlaWdodDogbmV4dFNlY3Rpb25FbmRzLnkyIC0gbmV4dFNlY3Rpb25FbmRzLnkxfSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRpbWVyLnJlZ2lzdGVyRGVsYXkodGhpcy5wdXNoTm93UGxheVNlY3Rpb25JbmRpY2F0b3IuYmluZCh0aGlzKSwgc2VjdGlvbkxlblN1bSoxMDAwLCAxKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZihpbmRleCA9PSBzZWxmLmxlbmd0aCAtMSl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRpbWVyLnJlZ2lzdGVyRGVsYXkodGhpcy5wbGF5LmJpbmQodGhpcyksIHNlY3Rpb25MZW5TdW0qMTAwMCwgMSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHB1c2hOb3dQbGF5U2VjdGlvbkluZGljYXRvcigpe1xyXG4gICAgICAgIGxldCBuZXh0U2hhcGUgPSB0aGlzLmluZGljYXRvclNoYXBlcy5zaGlmdCgpO1xyXG4gICAgICAgIHRoaXMubm93UGxheVNlY3Rpb25JbmRpY2F0b3Iuc2V0UG9zKG5leHRTaGFwZS54LCBuZXh0U2hhcGUueSk7XHJcbiAgICAgICAgdGhpcy5ub3dQbGF5U2VjdGlvbkluZGljYXRvci5zZXRTaGFwZShuZXh0U2hhcGUud2lkdGgsIG5leHRTaGFwZS5oZWlnaHQpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc3RvcE5vd1BsYXlTZWN0aW9uSW5kaWNhdG9yKCl7XHJcbiAgICAgICAgaWYodGhpcy5ub3dQbGF5U2VjdGlvbkluZGljYXRvciAhPSBudWxsKXtcclxuICAgICAgICAgICAgdGhpcy5ub3dQbGF5U2VjdGlvbkluZGljYXRvci5yZW1vdmUoKTtcclxuICAgICAgICAgICAgdGhpcy5ub3dQbGF5U2VjdGlvbkluZGljYXRvciA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0U2V0aW9uQmVhdHMoc2VjdGlvbk5vdGVzOiBTVkdOb3RlW10pe1xyXG4gICAgICAgIC8vIElmIHRoZSBmaXJzdCBub3RlIHNlbGVjdGVkIGlzIG5vdGUgb24gdGhlIGJlYXQsIGNhbGMgYSBwcmViZWF0IG5vdGUgdmFsdWUuXHJcbiAgICAgICAgbGV0IHByZUJlYXQgPSAwO1xyXG4gICAgICAgIGlmKHNlY3Rpb25Ob3Rlc1swXS5ub3RlICE9IDApe1xyXG4gICAgICAgICAgICBsZXQgcHJlU3VtOiBudW1iZXIgPSAwO1xyXG4gICAgICAgICAgICBsZXQgc2VjdGlvbk5vdGVSYXc6IE5vdGVbXSA9IHRoaXMuY29udHJvbFRhYi5nZXRTZWN0aW9uRGF0YShzZWN0aW9uTm90ZXNbMF0uc2VjdGlvbik7XHJcbiAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7aTwgc2VjdGlvbk5vdGVzWzBdLm5vdGU7IGkrKyl7XHJcbiAgICAgICAgICAgICAgICBwcmVTdW0gKz0gdGhpcy50aW1lU2lnbmF0dXJlLmxvd2VyL3NlY3Rpb25Ob3RlUmF3W2ldWzBdO1xyXG4gICAgICAgICAgICB9IFxyXG4gICAgICAgICAgICBpZihwcmVTdW0gJTEgIT0gMCl7XHJcbiAgICAgICAgICAgICAgICBwcmVCZWF0ID0gdGhpcy50aW1lU2lnbmF0dXJlLmxvd2VyLygxIC0gKHByZVN1bSUxKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBub3RlVmFsZXUyVGltZSAobm90ZVZhbHVlOiBudW1iZXIpOiBudW1iZXJ7XHJcbiAgICAgICAgaWYobm90ZVZhbHVlID09IDApIHJldHVybiAwO1xyXG4gICAgICAgIGVsc2UgcmV0dXJuICh0aGlzLnRpbWVTaWduYXR1cmUubG93ZXIvbm90ZVZhbHVlKS8odGhpcy5icG0vNjApO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcmVnaXN0ZXJTZWN0aW9uTWV0cm9ub21lKHN0YXJ0VGltZTogbnVtYmVyLCBzZWN0aW9uQmVhdHM6IG51bWJlciwgZmlyc3RDbGljazogYm9vbGVhbiwgcHJlQmVhdD86IG51bWJlcil7XHJcbiAgICAgICAgaWYocHJlQmVhdCA9PSBudWxsKXtcclxuICAgICAgICAgICAgcHJlQmVhdCA9IDA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBwcmUgPSB0aGlzLnRpbWVTaWduYXR1cmUubG93ZXIvcHJlQmVhdFxyXG4gICAgICAgIGlmKHByZSA9PSBJbmZpbml0eSkgcHJlID0gMDtcclxuICAgICAgICAvL01ldHJvbm9tZSBjbGljayBmaXJzdCBiZWF0IG9uIHRoZSBzZWN0aW9uXHJcbiAgICAgICAgaWYoZmlyc3RDbGljaykge1xyXG4gICAgICAgICAgICB0aGlzLm1ldHJvbm9tZS5zY2hlZHVsZVRpY2soc3RhcnRUaW1lKjEwMDAsICdzdHJvbmcnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMubWV0cm9ub21lLnNjaGVkdWxlVGljaygoc3RhcnRUaW1lICsgdGhpcy5ub3RlVmFsZXUyVGltZShwcmVCZWF0KSkqMTAwMCwgJ25vcm1hbCcpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zb2xlLmxvZyhzZWN0aW9uQmVhdHMgLSBwcmUpXHJcbiAgICAgICAgZm9yKGxldCBpID0gMTsgaSA8IE1hdGguZmxvb3Ioc2VjdGlvbkJlYXRzIC0gcHJlKTsgaSsrKXtcclxuICAgICAgICAgICAgdGhpcy5tZXRyb25vbWUuc2NoZWR1bGVUaWNrKChzdGFydFRpbWUgKyBpICogdGhpcy5ub3RlVmFsZXUyVGltZSh0aGlzLnRpbWVTaWduYXR1cmUubG93ZXIpICsgdGhpcy5ub3RlVmFsZXUyVGltZShwcmVCZWF0KSkqMTAwMCwgJ25vcm1hbCcpXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2V0RXZlbnRzKCl7XHJcbiAgICAgICAgdGhpcy5jb250cm9sVGFiLm9uKFwia2V5ZG93blwiLCAoa2V5KSA9PiB7XHJcbiAgICAgICAgICAgIGlmKCg8c3RyaW5nPmtleSkudG9Mb3dlckNhc2UoKSA9PT0gXCIgXCIpe1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jb250cm9sVGFiLmluRWRpdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wbGF5RmxhZyA9ICF0aGlzLnBsYXlGbGFnO1xyXG4gICAgICAgICAgICAgICAgaWYodGhpcy5wbGF5RmxhZyl7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lZGl0b3IudW5kaXNwbGF5SW5kaWNhdG9yKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5wcmVNZXRyb25vbWUpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlZ2lzdGVyU2VjdGlvbk1ldHJvbm9tZSh0aGlzLnBsYXlMYWcsIHRoaXMudGltZVNpZ25hdHVyZS51cHBlcix0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50aW1lci5yZWdpc3RlckRlbGF5KHRoaXMucGxheS5iaW5kKHRoaXMpLCB0aGlzLnRpbWVTaWduYXR1cmUudXBwZXIqdGhpcy5ub3RlVmFsZXUyVGltZSh0aGlzLnRpbWVTaWduYXR1cmUubG93ZXIpKjEwMDApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1ldHJvbm9tZS5wbGF5KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudGltZXIuc3RhcnQoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0b3AoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMuY2xlYXJBbmFseXplVUkoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZigoPHN0cmluZz5rZXkpLnRvTG93ZXJDYXNlKCkgPT09IFwicVwiKXtcclxuICAgICAgICAgICAgICAgIC8vIHRoaXMub25QbHVjayh7XCJjaGFubmVsXCI6IDAsIFwibm90ZVwiOiAwLCBcInRpbWVcIjogbmV3IERhdGUoKS5nZXRUaW1lKCl9KVxyXG4gICAgICAgICAgICAgICAgdGhpcy5vblBsdWNrKDAsIDAsIHBlcmZvcm1hbmNlLm5vdygpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuY29udHJvbFRhYi5vbihcIm1vdXNlZG93blwiLCAoeCwgeSkgPT57XHJcbiAgICAgICAgICAgIHRoaXMuY2xlYXJBbmFseXplVUkoKTtcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc29ydEJ5U2VjdGlvbklkKG5vdGVzOiBTVkdOb3RlW10pOiBBcnJheTxTVkdOb3RlW10+e1xyXG4gICAgICAgIGxldCBzZWxlY3RlZFNlY3Rpb25zOiBudW1iZXJbXSA9IFtdO1xyXG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBub3Rlcy5sZW5ndGg7IGkrKyl7XHJcbiAgICAgICAgICAgIHNlbGVjdGVkU2VjdGlvbnMucHVzaChub3Rlc1tpXS5zZWN0aW9uKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IHVuaXF1ZVNlbGVjdGVkU2VjdGlvbnMgPSBzZWxlY3RlZFNlY3Rpb25zLmZpbHRlcihmdW5jdGlvbihlbGVtLCBpbmRleCwgc2VsZil7XHJcbiAgICAgICAgICAgIHJldHVybiBpbmRleCA9PSBzZWxmLmluZGV4T2YoZWxlbSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgbGV0IHJldDogQXJyYXk8U1ZHTm90ZVtdPiA9IFtdO1xyXG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCB1bmlxdWVTZWxlY3RlZFNlY3Rpb25zLmxlbmd0aDsgaSsrKXtcclxuICAgICAgICAgICAgbGV0IHB1c2hOb3RlcyA9IG5vdGVzLmZpbHRlcihmdW5jdGlvbihlbGVtLCBpbmRleCwgc2VsZil7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZWxlbS5zZWN0aW9uID09IHVuaXF1ZVNlbGVjdGVkU2VjdGlvbnNbaV07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXQucHVzaChwdXNoTm90ZXMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmV0O1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2VjdGlvblR3b0VuZHMoc2VjdGlvbjogU1ZHTm90ZVtdKToge3gxOiBudW1iZXIsIHkxOiBudW1iZXIsIHgyOiBudW1iZXIsIHkyOiBudW1iZXJ9e1xyXG4gICAgICAgIGxldCBzdHJpbmdzID0gc2VjdGlvblswXS5ibG9ja0dyb3VwLmxlbmd0aDtcclxuICAgICAgICBsZXQgbGVmdFRvcEVuZCA9IHt4OiBzZWN0aW9uWzBdLmJsb2NrR3JvdXBbMF0ueCwgeTogc2VjdGlvblswXS5ibG9ja0dyb3VwWzBdLnl9O1xyXG4gICAgICAgIGxldCByaWdodEJvdEVuZCA9IHt4OiBzZWN0aW9uW3NlY3Rpb24ubGVuZ3RoIC0xXS5ibG9ja0dyb3VwW3N0cmluZ3MgLTFdLngsIHk6IHNlY3Rpb25bc2VjdGlvbi5sZW5ndGggLTFdLmJsb2NrR3JvdXBbc3RyaW5ncyAtMV0ueX07XHJcbiAgICAgICAgaWYoc2VjdGlvblswXS5ub3RlID09IDApe1xyXG4gICAgICAgICAgICBsZXQgdGhpc1NlY3Rpb24gPSB0aGlzLmNvbnRyb2xUYWIudGFiQ2FudmFzLmxheWVycy51aS5zZWN0aW9uSW5kaWNhdG9yW3NlY3Rpb25bMF0uc2VjdGlvbl07XHJcbiAgICAgICAgICAgIGxlZnRUb3BFbmQgPSB7eDogdGhpc1NlY3Rpb24ueCwgeTogdGhpc1NlY3Rpb24ueX07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKHNlY3Rpb25bc2VjdGlvbi5sZW5ndGggLTFdLm5vdGUgPT0gdGhpcy5jb250cm9sVGFiLm5vdGVzW3NlY3Rpb25bc2VjdGlvbi5sZW5ndGggLTFdLnNlY3Rpb25dLmxlbmd0aCAtMSl7XHJcbiAgICAgICAgICAgIGxldCB0aGlzU2VjdGlvbiA9IHRoaXMuY29udHJvbFRhYi50YWJDYW52YXMubGF5ZXJzLnVpLnNlY3Rpb25JbmRpY2F0b3Jbc2VjdGlvbltzZWN0aW9uLmxlbmd0aCAtMV0uc2VjdGlvbl07XHJcbiAgICAgICAgICAgIHJpZ2h0Qm90RW5kID0ge3g6IHRoaXNTZWN0aW9uLnggKyB0aGlzU2VjdGlvbi53aWR0aCwgeTogdGhpc1NlY3Rpb24ueSArIHRoaXNTZWN0aW9uLmhlaWdodH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB7eDE6IGxlZnRUb3BFbmQueCwgeTE6IGxlZnRUb3BFbmQueSwgeDI6IHJpZ2h0Qm90RW5kLngsIHkyOiByaWdodEJvdEVuZC55fTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBwcml2YXRlIHByYWN0aWNlQW5hbHl6ZShpbnB1dDogTWlkaUlucHV0W10sIGRldmljZVBsYXlUaW1lOiBudW1iZXIsIGRldmljZUVuZFRpbWU6IG51bWJlcik6IEFuYWx5emVSZXN1bHRbXXtcclxuICAgIHByaXZhdGUgcHJhY3RpY2VBbmFseXplKGlucHV0OiBNaWRpSW5wdXRbXSk6IEFuYWx5emVSZXN1bHRbXXtcclxuICAgICAgICAvLyBsZXQgbG9hZGVkU2hlZXRNdXNpYzogTm90ZUluZm9bXSA9IHRoaXMubG9hZFNoZWV0Tm90ZSgpO1xyXG4gICAgICAgIC8vIGxldCBzaGVldE11c2ljOiBOb3RlSW5mb1tdID0gbG9hZGVkU2hlZXRNdXNpYy5maWx0ZXIoKGVsZW0sIGluZGV4LCBzZWxmKSA9PntcclxuICAgICAgICAvLyAgICAgcmV0dXJuIGVsZW0ubm90ZVRpbWU+PSBkZXZpY2VQbGF5VGltZSAtIHRoaXMuZGV2aWNlU3RhcnRUaW1lICYmIGVsZW0ubm90ZVRpbWUgPD0gZGV2aWNlRW5kVGltZSAtdGhpcy5kZXZpY2VTdGFydFRpbWU7XHJcbiAgICAgICAgLy8gfSk7XHJcbiAgICAgICAgaWYoaW5wdXQubGVuZ3RoIDwgMSkgcmV0dXJuIFtdO1xyXG4gICAgICAgIGlmKHRoaXMubG9hZGVkU2hlZXQubGVuZ3RoIDwgMSkgcmV0dXJuIFtdO1xyXG5cclxuICAgICAgICBsZXQgcmV0czogQW5hbHl6ZVJlc3VsdFtdID0gW107XHJcbiAgICAgICAgaW5wdXQuZm9yRWFjaCgoZWxlbSwgaW5kZXgsIHNlbGYpID0+IHtcclxuICAgICAgICAgICAgbGV0IHJldDogQW5hbHl6ZVJlc3VsdDtcclxuICAgICAgICAgICAgLy8gaWYoZWxlbS50aW1lIDwgZGV2aWNlUGxheVRpbWUgfHwgZWxlbS50aW1lID4gZGV2aWNlRW5kVGltZSl7XHJcbiAgICAgICAgICAgIC8vICAgICByZXR1cm5cclxuICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgICAgICBsZXQgbWFwcGVkTm90ZSA9IHRoaXMudGltZU5vdGVNYXBwaW5nKGVsZW0udGltZSAtIHRoaXMuZGV2aWNlU3RhcnRUaW1lLCB0aGlzLmxvYWRlZFNoZWV0KTtcclxuICAgICAgICAgICAgbGV0IHRpbWVSZXN1bHQ6IFRpbWVSZXN1bHQ7XHJcbiAgICAgICAgICAgIGxldCBub3RlUmVzdWx0OiBib29sZWFuO1xyXG5cclxuICAgICAgICAgICAgLy9DaGVjayBpZiBwbGF5aW5nIGlucHV0IGlzIGNvcnJlY3QgYW5kIHJldHVybiByZXN1bHRzLlxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlbGVtLnRpbWUgLSB0aGlzLmRldmljZVN0YXJ0VGltZSlcclxuICAgICAgICAgICAgY29uc29sZS5sb2cocGVyZm9ybWFuY2Uubm93KCkgLSB0aGlzLmRldmljZVN0YXJ0VGltZSlcclxuICAgICAgICAgICAgaWYoTWF0aC5hYnMoKGVsZW0udGltZSAtIHRoaXMuZGV2aWNlU3RhcnRUaW1lKSAtICh0aGlzLmxvYWRlZFNoZWV0W21hcHBlZE5vdGVdLm5vdGVUaW1lK3RoaXMucGxheUxhZykpIDw9IHRoaXMuY29ycmVjdFRvbGVyYW5jZSl7XHJcbiAgICAgICAgICAgICAgICB0aW1lUmVzdWx0ID0gXCJjb3JyZWN0XCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZigoZWxlbS50aW1lIC0gdGhpcy5kZXZpY2VTdGFydFRpbWUpIC0gKHRoaXMubG9hZGVkU2hlZXRbbWFwcGVkTm90ZV0ubm90ZVRpbWUrdGhpcy5wbGF5TGFnKSA+IDApe1xyXG4gICAgICAgICAgICAgICAgdGltZVJlc3VsdCA9IFwiZHJhZ1wiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2V7XHJcbiAgICAgICAgICAgICAgICB0aW1lUmVzdWx0ID0gJ3J1c2gnO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZihlbGVtLm5vdGUgPT0gdGhpcy5sb2FkZWRTaGVldFttYXBwZWROb3RlXS5zdHJpbmdDb250ZW50W2VsZW0uY2hhbm5lbF0pe1xyXG4gICAgICAgICAgICAgICAgbm90ZVJlc3VsdCA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZXtcclxuICAgICAgICAgICAgICAgIG5vdGVSZXN1bHQgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0ID0ge1xyXG4gICAgICAgICAgICAgICAgXCJzZWN0aW9uXCI6IHRoaXMubG9hZGVkU2hlZXRbbWFwcGVkTm90ZV0uc2VjdGlvbixcclxuICAgICAgICAgICAgICAgIFwibm90ZVwiOiB0aGlzLmxvYWRlZFNoZWV0W21hcHBlZE5vdGVdLm5vdGUsXHJcbiAgICAgICAgICAgICAgICBcImNoYW5uZWxcIjogZWxlbS5jaGFubmVsLFxyXG4gICAgICAgICAgICAgICAgXCJwbGF5ZWROb3RlXCI6IGVsZW0ubm90ZSxcclxuICAgICAgICAgICAgICAgIFwic2hlZXROb3RlXCI6IHRoaXMubG9hZGVkU2hlZXRbbWFwcGVkTm90ZV0uc3RyaW5nQ29udGVudFtlbGVtLmNoYW5uZWxdLFxyXG4gICAgICAgICAgICAgICAgXCJwbGF5ZWRUaW1lXCI6IGVsZW0udGltZSAtIHRoaXMuZGV2aWNlU3RhcnRUaW1lLFxyXG4gICAgICAgICAgICAgICAgXCJzaGVldFRpbWVcIjogdGhpcy5sb2FkZWRTaGVldFttYXBwZWROb3RlXS5ub3RlVGltZSxcclxuICAgICAgICAgICAgICAgIFwibm90ZUlkXCI6IHRoaXMubG9hZGVkU2hlZXRbbWFwcGVkTm90ZV0ubm90ZUlkLFxyXG4gICAgICAgICAgICAgICAgXCJ0aW1lUmVzdWx0XCI6IHRpbWVSZXN1bHQsXHJcbiAgICAgICAgICAgICAgICBcIm5vdGVSZXN1bHRcIjogbm90ZVJlc3VsdFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHMucHVzaChyZXQpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgcmV0dXJuIHJldHM7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBkcmF3QW5hbHl6ZVVJKHRhcmdldDogTGF5ZXIsIHBsYXlSZXN1bHRzOiBBbmFseXplUmVzdWx0W10pe1xyXG4gICAgICAgIHBsYXlSZXN1bHRzLmZvckVhY2goKHJlc3VsdCwgaW5kZXgsIHNlbGYpPT57XHJcbiAgICAgICAgICAgIGxldCBbeCwgeV09ICB0aGlzLmNvbnRyb2xUYWIuZ2V0Tm90ZVBvc2l0aW9uKHJlc3VsdC5zZWN0aW9uLCByZXN1bHQubm90ZSwgcmVzdWx0LmNoYW5uZWwpO1xyXG4gICAgICAgICAgICBsZXQgbm90ZVZhbHVlID0gdGhpcy5jb250cm9sVGFiLmdldE5vdGVEYXRhKHJlc3VsdC5zZWN0aW9uLCByZXN1bHQubm90ZSkubm90ZVZhbHVlO1xyXG5cclxuICAgICAgICAgICAgbGV0IHJlc3VsdFBvc0JpYXM6IG51bWJlciA9IDA7XHJcbiAgICAgICAgICAgIGlmKHJlc3VsdC50aW1lUmVzdWx0ID09IFwiZHJhZ1wiKXtcclxuICAgICAgICAgICAgICAgIHJlc3VsdFBvc0JpYXMgPSAxLyhub3RlVmFsdWUgLyB0aGlzLnRpbWVTaWduYXR1cmUubG93ZXIpICogMzA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAocmVzdWx0LnRpbWVSZXN1bHQgPT0gXCJydXNoXCIpe1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0UG9zQmlhcyA9IDEvKG5vdGVWYWx1ZSAvIHRoaXMudGltZVNpZ25hdHVyZS5sb3dlcikgKiAoLTMwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgbGV0IHJlc3VsdEVsbGlwc2UgPSB0YXJnZXQuY3JlYXRlRWxsaXBzZSh4ICsgcmVzdWx0UG9zQmlhcyAsIHksIDgsIDgpO1xyXG4gICAgICAgICAgICBsZXQgcmVzdWx0VGV4dCA9IHRhcmdldC5jcmVhdGVUZXh0KHggKyByZXN1bHRQb3NCaWFzLCB5ICsgNSwgcmVzdWx0LnBsYXllZE5vdGUudG9TdHJpbmcoKSwgXCJtaWRkbGVcIik7XHJcbiAgICAgICAgICAgIGlmKHJlc3VsdC50aW1lUmVzdWx0ID09IFwiY29ycmVjdFwiICYmIHJlc3VsdC5ub3RlUmVzdWx0KXtcclxuICAgICAgICAgICAgICAgIHJlc3VsdFRleHQuZmlsbCA9IHRoaXMuY29ycmVjdFJlc3VsdENvbG9yO1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0RWxsaXBzZS5maWxsID0gdGhpcy5jb3JyZWN0UmVzdWx0Q29sb3I7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZXtcclxuICAgICAgICAgICAgICAgIC8vIHJlc3VsdFRleHQuZmlsbCA9IHRoaXMud3JvbmdSZXN1bHRDb2xvcjtcclxuICAgICAgICAgICAgICAgIHJlc3VsdFRleHQuZmlsbCA9IHRoaXMud2hpdGVDb2xvcjtcclxuICAgICAgICAgICAgICAgIHJlc3VsdEVsbGlwc2UuZmlsbCA9IHRoaXMud3JvbmdSZXN1bHRDb2xvcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgXHJcblxyXG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhyZXN1bHRFbGxpcHNlLmN4KVxyXG4gICAgICAgICAgICAvLyByZXN1bHRUZXh0LnggKz0gcmVzdWx0UG9zQmlhcztcclxuICAgICAgICAgICAgLy8gcmVzdWx0RWxsaXBzZS5jeCArPSByZXN1bHRQb3NCaWFzO1xyXG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhyZXN1bHRFbGxpcHNlLmN4KVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgdGhpcy5yZXN1bHRVSUVsZW1lbnRzLnB1c2gocmVzdWx0VGV4dCk7XHJcbiAgICAgICAgICAgIHRoaXMucmVzdWx0VUlFbGVtZW50cy5wdXNoKHJlc3VsdEVsbGlwc2UpO1xyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjbGVhckFuYWx5emVVSSgpe1xyXG4gICAgICAgIHRoaXMucmVzdWx0VUlFbGVtZW50cy5mb3JFYWNoKChlbGVtLCBpbmRleCwgc2VsZik9PntcclxuICAgICAgICAgICAgZWxlbS5yZW1vdmUoKTtcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgdGltZU5vdGVNYXBwaW5nKHRpbWU6IG51bWJlciwgc2hlZXRNdXNpYzogTm90ZUluZm9bXSk6IG51bWJlcntcclxuICAgICAgICBsZXQgbGFzdFRpbWUgPSAwO1xyXG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBzaGVldE11c2ljLmxlbmd0aDsgaSsrKXtcclxuICAgICAgICAgICAgaWYodGltZSA+IGxhc3RUaW1lICYmIHRpbWUgPD0gc2hlZXRNdXNpY1tpXS5ub3RlVGltZSl7XHJcbiAgICAgICAgICAgICAgICBpZihNYXRoLmFicyh0aW1lIC0gbGFzdFRpbWUpID4gTWF0aC5hYnModGltZSAtIHNoZWV0TXVzaWNbaV0ubm90ZVRpbWUpKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgcmV0dXJuIGkgLSAxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHRpbWUgPiBzaGVldE11c2ljW3NoZWV0TXVzaWMubGVuZ3RoIC0gMV0ubm90ZVRpbWUpe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHNoZWV0TXVzaWMubGVuZ3RoIC0gMVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGxhc3RUaW1lID0gc2hlZXRNdXNpY1tpXS5ub3RlVGltZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0iXSwibWFwcGluZ3MiOiJBQUdBO0FBQUE7QUFBQTtBQUFBO0FBMkRBO0FBcUNBO0FBakNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUNBOztBQUVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUFBOztBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/SLPract.ts\n");

/***/ }),

/***/ "./src/SlimTabV2.ts":
/*!**************************!*\
  !*** ./src/SlimTabV2.ts ***!
  \**************************/
/*! exports provided: SLTab */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"SLTab\", function() { return SLTab; });\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./utils */ \"./src/utils.ts\");\n/* harmony import */ var _SlimTabV2Types__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./SlimTabV2Types */ \"./src/SlimTabV2Types.ts\");\n/* harmony import */ var _SlimTabV2Canvas__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./SlimTabV2Canvas */ \"./src/SlimTabV2Canvas.ts\");\n\r\n\r\n\r\nclass SLTab {\r\n    constructor(data) {\r\n        this.inEdit = true;\r\n        this.lengthPerBeat = 4;\r\n        this.beatPerSection = 4;\r\n        this.containerHeight = 700;\r\n        this.lineWidth = 1200;\r\n        this.sectionPerLine = 4;\r\n        this.stringPadding = 16; // distance between each string\r\n        this.linePerPage = 20;\r\n        this.lineMargin = 42; // only for left and right\r\n        this.linePadding = [32, 14];\r\n        this.lineDistance = 90; // distance between each line\r\n        this.sectionAddNoteNumber = 8;\r\n        this.linkerElement = [];\r\n        this.startPosition = [this.lineMargin + this.linePadding[0] + 20, 120 + this.linePadding[1]]; // x, y\r\n        this.lineStartPosition = [this.lineMargin, 120]; // total line number, last line X, last line Y\r\n        this.calData = [];\r\n        Object.assign(this, data);\r\n        this.tabCanvas = new _SlimTabV2Canvas__WEBPACK_IMPORTED_MODULE_2__[\"SLCanvas\"](_SlimTabV2Canvas__WEBPACK_IMPORTED_MODULE_2__[\"SLLayer\"]);\r\n        this.width = this.lineWidth + this.linePadding[0] * 2 + 42 * 2;\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.tabCanvas.domElement, { width: `${this.width}` });\r\n        this.domElement = document.createElement(\"div\");\r\n        this.domElement.append(this.tabCanvas.domElement);\r\n        this.domElement.addEventListener(\"keydown\", (e) => {\r\n            let ka = [32, 37, 38, 39, 40]; //space: 32, left: 37, up: 38, right: 39, down: 40,\r\n            if (ka.includes(e.keyCode)) {\r\n                e.preventDefault();\r\n                e.returnValue = false;\r\n            }\r\n        });\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setStyle(this.domElement, { \"width\": `${this.width + 20}px`, height: `${this.containerHeight}px`, \"overflow-y\": \"auto\", \"overflow-x\": \"hidden\" });\r\n        //if add new event, you should describe the callback in eventCallBackInterface above\r\n        this.callbacks = new _utils__WEBPACK_IMPORTED_MODULE_0__[\"Callbacks\"]([\r\n            \"noteclick\",\r\n            \"noteshiftclick\",\r\n            \"notealtclick\",\r\n            \"notectrlclick\",\r\n            \"keydown\",\r\n            \"mouseovernote\",\r\n            \"mouseoutnote\",\r\n            \"mousedown\",\r\n            \"mousemove\",\r\n            \"mouseup\",\r\n            \"rightclick\",\r\n            \"sectionhover\",\r\n            \"sectionhout\",\r\n            \"sectionclick\",\r\n        ]);\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, { tabindex: \"-1\" });\r\n        this.domElement.addEventListener(\"keydown\", this.onKeydown.bind(this));\r\n        this.domElement.addEventListener(\"mousedown\", this.onMouseDown.bind(this));\r\n        this.domElement.addEventListener(\"mousemove\", this.onMouseMove.bind(this));\r\n        this.domElement.addEventListener(\"mouseup\", this.onMouseUp.bind(this));\r\n        this.domElement.addEventListener(\"contextmenu\", this.onMouseRightClick.bind(this)); //Right click\r\n    }\r\n    //todo: do a stricter check for these function\r\n    setData(data) {\r\n        this.clearData();\r\n        let na = [];\r\n        for (let i = 0; i < data.length; i++) {\r\n            let newSection = [];\r\n            for (let j = 0; j < data[i].length; j++) {\r\n                let newNote = new _SlimTabV2Types__WEBPACK_IMPORTED_MODULE_1__[\"Note\"]({ noteValue: data[i][j][0], stringContent: data[i][j][1], userData: data[i][j][2] });\r\n                newSection.push(newNote);\r\n            }\r\n            na.push(newSection);\r\n        }\r\n        this.notes = na;\r\n    }\r\n    getNoteData(section, note) {\r\n        return this.notes[section][note];\r\n    }\r\n    setNoteData(section, note, data) {\r\n        if (section === -1)\r\n            section = this.notes.length - 1;\r\n        if (note === -1)\r\n            note = this.notes[section].length - 1;\r\n        this.notes[section][note] = data;\r\n    }\r\n    setStringDataOfNote(section, note, string, data) {\r\n        if (string >= 0 && string <= 5) {\r\n            this.notes[section][note][1][string] = data;\r\n        }\r\n    }\r\n    getSectionData(section) {\r\n        return this.notes[section];\r\n    }\r\n    deleteNote(section, note, number = 1) {\r\n        if (section === -1)\r\n            section = this.notes.length - 1;\r\n        if (note === -1)\r\n            note = this.notes[section].length - 1;\r\n        let np = this.getNoteFlattenNumber(section, note);\r\n        let dn = this.notes[section].splice(note, number).length;\r\n        this.removeCalData(np, dn);\r\n    }\r\n    addNote(section, note, data) {\r\n        if (this.inEdit) {\r\n            if (section === -1 || section >= this.notes.length) {\r\n                section = this.notes.length;\r\n                this.notes.push([]);\r\n            }\r\n            if (note === -1 || note > this.notes[section].length) {\r\n                note = this.notes[section].length;\r\n            }\r\n            this.notes[section].splice(note, 0, data);\r\n            let np = this.getNoteFlattenNumber(section, note);\r\n            this.calData.splice(np, 0, { x: -1, y: -1, length: -1, blocks: [], tail: [], section: -1, note: -1, hasSvg: false });\r\n        }\r\n    }\r\n    isBlankNote(section, note) {\r\n        for (let i = 0; i < 6; i++) {\r\n            if (this.notes[section][note][1][i] != -1) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n    getSVGNote(section, note) {\r\n        let noteElements = this.tabCanvas.layers.notes.noteElements;\r\n        return noteElements.find((elem) => {\r\n            return elem.section == section && elem.note == note;\r\n        });\r\n    }\r\n    getNotePosition(section, note, string = 0) {\r\n        let sum = 0;\r\n        if (section == -1)\r\n            section = this.notes.length - 1;\r\n        if (note == -1)\r\n            note = this.notes[section].length - 1;\r\n        if (section >= this.notes.length || section < -1 || note >= this.notes[section].length || note < -1 || string > 5 || string < 0) {\r\n            return [-1, -1];\r\n        }\r\n        if (this.notes[section].length === 0)\r\n            return [-1, -1];\r\n        for (let i = 0; i < section; i++) {\r\n            sum += this.notes[i].length;\r\n        }\r\n        sum += note;\r\n        if (!this.tabCanvas.layers.notes.noteElements[sum])\r\n            return [-1, -1];\r\n        let sel = this.tabCanvas.layers.notes.noteElements[sum].blockGroup[string];\r\n        return [sel.x, sel.y];\r\n    }\r\n    getNoteNumberOfSection(section) {\r\n        if (section == -1)\r\n            section = this.notes.length - 1;\r\n        return this.notes[section].length;\r\n    }\r\n    getSectionNumber() {\r\n        return this.notes.length;\r\n    }\r\n    insertSection(section, data = []) {\r\n        if (section < -1 || section > this.notes.length) {\r\n            return false;\r\n        }\r\n        if (section === -1)\r\n            section = this.notes.length;\r\n        let isp = this.getNoteFlattenNumber(section, -1);\r\n        let isa = [];\r\n        for (let i = 0; i < data.length; i++) {\r\n            isa.push({ x: -1, y: -1, length: -1, blocks: [], tail: [], section: -1, note: -1, hasSvg: false });\r\n        }\r\n        this.notes.splice(section, 0, data);\r\n        this.calData.splice(isp + 1, 0, ...isa);\r\n        return true;\r\n    }\r\n    deleteSections(section, number = 1) {\r\n        if (section < -1 || section >= this.notes.length) {\r\n            return [];\r\n        }\r\n        let dn = 0;\r\n        let dp = this.getNoteFlattenNumber(section, 0);\r\n        for (let i = section; i < section + number && i < this.noteIndex.length; i++)\r\n            dn += this.notes[i].length;\r\n        this.removeCalData(dp, dn);\r\n        return this.notes.splice(section, number);\r\n    }\r\n    getNoteFlattenNumber(section, note) {\r\n        if (!this.notes[section])\r\n            return -1;\r\n        if (note === -1)\r\n            note = this.notes[section].length - 1;\r\n        if (this.notes[section][note]) {\r\n            let total = 0;\r\n            for (let i = 0; i < section; i++)\r\n                total += this.notes[i].length;\r\n            total += note;\r\n            return total;\r\n        }\r\n        return -1;\r\n    }\r\n    /**\r\n     * add a note\r\n     * @param { [number, number[], any] }   data, note length, [block number, index is string number,], user data\r\n     * @param { number }                    section, if give -1, note will be appended at last section. Index start from 0\r\n     * @param { number }                    note, if give -1, note will be appended at last note. Index start from 0\r\n     */\r\n    instrumentNoteInput(correction, data, section = -1, note = -1) {\r\n        if (section == -1)\r\n            section = this.notes.length - 1;\r\n        if (note == -1)\r\n            note = this.notes[section].length;\r\n        correction(this, data, section, note);\r\n        this.render();\r\n    }\r\n    attach(anchor) {\r\n        anchor.append(this.domElement);\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setStyle(anchor, { width: `${this.width + 20}px` });\r\n    }\r\n    noteIndex(note) {\r\n        return this.tabCanvas.layers.notes.noteElements.indexOf(note);\r\n    }\r\n    /**\r\n * Drag and drog area select notes\r\n * Bad implement by now, the function search each note to find collision\r\n * Algorithm will be fixed in future.\r\n */\r\n    areaSelect(x1, y1, x2, y2) {\r\n        let noteElements = this.tabCanvas.layers.notes.noteElements;\r\n        var selectedNoteIds = [];\r\n        let leftSelectedNote;\r\n        let rightSelectedNote;\r\n        for (let i = 0; i < noteElements.length; i++) {\r\n            for (let j = 0; j < 6; j++) {\r\n                //Check if note is in the selected area\r\n                if (noteElements[i].blockGroup[j].x >= x1\r\n                    && noteElements[i].blockGroup[j].x <= x2\r\n                    && noteElements[i].blockGroup[j].y >= y1\r\n                    && noteElements[i].blockGroup[j].y <= y2\r\n                    && noteElements[i].domelement.style.display != \"none\") {\r\n                    selectedNoteIds.push(i);\r\n                }\r\n            }\r\n        }\r\n        leftSelectedNote = Math.min(...selectedNoteIds);\r\n        rightSelectedNote = Math.max(...selectedNoteIds);\r\n        return noteElements.slice(leftSelectedNote, rightSelectedNote + 1);\r\n    }\r\n    endsSelect(head, tail) {\r\n        if (head > tail) {\r\n            let temp = tail;\r\n            tail = head;\r\n            head = temp;\r\n        }\r\n        return this.tabCanvas.layers.notes.noteElements.slice(head, tail + 1);\r\n    }\r\n    headToEndSelect(head) {\r\n        return this.tabCanvas.layers.notes.noteElements.slice(head, this.tabCanvas.layers.notes.noteElements.length);\r\n    }\r\n    render() {\r\n        this.setAllLine();\r\n        let [calDataLength, changeSet, linkerData, sectionPosition, dotData] = this.calNoteData();\r\n        this.setSectionIndicator(sectionPosition);\r\n        this.setAllNoteElementData(calDataLength, changeSet);\r\n        this.setLinker(linkerData);\r\n        this.setDot(dotData);\r\n        let ln = Math.ceil(this.notes.length / this.sectionPerLine);\r\n        if (this.height != (this.lineStartPosition[1] + (this.stringPadding * 5 + this.lineDistance) * ln + 70)) {\r\n            this.height = (this.lineStartPosition[1] + (this.stringPadding * 5 + this.lineDistance) * ln + 70);\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.tabCanvas.domElement, { height: `${this.height}` });\r\n        }\r\n    }\r\n    on(ename, cbk) {\r\n        if (ename in this.callbacks) {\r\n            this.callbacks[ename].push(cbk);\r\n        }\r\n    }\r\n    scrollTo(val) {\r\n        this.domElement.scrollTop = val;\r\n    }\r\n    getSectionLeftTopPos(section) {\r\n        if (section < this.notes.length) {\r\n            return [this.tabCanvas.layers.ui.sectionIndicator[section].x, this.tabCanvas.layers.ui.sectionIndicator[section].y];\r\n        }\r\n        return [-1, -1];\r\n    }\r\n    getSectionWidth(section) {\r\n        if (section < this.notes.length) {\r\n            this.tabCanvas.layers.ui.sectionIndicator[section].width;\r\n        }\r\n        return 0;\r\n    }\r\n    getSectionHeight(section) {\r\n        if (section < this.notes.length) {\r\n            this.tabCanvas.layers.ui.sectionIndicator[section].height;\r\n        }\r\n        return 0;\r\n    }\r\n    adjustPostion(y) {\r\n        if (y + 220 > this.domElement.scrollTop + this.containerHeight) {\r\n            this.scrollTo(y - this.containerHeight + 220);\r\n        }\r\n        if (y - 80 < this.domElement.scrollTop) {\r\n            this.scrollTo(y - 80);\r\n        }\r\n    }\r\n    isSectionFull(section) {\r\n        let stackLength = 0; // unit in beat\r\n        for (let i = 0; i < this.notes[section].length; i++) {\r\n            stackLength += this.lengthPerBeat / this.notes[section][i][0];\r\n        }\r\n        if (stackLength >= this.beatPerSection) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n    clearData() {\r\n        this.notes = [[]];\r\n        this.calData = [];\r\n        this.tabCanvas.layers.notes.removeNote(0, this.tabCanvas.layers.notes.noteElements.length);\r\n    }\r\n    removeCalData(removeIndex, num) {\r\n        this.calData.splice(removeIndex, num);\r\n        this.tabCanvas.layers.notes.removeNote(removeIndex, num);\r\n    }\r\n    setAllLine() {\r\n        let ln = Math.ceil(this.notes.length / this.sectionPerLine); // number of row you need\r\n        let an = this.tabCanvas.layers.sheet.row.length; // number of row you have\r\n        for (let i = an; i < ln; i++) {\r\n            let x = this.lineStartPosition[0];\r\n            let y = this.lineStartPosition[1] + (this.stringPadding * 5 + this.lineDistance) * i;\r\n            this.tabCanvas.layers.sheet.createRow(x, y, this.lineWidth, this.linePadding, this.stringPadding, this.sectionPerLine);\r\n        }\r\n        for (let i = ln; i < an; i++) {\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setStyle(this.tabCanvas.layers.sheet.row[i], { display: \"none\" });\r\n        }\r\n        for (let i = 0; i < ln; i++) {\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setStyle(this.tabCanvas.layers.sheet.row[i], { display: \"unset\" });\r\n        }\r\n    }\r\n    setSectionIndicator(position) {\r\n        if (position.length > this.tabCanvas.layers.ui.sectionIndicator.length) {\r\n            let nsNumber = position.length - this.tabCanvas.layers.ui.sectionIndicator.length;\r\n            for (let i = 0; i < nsNumber; i++) {\r\n                let nc = this.tabCanvas.layers.ui.createSectionIndicator();\r\n                nc.domElement.addEventListener(\"mousemove\", this.onSectionHover.bind(this));\r\n                nc.domElement.addEventListener(\"mouseout\", this.onSectionHout.bind(this));\r\n                nc.domElement.addEventListener(\"click\", this.onSectionClick.bind(this));\r\n            }\r\n        }\r\n        for (let i = 0; i < position.length; i++) {\r\n            let width = position[i][1][0] - position[i][0][0];\r\n            let height = this.stringPadding * 5;\r\n            this.tabCanvas.layers.ui.sectionIndicator[i].x = position[i][0][0];\r\n            this.tabCanvas.layers.ui.sectionIndicator[i].y = position[i][0][1];\r\n            this.tabCanvas.layers.ui.sectionIndicator[i].width = width;\r\n            this.tabCanvas.layers.ui.sectionIndicator[i].height = height;\r\n            this.tabCanvas.layers.sheet.bar[i].x1 = position[i][0][0] + width;\r\n            this.tabCanvas.layers.sheet.bar[i].x2 = position[i][0][0] + width;\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.tabCanvas.layers.ui.sectionIndicator[i].domElement, { \"data-section\": `${i}` });\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setStyle(this.tabCanvas.layers.ui.sectionIndicator[i].domElement, { display: \"unset\" });\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setStyle(this.tabCanvas.layers.sheet.bar[i].domElement, { display: \"unset\" });\r\n        }\r\n        for (let i = position.length; i < this.tabCanvas.layers.ui.sectionIndicator.length; i++) {\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setStyle(this.tabCanvas.layers.ui.sectionIndicator[i].domElement, { display: \"none\" });\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setStyle(this.tabCanvas.layers.sheet.bar[i].domElement, { display: \"none\" });\r\n        }\r\n    }\r\n    calNoteData() {\r\n        let [x, y] = this.startPosition;\r\n        let sectionLength = this.beatPerSection / this.lengthPerBeat;\r\n        let linker = [];\r\n        let dot = [];\r\n        let sectionIndicator = [];\r\n        let seperaterLength = 1 / 4;\r\n        let accumulatedLength = 0;\r\n        let ci = 0;\r\n        let changeSet = new Set();\r\n        let first = -1;\r\n        for (let s = 0; s < this.notes.length; s++) { // section\r\n            let line = Math.floor(s / this.sectionPerLine);\r\n            let lineTotalNote = 0;\r\n            accumulatedLength = 0;\r\n            for (let i = 0; i < this.sectionPerLine; i++) {\r\n                if (this.notes[line * this.sectionPerLine + i]) {\r\n                    lineTotalNote += Math.max(this.notes[line * this.sectionPerLine + i].length, this.sectionAddNoteNumber);\r\n                }\r\n                else {\r\n                    lineTotalNote += this.sectionAddNoteNumber;\r\n                }\r\n            }\r\n            let sectionWidth = this.lineWidth * (Math.max(this.notes[s].length, this.sectionAddNoteNumber)) / lineTotalNote;\r\n            let sectionTotalBeat = 0;\r\n            for (let i = 0; i < this.notes[s].length; i++) {\r\n                sectionTotalBeat += this.lengthPerBeat / this.notes[s][i][0];\r\n            }\r\n            let beatLength = (sectionWidth - 20) / sectionTotalBeat;\r\n            if (s % this.sectionPerLine == 0) { // change line\r\n                x = this.startPosition[0];\r\n                if (s != 0)\r\n                    y += this.stringPadding * 5 + this.lineDistance;\r\n            }\r\n            let sx = [[x - 20, y], [0, y]]; // section position\r\n            let nx = x + sectionWidth;\r\n            sx[1][0] = nx - 20;\r\n            sectionIndicator.push(sx);\r\n            for (let i = 0; i < this.notes[s].length; i++) { // note\r\n                let note = this.notes[s][i];\r\n                let noteLength = this.lengthPerBeat / note[0];\r\n                let tail;\r\n                if (accumulatedLength + noteLength / this.lengthPerBeat >= seperaterLength) { // the note is the end of a beat or the note's length equals to a beat\r\n                    let cdataLLength = 0;\r\n                    if (ci > 0)\r\n                        cdataLLength = this.calData[ci - 1].length;\r\n                    tail = this.calculateTail(cdataLLength, note[0], -1, beatLength);\r\n                    accumulatedLength = 0;\r\n                }\r\n                else {\r\n                    let cdataLLength = 0;\r\n                    if (ci > 0)\r\n                        cdataLLength = this.calData[ci - 1].length;\r\n                    tail = this.calculateTail(cdataLLength, note[0], accumulatedLength, beatLength);\r\n                    accumulatedLength += noteLength / this.lengthPerBeat;\r\n                }\r\n                let step = beatLength * this.lengthPerBeat / note[0];\r\n                let updateNote = this.updatecalData(ci, x, y, note[0], note[1], tail, s, i);\r\n                if (updateNote >= 0)\r\n                    changeSet.add(updateNote).add(updateNote - 1);\r\n                ci++;\r\n                let userDataArray = [];\r\n                if (note[2])\r\n                    userDataArray = note[2].split(\" \");\r\n                if (userDataArray.includes(\"linkEnd\"))\r\n                    linker.push([x, y]);\r\n                if (userDataArray.includes(\"linkStart\"))\r\n                    linker.push([x, y]);\r\n                if (note[0] !== Math.floor(note[0])) {\r\n                    //console.log(note[0]);\r\n                    dot.push([x, y]);\r\n                }\r\n                x += step;\r\n            }\r\n            x = nx;\r\n        }\r\n        changeSet.delete(-1);\r\n        return [ci, changeSet, linker, sectionIndicator, dot]; // ci = totoal section number, changeSet = store index of change data\r\n    }\r\n    updatecalData(arryIndex, x, y, noteLength, noteData, tail, section, note) {\r\n        if (arryIndex > this.calData.length) {\r\n            console.error(\"array index erro, should not be greater than calData.length\");\r\n            return -1;\r\n        }\r\n        if (arryIndex === this.calData.length) {\r\n            this.calData.push({ x: x, y: y, length: noteLength, blocks: noteData.slice(0, 6), tail: tail.slice(0, tail.length), section: section, note: note, hasSvg: false });\r\n            return arryIndex;\r\n        }\r\n        let data = this.calData[arryIndex];\r\n        if (data.x != x || data.y != y || data.length != noteLength || data.section != section || data.note != note || !this.compareArray(data.blocks, noteData) || !this.compareArray(data.tail, tail)) {\r\n            this.calData[arryIndex].x = x;\r\n            this.calData[arryIndex].y = y;\r\n            this.calData[arryIndex].length = noteLength;\r\n            this.calData[arryIndex].blocks = noteData.slice(0, 6);\r\n            this.calData[arryIndex].tail = tail.slice(0, tail.length);\r\n            this.calData[arryIndex].section = section;\r\n            this.calData[arryIndex].note = note;\r\n            return arryIndex;\r\n        }\r\n        return -1;\r\n    }\r\n    compareArray(a, b) {\r\n        if (a.length != b.length)\r\n            return false;\r\n        for (let i = 0; i < a.length; i++) {\r\n            if (a[i] != b[i])\r\n                return false;\r\n        }\r\n        return true;\r\n    }\r\n    calculateTail(lastNoteLength, noteLength, accumulatedLength, beatLength) {\r\n        let step = beatLength * this.lengthPerBeat / lastNoteLength * -1;\r\n        let basicLength = 8;\r\n        if (accumulatedLength == -1)\r\n            basicLength = -8;\r\n        if (accumulatedLength == 0) { // start of a seperate note\r\n            if (noteLength <= 4) {\r\n            }\r\n            else if (noteLength <= 8) {\r\n                return [basicLength, 0, 0];\r\n            }\r\n            else if (noteLength <= 16) {\r\n                return [basicLength, basicLength, 0];\r\n            }\r\n            else if (noteLength <= 32) {\r\n                return [basicLength, basicLength, basicLength];\r\n            }\r\n        }\r\n        else {\r\n            if (noteLength <= 4) {\r\n            }\r\n            else if (noteLength <= 8) {\r\n                if (lastNoteLength >= 8) {\r\n                    return [step, 0, 0];\r\n                }\r\n            }\r\n            else if (noteLength <= 16) {\r\n                if (lastNoteLength <= 4) {\r\n                }\r\n                else if (lastNoteLength <= 8) {\r\n                    return [step, basicLength, 0];\r\n                }\r\n                else if (lastNoteLength <= 32) {\r\n                    return [step, step, 0];\r\n                }\r\n            }\r\n            else if (noteLength <= 32) {\r\n                if (lastNoteLength <= 4) {\r\n                }\r\n                else if (lastNoteLength <= 8) {\r\n                    return [step, basicLength, basicLength];\r\n                }\r\n                else if (lastNoteLength <= 16) {\r\n                    return [step, step, basicLength];\r\n                }\r\n                else if (lastNoteLength <= 32) {\r\n                    return [step, step, step];\r\n                }\r\n            }\r\n        }\r\n        return [0, 0, 0];\r\n    }\r\n    /**\r\n     * receive data from calNoteData and set elements\r\n     * @param { [number, number, number, number[]][] } data\r\n     */\r\n    setAllNoteElementData(dataLength, changeSet) {\r\n        let data = this.calData;\r\n        let noteElement = this.tabCanvas.layers.notes.noteElements;\r\n        let ne = dataLength - noteElement.length;\r\n        let nullData = { x: 0, y: 0, length: 0, blocks: [-1, -1, -1, -1, -1, -1], tail: [0, 0, 0], section: 0, note: 0, hasSvg: null }; //[0, 0, 0, [-1, -1, -1, -1, -1, -1], [0, 0, 0], 0, 0];\r\n        for (let i = 0; i < this.calData.length; i++) {\r\n            if (!this.calData[i].hasSvg) {\r\n                this.tabCanvas.layers.notes.createNote(i);\r\n                this.calData[i].hasSvg = true;\r\n                noteElement[i].blockGroup.forEach((wg, i) => {\r\n                    wg.domelement.addEventListener(\"click\", this.onNoteClicked.bind(this));\r\n                    wg.domelement.addEventListener(\"mouseover\", this.onMouseOverNote.bind(this), false);\r\n                    wg.domelement.addEventListener(\"mouseout\", this.onMouseOutNote.bind(this));\r\n                    wg.string = i;\r\n                    _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(wg.domelement, { \"data-string\": `${i}` });\r\n                });\r\n            }\r\n        }\r\n        changeSet.forEach((si, i) => {\r\n            if (i != data.length - 1) {\r\n                if (data[i + 1].x > data[i].x) {\r\n                    this.setNoteElementData(noteElement[i], data[i], data[i + 1], (data[i + 1].x - data[i].x) * 0.7);\r\n                }\r\n                else {\r\n                    this.setNoteElementData(noteElement[i], data[i], data[i + 1], 30);\r\n                }\r\n            }\r\n            else {\r\n                this.setNoteElementData(noteElement[i], data[i], nullData, 30);\r\n            }\r\n        });\r\n    }\r\n    setNoteElementData(el, data, nexData, xlength) {\r\n        this.setElementPosition(el, data.x, data.y, data.tail, data.section, data.note, xlength);\r\n        this.setChordVisiable(el, data.x, data.y, data.length, data.blocks, data.tail, nexData.tail);\r\n    }\r\n    setElementPosition(e, x, y, tail, sectionIndex, noteIndex, xlength) {\r\n        let ln = Math.floor(sectionIndex / this.sectionPerLine);\r\n        // set note bar's position and bar tail's length\r\n        e.lineGroup[0].x1 = x;\r\n        e.lineGroup[0].y1 = 26 + y + this.stringPadding * 5;\r\n        e.lineGroup[0].x2 = x;\r\n        e.lineGroup[0].y2 = y;\r\n        e.lineGroup[1].x1 = x;\r\n        e.lineGroup[1].y1 = 25 + y + this.stringPadding * 5;\r\n        e.lineGroup[1].x2 = x + tail[0];\r\n        e.lineGroup[1].y2 = 25 + y + this.stringPadding * 5;\r\n        e.lineGroup[2].x1 = x;\r\n        e.lineGroup[2].y1 = 21 + y + this.stringPadding * 5;\r\n        e.lineGroup[2].x2 = x + tail[1];\r\n        e.lineGroup[2].y2 = 21 + y + this.stringPadding * 5;\r\n        e.lineGroup[3].x1 = x;\r\n        e.lineGroup[3].y1 = 17 + y + this.stringPadding * 5;\r\n        e.lineGroup[3].x2 = x + tail[2];\r\n        e.lineGroup[3].y2 = 17 + y + this.stringPadding * 5;\r\n        // set note word position\r\n        for (let i = 0; i < 6; i++) {\r\n            e.blockGroup[i].x = x;\r\n            e.blockGroup[i].y = y + this.stringPadding * i;\r\n            e.blockGroup[i].extendRect.y = y + this.stringPadding * (i - 0.5);\r\n            e.blockGroup[i].extendRect.height = this.stringPadding;\r\n            e.blockGroup[i].extendRect.width = xlength;\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(e.blockGroup[i].domelement, { \"data-x\": `${x}`, \"data-y\": `${y + this.stringPadding * i}`, \"data-line\": `${ln}` });\r\n        }\r\n        e.tail8.setPosition(x + 0.4, y + this.stringPadding * 5 + 14);\r\n        e.tail16.setPosition(x + 0.4, y + this.stringPadding * 5 + 10);\r\n        e.tail32.setPosition(x + 0.4, y + this.stringPadding * 5 + 6);\r\n        e.section = sectionIndex;\r\n        e.note = noteIndex;\r\n        e.line = ln;\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(e.domelement, { \"data-section\": `${sectionIndex}`, \"data-note\": `${noteIndex}` });\r\n        e.blockGroup.forEach((wg, i) => {\r\n            wg.section = sectionIndex;\r\n            wg.note = noteIndex;\r\n            wg.line = ln;\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(wg.domelement, { \"data-section\": `${sectionIndex}`, \"data-note\": `${noteIndex}`, \"data-line\": `${ln}` });\r\n        });\r\n    }\r\n    setChordVisiable(e, x, y, noteLength, data, tail, nextTail) {\r\n        let ap = true;\r\n        let hc = -1; // top chord which data is not -1\r\n        for (let i = 0; i < 6; i++) {\r\n            if (data[i] != -1) {\r\n                hc = i;\r\n                break;\r\n            }\r\n        }\r\n        e.tail8.hide();\r\n        e.tail16.hide();\r\n        e.tail32.hide();\r\n        for (let i = 0; i < 3; i++) {\r\n            if (tail[i] < 0 || nextTail[i] < 0) {\r\n                ap = false;\r\n                break;\r\n            }\r\n        }\r\n        if (ap) {\r\n            if (hc != -1) {\r\n                if (noteLength <= 4) {\r\n                }\r\n                else if (noteLength <= 8) {\r\n                    e.tail8.show();\r\n                }\r\n                else if (noteLength <= 16) {\r\n                    e.tail16.show();\r\n                }\r\n                else if (noteLength <= 32) {\r\n                    e.tail32.show();\r\n                }\r\n            }\r\n            e.lineGroup[1].x2 = x;\r\n            e.lineGroup[2].x2 = x;\r\n            e.lineGroup[3].x2 = x;\r\n        }\r\n        for (let i = 0; i < 6; i++) {\r\n            if (data[i] == -1) {\r\n                e.blockGroup[i].word.text = ``;\r\n                e.blockGroup[i].wordBack.text = ``;\r\n            }\r\n            else {\r\n                e.blockGroup[i].word.text = `${data[i]}`;\r\n                e.blockGroup[i].wordBack.text = `${data[i]}`;\r\n            }\r\n        }\r\n        if (noteLength == 2) {\r\n            e.lineGroup[0].y2 = 10 + y + this.stringPadding * 5;\r\n            return;\r\n        }\r\n        else if (noteLength == 1) {\r\n            e.lineGroup[0].y2 = 26 + y + this.stringPadding * 5;\r\n            return;\r\n        }\r\n        // note bar should reach the top word\r\n        if (hc === -1) {\r\n            e.lineGroup[0].y2 = y + this.stringPadding * 5 + 26;\r\n        }\r\n        else {\r\n            e.lineGroup[0].y2 = y + this.stringPadding * hc;\r\n        }\r\n    }\r\n    setLinker(linkerData) {\r\n        let lenumber = Math.floor(linkerData.length / 2);\r\n        let existNumber = this.tabCanvas.layers.background.linker.length;\r\n        for (let i = 0; i < lenumber - existNumber; i++) {\r\n            this.tabCanvas.layers.background.createLinker();\r\n        }\r\n        for (let i = 0; i < lenumber; i++) {\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setStyle(this.tabCanvas.layers.background.linker[i], { display: \"unset\" });\r\n            this.setLinkerData(this.tabCanvas.layers.background.linker[i], linkerData[i * 2], linkerData[i * 2 + 1]);\r\n        }\r\n        for (let i = lenumber; i < this.tabCanvas.layers.background.linker.length; i++) {\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setStyle(this.tabCanvas.layers.background.linker[i], { display: \"none\" });\r\n        }\r\n    }\r\n    setLinkerData(linkElement, start, end) {\r\n        let ly = start[1] + 31 + this.stringPadding * 5;\r\n        if (start[1] !== end[1]) {\r\n            let ex = start[0] + 30;\r\n            let sx = start[0];\r\n            let path = `M ${sx} ${ly} C ${sx + 4} ${ly + 15}, ${ex - 4} ${ly + 15}, ${ex} ${ly} C ${ex - 4} ${ly + 12}, ${sx + 4} ${ly + 12}, ${sx} ${ly} `;\r\n            ly = end[1] + 31 + this.stringPadding * 5;\r\n            sx = end[0] - 30;\r\n            ex = end[0];\r\n            path += `M ${sx} ${ly} C ${sx + 4} ${ly + 15}, ${ex - 4} ${ly + 15}, ${ex} ${ly} C ${ex - 4} ${ly + 12}, ${sx + 4} ${ly + 12}, ${sx} ${ly}`;\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(linkElement, { d: path });\r\n        }\r\n        else {\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(linkElement, { d: `M ${start[0]} ${ly} C ${start[0] + 4} ${ly + 15}, ${end[0] - 4} ${ly + 15}, ${end[0]} ${ly} C ${end[0] - 4} ${ly + 12}, ${start[0] + 4} ${ly + 12}, ${start[0]} ${ly}` });\r\n        }\r\n    }\r\n    setDot(dotData) {\r\n        let lenumber = dotData.length;\r\n        let existNumber = this.tabCanvas.layers.notes.dot.length;\r\n        for (let i = 0; i < lenumber - existNumber; i++) {\r\n            let ndt = this.tabCanvas.layers.notes.createEllipse(0, 0, 2.5, 2.5);\r\n            ndt.fill = \"white\";\r\n            this.tabCanvas.layers.notes.dot.push(ndt);\r\n        }\r\n        for (let i = 0; i < lenumber; i++) {\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setStyle(this.tabCanvas.layers.notes.dot[i].domElement, { display: \"unset\" });\r\n            this.tabCanvas.layers.notes.dot[i].cx = dotData[i][0] + 12;\r\n            this.tabCanvas.layers.notes.dot[i].cy = dotData[i][1] + 12 + this.stringPadding * 5;\r\n        }\r\n        for (let i = lenumber; i < this.tabCanvas.layers.notes.dot.length; i++) {\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setStyle(this.tabCanvas.layers.notes.dot[i].domElement, { display: \"none\" });\r\n        }\r\n    }\r\n    onNoteClicked(ev) {\r\n        let section = Number(ev.currentTarget.dataset.section);\r\n        let note = Number(ev.currentTarget.dataset.note);\r\n        let string = Number(ev.currentTarget.dataset.string);\r\n        let position = [Number(ev.currentTarget.dataset.x), Number(ev.currentTarget.dataset.y)];\r\n        if (ev.shiftKey) {\r\n            this.callbacks[\"noteshiftclick\"].callAll(section, note, string, position, ev.currentTarget);\r\n        }\r\n        else if (ev.altKey) {\r\n            this.callbacks[\"notealtclick\"].callAll(section, note, string, position, ev.currentTarget);\r\n        }\r\n        else if (ev.ctrlKey) {\r\n            this.callbacks[\"notectrlclick\"].callAll(section, note, string, position, ev.currentTarget);\r\n        }\r\n        else {\r\n            this.callbacks[\"noteclick\"].callAll(section, note, string, position, ev.currentTarget);\r\n        }\r\n    }\r\n    onKeydown(ev) {\r\n        this.callbacks[\"keydown\"].callAll(ev.key, ev.keyCode);\r\n    }\r\n    onMouseOverNote(ev) {\r\n        let section = Number(ev.currentTarget.dataset.section);\r\n        let note = Number(ev.currentTarget.dataset.note);\r\n        let string = Number(ev.currentTarget.dataset.string);\r\n        let position = [Number(ev.currentTarget.dataset.x), Number(ev.currentTarget.dataset.y)];\r\n        this.callbacks[\"mouseovernote\"].callAll(section, note, string, position, ev.currentTarget);\r\n    }\r\n    onMouseOutNote(ev) {\r\n        let section = Number(ev.currentTarget.dataset.section);\r\n        let note = Number(ev.currentTarget.dataset.note);\r\n        let string = Number(ev.currentTarget.dataset.string);\r\n        let position = [Number(ev.currentTarget.dataset.x), Number(ev.currentTarget.dataset.y)];\r\n        this.callbacks[\"mouseoutnote\"].callAll(section, note, string, position, ev.currentTarget);\r\n    }\r\n    onMouseDown(ev) {\r\n        this.callbacks[\"mousedown\"].callAll(Number(ev.x), Number(ev.y));\r\n    }\r\n    onMouseMove(ev) {\r\n        this.callbacks[\"mousemove\"].callAll(Number(ev.x), Number(ev.y));\r\n    }\r\n    onMouseUp(ev) {\r\n        this.callbacks[\"mouseup\"].callAll(Number(ev.x), Number(ev.y));\r\n    }\r\n    onMouseRightClick(ev) {\r\n        this.callbacks[\"rightclick\"].callAll(Number(ev.x), Number(ev.y));\r\n    }\r\n    onSectionHover(ev) {\r\n        this.callbacks[\"sectionhover\"].callAll(Number(ev.currentTarget.dataset.section));\r\n    }\r\n    onSectionHout(ev) {\r\n        this.callbacks[\"sectionhout\"].callAll(Number(ev.currentTarget.dataset.section));\r\n    }\r\n    onSectionClick(ev) {\r\n        let offsetY = ev.clientY - this.domElement.getBoundingClientRect().top + this.domElement.scrollTop;\r\n        let y = Number(ev.currentTarget.getAttribute(\"y\"));\r\n        let string = Math.floor((offsetY - y) / this.stringPadding);\r\n        this.callbacks[\"sectionclick\"].callAll(Number(ev.currentTarget.dataset.section), string);\r\n    }\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvU2xpbVRhYlYyLnRzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vc3JjL1NsaW1UYWJWMi50cz85NzBlIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7dXRpbHMsIENhbGxiYWNrc30gZnJvbSBcIi4vdXRpbHNcIlxyXG5pbXBvcnQgeyBzZWN0aW9uLCBOb3RlIH0gZnJvbSBcIi4vU2xpbVRhYlYyVHlwZXNcIlxyXG5pbXBvcnQgeyBDb3JyZWN0aW9uIH0gZnJvbSBcIi4vU2xpbVRhYlYySW50ZXJmYWNlXCJcclxuaW1wb3J0IHsgU0xDYW52YXMsIFNMTGF5ZXIsIFNWR05vdGUgfSBmcm9tIFwiLi9TbGltVGFiVjJDYW52YXNcIlxyXG5pbnRlcmZhY2UgY2FjdWxhdGVkTm90ZURhdGF7XHJcbiAgICB4OiBudW1iZXI7XHJcbiAgICB5OiBudW1iZXI7XHJcbiAgICBsZW5ndGg6IG51bWJlcjtcclxuICAgIGJsb2NrczogbnVtYmVyW107XHJcbiAgICB0YWlsOiBudW1iZXJbXTtcclxuICAgIHNlY3Rpb246IG51bWJlcjtcclxuICAgIG5vdGU6IG51bWJlcjtcclxuICAgIGhhc1N2ZzogYm9vbGVhbjtcclxufVxyXG4vL3R5cGUgY2FjdWxhdGVkTm90ZURhdGEgPSBbbnVtYmVyLCBudW1iZXIsIG51bWJlciwgbnVtYmVyW10sIG51bWJlcltdLCBudW1iZXIsIG51bWJlcl07IC8vW3gsIHkgLCBsZW5ndGgsIGJsb2NrIG9mIGV2ZXJ5IGNob3JkLCB0YWlsIGxlbmd0aCwgc2VjdGlvbiBpbmRleCwgbm90ZSBpbmRleF1cclxuaW50ZXJmYWNlIGV2ZW50Q2FsbEJhY2tJbnRlcmZhY2Uge1xyXG4gICAgbm90ZWNsaWNrOiAoc2VjdGlvbjogbnVtYmVyICwgbm90ZTogbnVtYmVyICwgc3RyaW5nOiBudW1iZXIsIHBvc2l0aW9uOiBudW1iZXJbXSwgY3VycmVudFRhcmdldDogSFRNTEVsZW1lbnQpID0+IGFueTtcclxuICAgIGtleWRvd246IChrZXk6IHN0cmluZywga2V5Q29kZTogbnVtYmVyKSA9PiBhbnk7XHJcbiAgICBtb3VzZW92ZXJub3RlOiAoc2VjdGlvbjogbnVtYmVyICwgbm90ZTogbnVtYmVyICwgc3RyaW5nOiBudW1iZXIsIHBvc2l0aW9uOiBudW1iZXJbXSwgY3VycmVudFRhcmdldDogSFRNTEVsZW1lbnQpID0+IGFueTtcclxuICAgIG1vdXNlb3V0bm90ZTogKHNlY3Rpb246IG51bWJlciAsIG5vdGU6IG51bWJlciAsIHN0cmluZzogbnVtYmVyLCBwb3NpdGlvbjogbnVtYmVyW10sIGN1cnJlbnRUYXJnZXQ6IEhUTUxFbGVtZW50KSA9PiBhbnk7XHJcbiAgICBub3Rlc2hpZnRjbGljazogKHNlY3Rpb246IG51bWJlciwgbm90ZTogbnVtYmVyLCBzdHJpbmc6IG51bWJlciwgcG9zaXRpb246IG51bWJlcltdLCBjdXJyZW50VGFyZ2V0OiBIVE1MRWxlbWVudCkgPT4gYW55O1xyXG4gICAgbm90ZWFsdGNsaWNrOiAoc2VjdGlvbjogbnVtYmVyLCBub3RlOiBudW1iZXIsIHN0cmluZzogbnVtYmVyLCBwb3NpdGlvbjogbnVtYmVyW10sIGN1cnJlbnRUYXJnZXQ6IEhUTUxFbGVtZW50KSA9PiBhbnk7XHJcbiAgICBub3RlY3RybGNsY2lrOiAoc2VjdGlvbjogbnVtYmVyLCBub3RlOiBudW1iZXIsIHN0cmluZzogbnVtYmVyLCBwb3NpdGlvbjogbnVtYmVyW10sIGN1cnJlbnRUYXJnZXQ6IEhUTUxFbGVtZW50KSA9PiBhbnk7XHJcbiAgICBtb3VzZWRvd246ICh4OiBudW1iZXIsIHk6IG51bWJlcikgPT4gYW55O1xyXG4gICAgbW91c2Vtb3ZlOiAoeDogbnVtYmVyLCB5OiBudW1iZXIpID0+IGFueTtcclxuICAgIG1vdXNldXA6ICh4OiBudW1iZXIsIHk6IG51bWJlcikgPT4gYW55O1xyXG4gICAgc2VjdGlvbmhvdmVyOiAoc2VjdGlvbjogbnVtYmVyKSA9PiBhbnk7XHJcbiAgICBzZWN0aW9uaG91dDogKHNlY3Rpb246IG51bWJlcikgPT4gYW55O1xyXG4gICAgc2VjdGlvbmNsaWNrOiAoc2VjdGlvbjogbnVtYmVyLCBzdHJpbmc6IG51bWJlcikgPT4gYW55O1xyXG59XHJcbmV4cG9ydCBjbGFzcyBTTFRhYiB7XHJcbiAgICB0YWJDYW52YXM6IFNMQ2FudmFzPFNMTGF5ZXI+O1xyXG4gICAgbm90ZXM6IHNlY3Rpb25bXTtcclxuICAgIGRvbUVsZW1lbnQ6IEhUTUxFbGVtZW50O1xyXG4gICAgaW5FZGl0OiBib29sZWFuID0gdHJ1ZTtcclxuICAgIHJlYWRvbmx5IGxlbmd0aFBlckJlYXQ6IG51bWJlciA9IDQ7XHJcbiAgICByZWFkb25seSBiZWF0UGVyU2VjdGlvbjogbnVtYmVyID0gNDtcclxuICAgIHJlYWRvbmx5IGNvbnRhaW5lckhlaWdodDogbnVtYmVyID0gNzAwO1xyXG4gICAgcHJpdmF0ZSBsaW5lV2lkdGg6IG51bWJlciA9IDEyMDA7XHJcbiAgICBwcml2YXRlIHNlY3Rpb25QZXJMaW5lOiBudW1iZXIgPSA0O1xyXG4gICAgcHJpdmF0ZSBzdHJpbmdQYWRkaW5nOiBudW1iZXIgPSAxNjsgLy8gZGlzdGFuY2UgYmV0d2VlbiBlYWNoIHN0cmluZ1xyXG4gICAgcHJpdmF0ZSBsaW5lUGVyUGFnZTogbnVtYmVyID0gMjA7XHJcbiAgICBwcml2YXRlIGxpbmVNYXJnaW46IG51bWJlciA9IDQyOyAvLyBvbmx5IGZvciBsZWZ0IGFuZCByaWdodFxyXG4gICAgcHJpdmF0ZSBsaW5lUGFkZGluZzogW251bWJlciwgbnVtYmVyXSA9IFszMiwgMTRdO1xyXG4gICAgcHJpdmF0ZSBsaW5lRGlzdGFuY2U6IG51bWJlciA9IDkwOyAvLyBkaXN0YW5jZSBiZXR3ZWVuIGVhY2ggbGluZVxyXG4gICAgcHJpdmF0ZSBzZWN0aW9uQWRkTm90ZU51bWJlciA9IDg7XHJcbiAgICBwcml2YXRlIGxpbmtlckVsZW1lbnQ6IFNWR0VsZW1lbnRbXSA9IFtdO1xyXG4gICAgcHJpdmF0ZSBzdGFydFBvc2l0aW9uOiBudW1iZXJbXSA9IFt0aGlzLmxpbmVNYXJnaW4gKyB0aGlzLmxpbmVQYWRkaW5nWzBdICsgMjAsIDEyMCArIHRoaXMubGluZVBhZGRpbmdbMV1dOyAvLyB4LCB5XHJcbiAgICBwcml2YXRlIGxpbmVTdGFydFBvc2l0aW9uOiBbbnVtYmVyLCBudW1iZXJdID0gW3RoaXMubGluZU1hcmdpbiwgMTIwXTsgLy8gdG90YWwgbGluZSBudW1iZXIsIGxhc3QgbGluZSBYLCBsYXN0IGxpbmUgWVxyXG4gICAgcHJpdmF0ZSBoZWlnaHQ6IG51bWJlcjtcclxuICAgIHByaXZhdGUgd2lkdGg6IG51bWJlcjtcclxuICAgIHByaXZhdGUgY2FsRGF0YTogY2FjdWxhdGVkTm90ZURhdGFbXSA9IFtdO1xyXG4gICAgXHJcbiAgICAvKipcclxuICAgICAqIENhbGxiYWNrc1xyXG4gICAgICogQXZhaWxhYmxlIGNhbGxiYWNrc1xyXG4gICAgICogbm90ZWNsaWNrOiB0cmlnZ2VyZWQgd2hlbiBhIG5vdGUgZWxlbWVudCBpcyBjbGlja2VkXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgY2FsbGJhY2tzOiBDYWxsYmFja3M7XHJcblxyXG4gICAgY29uc3RydWN0b3IoZGF0YT86IHtsZW5ndGhQZXJCZWF0PzogbnVtYmVyLCBiZWF0UGVyU2VjdGlvbj86IG51bWJlciwgbGluZVdpZHRoPzogbnVtYmVyLCBzZWN0aW9uUGVyTGluZT86IG51bWJlciwgbGluZVBlclBhZ2U/OiBudW1iZXJ9KSB7XHJcbiAgICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLCBkYXRhKTtcclxuICAgICAgICB0aGlzLnRhYkNhbnZhcyA9IG5ldyBTTENhbnZhczxTTExheWVyPihTTExheWVyKTtcclxuICAgICAgICB0aGlzLndpZHRoID0gdGhpcy5saW5lV2lkdGggKyB0aGlzLmxpbmVQYWRkaW5nWzBdKjIgKyA0MioyO1xyXG4gICAgICAgIHV0aWxzLnNldEF0dHJpYnV0ZXModGhpcy50YWJDYW52YXMuZG9tRWxlbWVudCx7d2lkdGg6IGAke3RoaXMud2lkdGh9YH0pO1xyXG4gICAgICAgIHRoaXMuZG9tRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgdGhpcy5kb21FbGVtZW50LmFwcGVuZCh0aGlzLnRhYkNhbnZhcy5kb21FbGVtZW50KTtcclxuICAgICAgICB0aGlzLmRvbUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwoZSkgPT4ge1xyXG4gICAgICAgICAgICBsZXQga2EgPSBbMzIsIDM3LCAzOCwgMzksIDQwXTsgLy9zcGFjZTogMzIsIGxlZnQ6IDM3LCB1cDogMzgsIHJpZ2h0OiAzOSwgZG93bjogNDAsXHJcbiAgICAgICAgICAgIGlmKGthLmluY2x1ZGVzKGUua2V5Q29kZSkpe1xyXG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgZS5yZXR1cm5WYWx1ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdXRpbHMuc2V0U3R5bGUodGhpcy5kb21FbGVtZW50LCB7XCJ3aWR0aFwiOiBgJHt0aGlzLndpZHRoICsgMjB9cHhgLCBoZWlnaHQ6IGAke3RoaXMuY29udGFpbmVySGVpZ2h0fXB4YCwgXCJvdmVyZmxvdy15XCI6IFwiYXV0b1wiLCBcIm92ZXJmbG93LXhcIjogXCJoaWRkZW5cIn0pO1xyXG4gICAgICAgIC8vaWYgYWRkIG5ldyBldmVudCwgeW91IHNob3VsZCBkZXNjcmliZSB0aGUgY2FsbGJhY2sgaW4gZXZlbnRDYWxsQmFja0ludGVyZmFjZSBhYm92ZVxyXG4gICAgICAgIHRoaXMuY2FsbGJhY2tzID0gbmV3IENhbGxiYWNrcyhbXHJcbiAgICAgICAgICAgIFwibm90ZWNsaWNrXCIsIFxyXG4gICAgICAgICAgICBcIm5vdGVzaGlmdGNsaWNrXCIsIFxyXG4gICAgICAgICAgICBcIm5vdGVhbHRjbGlja1wiLCBcclxuICAgICAgICAgICAgXCJub3RlY3RybGNsaWNrXCIsXHJcbiAgICAgICAgICAgIFwia2V5ZG93blwiLCBcclxuICAgICAgICAgICAgXCJtb3VzZW92ZXJub3RlXCIsIFxyXG4gICAgICAgICAgICBcIm1vdXNlb3V0bm90ZVwiLCBcclxuICAgICAgICAgICAgXCJtb3VzZWRvd25cIiwgXHJcbiAgICAgICAgICAgIFwibW91c2Vtb3ZlXCIsIFxyXG4gICAgICAgICAgICBcIm1vdXNldXBcIixcclxuICAgICAgICAgICAgXCJyaWdodGNsaWNrXCIsXHJcbiAgICAgICAgICAgIFwic2VjdGlvbmhvdmVyXCIsXHJcbiAgICAgICAgICAgIFwic2VjdGlvbmhvdXRcIixcclxuICAgICAgICAgICAgXCJzZWN0aW9uY2xpY2tcIixcclxuICAgICAgICBdKTtcclxuICAgICAgICBcclxuICAgICAgICB1dGlscy5zZXRBdHRyaWJ1dGVzKHRoaXMuZG9tRWxlbWVudCwge3RhYmluZGV4OiBcIi0xXCJ9KTtcclxuICAgICAgICB0aGlzLmRvbUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5vbktleWRvd24uYmluZCh0aGlzKSk7XHJcbiAgICAgICAgdGhpcy5kb21FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgdGhpcy5vbk1vdXNlRG93bi5iaW5kKHRoaXMpKTtcclxuICAgICAgICB0aGlzLmRvbUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLCB0aGlzLm9uTW91c2VNb3ZlLmJpbmQodGhpcykpO1xyXG4gICAgICAgIHRoaXMuZG9tRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2V1cFwiLCB0aGlzLm9uTW91c2VVcC5iaW5kKHRoaXMpKTtcclxuICAgICAgICB0aGlzLmRvbUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNvbnRleHRtZW51XCIsIHRoaXMub25Nb3VzZVJpZ2h0Q2xpY2suYmluZCh0aGlzKSk7Ly9SaWdodCBjbGlja1xyXG4gICAgfVxyXG5cclxuICAgIC8vdG9kbzogZG8gYSBzdHJpY3RlciBjaGVjayBmb3IgdGhlc2UgZnVuY3Rpb25cclxuICAgIHNldERhdGEoZGF0YTogW251bWJlciwgbnVtYmVyW10sIGFueV1bXVtdKSB7XHJcbiAgICAgICAgdGhpcy5jbGVhckRhdGEoKTtcclxuICAgICAgICBsZXQgbmE6IE5vdGVbXVtdID0gW107XHJcbiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpKyspe1xyXG4gICAgICAgICAgICBsZXQgbmV3U2VjdGlvbjogTm90ZVtdID0gW107XHJcbiAgICAgICAgICAgIGZvcihsZXQgaiA9IDA7IGogPCBkYXRhW2ldLmxlbmd0aDsgaisrKXtcclxuICAgICAgICAgICAgICAgIGxldCBuZXdOb3RlID0gbmV3IE5vdGUoe25vdGVWYWx1ZTogZGF0YVtpXVtqXVswXSwgc3RyaW5nQ29udGVudDogZGF0YVtpXVtqXVsxXSwgdXNlckRhdGE6IGRhdGFbaV1bal1bMl19KTtcclxuICAgICAgICAgICAgICAgIG5ld1NlY3Rpb24ucHVzaChuZXdOb3RlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBuYS5wdXNoKG5ld1NlY3Rpb24pO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLm5vdGVzID0gbmE7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0Tm90ZURhdGEoc2VjdGlvbjogbnVtYmVyLCBub3RlOiBudW1iZXIpOiBOb3Rle1xyXG4gICAgICAgIHJldHVybiB0aGlzLm5vdGVzW3NlY3Rpb25dW25vdGVdO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBzZXROb3RlRGF0YShzZWN0aW9uOiBudW1iZXIsIG5vdGU6IG51bWJlciwgZGF0YTogTm90ZSl7XHJcbiAgICAgICAgaWYoc2VjdGlvbiA9PT0gLTEpc2VjdGlvbiA9IHRoaXMubm90ZXMubGVuZ3RoIC0gMTtcclxuICAgICAgICBpZihub3RlID09PSAtMSlub3RlID0gdGhpcy5ub3Rlc1tzZWN0aW9uXS5sZW5ndGggLSAxO1xyXG4gICAgICAgIHRoaXMubm90ZXNbc2VjdGlvbl1bbm90ZV0gPSBkYXRhO1xyXG4gICAgfVxyXG5cclxuICAgIHNldFN0cmluZ0RhdGFPZk5vdGUoc2VjdGlvbjogbnVtYmVyLCBub3RlOiBudW1iZXIsIHN0cmluZzogbnVtYmVyLCBkYXRhOiBudW1iZXIpe1xyXG4gICAgICAgIGlmKHN0cmluZyA+PTAgJiYgc3RyaW5nIDw9IDUpe1xyXG4gICAgICAgICAgICB0aGlzLm5vdGVzW3NlY3Rpb25dW25vdGVdWzFdW3N0cmluZ10gPSBkYXRhO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZXRTZWN0aW9uRGF0YShzZWN0aW9uOiBudW1iZXIpOiBOb3RlW117XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubm90ZXNbc2VjdGlvbl07XHJcbiAgICB9XHJcblxyXG4gICAgZGVsZXRlTm90ZShzZWN0aW9uOiBudW1iZXIsIG5vdGU6IG51bWJlciwgbnVtYmVyOiBudW1iZXIgPSAxKXtcclxuICAgICAgICBpZihzZWN0aW9uID09PSAtMSlzZWN0aW9uID0gdGhpcy5ub3Rlcy5sZW5ndGggLSAxO1xyXG4gICAgICAgIGlmKG5vdGUgPT09IC0xKW5vdGUgPSB0aGlzLm5vdGVzW3NlY3Rpb25dLmxlbmd0aCAtIDE7XHJcbiAgICAgICAgbGV0IG5wID0gdGhpcy5nZXROb3RlRmxhdHRlbk51bWJlcihzZWN0aW9uLCBub3RlKTtcclxuICAgICAgICBsZXQgZG4gPSB0aGlzLm5vdGVzW3NlY3Rpb25dLnNwbGljZShub3RlLCBudW1iZXIpLmxlbmd0aDtcclxuICAgICAgICB0aGlzLnJlbW92ZUNhbERhdGEobnAsIGRuKTtcclxuICAgIH1cclxuXHJcbiAgICBhZGROb3RlKHNlY3Rpb246IG51bWJlciwgbm90ZTogbnVtYmVyLCBkYXRhOiBOb3RlKXtcclxuICAgICAgICBpZih0aGlzLmluRWRpdCl7XHJcbiAgICAgICAgICAgIGlmKHNlY3Rpb24gPT09IC0xIHx8IHNlY3Rpb24gPj0gdGhpcy5ub3Rlcy5sZW5ndGgpe1xyXG4gICAgICAgICAgICAgICAgc2VjdGlvbiA9IHRoaXMubm90ZXMubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5ub3Rlcy5wdXNoKFtdKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZihub3RlID09PSAtMSB8fCBub3RlID4gdGhpcy5ub3Rlc1tzZWN0aW9uXS5sZW5ndGgpe1xyXG4gICAgICAgICAgICAgICAgbm90ZSA9IHRoaXMubm90ZXNbc2VjdGlvbl0ubGVuZ3RoO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMubm90ZXNbc2VjdGlvbl0uc3BsaWNlKG5vdGUsIDAsIGRhdGEpO1xyXG4gICAgICAgICAgICBsZXQgbnAgPSB0aGlzLmdldE5vdGVGbGF0dGVuTnVtYmVyKHNlY3Rpb24sIG5vdGUpO1xyXG4gICAgICAgICAgICB0aGlzLmNhbERhdGEuc3BsaWNlKG5wLCAwLCB7eDogLTEsIHk6IC0xLCBsZW5ndGg6IC0xLCBibG9ja3M6IFtdLCB0YWlsOiBbXSwgc2VjdGlvbjogLTEsIG5vdGU6IC0xLCBoYXNTdmc6IGZhbHNlfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIFxyXG4gICAgaXNCbGFua05vdGUoc2VjdGlvbjogbnVtYmVyLCBub3RlOiBudW1iZXIpe1xyXG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCA2OyBpKyspe1xyXG4gICAgICAgICAgICBpZih0aGlzLm5vdGVzW3NlY3Rpb25dW25vdGVdWzFdW2ldICE9IC0xKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRTVkdOb3RlKHNlY3Rpb246IG51bWJlciwgbm90ZTogbnVtYmVyKTogU1ZHTm90ZXtcclxuICAgICAgICBsZXQgbm90ZUVsZW1lbnRzID0gdGhpcy50YWJDYW52YXMubGF5ZXJzLm5vdGVzLm5vdGVFbGVtZW50cztcclxuICAgICAgICByZXR1cm4gbm90ZUVsZW1lbnRzLmZpbmQoKGVsZW0pID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIGVsZW0uc2VjdGlvbiA9PSBzZWN0aW9uICYmIGVsZW0ubm90ZSA9PSBub3RlXHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuXHJcbiAgICBnZXROb3RlUG9zaXRpb24oc2VjdGlvbjogbnVtYmVyLCBub3RlOiBudW1iZXIsIHN0cmluZzogbnVtYmVyID0gMCk6IFtudW1iZXIsIG51bWJlcl17XHJcbiAgICAgICAgbGV0IHN1bSA9IDA7XHJcbiAgICAgICAgaWYoc2VjdGlvbiA9PSAtMSkgc2VjdGlvbiA9IHRoaXMubm90ZXMubGVuZ3RoIC0xO1xyXG4gICAgICAgIGlmKG5vdGUgPT0gLTEpIG5vdGUgPSB0aGlzLm5vdGVzW3NlY3Rpb25dLmxlbmd0aCAtMTtcclxuICAgICAgICBpZihzZWN0aW9uID49IHRoaXMubm90ZXMubGVuZ3RoIHx8IHNlY3Rpb24gPCAtMSB8fCBub3RlID49IHRoaXMubm90ZXNbc2VjdGlvbl0ubGVuZ3RoIHx8IG5vdGUgPCAtMSB8fCBzdHJpbmcgPiA1IHx8IHN0cmluZyA8IDApe1xyXG4gICAgICAgICAgICByZXR1cm4gWy0xLCAtMV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKHRoaXMubm90ZXNbc2VjdGlvbl0ubGVuZ3RoID09PSAwICkgcmV0dXJuIFstMSwgLTFdO1xyXG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBzZWN0aW9uOyBpKyspe1xyXG4gICAgICAgICAgICBzdW0gKz0gdGhpcy5ub3Rlc1tpXS5sZW5ndGg7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHN1bSArPSBub3RlO1xyXG4gICAgICAgIGlmKCF0aGlzLnRhYkNhbnZhcy5sYXllcnMubm90ZXMubm90ZUVsZW1lbnRzW3N1bV0pIHJldHVybiBbLTEsIC0xXTtcclxuICAgICAgICBsZXQgc2VsID0gdGhpcy50YWJDYW52YXMubGF5ZXJzLm5vdGVzLm5vdGVFbGVtZW50c1tzdW1dLmJsb2NrR3JvdXBbc3RyaW5nXTtcclxuICAgICAgICByZXR1cm4gW3NlbC54LCBzZWwueV07XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0Tm90ZU51bWJlck9mU2VjdGlvbihzZWN0aW9uOiBudW1iZXIpe1xyXG4gICAgICAgIGlmKHNlY3Rpb24gPT0gLTEpIHNlY3Rpb24gPSB0aGlzLm5vdGVzLmxlbmd0aCAtIDE7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubm90ZXNbc2VjdGlvbl0ubGVuZ3RoO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFNlY3Rpb25OdW1iZXIoKXtcclxuICAgICAgICByZXR1cm4gdGhpcy5ub3Rlcy5sZW5ndGg7XHJcbiAgICB9XHJcbiAgICBpbnNlcnRTZWN0aW9uKHNlY3Rpb246IG51bWJlciwgZGF0YTogc2VjdGlvbiA9IFtdKTogYm9vbGVhbntcclxuICAgICAgICBpZihzZWN0aW9uIDwgLTEgfHwgc2VjdGlvbiA+IHRoaXMubm90ZXMubGVuZ3RoKXtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZihzZWN0aW9uID09PSAtMSlzZWN0aW9uID0gdGhpcy5ub3Rlcy5sZW5ndGg7XHJcbiAgICAgICAgbGV0IGlzcCA9IHRoaXMuZ2V0Tm90ZUZsYXR0ZW5OdW1iZXIoc2VjdGlvbiwgLTEpO1xyXG4gICAgICAgIGxldCBpc2E6IGNhY3VsYXRlZE5vdGVEYXRhW10gPSBbXTtcclxuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKyl7XHJcbiAgICAgICAgICAgIGlzYS5wdXNoKHt4OiAtMSwgeTogLTEsIGxlbmd0aDogLTEsIGJsb2NrczogW10sIHRhaWw6IFtdLCBzZWN0aW9uOiAtMSwgbm90ZTogLTEsIGhhc1N2ZzogZmFsc2V9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5ub3Rlcy5zcGxpY2Uoc2VjdGlvbiwgMCwgZGF0YSk7XHJcbiAgICAgICAgdGhpcy5jYWxEYXRhLnNwbGljZShpc3AgKyAxLCAwLCAuLi5pc2EpO1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gICAgZGVsZXRlU2VjdGlvbnMoc2VjdGlvbjogbnVtYmVyLCBudW1iZXI6IG51bWJlciA9IDEpOiBzZWN0aW9uW117XHJcbiAgICAgICAgaWYoc2VjdGlvbiA8IC0xIHx8IHNlY3Rpb24gPj0gdGhpcy5ub3Rlcy5sZW5ndGgpe1xyXG4gICAgICAgICAgICByZXR1cm4gW107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBkbiA9IDA7XHJcbiAgICAgICAgbGV0IGRwID0gdGhpcy5nZXROb3RlRmxhdHRlbk51bWJlcihzZWN0aW9uLCAwKTtcclxuICAgICAgICBmb3IobGV0IGkgPSBzZWN0aW9uOyBpIDwgc2VjdGlvbiArIG51bWJlciAmJiBpIDwgdGhpcy5ub3RlSW5kZXgubGVuZ3RoOyBpKyspIGRuICs9IHRoaXMubm90ZXNbaV0ubGVuZ3RoO1xyXG4gICAgICAgIHRoaXMucmVtb3ZlQ2FsRGF0YShkcCwgZG4pO1xyXG4gICAgICAgIHJldHVybiB0aGlzLm5vdGVzLnNwbGljZShzZWN0aW9uLCBudW1iZXIpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldE5vdGVGbGF0dGVuTnVtYmVyKHNlY3Rpb246IG51bWJlciwgbm90ZTogbnVtYmVyKTogbnVtYmVye1xyXG4gICAgICAgIGlmKCF0aGlzLm5vdGVzW3NlY3Rpb25dKSByZXR1cm4gLTE7XHJcbiAgICAgICAgaWYobm90ZSA9PT0gLTEpIG5vdGUgPSB0aGlzLm5vdGVzW3NlY3Rpb25dLmxlbmd0aCAtIDE7XHJcbiAgICAgICAgaWYodGhpcy5ub3Rlc1tzZWN0aW9uXVtub3RlXSl7XHJcbiAgICAgICAgICAgIGxldCB0b3RhbCA9IDA7XHJcbiAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBzZWN0aW9uOyBpKyspIHRvdGFsICs9IHRoaXMubm90ZXNbaV0ubGVuZ3RoO1xyXG4gICAgICAgICAgICB0b3RhbCArPSBub3RlO1xyXG4gICAgICAgICAgICByZXR1cm4gdG90YWw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiAtMTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogYWRkIGEgbm90ZVxyXG4gICAgICogQHBhcmFtIHsgW251bWJlciwgbnVtYmVyW10sIGFueV0gfSAgIGRhdGEsIG5vdGUgbGVuZ3RoLCBbYmxvY2sgbnVtYmVyLCBpbmRleCBpcyBzdHJpbmcgbnVtYmVyLF0sIHVzZXIgZGF0YVxyXG4gICAgICogQHBhcmFtIHsgbnVtYmVyIH0gICAgICAgICAgICAgICAgICAgIHNlY3Rpb24sIGlmIGdpdmUgLTEsIG5vdGUgd2lsbCBiZSBhcHBlbmRlZCBhdCBsYXN0IHNlY3Rpb24uIEluZGV4IHN0YXJ0IGZyb20gMFxyXG4gICAgICogQHBhcmFtIHsgbnVtYmVyIH0gICAgICAgICAgICAgICAgICAgIG5vdGUsIGlmIGdpdmUgLTEsIG5vdGUgd2lsbCBiZSBhcHBlbmRlZCBhdCBsYXN0IG5vdGUuIEluZGV4IHN0YXJ0IGZyb20gMFxyXG4gICAgICovXHJcbiAgICBpbnN0cnVtZW50Tm90ZUlucHV0KGNvcnJlY3Rpb246IENvcnJlY3Rpb24sIGRhdGE6IE5vdGUsIHNlY3Rpb246IG51bWJlciA9IC0xLCBub3RlOiBudW1iZXIgPSAtMSkge1xyXG4gICAgICAgIGlmKHNlY3Rpb24gPT0gLTEpc2VjdGlvbiA9IHRoaXMubm90ZXMubGVuZ3RoIC0gMTtcclxuICAgICAgICBpZihub3RlID09IC0xKW5vdGUgPSB0aGlzLm5vdGVzW3NlY3Rpb25dLmxlbmd0aDtcclxuICAgICAgICBjb3JyZWN0aW9uKHRoaXMsIGRhdGEsIHNlY3Rpb24sIG5vdGUpO1xyXG4gICAgICAgIHRoaXMucmVuZGVyKCk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGF0dGFjaChhbmNob3I6IEhUTUxFbGVtZW50KXtcclxuICAgICAgICBhbmNob3IuYXBwZW5kKHRoaXMuZG9tRWxlbWVudCk7XHJcbiAgICAgICAgdXRpbHMuc2V0U3R5bGUoYW5jaG9yLCB7d2lkdGg6IGAke3RoaXMud2lkdGggKyAyMH1weGB9KTtcclxuICAgIH1cclxuXHJcbiAgICBub3RlSW5kZXgobm90ZTogU1ZHTm90ZSl7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudGFiQ2FudmFzLmxheWVycy5ub3Rlcy5ub3RlRWxlbWVudHMuaW5kZXhPZihub3RlKTtcclxuICAgIH1cclxuICAgICAgICAvKipcclxuICAgICAqIERyYWcgYW5kIGRyb2cgYXJlYSBzZWxlY3Qgbm90ZXNcclxuICAgICAqIEJhZCBpbXBsZW1lbnQgYnkgbm93LCB0aGUgZnVuY3Rpb24gc2VhcmNoIGVhY2ggbm90ZSB0byBmaW5kIGNvbGxpc2lvblxyXG4gICAgICogQWxnb3JpdGhtIHdpbGwgYmUgZml4ZWQgaW4gZnV0dXJlLlxyXG4gICAgICovXHJcbiAgICBhcmVhU2VsZWN0KHgxOiBudW1iZXIsIHkxOiBudW1iZXIsIHgyOiBudW1iZXIsIHkyOiBudW1iZXIpe1xyXG4gICAgICAgIGxldCBub3RlRWxlbWVudHMgPSB0aGlzLnRhYkNhbnZhcy5sYXllcnMubm90ZXMubm90ZUVsZW1lbnRzO1xyXG4gICAgICAgIHZhciBzZWxlY3RlZE5vdGVJZHM6IG51bWJlcltdID0gW107XHJcbiAgICAgICAgbGV0IGxlZnRTZWxlY3RlZE5vdGU6IG51bWJlcjtcclxuICAgICAgICBsZXQgcmlnaHRTZWxlY3RlZE5vdGU6IG51bWJlcjtcclxuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgbm90ZUVsZW1lbnRzLmxlbmd0aDsgaSsrKXtcclxuICAgICAgICAgICAgZm9yKGxldCBqID0gMDsgaiA8IDY7IGorKyl7XHJcbiAgICAgICAgICAgICAgICAvL0NoZWNrIGlmIG5vdGUgaXMgaW4gdGhlIHNlbGVjdGVkIGFyZWFcclxuICAgICAgICAgICAgICAgIGlmKG5vdGVFbGVtZW50c1tpXS5ibG9ja0dyb3VwW2pdLnggPj0geDEgXHJcbiAgICAgICAgICAgICAgICAgICAgJiYgbm90ZUVsZW1lbnRzW2ldLmJsb2NrR3JvdXBbal0ueCA8PSB4MiBcclxuICAgICAgICAgICAgICAgICAgICAmJiBub3RlRWxlbWVudHNbaV0uYmxvY2tHcm91cFtqXS55ID49eTEgXHJcbiAgICAgICAgICAgICAgICAgICAgJiYgbm90ZUVsZW1lbnRzW2ldLmJsb2NrR3JvdXBbal0ueSA8PXkyIFxyXG4gICAgICAgICAgICAgICAgICAgICYmIG5vdGVFbGVtZW50c1tpXS5kb21lbGVtZW50LnN0eWxlLmRpc3BsYXkgIT0gXCJub25lXCIpe1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkTm90ZUlkcy5wdXNoKGkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxlZnRTZWxlY3RlZE5vdGUgPSBNYXRoLm1pbiguLi5zZWxlY3RlZE5vdGVJZHMpO1xyXG4gICAgICAgIHJpZ2h0U2VsZWN0ZWROb3RlID0gTWF0aC5tYXgoLi4uc2VsZWN0ZWROb3RlSWRzKTtcclxuICAgICAgICByZXR1cm4gbm90ZUVsZW1lbnRzLnNsaWNlKGxlZnRTZWxlY3RlZE5vdGUsIHJpZ2h0U2VsZWN0ZWROb3RlKzEpO1xyXG4gICAgfVxyXG4gICAgZW5kc1NlbGVjdChoZWFkOiBudW1iZXIsIHRhaWw6IG51bWJlcik6IFNWR05vdGVbXXtcclxuICAgICAgICBpZihoZWFkID4gdGFpbCl7XHJcbiAgICAgICAgICAgIGxldCB0ZW1wID0gdGFpbDtcclxuICAgICAgICAgICAgdGFpbCA9IGhlYWQ7XHJcbiAgICAgICAgICAgIGhlYWQgPSB0ZW1wO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy50YWJDYW52YXMubGF5ZXJzLm5vdGVzLm5vdGVFbGVtZW50cy5zbGljZShoZWFkLCB0YWlsKzEpO1xyXG4gICAgfVxyXG4gICAgaGVhZFRvRW5kU2VsZWN0KGhlYWQ6IG51bWJlcik6IFNWR05vdGVbXXtcclxuICAgICAgICByZXR1cm4gdGhpcy50YWJDYW52YXMubGF5ZXJzLm5vdGVzLm5vdGVFbGVtZW50cy5zbGljZShoZWFkLCB0aGlzLnRhYkNhbnZhcy5sYXllcnMubm90ZXMubm90ZUVsZW1lbnRzLmxlbmd0aCk7XHJcbiAgICB9XHJcbiAgICByZW5kZXIoKSB7XHJcbiAgICAgICAgdGhpcy5zZXRBbGxMaW5lKCk7XHJcbiAgICAgICAgbGV0IFtjYWxEYXRhTGVuZ3RoLCBjaGFuZ2VTZXQsIGxpbmtlckRhdGEsIHNlY3Rpb25Qb3NpdGlvbiwgZG90RGF0YV0gPSB0aGlzLmNhbE5vdGVEYXRhKCk7XHJcbiAgICAgICAgdGhpcy5zZXRTZWN0aW9uSW5kaWNhdG9yKHNlY3Rpb25Qb3NpdGlvbik7XHJcbiAgICAgICAgdGhpcy5zZXRBbGxOb3RlRWxlbWVudERhdGEoY2FsRGF0YUxlbmd0aCwgY2hhbmdlU2V0KTtcclxuICAgICAgICB0aGlzLnNldExpbmtlcihsaW5rZXJEYXRhKTtcclxuICAgICAgICB0aGlzLnNldERvdChkb3REYXRhKTtcclxuICAgICAgICBsZXQgbG4gPSBNYXRoLmNlaWwodGhpcy5ub3Rlcy5sZW5ndGggLyB0aGlzLnNlY3Rpb25QZXJMaW5lKTtcclxuICAgICAgICBpZih0aGlzLmhlaWdodCAhPSAodGhpcy5saW5lU3RhcnRQb3NpdGlvblsxXSArICh0aGlzLnN0cmluZ1BhZGRpbmcgKiA1ICsgdGhpcy5saW5lRGlzdGFuY2UpICogbG4gKyA3MCkpe1xyXG4gICAgICAgICAgICB0aGlzLmhlaWdodCA9ICh0aGlzLmxpbmVTdGFydFBvc2l0aW9uWzFdICsgKHRoaXMuc3RyaW5nUGFkZGluZyAqIDUgKyB0aGlzLmxpbmVEaXN0YW5jZSkgKiBsbiArIDcwKTtcclxuICAgICAgICAgICAgdXRpbHMuc2V0QXR0cmlidXRlcyh0aGlzLnRhYkNhbnZhcy5kb21FbGVtZW50LHsgaGVpZ2h0OiBgJHt0aGlzLmhlaWdodH1gfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9uPGsgZXh0ZW5kcyBrZXlvZiBldmVudENhbGxCYWNrSW50ZXJmYWNlPihlbmFtZTogaywgY2JrOiBldmVudENhbGxCYWNrSW50ZXJmYWNlW2tdKSB7XHJcbiAgICAgICAgaWYoZW5hbWUgaW4gdGhpcy5jYWxsYmFja3MpIHtcclxuICAgICAgICAgICAgdGhpcy5jYWxsYmFja3NbZW5hbWVdLnB1c2goY2JrKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc2Nyb2xsVG8odmFsOiBudW1iZXIpe1xyXG4gICAgICAgIHRoaXMuZG9tRWxlbWVudC5zY3JvbGxUb3AgPSB2YWw7XHJcbiAgICB9XHJcbiAgICBnZXRTZWN0aW9uTGVmdFRvcFBvcyhzZWN0aW9uOiBudW1iZXIpOiBbbnVtYmVyLCBudW1iZXJde1xyXG4gICAgICAgIGlmKHNlY3Rpb24gPCB0aGlzLm5vdGVzLmxlbmd0aCl7XHJcbiAgICAgICAgICAgIHJldHVybiBbdGhpcy50YWJDYW52YXMubGF5ZXJzLnVpLnNlY3Rpb25JbmRpY2F0b3Jbc2VjdGlvbl0ueCwgdGhpcy50YWJDYW52YXMubGF5ZXJzLnVpLnNlY3Rpb25JbmRpY2F0b3Jbc2VjdGlvbl0ueV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBbLTEsIC0xXVxyXG4gICAgfVxyXG4gICAgZ2V0U2VjdGlvbldpZHRoKHNlY3Rpb246IG51bWJlcik6IG51bWJlcntcclxuICAgICAgICBpZihzZWN0aW9uIDwgdGhpcy5ub3Rlcy5sZW5ndGgpe1xyXG4gICAgICAgICAgICB0aGlzLnRhYkNhbnZhcy5sYXllcnMudWkuc2VjdGlvbkluZGljYXRvcltzZWN0aW9uXS53aWR0aDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIDA7XHJcbiAgICB9XHJcbiAgICBnZXRTZWN0aW9uSGVpZ2h0KHNlY3Rpb246IG51bWJlcik6IG51bWJlcntcclxuICAgICAgICBpZihzZWN0aW9uIDwgdGhpcy5ub3Rlcy5sZW5ndGgpe1xyXG4gICAgICAgICAgICB0aGlzLnRhYkNhbnZhcy5sYXllcnMudWkuc2VjdGlvbkluZGljYXRvcltzZWN0aW9uXS5oZWlnaHQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiAwO1xyXG4gICAgfVxyXG4gICAgYWRqdXN0UG9zdGlvbih5OiBudW1iZXIpe1xyXG4gICAgICAgIGlmKHkgKyAyMjAgPiB0aGlzLmRvbUVsZW1lbnQuc2Nyb2xsVG9wICsgdGhpcy5jb250YWluZXJIZWlnaHQpe1xyXG4gICAgICAgICAgICB0aGlzLnNjcm9sbFRvKHkgLSB0aGlzLmNvbnRhaW5lckhlaWdodCArIDIyMCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKHkgLSA4MCA8IHRoaXMuZG9tRWxlbWVudC5zY3JvbGxUb3Ape1xyXG4gICAgICAgICAgICB0aGlzLnNjcm9sbFRvKHkgLSA4MCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGlzU2VjdGlvbkZ1bGwoc2VjdGlvbjogbnVtYmVyKXtcclxuICAgICAgICBsZXQgc3RhY2tMZW5ndGggPSAwOy8vIHVuaXQgaW4gYmVhdFxyXG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCB0aGlzLm5vdGVzW3NlY3Rpb25dLmxlbmd0aDsgaSsrKXtcclxuICAgICAgICAgICAgc3RhY2tMZW5ndGggKz0gdGhpcy5sZW5ndGhQZXJCZWF0IC8gdGhpcy5ub3Rlc1tzZWN0aW9uXVtpXVswXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoc3RhY2tMZW5ndGggPj0gdGhpcy5iZWF0UGVyU2VjdGlvbil7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjbGVhckRhdGEoKXtcclxuICAgICAgICB0aGlzLm5vdGVzID0gW1tdXTtcclxuICAgICAgICB0aGlzLmNhbERhdGEgPSBbXTtcclxuICAgICAgICB0aGlzLnRhYkNhbnZhcy5sYXllcnMubm90ZXMucmVtb3ZlTm90ZSgwLCB0aGlzLnRhYkNhbnZhcy5sYXllcnMubm90ZXMubm90ZUVsZW1lbnRzLmxlbmd0aCk7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIHJlbW92ZUNhbERhdGEocmVtb3ZlSW5kZXg6IG51bWJlciwgbnVtOiBudW1iZXIpe1xyXG4gICAgICAgIHRoaXMuY2FsRGF0YS5zcGxpY2UocmVtb3ZlSW5kZXgsIG51bSk7XHJcbiAgICAgICAgdGhpcy50YWJDYW52YXMubGF5ZXJzLm5vdGVzLnJlbW92ZU5vdGUocmVtb3ZlSW5kZXgsIG51bSk7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIHNldEFsbExpbmUoKSB7XHJcbiAgICAgICAgbGV0IGxuID0gTWF0aC5jZWlsKHRoaXMubm90ZXMubGVuZ3RoIC8gdGhpcy5zZWN0aW9uUGVyTGluZSk7IC8vIG51bWJlciBvZiByb3cgeW91IG5lZWRcclxuICAgICAgICBsZXQgYW4gPSB0aGlzLnRhYkNhbnZhcy5sYXllcnMuc2hlZXQucm93Lmxlbmd0aDsgLy8gbnVtYmVyIG9mIHJvdyB5b3UgaGF2ZVxyXG4gICAgICAgIGZvcihsZXQgaSA9IGFuOyBpIDwgbG4gOyBpKyspe1xyXG4gICAgICAgICAgICBsZXQgeCA9IHRoaXMubGluZVN0YXJ0UG9zaXRpb25bMF07XHJcbiAgICAgICAgICAgIGxldCB5ID0gdGhpcy5saW5lU3RhcnRQb3NpdGlvblsxXSArICh0aGlzLnN0cmluZ1BhZGRpbmcgKiA1ICsgdGhpcy5saW5lRGlzdGFuY2UpICogaTtcclxuICAgICAgICAgICAgdGhpcy50YWJDYW52YXMubGF5ZXJzLnNoZWV0LmNyZWF0ZVJvdyh4LCB5LCB0aGlzLmxpbmVXaWR0aCwgdGhpcy5saW5lUGFkZGluZywgdGhpcy5zdHJpbmdQYWRkaW5nLCB0aGlzLnNlY3Rpb25QZXJMaW5lKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yKGxldCBpID0gbG47IGkgPCBhbjsgaSsrKXtcclxuICAgICAgICAgICAgdXRpbHMuc2V0U3R5bGUodGhpcy50YWJDYW52YXMubGF5ZXJzLnNoZWV0LnJvd1tpXSwge2Rpc3BsYXk6IFwibm9uZVwifSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBsbjsgaSsrKXtcclxuICAgICAgICAgICAgdXRpbHMuc2V0U3R5bGUodGhpcy50YWJDYW52YXMubGF5ZXJzLnNoZWV0LnJvd1tpXSwge2Rpc3BsYXk6IFwidW5zZXRcIn0pXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSBzZXRTZWN0aW9uSW5kaWNhdG9yKHBvc2l0aW9uOiBbbnVtYmVyW10sIG51bWJlcltdXVtdKXtcclxuICAgICAgICBpZihwb3NpdGlvbi5sZW5ndGggPiB0aGlzLnRhYkNhbnZhcy5sYXllcnMudWkuc2VjdGlvbkluZGljYXRvci5sZW5ndGgpe1xyXG4gICAgICAgICAgICBsZXQgbnNOdW1iZXIgPSBwb3NpdGlvbi5sZW5ndGggLSB0aGlzLnRhYkNhbnZhcy5sYXllcnMudWkuc2VjdGlvbkluZGljYXRvci5sZW5ndGg7XHJcbiAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBuc051bWJlcjsgaSsrKXtcclxuICAgICAgICAgICAgICAgIGxldCBuYyA9IHRoaXMudGFiQ2FudmFzLmxheWVycy51aS5jcmVhdGVTZWN0aW9uSW5kaWNhdG9yKCk7XHJcbiAgICAgICAgICAgICAgICBuYy5kb21FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIix0aGlzLm9uU2VjdGlvbkhvdmVyLmJpbmQodGhpcykpO1xyXG4gICAgICAgICAgICAgICAgbmMuZG9tRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2VvdXRcIix0aGlzLm9uU2VjdGlvbkhvdXQuYmluZCh0aGlzKSk7XHJcbiAgICAgICAgICAgICAgICBuYy5kb21FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLHRoaXMub25TZWN0aW9uQ2xpY2suYmluZCh0aGlzKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IHBvc2l0aW9uLmxlbmd0aDsgaSsrKXtcclxuICAgICAgICAgICAgbGV0IHdpZHRoID0gcG9zaXRpb25baV1bMV1bMF0gLSBwb3NpdGlvbltpXVswXVswXTtcclxuICAgICAgICAgICAgbGV0IGhlaWdodCA9IHRoaXMuc3RyaW5nUGFkZGluZyAqIDU7XHJcbiAgICAgICAgICAgIHRoaXMudGFiQ2FudmFzLmxheWVycy51aS5zZWN0aW9uSW5kaWNhdG9yW2ldLnggPSBwb3NpdGlvbltpXVswXVswXVxyXG4gICAgICAgICAgICB0aGlzLnRhYkNhbnZhcy5sYXllcnMudWkuc2VjdGlvbkluZGljYXRvcltpXS55ID0gcG9zaXRpb25baV1bMF1bMV1cclxuICAgICAgICAgICAgdGhpcy50YWJDYW52YXMubGF5ZXJzLnVpLnNlY3Rpb25JbmRpY2F0b3JbaV0ud2lkdGggPSB3aWR0aDtcclxuICAgICAgICAgICAgdGhpcy50YWJDYW52YXMubGF5ZXJzLnVpLnNlY3Rpb25JbmRpY2F0b3JbaV0uaGVpZ2h0ID0gaGVpZ2h0O1xyXG4gICAgICAgICAgICB0aGlzLnRhYkNhbnZhcy5sYXllcnMuc2hlZXQuYmFyW2ldLngxID0gcG9zaXRpb25baV1bMF1bMF0gKyB3aWR0aDtcclxuICAgICAgICAgICAgdGhpcy50YWJDYW52YXMubGF5ZXJzLnNoZWV0LmJhcltpXS54MiA9IHBvc2l0aW9uW2ldWzBdWzBdICsgd2lkdGg7XHJcbiAgICAgICAgICAgIHV0aWxzLnNldEF0dHJpYnV0ZXModGhpcy50YWJDYW52YXMubGF5ZXJzLnVpLnNlY3Rpb25JbmRpY2F0b3JbaV0uZG9tRWxlbWVudCx7XCJkYXRhLXNlY3Rpb25cIjogYCR7aX1gfSk7XHJcbiAgICAgICAgICAgIHV0aWxzLnNldFN0eWxlKDxIVE1MRWxlbWVudD48dW5rbm93bj50aGlzLnRhYkNhbnZhcy5sYXllcnMudWkuc2VjdGlvbkluZGljYXRvcltpXS5kb21FbGVtZW50LCB7ZGlzcGxheTogXCJ1bnNldFwifSk7XHJcbiAgICAgICAgICAgIHV0aWxzLnNldFN0eWxlKDxIVE1MRWxlbWVudD48dW5rbm93bj50aGlzLnRhYkNhbnZhcy5sYXllcnMuc2hlZXQuYmFyW2ldLmRvbUVsZW1lbnQsIHtkaXNwbGF5OiBcInVuc2V0XCJ9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yKGxldCBpID0gcG9zaXRpb24ubGVuZ3RoOyBpIDwgdGhpcy50YWJDYW52YXMubGF5ZXJzLnVpLnNlY3Rpb25JbmRpY2F0b3IubGVuZ3RoOyBpKyspe1xyXG4gICAgICAgICAgICB1dGlscy5zZXRTdHlsZSg8SFRNTEVsZW1lbnQ+PHVua25vd24+dGhpcy50YWJDYW52YXMubGF5ZXJzLnVpLnNlY3Rpb25JbmRpY2F0b3JbaV0uZG9tRWxlbWVudCwge2Rpc3BsYXk6IFwibm9uZVwifSk7XHJcbiAgICAgICAgICAgIHV0aWxzLnNldFN0eWxlKDxIVE1MRWxlbWVudD48dW5rbm93bj50aGlzLnRhYkNhbnZhcy5sYXllcnMuc2hlZXQuYmFyW2ldLmRvbUVsZW1lbnQsIHtkaXNwbGF5OiBcIm5vbmVcIn0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNhbE5vdGVEYXRhKCk6W251bWJlciwgU2V0PG51bWJlcj4sIG51bWJlcltdW10sIFtudW1iZXJbXSwgbnVtYmVyW11dW10sIG51bWJlcltdW10gXXtcclxuICAgICAgICBsZXQgW3gsIHldID0gdGhpcy5zdGFydFBvc2l0aW9uO1xyXG4gICAgICAgIGxldCBzZWN0aW9uTGVuZ3RoID0gdGhpcy5iZWF0UGVyU2VjdGlvbiAvIHRoaXMubGVuZ3RoUGVyQmVhdDtcclxuICAgICAgICBsZXQgbGlua2VyID0gW107XHJcbiAgICAgICAgbGV0IGRvdCA9IFtdO1xyXG4gICAgICAgIGxldCBzZWN0aW9uSW5kaWNhdG9yOiBbbnVtYmVyW10sIG51bWJlcltdXVtdID0gW107XHJcbiAgICAgICAgbGV0IHNlcGVyYXRlckxlbmd0aCA9IDEgLyA0O1xyXG4gICAgICAgIGxldCBhY2N1bXVsYXRlZExlbmd0aCA9IDA7XHJcbiAgICAgICAgbGV0IGNpID0gMDtcclxuICAgICAgICBsZXQgY2hhbmdlU2V0ID0gbmV3IFNldDxudW1iZXI+KCk7XHJcbiAgICAgICAgbGV0IGZpcnN0ID0gLTE7XHJcblxyXG4gICAgICAgIGZvcihsZXQgcyA9IDA7IHMgPCB0aGlzLm5vdGVzLmxlbmd0aDsgcysrKXsgLy8gc2VjdGlvblxyXG4gICAgICAgICAgICBsZXQgbGluZSA9IE1hdGguZmxvb3IocyAvIHRoaXMuc2VjdGlvblBlckxpbmUpO1xyXG4gICAgICAgICAgICBsZXQgbGluZVRvdGFsTm90ZSA9IDA7XHJcbiAgICAgICAgICAgIGFjY3VtdWxhdGVkTGVuZ3RoID0gMDtcclxuICAgICAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IHRoaXMuc2VjdGlvblBlckxpbmU7IGkrKyl7XHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLm5vdGVzW2xpbmUgKiB0aGlzLnNlY3Rpb25QZXJMaW5lICsgaV0pe1xyXG4gICAgICAgICAgICAgICAgICAgIGxpbmVUb3RhbE5vdGUgKz0gTWF0aC5tYXgodGhpcy5ub3Rlc1tsaW5lICogdGhpcy5zZWN0aW9uUGVyTGluZSArIGldLmxlbmd0aCwgdGhpcy5zZWN0aW9uQWRkTm90ZU51bWJlcik7XHJcbiAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICBsaW5lVG90YWxOb3RlICs9IHRoaXMuc2VjdGlvbkFkZE5vdGVOdW1iZXI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbGV0IHNlY3Rpb25XaWR0aCA9IHRoaXMubGluZVdpZHRoICogKE1hdGgubWF4KHRoaXMubm90ZXNbc10ubGVuZ3RoLCB0aGlzLnNlY3Rpb25BZGROb3RlTnVtYmVyKSkgLyBsaW5lVG90YWxOb3RlO1xyXG4gICAgICAgICAgICBsZXQgc2VjdGlvblRvdGFsQmVhdCA9IDA7XHJcbiAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCB0aGlzLm5vdGVzW3NdLmxlbmd0aDsgaSsrKXtcclxuICAgICAgICAgICAgICAgIHNlY3Rpb25Ub3RhbEJlYXQgKz0gdGhpcy5sZW5ndGhQZXJCZWF0IC90aGlzLm5vdGVzW3NdW2ldWzBdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGxldCBiZWF0TGVuZ3RoID0gKHNlY3Rpb25XaWR0aCAtIDIwKSAvIHNlY3Rpb25Ub3RhbEJlYXQ7XHJcblxyXG4gICAgICAgICAgICBpZihzICUgdGhpcy5zZWN0aW9uUGVyTGluZSA9PSAwKXsgLy8gY2hhbmdlIGxpbmVcclxuICAgICAgICAgICAgICAgIHggPSB0aGlzLnN0YXJ0UG9zaXRpb25bMF07XHJcbiAgICAgICAgICAgICAgICBpZihzICE9IDApeSArPSB0aGlzLnN0cmluZ1BhZGRpbmcgKiA1ICsgdGhpcy5saW5lRGlzdGFuY2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbGV0IHN4OiBbbnVtYmVyW10sIG51bWJlcltdXSA9IFtbeCAtIDIwLCB5XSwgWzAsIHldXTsgLy8gc2VjdGlvbiBwb3NpdGlvblxyXG4gICAgICAgICAgICBsZXQgbnggPSB4ICsgc2VjdGlvbldpZHRoO1xyXG4gICAgICAgICAgICBzeFsxXVswXSA9IG54IC0gMjA7XHJcbiAgICAgICAgICAgIHNlY3Rpb25JbmRpY2F0b3IucHVzaChzeCk7XHJcbiAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCB0aGlzLm5vdGVzW3NdLmxlbmd0aDsgaSsrKXsgLy8gbm90ZVxyXG4gICAgICAgICAgICAgICAgbGV0IG5vdGUgPSB0aGlzLm5vdGVzW3NdW2ldO1xyXG4gICAgICAgICAgICAgICAgbGV0IG5vdGVMZW5ndGggPSB0aGlzLmxlbmd0aFBlckJlYXQgLyBub3RlWzBdO1xyXG4gICAgICAgICAgICAgICAgbGV0IHRhaWw6IG51bWJlcltdO1xyXG4gICAgICAgICAgICAgICAgaWYoYWNjdW11bGF0ZWRMZW5ndGggKyBub3RlTGVuZ3RoIC8gdGhpcy5sZW5ndGhQZXJCZWF0ID49IHNlcGVyYXRlckxlbmd0aCl7IC8vIHRoZSBub3RlIGlzIHRoZSBlbmQgb2YgYSBiZWF0IG9yIHRoZSBub3RlJ3MgbGVuZ3RoIGVxdWFscyB0byBhIGJlYXRcclxuICAgICAgICAgICAgICAgICAgICBsZXQgY2RhdGFMTGVuZ3RoID0gMDtcclxuICAgICAgICAgICAgICAgICAgICBpZihjaSA+IDApIGNkYXRhTExlbmd0aCA9IHRoaXMuY2FsRGF0YVtjaSAtIDFdLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgICAgICB0YWlsID0gdGhpcy5jYWxjdWxhdGVUYWlsKGNkYXRhTExlbmd0aCwgbm90ZVswXSwgLTEsIGJlYXRMZW5ndGgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGFjY3VtdWxhdGVkTGVuZ3RoID0gMDtcclxuICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBjZGF0YUxMZW5ndGggPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKGNpID4gMCkgY2RhdGFMTGVuZ3RoID0gdGhpcy5jYWxEYXRhW2NpIC0gMV0ubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgICAgIHRhaWwgPSB0aGlzLmNhbGN1bGF0ZVRhaWwoY2RhdGFMTGVuZ3RoLCBub3RlWzBdLCBhY2N1bXVsYXRlZExlbmd0aCwgYmVhdExlbmd0aCk7XHJcbiAgICAgICAgICAgICAgICAgICAgYWNjdW11bGF0ZWRMZW5ndGggKz0gbm90ZUxlbmd0aCAvIHRoaXMubGVuZ3RoUGVyQmVhdDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGxldCBzdGVwID0gYmVhdExlbmd0aCAqIHRoaXMubGVuZ3RoUGVyQmVhdCAvIG5vdGVbMF07XHJcbiAgICAgICAgICAgICAgICBsZXQgdXBkYXRlTm90ZSA9IHRoaXMudXBkYXRlY2FsRGF0YShjaSwgeCwgeSwgbm90ZVswXSwgbm90ZVsxXSwgdGFpbCwgcywgaSk7XHJcbiAgICAgICAgICAgICAgICBpZih1cGRhdGVOb3RlPj0wKWNoYW5nZVNldC5hZGQodXBkYXRlTm90ZSkuYWRkKHVwZGF0ZU5vdGUgLSAxKTtcclxuICAgICAgICAgICAgICAgIGNpKys7XHJcbiAgICAgICAgICAgICAgICBsZXQgdXNlckRhdGFBcnJheSA9IFtdO1xyXG4gICAgICAgICAgICAgICAgaWYobm90ZVsyXSkgdXNlckRhdGFBcnJheSA9IG5vdGVbMl0uc3BsaXQoXCIgXCIpO1xyXG4gICAgICAgICAgICAgICAgaWYodXNlckRhdGFBcnJheS5pbmNsdWRlcyhcImxpbmtFbmRcIikpIGxpbmtlci5wdXNoKFt4LHldKTtcclxuICAgICAgICAgICAgICAgIGlmKHVzZXJEYXRhQXJyYXkuaW5jbHVkZXMoXCJsaW5rU3RhcnRcIikpIGxpbmtlci5wdXNoKFt4LHldKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZihub3RlWzBdICE9PSBNYXRoLmZsb29yKG5vdGVbMF0pKXtcclxuICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKG5vdGVbMF0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGRvdC5wdXNoKFt4LCB5XSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB4ICs9IHN0ZXA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgeCA9IG54O1xyXG4gICAgICAgIH1cclxuICAgICAgICBjaGFuZ2VTZXQuZGVsZXRlKC0xKTtcclxuICAgICAgICByZXR1cm4gW2NpLCBjaGFuZ2VTZXQsIGxpbmtlciwgc2VjdGlvbkluZGljYXRvciwgZG90XTsvLyBjaSA9IHRvdG9hbCBzZWN0aW9uIG51bWJlciwgY2hhbmdlU2V0ID0gc3RvcmUgaW5kZXggb2YgY2hhbmdlIGRhdGFcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHVwZGF0ZWNhbERhdGEoYXJyeUluZGV4OiBudW1iZXIsIHg6IG51bWJlciwgeTogbnVtYmVyLCBub3RlTGVuZ3RoOiBudW1iZXIsIG5vdGVEYXRhOiBudW1iZXJbXSwgdGFpbDogbnVtYmVyW10sIHNlY3Rpb246IG51bWJlciwgbm90ZTogbnVtYmVyKTogbnVtYmVye1xyXG4gICAgICAgIGlmKGFycnlJbmRleCA+IHRoaXMuY2FsRGF0YS5sZW5ndGgpe1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiYXJyYXkgaW5kZXggZXJybywgc2hvdWxkIG5vdCBiZSBncmVhdGVyIHRoYW4gY2FsRGF0YS5sZW5ndGhcIik7XHJcbiAgICAgICAgICAgIHJldHVybiAtMTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoYXJyeUluZGV4ID09PSB0aGlzLmNhbERhdGEubGVuZ3RoKXtcclxuICAgICAgICAgICAgdGhpcy5jYWxEYXRhLnB1c2goe3g6IHgsIHk6IHksIGxlbmd0aDogbm90ZUxlbmd0aCwgYmxvY2tzOiBub3RlRGF0YS5zbGljZSgwLCA2KSwgdGFpbDogdGFpbC5zbGljZSgwLCB0YWlsLmxlbmd0aCksIHNlY3Rpb246IHNlY3Rpb24sIG5vdGU6IG5vdGUsIGhhc1N2ZzogZmFsc2V9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGFycnlJbmRleDtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IGRhdGEgPSB0aGlzLmNhbERhdGFbYXJyeUluZGV4XTtcclxuICAgICAgICBpZihkYXRhLnggIT0geCB8fCBkYXRhLnkgIT0geSB8fCBkYXRhLmxlbmd0aCAhPSBub3RlTGVuZ3RoIHx8IGRhdGEuc2VjdGlvbiAhPSBzZWN0aW9uIHx8IGRhdGEubm90ZSAhPSBub3RlIHx8ICF0aGlzLmNvbXBhcmVBcnJheShkYXRhLmJsb2Nrcywgbm90ZURhdGEpIHx8ICF0aGlzLmNvbXBhcmVBcnJheShkYXRhLnRhaWwsIHRhaWwpKXsgXHJcbiAgICAgICAgICAgIHRoaXMuY2FsRGF0YVthcnJ5SW5kZXhdLnggPSB4O1xyXG4gICAgICAgICAgICB0aGlzLmNhbERhdGFbYXJyeUluZGV4XS55ID0geTtcclxuICAgICAgICAgICAgdGhpcy5jYWxEYXRhW2FycnlJbmRleF0ubGVuZ3RoID0gbm90ZUxlbmd0aDtcclxuICAgICAgICAgICAgdGhpcy5jYWxEYXRhW2FycnlJbmRleF0uYmxvY2tzID0gbm90ZURhdGEuc2xpY2UoMCwgNik7XHJcbiAgICAgICAgICAgIHRoaXMuY2FsRGF0YVthcnJ5SW5kZXhdLnRhaWwgPSB0YWlsLnNsaWNlKDAsIHRhaWwubGVuZ3RoKTtcclxuICAgICAgICAgICAgdGhpcy5jYWxEYXRhW2FycnlJbmRleF0uc2VjdGlvbiA9IHNlY3Rpb247XHJcbiAgICAgICAgICAgIHRoaXMuY2FsRGF0YVthcnJ5SW5kZXhdLm5vdGUgPSBub3RlO1xyXG4gICAgICAgICAgICByZXR1cm4gYXJyeUluZGV4O1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICByZXR1cm4gLTE7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjb21wYXJlQXJyYXkoYTogbnVtYmVyW10sIGI6IG51bWJlcltdKXtcclxuICAgICAgICBpZihhLmxlbmd0aCAhPSBiLmxlbmd0aCkgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBhLmxlbmd0aDsgaSsrKXtcclxuICAgICAgICAgICAgaWYoYVtpXSAhPSBiW2ldKSByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY2FsY3VsYXRlVGFpbChsYXN0Tm90ZUxlbmd0aDogbnVtYmVyLCBub3RlTGVuZ3RoOiBudW1iZXIsIGFjY3VtdWxhdGVkTGVuZ3RoOiBudW1iZXIsIGJlYXRMZW5ndGg6IG51bWJlcik6IG51bWJlcltde1xyXG4gICAgICAgIGxldCBzdGVwID0gYmVhdExlbmd0aCAqIHRoaXMubGVuZ3RoUGVyQmVhdCAvIGxhc3ROb3RlTGVuZ3RoICogLTE7XHJcbiAgICAgICAgbGV0IGJhc2ljTGVuZ3RoID0gODtcclxuICAgICAgICBpZihhY2N1bXVsYXRlZExlbmd0aCA9PSAtMSliYXNpY0xlbmd0aCA9IC04O1xyXG4gICAgICAgIGlmKGFjY3VtdWxhdGVkTGVuZ3RoID09IDApeyAvLyBzdGFydCBvZiBhIHNlcGVyYXRlIG5vdGVcclxuICAgICAgICAgICAgaWYobm90ZUxlbmd0aCA8PSA0KXtcclxuXHJcbiAgICAgICAgICAgIH1lbHNlIGlmKG5vdGVMZW5ndGggPD0gOCl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gW2Jhc2ljTGVuZ3RoLCAwLCAwXTtcclxuICAgICAgICAgICAgfWVsc2UgaWYobm90ZUxlbmd0aCA8PSAxNil7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gW2Jhc2ljTGVuZ3RoLCBiYXNpY0xlbmd0aCwgMF07XHJcbiAgICAgICAgICAgIH1lbHNlIGlmKG5vdGVMZW5ndGggPD0gMzIpe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFtiYXNpY0xlbmd0aCwgYmFzaWNMZW5ndGgsIGJhc2ljTGVuZ3RoXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICBpZihub3RlTGVuZ3RoIDw9IDQpe1xyXG5cclxuICAgICAgICAgICAgfWVsc2UgaWYobm90ZUxlbmd0aCA8PSA4KXtcclxuICAgICAgICAgICAgICAgIGlmKGxhc3ROb3RlTGVuZ3RoID49IDgpe1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbc3RlcCwgMCwgMF07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1lbHNlIGlmKG5vdGVMZW5ndGggPD0gMTYpe1xyXG4gICAgICAgICAgICAgICAgaWYobGFzdE5vdGVMZW5ndGggPD0gNCl7XHJcblxyXG4gICAgICAgICAgICAgICAgfWVsc2UgaWYobGFzdE5vdGVMZW5ndGggPD0gOCApe1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbc3RlcCwgYmFzaWNMZW5ndGgsIDBdO1xyXG4gICAgICAgICAgICAgICAgfWVsc2UgaWYobGFzdE5vdGVMZW5ndGggPD0gMzIpe1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbc3RlcCwgc3RlcCwgMF07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1lbHNlIGlmKG5vdGVMZW5ndGggPD0gMzIpe1xyXG4gICAgICAgICAgICAgICAgaWYobGFzdE5vdGVMZW5ndGggPD0gNCl7XHJcblxyXG4gICAgICAgICAgICAgICAgfWVsc2UgaWYobGFzdE5vdGVMZW5ndGggPD0gOCl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFtzdGVwLCBiYXNpY0xlbmd0aCwgYmFzaWNMZW5ndGhdO1xyXG4gICAgICAgICAgICAgICAgfWVsc2UgaWYobGFzdE5vdGVMZW5ndGggPD0gMTYpe1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbc3RlcCwgc3RlcCwgYmFzaWNMZW5ndGhdO1xyXG4gICAgICAgICAgICAgICAgfWVsc2UgaWYobGFzdE5vdGVMZW5ndGggPD0gMzIpe1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbc3RlcCwgc3RlcCwgc3RlcF07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIFswLCAwLCAwXTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogcmVjZWl2ZSBkYXRhIGZyb20gY2FsTm90ZURhdGEgYW5kIHNldCBlbGVtZW50c1xyXG4gICAgICogQHBhcmFtIHsgW251bWJlciwgbnVtYmVyLCBudW1iZXIsIG51bWJlcltdXVtdIH0gZGF0YSBcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBzZXRBbGxOb3RlRWxlbWVudERhdGEoZGF0YUxlbmd0aDogbnVtYmVyLCBjaGFuZ2VTZXQ6IFNldDxudW1iZXI+KXtcclxuICAgICAgICBsZXQgZGF0YSA9IHRoaXMuY2FsRGF0YTtcclxuICAgICAgICBsZXQgbm90ZUVsZW1lbnQgPSB0aGlzLnRhYkNhbnZhcy5sYXllcnMubm90ZXMubm90ZUVsZW1lbnRzXHJcbiAgICAgICAgbGV0IG5lID0gZGF0YUxlbmd0aCAtIG5vdGVFbGVtZW50Lmxlbmd0aDtcclxuICAgICAgICBsZXQgbnVsbERhdGE6IGNhY3VsYXRlZE5vdGVEYXRhID0ge3g6IDAsIHk6IDAsIGxlbmd0aDogMCwgYmxvY2tzOiBbLTEsIC0xLCAtMSwgLTEsIC0xLCAtMV0sIHRhaWw6IFswLCAwLCAwXSwgc2VjdGlvbjogMCwgbm90ZTogMCwgaGFzU3ZnOiBudWxsfS8vWzAsIDAsIDAsIFstMSwgLTEsIC0xLCAtMSwgLTEsIC0xXSwgWzAsIDAsIDBdLCAwLCAwXTtcclxuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgdGhpcy5jYWxEYXRhLmxlbmd0aDsgaSsrKXtcclxuICAgICAgICAgICAgaWYoIXRoaXMuY2FsRGF0YVtpXS5oYXNTdmcpe1xyXG4gICAgICAgICAgICAgICAgdGhpcy50YWJDYW52YXMubGF5ZXJzLm5vdGVzLmNyZWF0ZU5vdGUoaSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNhbERhdGFbaV0uaGFzU3ZnID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIG5vdGVFbGVtZW50W2ldLmJsb2NrR3JvdXAuZm9yRWFjaCgod2csIGkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB3Zy5kb21lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLm9uTm90ZUNsaWNrZWQuYmluZCh0aGlzKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgd2cuZG9tZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2VvdmVyXCIsIHRoaXMub25Nb3VzZU92ZXJOb3RlLmJpbmQodGhpcyksIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICB3Zy5kb21lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW91dFwiLCB0aGlzLm9uTW91c2VPdXROb3RlLmJpbmQodGhpcykpO1xyXG4gICAgICAgICAgICAgICAgICAgIHdnLnN0cmluZyA9IGk7XHJcbiAgICAgICAgICAgICAgICAgICAgdXRpbHMuc2V0QXR0cmlidXRlcyh3Zy5kb21lbGVtZW50LCB7XCJkYXRhLXN0cmluZ1wiOiBgJHtpfWB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNoYW5nZVNldC5mb3JFYWNoKChzaSwgaSk9PntcclxuICAgICAgICAgICAgaWYoaSAhPSBkYXRhLmxlbmd0aCAtIDEpe1xyXG4gICAgICAgICAgICAgICAgaWYoZGF0YVtpKzFdLnggPiBkYXRhW2ldLngpe1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0Tm90ZUVsZW1lbnREYXRhKG5vdGVFbGVtZW50W2ldLCBkYXRhW2ldLCBkYXRhW2kgKyAxXSwgKGRhdGFbaSsxXS54IC0gZGF0YVtpXS54KSAqIDAuNyk7XHJcbiAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldE5vdGVFbGVtZW50RGF0YShub3RlRWxlbWVudFtpXSwgZGF0YVtpXSwgZGF0YVtpICsgMV0sIDMwKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldE5vdGVFbGVtZW50RGF0YShub3RlRWxlbWVudFtpXSwgZGF0YVtpXSwgbnVsbERhdGEsIDMwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSBzZXROb3RlRWxlbWVudERhdGEoZWw6IFNWR05vdGUsIGRhdGE6IGNhY3VsYXRlZE5vdGVEYXRhLCBuZXhEYXRhOmNhY3VsYXRlZE5vdGVEYXRhICx4bGVuZ3RoOiBudW1iZXIpe1xyXG4gICAgICAgIHRoaXMuc2V0RWxlbWVudFBvc2l0aW9uKGVsLCBkYXRhLngsIGRhdGEueSwgZGF0YS50YWlsLCBkYXRhLnNlY3Rpb24sIGRhdGEubm90ZSwgeGxlbmd0aCk7XHJcbiAgICAgICAgdGhpcy5zZXRDaG9yZFZpc2lhYmxlKGVsLCBkYXRhLngsIGRhdGEueSwgZGF0YS5sZW5ndGgsIGRhdGEuYmxvY2tzLCBkYXRhLnRhaWwsIG5leERhdGEudGFpbCk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHByaXZhdGUgc2V0RWxlbWVudFBvc2l0aW9uKGU6IFNWR05vdGUsIHg6bnVtYmVyLCB5Om51bWJlciwgdGFpbDogbnVtYmVyW10sIHNlY3Rpb25JbmRleDogbnVtYmVyLCBub3RlSW5kZXg6IG51bWJlciwgeGxlbmd0aDogbnVtYmVyKXtcclxuICAgICAgICBsZXQgbG4gPSBNYXRoLmZsb29yKHNlY3Rpb25JbmRleCAvIHRoaXMuc2VjdGlvblBlckxpbmUpO1xyXG4gICAgICAgIC8vIHNldCBub3RlIGJhcidzIHBvc2l0aW9uIGFuZCBiYXIgdGFpbCdzIGxlbmd0aFxyXG4gICAgICAgIGUubGluZUdyb3VwWzBdLngxID0geDsgZS5saW5lR3JvdXBbMF0ueTEgPSAyNiArIHkgKyB0aGlzLnN0cmluZ1BhZGRpbmcgKiA1OyBlLmxpbmVHcm91cFswXS54MiA9IHg7IGUubGluZUdyb3VwWzBdLnkyID0geTtcclxuICAgICAgICBlLmxpbmVHcm91cFsxXS54MSA9IHg7IGUubGluZUdyb3VwWzFdLnkxID0gMjUgKyB5ICsgdGhpcy5zdHJpbmdQYWRkaW5nICogNTsgZS5saW5lR3JvdXBbMV0ueDIgPSB4ICsgdGFpbFswXTsgZS5saW5lR3JvdXBbMV0ueTIgPSAyNSArIHkgKyB0aGlzLnN0cmluZ1BhZGRpbmcgKiA1O1xyXG4gICAgICAgIGUubGluZUdyb3VwWzJdLngxID0geDsgZS5saW5lR3JvdXBbMl0ueTEgPSAyMSArIHkgKyB0aGlzLnN0cmluZ1BhZGRpbmcgKiA1OyBlLmxpbmVHcm91cFsyXS54MiA9IHggKyB0YWlsWzFdOyBlLmxpbmVHcm91cFsyXS55MiA9IDIxICsgeSArIHRoaXMuc3RyaW5nUGFkZGluZyAqIDU7XHJcbiAgICAgICAgZS5saW5lR3JvdXBbM10ueDEgPSB4OyBlLmxpbmVHcm91cFszXS55MSA9IDE3ICsgeSArIHRoaXMuc3RyaW5nUGFkZGluZyAqIDU7IGUubGluZUdyb3VwWzNdLngyID0geCArIHRhaWxbMl07IGUubGluZUdyb3VwWzNdLnkyID0gMTcgKyB5ICsgdGhpcy5zdHJpbmdQYWRkaW5nICogNTtcclxuICAgICAgICAvLyBzZXQgbm90ZSB3b3JkIHBvc2l0aW9uXHJcbiAgICAgICAgZm9yKGxldCBpID0gMCA7IGkgPCA2OyBpKyspe1xyXG4gICAgICAgICAgICBlLmJsb2NrR3JvdXBbaV0ueCA9IHg7XHJcbiAgICAgICAgICAgIGUuYmxvY2tHcm91cFtpXS55ID0geSArIHRoaXMuc3RyaW5nUGFkZGluZyAqIGk7XHJcbiAgICAgICAgICAgIGUuYmxvY2tHcm91cFtpXS5leHRlbmRSZWN0LnkgPSAgeSArIHRoaXMuc3RyaW5nUGFkZGluZyAqIChpIC0gMC41KTtcclxuICAgICAgICAgICAgZS5ibG9ja0dyb3VwW2ldLmV4dGVuZFJlY3QuaGVpZ2h0ID0gdGhpcy5zdHJpbmdQYWRkaW5nO1xyXG4gICAgICAgICAgICBlLmJsb2NrR3JvdXBbaV0uZXh0ZW5kUmVjdC53aWR0aCA9IHhsZW5ndGg7XHJcbiAgICAgICAgICAgIHV0aWxzLnNldEF0dHJpYnV0ZXMoZS5ibG9ja0dyb3VwW2ldLmRvbWVsZW1lbnQse1wiZGF0YS14XCI6IGAke3h9YCwgXCJkYXRhLXlcIjogYCR7eSArIHRoaXMuc3RyaW5nUGFkZGluZyAqIGl9YCwgXCJkYXRhLWxpbmVcIjogYCR7bG59YH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlLnRhaWw4LnNldFBvc2l0aW9uKHggKyAwLjQseSArIHRoaXMuc3RyaW5nUGFkZGluZyAqIDUgKyAxNCk7XHJcbiAgICAgICAgZS50YWlsMTYuc2V0UG9zaXRpb24oeCArIDAuNCx5ICsgdGhpcy5zdHJpbmdQYWRkaW5nICogNSArIDEwKTtcclxuICAgICAgICBlLnRhaWwzMi5zZXRQb3NpdGlvbih4ICsgMC40LHkgKyB0aGlzLnN0cmluZ1BhZGRpbmcgKiA1ICsgNik7XHJcbiAgICAgICAgZS5zZWN0aW9uID0gc2VjdGlvbkluZGV4O1xyXG4gICAgICAgIGUubm90ZSA9IG5vdGVJbmRleDtcclxuICAgICAgICBlLmxpbmUgPSBsbjtcclxuICAgICAgICB1dGlscy5zZXRBdHRyaWJ1dGVzKGUuZG9tZWxlbWVudCwge1wiZGF0YS1zZWN0aW9uXCI6IGAke3NlY3Rpb25JbmRleH1gLCBcImRhdGEtbm90ZVwiOiBgJHtub3RlSW5kZXh9YH0pO1xyXG4gICAgICAgIGUuYmxvY2tHcm91cC5mb3JFYWNoKCh3ZywgaSkgPT4ge1xyXG4gICAgICAgICAgICB3Zy5zZWN0aW9uID0gc2VjdGlvbkluZGV4O1xyXG4gICAgICAgICAgICB3Zy5ub3RlID0gbm90ZUluZGV4O1xyXG4gICAgICAgICAgICB3Zy5saW5lID0gbG47XHJcbiAgICAgICAgICAgIHV0aWxzLnNldEF0dHJpYnV0ZXMod2cuZG9tZWxlbWVudCwge1wiZGF0YS1zZWN0aW9uXCI6IGAke3NlY3Rpb25JbmRleH1gLCBcImRhdGEtbm90ZVwiOiBgJHtub3RlSW5kZXh9YCwgXCJkYXRhLWxpbmVcIjogYCR7bG59YH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSBzZXRDaG9yZFZpc2lhYmxlKGU6U1ZHTm90ZSwgeDogbnVtYmVyLCB5OiBudW1iZXIsIG5vdGVMZW5ndGg6IG51bWJlciwgZGF0YTogbnVtYmVyW10sIHRhaWw6IG51bWJlcltdLCBuZXh0VGFpbDogbnVtYmVyW10pe1xyXG4gICAgICAgIGxldCBhcCA9IHRydWU7XHJcbiAgICAgICAgbGV0IGhjOiBudW1iZXIgPSAtMTsgLy8gdG9wIGNob3JkIHdoaWNoIGRhdGEgaXMgbm90IC0xXHJcbiAgICAgICAgZm9yKGxldCBpID0gMCA7IGkgPCA2OyBpKyspe1xyXG4gICAgICAgICAgICBpZihkYXRhW2ldICE9IC0xKXtcclxuICAgICAgICAgICAgICAgIGhjID0gaTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9ICAgIFxyXG4gICAgICAgIH1cclxuICAgICAgICBlLnRhaWw4LmhpZGUoKTtcclxuICAgICAgICBlLnRhaWwxNi5oaWRlKCk7XHJcbiAgICAgICAgZS50YWlsMzIuaGlkZSgpO1xyXG4gICAgICAgIGZvcihsZXQgaSA9IDAgOyBpIDwgMzsgaSsrKXtcclxuICAgICAgICAgICAgaWYodGFpbFtpXSA8IDAgfHwgbmV4dFRhaWxbaV0gPCAwKXtcclxuICAgICAgICAgICAgICAgIGFwID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZihhcCl7XHJcbiAgICAgICAgICAgIGlmKGhjICE9IC0xKXtcclxuICAgICAgICAgICAgICAgIGlmKG5vdGVMZW5ndGggPD00KXtcclxuXHJcbiAgICAgICAgICAgICAgICB9ZWxzZSBpZihub3RlTGVuZ3RoIDw9IDgpe1xyXG4gICAgICAgICAgICAgICAgICAgIGUudGFpbDguc2hvdygpO1xyXG4gICAgICAgICAgICAgICAgfWVsc2UgaWYobm90ZUxlbmd0aCA8PSAxNil7XHJcbiAgICAgICAgICAgICAgICAgICAgZS50YWlsMTYuc2hvdygpO1xyXG4gICAgICAgICAgICAgICAgfWVsc2UgaWYobm90ZUxlbmd0aCA8PSAzMil7XHJcbiAgICAgICAgICAgICAgICAgICAgZS50YWlsMzIuc2hvdygpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGUubGluZUdyb3VwWzFdLngyID0geDtcclxuICAgICAgICAgICAgZS5saW5lR3JvdXBbMl0ueDIgPSB4O1xyXG4gICAgICAgICAgICBlLmxpbmVHcm91cFszXS54MiA9IHg7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvcihsZXQgaSA9IDAgOyBpIDwgNjsgaSsrKXtcclxuICAgICAgICAgICAgaWYoZGF0YVtpXSA9PSAtMSl7XHJcbiAgICAgICAgICAgICAgICBlLmJsb2NrR3JvdXBbaV0ud29yZC50ZXh0ID0gYGA7XHJcbiAgICAgICAgICAgICAgICBlLmJsb2NrR3JvdXBbaV0ud29yZEJhY2sudGV4dCA9IGBgO1xyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIGUuYmxvY2tHcm91cFtpXS53b3JkLnRleHQgPSBgJHtkYXRhW2ldfWA7XHJcbiAgICAgICAgICAgICAgICBlLmJsb2NrR3JvdXBbaV0ud29yZEJhY2sudGV4dCA9IGAke2RhdGFbaV19YDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZihub3RlTGVuZ3RoID09IDIpe1xyXG4gICAgICAgICAgICBlLmxpbmVHcm91cFswXS55MiA9IDEwICsgeSArIHRoaXMuc3RyaW5nUGFkZGluZyAqIDU7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9ZWxzZSBpZihub3RlTGVuZ3RoID09IDEpe1xyXG4gICAgICAgICAgICBlLmxpbmVHcm91cFswXS55MiA9IDI2ICsgeSArIHRoaXMuc3RyaW5nUGFkZGluZyAqIDU7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gbm90ZSBiYXIgc2hvdWxkIHJlYWNoIHRoZSB0b3Agd29yZFxyXG4gICAgICAgIGlmKGhjID09PSAtMSl7XHJcbiAgICAgICAgICAgIGUubGluZUdyb3VwWzBdLnkyID0geSArIHRoaXMuc3RyaW5nUGFkZGluZyAqIDUgKyAyNiA7XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIGUubGluZUdyb3VwWzBdLnkyID0geSArIHRoaXMuc3RyaW5nUGFkZGluZyAqIGhjO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNldExpbmtlcihsaW5rZXJEYXRhOiBudW1iZXJbXVtdKXtcclxuICAgICAgICBsZXQgbGVudW1iZXIgPSBNYXRoLmZsb29yKGxpbmtlckRhdGEubGVuZ3RoIC8gMik7XHJcbiAgICAgICAgbGV0IGV4aXN0TnVtYmVyID0gdGhpcy50YWJDYW52YXMubGF5ZXJzLmJhY2tncm91bmQubGlua2VyLmxlbmd0aDtcclxuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgbGVudW1iZXIgLSBleGlzdE51bWJlcjsgaSsrKXtcclxuICAgICAgICAgICAgdGhpcy50YWJDYW52YXMubGF5ZXJzLmJhY2tncm91bmQuY3JlYXRlTGlua2VyKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBsZW51bWJlcjsgaSsrKXtcclxuICAgICAgICAgICAgdXRpbHMuc2V0U3R5bGUoPEhUTUxFbGVtZW50Pjx1bmtub3duPnRoaXMudGFiQ2FudmFzLmxheWVycy5iYWNrZ3JvdW5kLmxpbmtlcltpXSwge2Rpc3BsYXk6IFwidW5zZXRcIn0pO1xyXG4gICAgICAgICAgICB0aGlzLnNldExpbmtlckRhdGEodGhpcy50YWJDYW52YXMubGF5ZXJzLmJhY2tncm91bmQubGlua2VyW2ldLCBsaW5rZXJEYXRhW2kqMl0sIGxpbmtlckRhdGFbaSoyKzFdKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yKGxldCBpID0gbGVudW1iZXI7IGkgPCB0aGlzLnRhYkNhbnZhcy5sYXllcnMuYmFja2dyb3VuZC5saW5rZXIubGVuZ3RoOyBpKyspe1xyXG4gICAgICAgICAgICB1dGlscy5zZXRTdHlsZSg8SFRNTEVsZW1lbnQ+PHVua25vd24+dGhpcy50YWJDYW52YXMubGF5ZXJzLmJhY2tncm91bmQubGlua2VyW2ldLCB7ZGlzcGxheTogXCJub25lXCJ9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIHNldExpbmtlckRhdGEobGlua0VsZW1lbnQ6U1ZHRWxlbWVudCwgc3RhcnQ6IG51bWJlcltdLCBlbmQ6IG51bWJlcltdKXtcclxuICAgICAgICBsZXQgbHkgPSBzdGFydFsxXSArIDMxICsgdGhpcy5zdHJpbmdQYWRkaW5nICogNTtcclxuICAgICAgICBpZihzdGFydFsxXSAhPT0gZW5kWzFdKXtcclxuICAgICAgICAgICAgbGV0IGV4ID0gc3RhcnRbMF0gKyAzMDtcclxuICAgICAgICAgICAgbGV0IHN4ID0gc3RhcnRbMF07XHJcbiAgICAgICAgICAgIGxldCBwYXRoID0gYE0gJHtzeH0gJHtseX0gQyAke3N4KzR9ICR7bHkrMTV9LCAke2V4LTR9ICR7bHkrMTV9LCAke2V4fSAke2x5fSBDICR7ZXgtNH0gJHtseSsxMn0sICR7c3grNH0gJHtseSsxMn0sICR7c3h9ICR7bHl9IGA7XHJcbiAgICAgICAgICAgIGx5ID0gZW5kWzFdICsgMzEgKyB0aGlzLnN0cmluZ1BhZGRpbmcgKiA1O1xyXG4gICAgICAgICAgICBzeCA9IGVuZFswXSAtIDMwO1xyXG4gICAgICAgICAgICBleCA9IGVuZFswXTtcclxuICAgICAgICAgICAgcGF0aCArPSBgTSAke3N4fSAke2x5fSBDICR7c3grNH0gJHtseSsxNX0sICR7ZXgtNH0gJHtseSsxNX0sICR7ZXh9ICR7bHl9IEMgJHtleC00fSAke2x5KzEyfSwgJHtzeCs0fSAke2x5KzEyfSwgJHtzeH0gJHtseX1gO1xyXG4gICAgICAgICAgICB1dGlscy5zZXRBdHRyaWJ1dGVzKGxpbmtFbGVtZW50LCB7ZDogcGF0aH0pO1xyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICB1dGlscy5zZXRBdHRyaWJ1dGVzKGxpbmtFbGVtZW50LCB7ZDogYE0gJHtzdGFydFswXX0gJHtseX0gQyAke3N0YXJ0WzBdKzR9ICR7bHkrMTV9LCAke2VuZFswXS00fSAke2x5KzE1fSwgJHtlbmRbMF19ICR7bHl9IEMgJHtlbmRbMF0tNH0gJHtseSsxMn0sICR7c3RhcnRbMF0rNH0gJHtseSsxMn0sICR7c3RhcnRbMF19ICR7bHl9YH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHByaXZhdGUgc2V0RG90KGRvdERhdGE6IG51bWJlcltdW10pe1xyXG4gICAgICAgIGxldCBsZW51bWJlciA9IGRvdERhdGEubGVuZ3RoO1xyXG4gICAgICAgIGxldCBleGlzdE51bWJlciA9IHRoaXMudGFiQ2FudmFzLmxheWVycy5ub3Rlcy5kb3QubGVuZ3RoO1xyXG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBsZW51bWJlciAtIGV4aXN0TnVtYmVyOyBpKyspe1xyXG4gICAgICAgICAgICBsZXQgbmR0ID0gdGhpcy50YWJDYW52YXMubGF5ZXJzLm5vdGVzLmNyZWF0ZUVsbGlwc2UoMCwgMCwgMi41LCAyLjUpO1xyXG4gICAgICAgICAgICBuZHQuZmlsbCA9IFwid2hpdGVcIjtcclxuICAgICAgICAgICAgdGhpcy50YWJDYW52YXMubGF5ZXJzLm5vdGVzLmRvdC5wdXNoKG5kdCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBsZW51bWJlcjsgaSsrKXtcclxuICAgICAgICAgICAgdXRpbHMuc2V0U3R5bGUoPEhUTUxFbGVtZW50Pjx1bmtub3duPnRoaXMudGFiQ2FudmFzLmxheWVycy5ub3Rlcy5kb3RbaV0uZG9tRWxlbWVudCwge2Rpc3BsYXk6IFwidW5zZXRcIn0pO1xyXG4gICAgICAgICAgICB0aGlzLnRhYkNhbnZhcy5sYXllcnMubm90ZXMuZG90W2ldLmN4ID0gZG90RGF0YVtpXVswXSArIDEyO1xyXG4gICAgICAgICAgICB0aGlzLnRhYkNhbnZhcy5sYXllcnMubm90ZXMuZG90W2ldLmN5ID0gZG90RGF0YVtpXVsxXSArIDEyICsgdGhpcy5zdHJpbmdQYWRkaW5nICogNTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yKGxldCBpID0gbGVudW1iZXI7IGkgPCB0aGlzLnRhYkNhbnZhcy5sYXllcnMubm90ZXMuZG90Lmxlbmd0aDsgaSsrKXtcclxuICAgICAgICAgICAgdXRpbHMuc2V0U3R5bGUoPEhUTUxFbGVtZW50Pjx1bmtub3duPnRoaXMudGFiQ2FudmFzLmxheWVycy5ub3Rlcy5kb3RbaV0uZG9tRWxlbWVudCwge2Rpc3BsYXk6IFwibm9uZVwifSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSBvbk5vdGVDbGlja2VkKGV2OiBNb3VzZUV2ZW50KSB7XHJcbiAgICAgICAgbGV0IHNlY3Rpb24gPSBOdW1iZXIoKGV2LmN1cnJlbnRUYXJnZXQgYXMgU1ZHR0VsZW1lbnQpLmRhdGFzZXQuc2VjdGlvbik7XHJcbiAgICAgICAgbGV0IG5vdGUgPSBOdW1iZXIoKGV2LmN1cnJlbnRUYXJnZXQgYXMgU1ZHR0VsZW1lbnQpLmRhdGFzZXQubm90ZSk7XHJcbiAgICAgICAgbGV0IHN0cmluZyA9IE51bWJlcigoZXYuY3VycmVudFRhcmdldCBhcyBTVkdFbGVtZW50KS5kYXRhc2V0LnN0cmluZyk7XHJcbiAgICAgICAgbGV0IHBvc2l0aW9uID0gW051bWJlcigoZXYuY3VycmVudFRhcmdldCBhcyBTVkdFbGVtZW50KS5kYXRhc2V0LngpLCBOdW1iZXIoKGV2LmN1cnJlbnRUYXJnZXQgYXMgU1ZHRWxlbWVudCkuZGF0YXNldC55KV1cclxuICAgICAgICBpZihldi5zaGlmdEtleSl7XHJcbiAgICAgICAgICAgIHRoaXMuY2FsbGJhY2tzW1wibm90ZXNoaWZ0Y2xpY2tcIl0uY2FsbEFsbChzZWN0aW9uLCBub3RlLCBzdHJpbmcsIHBvc2l0aW9uLCBldi5jdXJyZW50VGFyZ2V0KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZihldi5hbHRLZXkpe1xyXG4gICAgICAgICAgICB0aGlzLmNhbGxiYWNrc1tcIm5vdGVhbHRjbGlja1wiXS5jYWxsQWxsKHNlY3Rpb24sIG5vdGUsIHN0cmluZywgcG9zaXRpb24sIGV2LmN1cnJlbnRUYXJnZXQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmKGV2LmN0cmxLZXkpe1xyXG4gICAgICAgICAgICB0aGlzLmNhbGxiYWNrc1tcIm5vdGVjdHJsY2xpY2tcIl0uY2FsbEFsbChzZWN0aW9uLCBub3RlLCBzdHJpbmcsIHBvc2l0aW9uLCBldi5jdXJyZW50VGFyZ2V0KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZXtcclxuICAgICAgICAgICAgdGhpcy5jYWxsYmFja3NbXCJub3RlY2xpY2tcIl0uY2FsbEFsbChzZWN0aW9uLCBub3RlLCBzdHJpbmcsIHBvc2l0aW9uLCBldi5jdXJyZW50VGFyZ2V0KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIG9uS2V5ZG93bihldjogS2V5Ym9hcmRFdmVudCl7XHJcbiAgICAgICAgdGhpcy5jYWxsYmFja3NbXCJrZXlkb3duXCJdLmNhbGxBbGwoZXYua2V5LCBldi5rZXlDb2RlKTtcclxuICAgIH1cclxuICAgIHByaXZhdGUgb25Nb3VzZU92ZXJOb3RlKGV2OiBNb3VzZUV2ZW50KXtcclxuICAgICAgICBsZXQgc2VjdGlvbiA9IE51bWJlcigoZXYuY3VycmVudFRhcmdldCBhcyBTVkdHRWxlbWVudCkuZGF0YXNldC5zZWN0aW9uKTtcclxuICAgICAgICBsZXQgbm90ZSA9IE51bWJlcigoZXYuY3VycmVudFRhcmdldCBhcyBTVkdHRWxlbWVudCkuZGF0YXNldC5ub3RlKTtcclxuICAgICAgICBsZXQgc3RyaW5nID0gTnVtYmVyKChldi5jdXJyZW50VGFyZ2V0IGFzIFNWR0VsZW1lbnQpLmRhdGFzZXQuc3RyaW5nKTtcclxuICAgICAgICBsZXQgcG9zaXRpb24gPSBbTnVtYmVyKChldi5jdXJyZW50VGFyZ2V0IGFzIFNWR0VsZW1lbnQpLmRhdGFzZXQueCksIE51bWJlcigoZXYuY3VycmVudFRhcmdldCBhcyBTVkdFbGVtZW50KS5kYXRhc2V0LnkpXVxyXG4gICAgICAgIHRoaXMuY2FsbGJhY2tzW1wibW91c2VvdmVybm90ZVwiXS5jYWxsQWxsKHNlY3Rpb24sIG5vdGUsIHN0cmluZywgcG9zaXRpb24sIGV2LmN1cnJlbnRUYXJnZXQpO1xyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSBvbk1vdXNlT3V0Tm90ZShldjogTW91c2VFdmVudCl7XHJcbiAgICAgICAgbGV0IHNlY3Rpb24gPSBOdW1iZXIoKGV2LmN1cnJlbnRUYXJnZXQgYXMgU1ZHR0VsZW1lbnQpLmRhdGFzZXQuc2VjdGlvbik7XHJcbiAgICAgICAgbGV0IG5vdGUgPSBOdW1iZXIoKGV2LmN1cnJlbnRUYXJnZXQgYXMgU1ZHR0VsZW1lbnQpLmRhdGFzZXQubm90ZSk7XHJcbiAgICAgICAgbGV0IHN0cmluZyA9IE51bWJlcigoZXYuY3VycmVudFRhcmdldCBhcyBTVkdFbGVtZW50KS5kYXRhc2V0LnN0cmluZyk7XHJcbiAgICAgICAgbGV0IHBvc2l0aW9uID0gW051bWJlcigoZXYuY3VycmVudFRhcmdldCBhcyBTVkdFbGVtZW50KS5kYXRhc2V0LngpLCBOdW1iZXIoKGV2LmN1cnJlbnRUYXJnZXQgYXMgU1ZHRWxlbWVudCkuZGF0YXNldC55KV1cclxuICAgICAgICB0aGlzLmNhbGxiYWNrc1tcIm1vdXNlb3V0bm90ZVwiXS5jYWxsQWxsKHNlY3Rpb24sIG5vdGUsIHN0cmluZywgcG9zaXRpb24sIGV2LmN1cnJlbnRUYXJnZXQpO1xyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSBvbk1vdXNlRG93bihldjogTW91c2VFdmVudCl7XHJcbiAgICAgICAgdGhpcy5jYWxsYmFja3NbXCJtb3VzZWRvd25cIl0uY2FsbEFsbChOdW1iZXIoZXYueCksIE51bWJlcihldi55KSk7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIG9uTW91c2VNb3ZlKGV2OiBNb3VzZUV2ZW50KXtcclxuICAgICAgICB0aGlzLmNhbGxiYWNrc1tcIm1vdXNlbW92ZVwiXS5jYWxsQWxsKE51bWJlcihldi54KSwgTnVtYmVyKGV2LnkpKTtcclxuICAgIH1cclxuICAgIHByaXZhdGUgb25Nb3VzZVVwKGV2OiBNb3VzZUV2ZW50KXtcclxuICAgICAgICB0aGlzLmNhbGxiYWNrc1tcIm1vdXNldXBcIl0uY2FsbEFsbChOdW1iZXIoZXYueCksIE51bWJlcihldi55KSk7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIG9uTW91c2VSaWdodENsaWNrKGV2OiBNb3VzZUV2ZW50KXtcclxuICAgICAgICB0aGlzLmNhbGxiYWNrc1tcInJpZ2h0Y2xpY2tcIl0uY2FsbEFsbChOdW1iZXIoZXYueCksIE51bWJlcihldi55KSk7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIG9uU2VjdGlvbkhvdmVyKGV2OiBNb3VzZUV2ZW50KXtcclxuICAgICAgICB0aGlzLmNhbGxiYWNrc1tcInNlY3Rpb25ob3ZlclwiXS5jYWxsQWxsKE51bWJlcigoZXYuY3VycmVudFRhcmdldCBhcyBTVkdFbGVtZW50KS5kYXRhc2V0LnNlY3Rpb24pKTtcclxuICAgIH1cclxuICAgIHByaXZhdGUgb25TZWN0aW9uSG91dChldjogTW91c2VFdmVudCl7XHJcbiAgICAgICAgdGhpcy5jYWxsYmFja3NbXCJzZWN0aW9uaG91dFwiXS5jYWxsQWxsKE51bWJlcigoZXYuY3VycmVudFRhcmdldCBhcyBTVkdFbGVtZW50KS5kYXRhc2V0LnNlY3Rpb24pKTtcclxuICAgIH1cclxuICAgIHByaXZhdGUgb25TZWN0aW9uQ2xpY2soZXY6IE1vdXNlRXZlbnQpe1xyXG4gICAgICAgIGxldCBvZmZzZXRZID0gZXYuY2xpZW50WSAtIHRoaXMuZG9tRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3AgKyB0aGlzLmRvbUVsZW1lbnQuc2Nyb2xsVG9wO1xyXG4gICAgICAgIGxldCB5ID0gTnVtYmVyKCg8U1ZHRWxlbWVudD5ldi5jdXJyZW50VGFyZ2V0KS5nZXRBdHRyaWJ1dGUoXCJ5XCIpKTtcclxuICAgICAgICBsZXQgc3RyaW5nID0gTWF0aC5mbG9vcigob2Zmc2V0WSAtIHkpL3RoaXMuc3RyaW5nUGFkZGluZyk7XHJcbiAgICAgICAgdGhpcy5jYWxsYmFja3NbXCJzZWN0aW9uY2xpY2tcIl0uY2FsbEFsbChOdW1iZXIoKGV2LmN1cnJlbnRUYXJnZXQgYXMgU1ZHRWxlbWVudCkuZGF0YXNldC5zZWN0aW9uKSwgc3RyaW5nKTtcclxuICAgIH1cclxufSJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFFQTtBQTJCQTtBQThCQTtBQTFCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQVVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBS0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFFQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBRUE7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFFQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/SlimTabV2.ts\n");

/***/ }),

/***/ "./src/SlimTabV2Canvas.ts":
/*!********************************!*\
  !*** ./src/SlimTabV2Canvas.ts ***!
  \********************************/
/*! exports provided: NoteBlock, SVGNote, Layer, SVGShape, Rect, Ellipse, Line, Text, Layers, SLLayer, SLCanvas */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"NoteBlock\", function() { return NoteBlock; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"SVGNote\", function() { return SVGNote; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Layer\", function() { return Layer; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"SVGShape\", function() { return SVGShape; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Rect\", function() { return Rect; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Ellipse\", function() { return Ellipse; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Line\", function() { return Line; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Text\", function() { return Text; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Layers\", function() { return Layers; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"SLLayer\", function() { return SLLayer; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"SLCanvas\", function() { return SLCanvas; });\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./utils */ \"./src/utils.ts\");\n\r\nclass NoteBlock {\r\n    constructor(domelement, word, wordBack, extendRect) {\r\n        this.domelement = domelement;\r\n        this.word = word;\r\n        this.wordBack = wordBack;\r\n        this.extendRect = extendRect;\r\n    }\r\n    set x(val) {\r\n        if (this._x !== val) {\r\n            this._x = val;\r\n            this.word.x = val;\r\n            this.wordBack.x = val;\r\n            this.extendRect.x = val;\r\n        }\r\n    }\r\n    get x() {\r\n        return this._x;\r\n    }\r\n    set y(val) {\r\n        if (this._y !== val) {\r\n            this._y = val;\r\n            this.word.y = val + 4;\r\n            this.wordBack.y = val + 4;\r\n        }\r\n    }\r\n    get y() {\r\n        return this._y;\r\n    }\r\n    set section(val) {\r\n        this._section = val;\r\n    }\r\n    get section() {\r\n        return this._section;\r\n    }\r\n    set note(val) {\r\n        this._note = val;\r\n    }\r\n    get note() {\r\n        return this._note;\r\n    }\r\n    set string(val) {\r\n        this._string = val;\r\n    }\r\n    get string() {\r\n        return this._string;\r\n    }\r\n    set line(val) {\r\n        this._line = val;\r\n    }\r\n    get line() {\r\n        return this._line;\r\n    }\r\n}\r\nclass SVGNote {\r\n    constructor(domelement, blockGroup, lineGroup) {\r\n        this.blockGroup = [];\r\n        this.lineGroup = [];\r\n        this.domelement = domelement;\r\n        this.blockGroup = blockGroup;\r\n        this.lineGroup = lineGroup;\r\n        this.tail8 = new Base8Tail();\r\n        this.tail16 = new Base16Tail();\r\n        this.tail32 = new Base32Tail();\r\n        this.domelement.append(this.tail32.domElement, this.tail16.domElement, this.tail8.domElement);\r\n    }\r\n    set section(val) {\r\n        this._section = val;\r\n    }\r\n    get section() {\r\n        return this._section;\r\n    }\r\n    set note(val) {\r\n        this._note = val;\r\n    }\r\n    get note() {\r\n        return this._note;\r\n    }\r\n    set line(val) {\r\n        this._line = val;\r\n    }\r\n    get line() {\r\n        return this._line;\r\n    }\r\n}\r\nclass Tail {\r\n    constructor() {\r\n        this._isShow = true;\r\n        this.domElement = document.createElementNS('http://www.w3.org/2000/svg', \"g\");\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, { style: \"fill: white;\" });\r\n        //this.hide();\r\n    }\r\n    setPosition(x, y) {\r\n        if (this._x !== x || this._y !== y) {\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setStyle(this.domElement, { \"transform\": `scale(0.08) translate(${x / 0.08}px,${y / 0.08}px)` });\r\n            this._x = x;\r\n            this._y = y;\r\n        }\r\n    }\r\n    show() {\r\n        if (!this._isShow) {\r\n            this._isShow = true;\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setStyle(this.domElement, { display: \"unset\" });\r\n        }\r\n    }\r\n    hide() {\r\n        if (this._isShow) {\r\n            this._isShow = false;\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setStyle(this.domElement, { display: \"none\" });\r\n        }\r\n    }\r\n}\r\nclass Base8Tail extends Tail {\r\n    constructor() {\r\n        super();\r\n        this.domElement.innerHTML = `<use xlink:href=\"#stail8\"></use>`;\r\n    }\r\n}\r\nclass Base16Tail extends Tail {\r\n    constructor() {\r\n        super();\r\n        this.domElement.innerHTML = `<use xlink:href=\"#stail16\"></use>`;\r\n    }\r\n}\r\nclass Base32Tail extends Tail {\r\n    constructor() {\r\n        super();\r\n        this.domElement.innerHTML = `<use xlink:href=\"#stail32\"></use>`;\r\n    }\r\n}\r\nclass Layer {\r\n    constructor() {\r\n        this.linker = [];\r\n        this.domElement = document.createElementNS('http://www.w3.org/2000/svg', \"g\");\r\n    }\r\n    clear() {\r\n        this.domElement.innerHTML = \"\";\r\n    }\r\n    createRect(x, y, width, height, strokeWidth, fill, target) {\r\n        const inst = document.createElementNS('http://www.w3.org/2000/svg', \"rect\");\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(inst, {\r\n            x: `${x}`, y: `${y}`,\r\n            width: `${width}`, height: `${height}`,\r\n            \"stroke-width\": `${strokeWidth}`,\r\n            fill: fill,\r\n        });\r\n        if (!target)\r\n            this.domElement.appendChild(inst);\r\n        else\r\n            target.appendChild(inst);\r\n        return new Rect(inst);\r\n    }\r\n    createEllipse(cx, cy, rx, ry, target) {\r\n        const inst = document.createElementNS('http://www.w3.org/2000/svg', \"ellipse\");\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(inst, {\r\n            cx: `${cx}`, cy: `${cy}`,\r\n            rx: `${rx}`, ry: `${ry}`\r\n        });\r\n        if (!target)\r\n            this.domElement.appendChild(inst);\r\n        else\r\n            target.appendChild(inst);\r\n        return new Ellipse(inst);\r\n    }\r\n    createText(x, y, str, anchor, target) {\r\n        const inst = document.createElementNS('http://www.w3.org/2000/svg', \"text\");\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(inst, {\r\n            x: `${x}`, y: `${y}`,\r\n            'text-anchor': `${anchor}`\r\n        });\r\n        inst.innerHTML = `${str}`;\r\n        if (!target)\r\n            this.domElement.appendChild(inst);\r\n        else\r\n            target.appendChild(inst);\r\n        return new Text(inst);\r\n    }\r\n    createLine(x1, y1, x2, y2, width, color, target) {\r\n        const inst = document.createElementNS('http://www.w3.org/2000/svg', \"line\");\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(inst, {\r\n            x1: `${x1}`, y1: `${y1}`,\r\n            x2: `${x2}`, y2: `${y2}`,\r\n            stroke: `${color}`,\r\n            \"stroke-width\": `${width}`\r\n        });\r\n        if (!target)\r\n            this.domElement.appendChild(inst);\r\n        else\r\n            target.appendChild(inst);\r\n        return new Line(inst);\r\n    }\r\n    ;\r\n    createLinker(target) {\r\n        let linker = document.createElementNS('http://www.w3.org/2000/svg', \"path\");\r\n        if (!target)\r\n            this.domElement.appendChild(linker);\r\n        else\r\n            target.appendChild(linker);\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(linker, { fill: `white` });\r\n        this.linker.push(linker);\r\n        return linker;\r\n    }\r\n}\r\nclass SVGShape {\r\n    constructor(domElement) {\r\n        this._domElement = domElement;\r\n    }\r\n    remove() {\r\n        this._domElement.remove();\r\n    }\r\n    get domElement() {\r\n        return this._domElement;\r\n    }\r\n    set style(val) {\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setStyle(this.domElement, val);\r\n    }\r\n}\r\n;\r\nclass Rect extends SVGShape {\r\n    constructor(domElement) {\r\n        super(domElement);\r\n    }\r\n    setPos(x, y) {\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n            \"x\": `${x}`, \"y\": `${y}`\r\n        });\r\n    }\r\n    setShape(width, height) {\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n            \"width\": `${width}`, \"height\": `${height}`\r\n        });\r\n    }\r\n    set x(val) {\r\n        if (this._x !== val) {\r\n            this._x = val;\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n                x: `${val}`\r\n            });\r\n        }\r\n    }\r\n    get x() {\r\n        return this._x;\r\n    }\r\n    set y(val) {\r\n        if (this._y !== val) {\r\n            this._y = val;\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n                y: `${val}`\r\n            });\r\n        }\r\n    }\r\n    get y() {\r\n        return this._y;\r\n    }\r\n    set width(val) {\r\n        if (this._width !== val) {\r\n            this._width = val;\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n                width: `${val}`\r\n            });\r\n        }\r\n    }\r\n    get width() {\r\n        return this._width;\r\n    }\r\n    set height(val) {\r\n        if (this._height !== val) {\r\n            this._height = val;\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n                height: `${val}`\r\n            });\r\n        }\r\n    }\r\n    get height() {\r\n        return this._height;\r\n    }\r\n    set strokeWidth(val) {\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n            \"stroke-width\": `${val}`\r\n        });\r\n    }\r\n    get strokeWidth() {\r\n        return Number(this.domElement.getAttribute(\"stroke-width\"));\r\n    }\r\n    set fill(val) {\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n            fill: `${val}`\r\n        });\r\n    }\r\n    get fill() {\r\n        return this.domElement.getAttribute(\"fill\");\r\n    }\r\n}\r\nclass Ellipse extends SVGShape {\r\n    constructor(domElement) {\r\n        super(domElement);\r\n    }\r\n    setPos(cx, cy) {\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n            \"cx\": `${cx}`, \"cy\": `${cy}`\r\n        });\r\n    }\r\n    setShape(cx, cy, rx, ry) {\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n            \"rx\": `${rx}`, \"ry\": `${ry}`\r\n        });\r\n    }\r\n    set cx(val) {\r\n        if (this._cx != val) {\r\n            this._cx = val;\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n                \"cx\": `${val}`\r\n            });\r\n        }\r\n    }\r\n    get cx() {\r\n        return this._cx;\r\n    }\r\n    set cy(val) {\r\n        if (this._cy != val) {\r\n            this._cy = val;\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n                \"cy\": `${val}`\r\n            });\r\n        }\r\n    }\r\n    get cy() {\r\n        return this._cy;\r\n    }\r\n    set rx(val) {\r\n        if (this._rx != val) {\r\n            this._rx = val;\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n                rx: `${val}`\r\n            });\r\n        }\r\n    }\r\n    get rx() {\r\n        return this._rx;\r\n    }\r\n    set ry(val) {\r\n        if (this._ry != val) {\r\n            this._ry = val;\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n                ry: `${val}`\r\n            });\r\n        }\r\n    }\r\n    get ry() {\r\n        return this._ry;\r\n    }\r\n    set fill(val) {\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n            fill: `${val}`\r\n        });\r\n    }\r\n    get fill() {\r\n        return this.domElement.getAttribute(\"fill\");\r\n    }\r\n}\r\nclass Line extends SVGShape {\r\n    constructor(domElement) {\r\n        super(domElement);\r\n    }\r\n    setEndPoints(x1, y1, x2, y2) {\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n            \"x1\": `${x1}`, \"y1\": `${y1}`,\r\n            \"x2\": `${x2}`, \"y2\": `${y2}`\r\n        });\r\n    }\r\n    set x1(val) {\r\n        if (this._x1 != val) {\r\n            this._x1 = val;\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n                x1: `${val}`\r\n            });\r\n        }\r\n    }\r\n    get x1() {\r\n        return Number(this.domElement.getAttribute(\"x1\"));\r\n    }\r\n    set y1(val) {\r\n        if (this._y1 != val) {\r\n            this._y1 = val;\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n                y1: `${val}`\r\n            });\r\n        }\r\n    }\r\n    get y1() {\r\n        return Number(this.domElement.getAttribute(\"y1\"));\r\n    }\r\n    set x2(val) {\r\n        if (this._x2 != val) {\r\n            this._x2 = val;\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n                x2: `${val}`\r\n            });\r\n        }\r\n    }\r\n    get x2() {\r\n        return Number(this.domElement.getAttribute(\"x2\"));\r\n    }\r\n    set y2(val) {\r\n        if (this._y2 != val) {\r\n            this._y2 = val;\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n                y2: `${val}`\r\n            });\r\n        }\r\n    }\r\n    get y2() {\r\n        return Number(this.domElement.getAttribute(\"y2\"));\r\n    }\r\n    set stroke(val) {\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n            stroke: `${val}`\r\n        });\r\n    }\r\n    get stroke() {\r\n        return this.domElement.getAttribute(\"stroke\");\r\n    }\r\n    set strokeWidth(val) {\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n            \"stroke-width\": `${val}`\r\n        });\r\n    }\r\n    get strokeWidth() {\r\n        return Number(this.domElement.getAttribute(\"stroke-width\"));\r\n    }\r\n}\r\nclass Text extends SVGShape {\r\n    constructor(domElement) {\r\n        super(domElement);\r\n    }\r\n    setPos(x, y) {\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n            \"x\": `${x}`, \"y\": `${y}`,\r\n        });\r\n    }\r\n    set x(val) {\r\n        if (this._x != val) {\r\n            this._x = val;\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n                x: `${val}`\r\n            });\r\n        }\r\n    }\r\n    get x() {\r\n        return Number(this.domElement.getAttribute(\"x\"));\r\n    }\r\n    set y(val) {\r\n        if (this._y != val) {\r\n            this._y = val;\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n                y: `${val}`\r\n            });\r\n        }\r\n    }\r\n    get y() {\r\n        return Number(this.domElement.getAttribute(\"y\"));\r\n    }\r\n    set anchor(val) {\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n            \"text-anchor\": `${val}`\r\n        });\r\n    }\r\n    get anchor() {\r\n        return this.domElement.getAttribute(\"text-anchor\");\r\n    }\r\n    set text(val) {\r\n        if (this.domElement.innerHTML !== val) {\r\n            this.domElement.innerHTML = `${val}`;\r\n        }\r\n    }\r\n    get text() {\r\n        return this.domElement.innerHTML;\r\n    }\r\n    set strokeWidth(val) {\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n            \"stroke-width\": `${val}`\r\n        });\r\n    }\r\n    get strokeWidth() {\r\n        return Number(this.domElement.getAttribute(\"stroke-width\"));\r\n    }\r\n    set fill(val) {\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n            fill: `${val}`\r\n        });\r\n    }\r\n}\r\nclass NoteLayer extends Layer {\r\n    constructor() {\r\n        super();\r\n        this.noteElements = [];\r\n        this.dot = [];\r\n        this.domElement.innerHTML = `\r\n        <defs>\r\n            <path id=\"SVGTAIL8_1\" d=\"M-4.728,151.313l10.303,2.061l39.153-33.854c0,0,20.543-24.318,23.338-67.708L70.34,0H43.846L22.061,78.012\r\n                l-33.854,20.901L-4.728,151.313z\"/>\r\n        \t<clipPath id=\"SVGTAIL8_2\">\r\n                <use xlink:href=\"#SVGTAIL8_1\"  style=\"overflow:visible;\"/>\r\n            </clipPath>\r\n\r\n            <path id=\"stail16\"d=\"M67.37,59.776c2.698-19.84-2.806-39.01-7.124-58.173C60.138,1.127,59.523,0.765,58.825,0c0,3.411-0.317,6.266,0.054,9.029\r\n            c1.69,12.576,0.707,25.062-2.478,37.175c-5.494,20.897-15.163,39.32-35.394,49.69c-6.397,3.279-13.599,4.99-20.612,7.443\r\n            l-0.168,42.842c0.429-1.459,1.031-2.899,1.881-4.318c5.712-9.535,13.379-17.275,23.422-21.731\r\n            c11.728-5.203,21.372-12.634,29.432-22.407c0.486-0.59,1.154-1.029,2.017-1.782c-6.693,34.412-26.894,55.961-56.794,60.555\r\n            L0,203.874c1.634-4.092,2.518-8.621,4.922-12.148c5.906-8.664,14.092-14.797,23.71-19.308c16.597-7.786,30.016-19.532,35.085-37.498\r\n            c3.198-11.333,4.22-23.682,3.872-35.506C67.2,86.185,65.551,73.148,67.37,59.776z\"/>\r\n        \r\n            <path id=\"stail8\" style=\"clip-path:url(#SVGTAIL8_2);\" d=\"M67.352,64.184c2.698-19.84-2.806-39.01-7.124-58.173\r\n            c-0.107-0.476-0.722-0.837-1.42-1.603c0,3.411-0.317,6.266,0.054,9.029c1.69,12.576,0.707,25.062-2.478,37.175\r\n            c-5.494,20.897-15.163,39.32-35.394,49.69c-6.397,3.279-13.599,4.99-20.612,7.443l-0.168,42.842\r\n            c0.429-1.459,1.031-2.899,1.881-4.318c5.712-9.535,13.379-17.275,23.422-21.731c11.728-5.203,21.372-12.634,29.432-22.407\r\n            c0.486-0.59,1.154-1.029,2.017-1.782c-6.693,34.412-26.894,55.961-56.794,60.555l-0.186,47.379\r\n            c1.634-4.092,2.518-8.621,4.922-12.148c5.906-8.664,14.092-14.797,23.71-19.308c16.597-7.786,30.016-19.532,35.085-37.498\r\n            c3.198-11.333,4.22-23.682,3.872-35.506C67.182,90.594,65.534,77.557,67.352,64.184z\"/>\r\n\r\n            <path id=\"SVGID_1_\" d=\"M-4.17,255.543l10.303,2.061l39.153-33.854c0,0,20.543-24.318,23.338-67.708l2.274-51.812H44.404\r\n                l-21.784,78.012l-33.854,20.901L-4.17,255.543z\"/>\r\n            <clipPath id=\"SVGID_2_\">\r\n                <use xlink:href=\"#SVGID_1_\"  style=\"overflow:visible;\"/>\r\n            </clipPath>\r\n            <g id=\"stail32\">\r\n            <path d=\"M67.183,59.776c2.698-19.84-2.806-39.01-7.124-58.173C59.952,1.127,59.337,0.765,58.639,0c0,3.411-0.317,6.266,0.054,9.029\r\n\t\tc1.69,12.576,0.707,25.062-2.478,37.175c-5.494,20.897-15.163,39.32-35.394,49.69c-6.397,3.279-13.599,4.99-20.612,7.443\r\n\t\tl-0.168,42.842c0.429-1.459,1.031-2.899,1.881-4.318c5.712-9.535,13.379-17.275,23.422-21.731\r\n\t\tc11.728-5.203,21.372-12.634,29.432-22.407c0.486-0.59,1.154-1.029,2.017-1.782C50.101,130.352,29.9,151.901,0,156.495\r\n\t\tl-0.186,47.379c1.634-4.092,2.518-8.621,4.922-12.148c5.906-8.664,14.092-14.797,23.71-19.308\r\n\t\tc16.597-7.786,30.016-19.532,35.085-37.498c3.198-11.333,4.22-23.682,3.872-35.506C67.013,86.185,65.365,73.148,67.183,59.776z\"/>\r\n            <path style=\"clip-path:url(#SVGID_2_);\" d=\"M67.91,168.414c2.698-19.84-2.806-39.01-7.124-58.173\r\n\t\t\tc-0.107-0.476-0.722-0.837-1.42-1.603c0,3.411-0.317,6.266,0.054,9.029c1.69,12.576,0.707,25.062-2.478,37.175\r\n\t\t\tc-5.494,20.897-15.163,39.32-35.394,49.69c-6.397,3.279-13.599,4.99-20.612,7.443l-0.168,42.842\r\n\t\t\tc0.429-1.459,1.031-2.899,1.881-4.318c5.712-9.535,13.379-17.275,23.422-21.731c11.728-5.203,21.372-12.634,29.432-22.407\r\n\t\t\tc0.486-0.59,1.154-1.029,2.017-1.782c-6.693,34.412-26.894,55.96-56.794,60.555L0.54,312.512\r\n\t\t\tc1.634-4.092,2.518-8.621,4.922-12.148c5.906-8.664,14.092-14.797,23.71-19.308c16.597-7.786,30.016-19.532,35.085-37.498\r\n            c3.198-11.333,4.22-23.682,3.872-35.506C67.74,194.823,66.092,181.786,67.91,168.414z\"/>\r\n            </g>\r\n        </defs>\r\n        `;\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, { \"data-layer\": \"NoteLayer\" });\r\n    }\r\n    createNote(insertIndex = -1) {\r\n        const note = document.createElementNS('http://www.w3.org/2000/svg', \"g\");\r\n        const blockGroup = document.createElementNS('http://www.w3.org/2000/svg', \"g\");\r\n        const blockArray = [];\r\n        const lineGroup = document.createElementNS('http://www.w3.org/2000/svg', \"g\");\r\n        const lg = [];\r\n        lg.push(this.createLine(0, 0, 0, 0, 1, \"white\", lineGroup));\r\n        for (let i = 0; i < 3; i++) {\r\n            lg.push(this.createLine(0, 0, 0, 0, 2, \"white\", lineGroup));\r\n        }\r\n        note.append(lineGroup);\r\n        for (let i = 0; i < 6; i++) {\r\n            const wordGroup = document.createElementNS('http://www.w3.org/2000/svg', \"g\");\r\n            const extendRect = this.createRect(0, 0, 0, 0, 0, \"rgba(0, 0, 0, 0)\", wordGroup);\r\n            const wordBack = this.createText(0, 0, \"\", \"middle\", wordGroup);\r\n            const word = this.createText(0, 0, \"\", \"middle\", wordGroup);\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(wordGroup, { \"stroke-width\": '0', \"stroke\": \"black\", style: \"cursor:pointer;\" });\r\n            wordBack.strokeWidth = 3;\r\n            wordBack.style = { font: \"12px Sans-serf\" };\r\n            word.style = { \"font\": \"12px Sans-serif\", \"fill\": \"#fff\" };\r\n            blockGroup.append(wordGroup);\r\n            blockArray.push(new NoteBlock(wordGroup, word, wordBack, extendRect));\r\n        }\r\n        note.append(blockGroup);\r\n        if (insertIndex === -1)\r\n            insertIndex = this.noteElements.length;\r\n        this.noteElements.splice(insertIndex, 0, new SVGNote(note, blockArray, lg));\r\n        //this.noteElements.push(new SVGNote(<HTMLElement><unknown>note, blockArray, lg));\r\n        this.domElement.append(note);\r\n        return note;\r\n    }\r\n    removeNote(noteIndex, num = 1) {\r\n        for (let i = 0; i < num; i++) {\r\n            if (this.noteElements[noteIndex + i])\r\n                this.domElement.removeChild(this.noteElements[noteIndex + i].domelement);\r\n        }\r\n        this.noteElements.splice(noteIndex, num);\r\n    }\r\n}\r\nclass SheetLayer extends Layer {\r\n    constructor() {\r\n        super();\r\n        this.row = [];\r\n        this.bar = [];\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, { \"data-layer\": \"SheetLayer\" });\r\n    }\r\n    createRow(x, y, lineWidth, linePadding, stringPadding, sectionPerLine) {\r\n        let ng = document.createElementNS('http://www.w3.org/2000/svg', \"g\");\r\n        let lineBack = document.createElementNS('http://www.w3.org/2000/svg', \"rect\");\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(lineBack, { x: `${x}`, y: `${y}`, style: \"fill: rgba(255, 255, 255, 0.09)\", width: `${linePadding[0] * 2 + lineWidth}`, height: `${linePadding[1] * 2 + stringPadding * 5}` });\r\n        ng.appendChild(lineBack);\r\n        x += linePadding[0];\r\n        y += linePadding[1];\r\n        for (let i = 0; i < 6; i++) {\r\n            let l = lineWidth;\r\n            this.createLine(x, y + i * stringPadding, x + l, y + i * stringPadding, 2, \"rgba(255, 255, 255, 0.24)\", ng);\r\n        }\r\n        this.drawRowTitle(x - 30, y, ng);\r\n        this.createLine(x, y, x, y + stringPadding * 5, 2, \"rgba(255, 255, 255, 0.24)\", ng);\r\n        for (let i = 0; i < sectionPerLine; i++) {\r\n            let nb = this.createLine(0, y, 0, y + stringPadding * 5, 2, \"rgba(255, 255, 255, 0.24)\", this.domElement);\r\n            this.bar.push(nb);\r\n        }\r\n        this.domElement.append(ng);\r\n        this.row.push(ng);\r\n        return ng;\r\n    }\r\n    drawRowTitle(x, y, target) {\r\n        let title = document.createElementNS('http://www.w3.org/2000/svg', \"g\");\r\n        title.innerHTML = `\r\n        <text style=\"fill:#959595;font:17px arial;\">\r\n            <tspan x='${x + 10}' y='${y + 26}'>T</tspan>\r\n            <tspan x='${x + 10}' y='${y + 22 + 26}'>A</tspan>\r\n            <tspan x='${x + 10}' y='${y + 44 + 26}'>B</tspan>\r\n        </text>\r\n        `;\r\n        if (target)\r\n            target.append(title);\r\n        return title;\r\n    }\r\n}\r\nclass UILayer extends Layer {\r\n    constructor() {\r\n        super();\r\n        this.sectionIndicator = [];\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, { \"data-layer\": \"UILayer\" });\r\n    }\r\n    createSectionIndicator() {\r\n        let newSquare = this.createRect(0, 0, 0, 0, 0, \"rgba(0, 255, 255, 0)\");\r\n        //utils.setAttributes(newSquare, {style: \"display: none\"});\r\n        this.sectionIndicator.push(newSquare);\r\n        return newSquare;\r\n    }\r\n    hightLightSection(section) {\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.sectionIndicator[section].domElement, { fill: \"rgba(0, 255, 255, 0.13)\" });\r\n    }\r\n    hideSectionIndicator(section) {\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.sectionIndicator[section].domElement, { fill: \"rgba(0, 255, 255, 0)\" });\r\n    }\r\n}\r\nclass Layers {\r\n    constructor() {\r\n        this.background = new Layer();\r\n        this.sheet = new SheetLayer();\r\n        this.notes = new NoteLayer();\r\n        this.foreground = new Layer();\r\n    }\r\n    get flattened() {\r\n        return [this.background, this.sheet, this.notes, this.foreground];\r\n    }\r\n}\r\nclass SLLayer extends Layers {\r\n    constructor() {\r\n        super();\r\n        this.ui = new UILayer();\r\n    }\r\n    get flattened() {\r\n        return [this.background, this.sheet, this.ui, this.notes, this.foreground];\r\n    }\r\n}\r\nclass SLCanvas {\r\n    constructor(layerType) {\r\n        this.layerType = layerType;\r\n        this.layers = new layerType();\r\n        this.domElement = document.createElementNS('http://www.w3.org/2000/svg', \"svg\");\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setStyle(this.domElement, { \"user-select\": \"none\", \"outline\": \"none\" });\r\n        this.layers.flattened.forEach(layer => this.domElement.appendChild(layer.domElement));\r\n    }\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvU2xpbVRhYlYyQ2FudmFzLnRzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vc3JjL1NsaW1UYWJWMkNhbnZhcy50cz8zYWM5Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7dXRpbHN9IGZyb20gJy4vdXRpbHMnO1xyXG5cclxuaW50ZXJmYWNlIFNWR1ByaW1pdGl2ZVJlbmRlcmVyIHtcclxuICAgIGNsZWFyKCk6IHZvaWQ7XHJcbiAgICBjcmVhdGVSZWN0KHg6IG51bWJlciwgeTogbnVtYmVyLCB3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlciwgc3Ryb2tlV2lkdGg6IG51bWJlciwgY29sb3I6IHN0cmluZyk6IFJlY3Q7XHJcbiAgICBjcmVhdGVFbGxpcHNlKGN4OiBudW1iZXIsIGN5OiBudW1iZXIsIHJ4OiBudW1iZXIsIHJ5OiBudW1iZXIpOiBFbGxpcHNlO1xyXG4gICAgY3JlYXRlVGV4dCh4OiBudW1iZXIsIHk6IG51bWJlciwgc3RyOiBzdHJpbmcsIGFuY2hvcjogc3RyaW5nKTogVGV4dDtcclxuICAgIGNyZWF0ZUxpbmUoeDE6IG51bWJlciwgeTE6IG51bWJlciwgeDI6IG51bWJlciwgeTI6IG51bWJlciwgd2lkdGg6IG51bWJlciwgY29sb3I/OiBzdHJpbmcpOiBMaW5lO1xyXG59XHJcbmV4cG9ydCBjbGFzcyBOb3RlQmxvY2t7XHJcbiAgICByZWFkb25seSBkb21lbGVtZW50OiBIVE1MRWxlbWVudDtcclxuICAgIHJlYWRvbmx5IHdvcmQ6IFRleHQ7XHJcbiAgICByZWFkb25seSB3b3JkQmFjazogVGV4dDtcclxuICAgIHJlYWRvbmx5IGV4dGVuZFJlY3Q6IFJlY3Q7XHJcbiAgICBwcml2YXRlIF94OiBudW1iZXI7XHJcbiAgICBwcml2YXRlIF95OiBudW1iZXI7XHJcbiAgICBwcml2YXRlIF9zZWN0aW9uOiBudW1iZXI7XHJcbiAgICBwcml2YXRlIF9ub3RlOiBudW1iZXI7XHJcbiAgICBwcml2YXRlIF9zdHJpbmc6IG51bWJlcjtcclxuICAgIHByaXZhdGUgX2xpbmU6IG51bWJlcjtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihkb21lbGVtZW50OiBIVE1MRWxlbWVudCwgd29yZDogVGV4dCwgd29yZEJhY2s6IFRleHQsIGV4dGVuZFJlY3Q6IFJlY3Qpe1xyXG4gICAgICAgIHRoaXMuZG9tZWxlbWVudCA9IGRvbWVsZW1lbnQ7XHJcbiAgICAgICAgdGhpcy53b3JkID0gd29yZDtcclxuICAgICAgICB0aGlzLndvcmRCYWNrID0gd29yZEJhY2s7XHJcbiAgICAgICAgdGhpcy5leHRlbmRSZWN0ID0gZXh0ZW5kUmVjdDtcclxuICAgIH1cclxuICAgIHNldCB4KHZhbDogbnVtYmVyKXtcclxuICAgICAgICBpZih0aGlzLl94ICE9PSB2YWwpe1xyXG4gICAgICAgICAgICB0aGlzLl94ID0gdmFsO1xyXG4gICAgICAgICAgICB0aGlzLndvcmQueCA9IHZhbDtcclxuICAgICAgICAgICAgdGhpcy53b3JkQmFjay54ID0gdmFsO1xyXG4gICAgICAgICAgICB0aGlzLmV4dGVuZFJlY3QueCA9IHZhbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBnZXQgeCgpe1xyXG4gICAgICAgIHJldHVybiB0aGlzLl94O1xyXG4gICAgfVxyXG4gICAgc2V0IHkodmFsOiBudW1iZXIpe1xyXG4gICAgICAgIGlmKHRoaXMuX3kgIT09IHZhbCl7XHJcbiAgICAgICAgICAgIHRoaXMuX3kgPSB2YWw7XHJcbiAgICAgICAgICAgIHRoaXMud29yZC55ID0gdmFsICsgNDtcclxuICAgICAgICAgICAgdGhpcy53b3JkQmFjay55ID0gdmFsICsgNDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBnZXQgeSgpe1xyXG4gICAgICAgIHJldHVybiB0aGlzLl95O1xyXG4gICAgfVxyXG4gICAgc2V0IHNlY3Rpb24odmFsOiBudW1iZXIpe1xyXG4gICAgICAgIHRoaXMuX3NlY3Rpb24gPSB2YWw7XHJcbiAgICB9XHJcbiAgICBnZXQgc2VjdGlvbigpOiBudW1iZXJ7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NlY3Rpb247XHJcbiAgICB9XHJcbiAgICBzZXQgbm90ZSh2YWw6IG51bWJlcil7XHJcbiAgICAgICAgdGhpcy5fbm90ZSA9IHZhbDtcclxuICAgIH1cclxuICAgIGdldCBub3RlKCk6IG51bWJlcntcclxuICAgICAgICByZXR1cm4gdGhpcy5fbm90ZTtcclxuICAgIH1cclxuICAgIHNldCBzdHJpbmcodmFsOiBudW1iZXIpe1xyXG4gICAgICAgIHRoaXMuX3N0cmluZyA9IHZhbDtcclxuICAgIH1cclxuICAgIGdldCBzdHJpbmcoKTogbnVtYmVye1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9zdHJpbmc7XHJcbiAgICB9XHJcbiAgICBzZXQgbGluZSh2YWw6IG51bWJlcil7XHJcbiAgICAgICAgdGhpcy5fbGluZSA9IHZhbDtcclxuICAgIH1cclxuICAgIGdldCBsaW5lKCk6IG51bWJlcntcclxuICAgICAgICByZXR1cm4gdGhpcy5fbGluZTtcclxuICAgIH1cclxufVxyXG5leHBvcnQgY2xhc3MgU1ZHTm90ZXtcclxuICAgIHJlYWRvbmx5IGRvbWVsZW1lbnQ6IEhUTUxFbGVtZW50O1xyXG4gICAgcmVhZG9ubHkgYmxvY2tHcm91cDogTm90ZUJsb2NrW10gPSBbXTtcclxuICAgIHJlYWRvbmx5IGxpbmVHcm91cDogTGluZVtdID0gW107XHJcbiAgICByZWFkb25seSB0YWlsODogQmFzZThUYWlsO1xyXG4gICAgcmVhZG9ubHkgdGFpbDE2OiBCYXNlMTZUYWlsO1xyXG4gICAgcmVhZG9ubHkgdGFpbDMyOiBCYXNlMzJUYWlsO1xyXG4gICAgcHJpdmF0ZSBfc2VjdGlvbjogbnVtYmVyO1xyXG4gICAgcHJpdmF0ZSBfbm90ZTogbnVtYmVyO1xyXG4gICAgcHJpdmF0ZSBfbGluZTogbnVtYmVyO1xyXG4gICAgY29uc3RydWN0b3IoZG9tZWxlbWVudDogSFRNTEVsZW1lbnQsIGJsb2NrR3JvdXA6IE5vdGVCbG9ja1tdLCBsaW5lR3JvdXA6IExpbmVbXSl7XHJcbiAgICAgICAgdGhpcy5kb21lbGVtZW50ID0gZG9tZWxlbWVudDtcclxuICAgICAgICB0aGlzLmJsb2NrR3JvdXAgPSBibG9ja0dyb3VwO1xyXG4gICAgICAgIHRoaXMubGluZUdyb3VwID0gbGluZUdyb3VwO1xyXG4gICAgICAgIHRoaXMudGFpbDggPSBuZXcgQmFzZThUYWlsKCk7XHJcbiAgICAgICAgdGhpcy50YWlsMTYgPSBuZXcgQmFzZTE2VGFpbCgpO1xyXG4gICAgICAgIHRoaXMudGFpbDMyID0gbmV3IEJhc2UzMlRhaWwoKTtcclxuICAgICAgICB0aGlzLmRvbWVsZW1lbnQuYXBwZW5kKHRoaXMudGFpbDMyLmRvbUVsZW1lbnQsIHRoaXMudGFpbDE2LmRvbUVsZW1lbnQsIHRoaXMudGFpbDguZG9tRWxlbWVudCk7XHJcbiAgICB9XHJcbiAgICBzZXQgc2VjdGlvbih2YWw6IG51bWJlcil7XHJcbiAgICAgICAgdGhpcy5fc2VjdGlvbiA9IHZhbDtcclxuICAgIH1cclxuICAgIGdldCBzZWN0aW9uKCk6IG51bWJlcntcclxuICAgICAgICByZXR1cm4gdGhpcy5fc2VjdGlvbjtcclxuICAgIH1cclxuICAgIHNldCBub3RlKHZhbDogbnVtYmVyKXtcclxuICAgICAgICB0aGlzLl9ub3RlID0gdmFsO1xyXG4gICAgfVxyXG4gICAgZ2V0IG5vdGUoKTogbnVtYmVye1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9ub3RlO1xyXG4gICAgfVxyXG4gICAgc2V0IGxpbmUodmFsOiBudW1iZXIpe1xyXG4gICAgICAgIHRoaXMuX2xpbmUgPSB2YWw7XHJcbiAgICB9XHJcbiAgICBnZXQgbGluZSgpOiBudW1iZXJ7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2xpbmU7XHJcbiAgICB9XHJcbn1cclxuY2xhc3MgVGFpbHtcclxuICAgIHJlYWRvbmx5IGRvbUVsZW1lbnQ6IFNWR0VsZW1lbnQ7XHJcbiAgICBwcml2YXRlIF94OiBudW1iZXI7XHJcbiAgICBwcml2YXRlIF95OiBudW1iZXI7XHJcbiAgICBwcml2YXRlIF9pc1Nob3c6IGJvb2xlYW4gPSB0cnVlO1xyXG4gICAgY29uc3RydWN0b3IoKXtcclxuICAgICAgICB0aGlzLmRvbUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyxcImdcIik7XHJcbiAgICAgICAgdXRpbHMuc2V0QXR0cmlidXRlcyh0aGlzLmRvbUVsZW1lbnQsIHtzdHlsZTogXCJmaWxsOiB3aGl0ZTtcIn0pO1xyXG4gICAgICAgIC8vdGhpcy5oaWRlKCk7XHJcbiAgICB9XHJcbiAgICBzZXRQb3NpdGlvbih4OiBudW1iZXIsIHk6IG51bWJlcil7XHJcbiAgICAgICAgaWYodGhpcy5feCAhPT0geCB8fCB0aGlzLl95ICE9PSB5KXtcclxuICAgICAgICAgICAgdXRpbHMuc2V0U3R5bGUoPEhUTUxFbGVtZW50Pjx1bmtub3duPnRoaXMuZG9tRWxlbWVudCx7XCJ0cmFuc2Zvcm1cIjogYHNjYWxlKDAuMDgpIHRyYW5zbGF0ZSgke3ggLyAwLjA4fXB4LCR7eSAvIDAuMDh9cHgpYH0pO1xyXG4gICAgICAgICAgICB0aGlzLl94ID0geDtcclxuICAgICAgICAgICAgdGhpcy5feSA9IHk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgc2hvdygpe1xyXG4gICAgICAgIGlmKCF0aGlzLl9pc1Nob3cpe1xyXG4gICAgICAgICAgICB0aGlzLl9pc1Nob3cgPSB0cnVlO1xyXG4gICAgICAgICAgICB1dGlscy5zZXRTdHlsZSg8SFRNTEVsZW1lbnQ+PHVua25vd24+dGhpcy5kb21FbGVtZW50LHtkaXNwbGF5OiBcInVuc2V0XCJ9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBoaWRlKCl7XHJcbiAgICAgICAgaWYodGhpcy5faXNTaG93KXtcclxuICAgICAgICAgICAgdGhpcy5faXNTaG93ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHV0aWxzLnNldFN0eWxlKDxIVE1MRWxlbWVudD48dW5rbm93bj50aGlzLmRvbUVsZW1lbnQse2Rpc3BsYXk6IFwibm9uZVwifSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbmNsYXNzIEJhc2U4VGFpbCBleHRlbmRzIFRhaWx7XHJcbiAgICBjb25zdHJ1Y3Rvcigpe1xyXG4gICAgICAgIHN1cGVyKCk7XHJcbiAgICAgICAgdGhpcy5kb21FbGVtZW50LmlubmVySFRNTCA9IGA8dXNlIHhsaW5rOmhyZWY9XCIjc3RhaWw4XCI+PC91c2U+YDtcclxuICAgIH1cclxufVxyXG5cclxuY2xhc3MgQmFzZTE2VGFpbCBleHRlbmRzIFRhaWx7XHJcbiAgICBjb25zdHJ1Y3Rvcigpe1xyXG4gICAgICAgIHN1cGVyKCk7XHJcbiAgICAgICAgdGhpcy5kb21FbGVtZW50LmlubmVySFRNTCA9IGA8dXNlIHhsaW5rOmhyZWY9XCIjc3RhaWwxNlwiPjwvdXNlPmBcclxuICAgIH1cclxufVxyXG5cclxuY2xhc3MgQmFzZTMyVGFpbCBleHRlbmRzIFRhaWx7XHJcbiAgICBjb25zdHJ1Y3Rvcigpe1xyXG4gICAgICAgIHN1cGVyKCk7XHJcbiAgICAgICAgdGhpcy5kb21FbGVtZW50LmlubmVySFRNTCA9IGA8dXNlIHhsaW5rOmhyZWY9XCIjc3RhaWwzMlwiPjwvdXNlPmA7XHJcbiAgICB9XHJcbn1cclxuZXhwb3J0IGNsYXNzIExheWVyIGltcGxlbWVudHMgU1ZHUHJpbWl0aXZlUmVuZGVyZXIge1xyXG4gICAgcmVhZG9ubHkgZG9tRWxlbWVudDogU1ZHRWxlbWVudDtcclxuICAgIHJlYWRvbmx5IGxpbmtlcjogU1ZHRWxlbWVudFtdID0gW107XHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICB0aGlzLmRvbUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyxcImdcIik7XHJcbiAgICB9XHJcblxyXG4gICAgY2xlYXIoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5kb21FbGVtZW50LmlubmVySFRNTCA9IFwiXCI7XHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlUmVjdCh4OiBudW1iZXIsIHk6IG51bWJlciwgd2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIsIHN0cm9rZVdpZHRoOiBudW1iZXIsIGZpbGw6IHN0cmluZywgdGFyZ2V0PzogU1ZHRWxlbWVudCk6IFJlY3Qge1xyXG4gICAgICAgIGNvbnN0IGluc3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyxcInJlY3RcIik7XHJcbiAgICAgICAgdXRpbHMuc2V0QXR0cmlidXRlcyhpbnN0LCB7XHJcbiAgICAgICAgICAgIHg6IGAke3h9YCwgeTpgJHt5fWAsXHJcbiAgICAgICAgICAgIHdpZHRoOmAke3dpZHRofWAsIGhlaWdodDogYCR7aGVpZ2h0fWAsXHJcbiAgICAgICAgICAgIFwic3Ryb2tlLXdpZHRoXCI6IGAke3N0cm9rZVdpZHRofWAsXHJcbiAgICAgICAgICAgIGZpbGw6IGZpbGwsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgaWYoIXRhcmdldClcclxuICAgICAgICAgICAgdGhpcy5kb21FbGVtZW50LmFwcGVuZENoaWxkKGluc3QpO1xyXG4gICAgICAgIGVsc2VcclxuICAgICAgICAgICAgdGFyZ2V0LmFwcGVuZENoaWxkKGluc3QpO1xyXG4gICAgICAgIHJldHVybiBuZXcgUmVjdChpbnN0KTtcclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGVFbGxpcHNlKGN4OiBudW1iZXIsIGN5OiBudW1iZXIsIHJ4OiBudW1iZXIsIHJ5OiBudW1iZXIsIHRhcmdldD86IFNWR0VsZW1lbnQpOiBFbGxpcHNlIHtcclxuICAgICAgICBjb25zdCBpbnN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsXCJlbGxpcHNlXCIpO1xyXG4gICAgICAgIHV0aWxzLnNldEF0dHJpYnV0ZXMoaW5zdCwge1xyXG4gICAgICAgICAgICBjeDogYCR7Y3h9YCwgY3k6IGAke2N5fWAsXHJcbiAgICAgICAgICAgIHJ4OiBgJHtyeH1gLCByeTogYCR7cnl9YFxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpZighdGFyZ2V0KVxyXG4gICAgICAgICAgICB0aGlzLmRvbUVsZW1lbnQuYXBwZW5kQ2hpbGQoaW5zdCk7XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB0YXJnZXQuYXBwZW5kQ2hpbGQoaW5zdCk7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBFbGxpcHNlKGluc3QpO1xyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZVRleHQoeDogbnVtYmVyLCB5OiBudW1iZXIsIHN0cjogc3RyaW5nLCBhbmNob3I6IHN0cmluZywgdGFyZ2V0PzogU1ZHRWxlbWVudCk6IFRleHQge1xyXG4gICAgICAgIGNvbnN0IGluc3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyxcInRleHRcIik7XHJcbiAgICAgICAgdXRpbHMuc2V0QXR0cmlidXRlcyhpbnN0LCB7XHJcbiAgICAgICAgICAgIHg6IGAke3h9YCwgeTogYCR7eX1gLFxyXG4gICAgICAgICAgICAndGV4dC1hbmNob3InOiBgJHthbmNob3J9YFxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGluc3QuaW5uZXJIVE1MID0gYCR7c3RyfWA7XHJcblxyXG4gICAgICAgIGlmKCF0YXJnZXQpXHJcbiAgICAgICAgICAgIHRoaXMuZG9tRWxlbWVudC5hcHBlbmRDaGlsZChpbnN0KTtcclxuICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHRhcmdldC5hcHBlbmRDaGlsZChpbnN0KTtcclxuICAgICAgICByZXR1cm4gbmV3IFRleHQoaW5zdCk7XHJcbiAgICB9XHJcbiAgICBjcmVhdGVMaW5lKHgxOiBudW1iZXIsIHkxOiBudW1iZXIsIHgyOiBudW1iZXIsIHkyOiBudW1iZXIsIHdpZHRoOiBudW1iZXIsIGNvbG9yOiBzdHJpbmcsIHRhcmdldD86IFNWR0VsZW1lbnQpOiBMaW5lIHtcclxuICAgICAgICBjb25zdCBpbnN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsXCJsaW5lXCIpO1xyXG4gICAgICAgIHV0aWxzLnNldEF0dHJpYnV0ZXMoaW5zdCwge1xyXG4gICAgICAgICAgICB4MTogYCR7eDF9YCwgeTE6IGAke3kxfWAsXHJcbiAgICAgICAgICAgIHgyOiBgJHt4Mn1gLCB5MjogYCR7eTJ9YCxcclxuICAgICAgICAgICAgc3Ryb2tlOiBgJHtjb2xvcn1gLFxyXG4gICAgICAgICAgICBcInN0cm9rZS13aWR0aFwiOiBgJHt3aWR0aH1gXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYoIXRhcmdldClcclxuICAgICAgICAgICAgdGhpcy5kb21FbGVtZW50LmFwcGVuZENoaWxkKGluc3QpO1xyXG4gICAgICAgIGVsc2VcclxuICAgICAgICAgICAgdGFyZ2V0LmFwcGVuZENoaWxkKGluc3QpO1xyXG4gICAgICAgIHJldHVybiBuZXcgTGluZShpbnN0KTtcclxuICAgIH07XHJcbiAgICBjcmVhdGVMaW5rZXIodGFyZ2V0PzogU1ZHRWxlbWVudCl7XHJcbiAgICAgICAgbGV0IGxpbmtlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLFwicGF0aFwiKTtcclxuICAgICAgICBpZighdGFyZ2V0KVxyXG4gICAgICAgICAgICB0aGlzLmRvbUVsZW1lbnQuYXBwZW5kQ2hpbGQobGlua2VyKTtcclxuICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHRhcmdldC5hcHBlbmRDaGlsZChsaW5rZXIpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHV0aWxzLnNldEF0dHJpYnV0ZXMobGlua2VyLCB7ZmlsbDogYHdoaXRlYH0pO1xyXG4gICAgICAgIHRoaXMubGlua2VyLnB1c2gobGlua2VyKTtcclxuICAgICAgICByZXR1cm4gbGlua2VyO1xyXG4gICAgfVxyXG59XHJcblxyXG5cclxuZXhwb3J0IGNsYXNzIFNWR1NoYXBlIHtcclxuICAgIHByb3RlY3RlZCBfZG9tRWxlbWVudDogU1ZHRWxlbWVudDtcclxuICAgIGNvbnN0cnVjdG9yKGRvbUVsZW1lbnQ6IFNWR0VsZW1lbnQpIHtcclxuICAgICAgICB0aGlzLl9kb21FbGVtZW50ID0gZG9tRWxlbWVudDtcclxuICAgIH1cclxuICAgIHJlbW92ZSgpIHtcclxuICAgICAgICB0aGlzLl9kb21FbGVtZW50LnJlbW92ZSgpO1xyXG4gICAgfVxyXG4gICAgZ2V0IGRvbUVsZW1lbnQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2RvbUVsZW1lbnQ7XHJcbiAgICB9XHJcbiAgICBzZXQgc3R5bGUodmFsOiB7W2tleTogc3RyaW5nXTogc3RyaW5nfSl7XHJcbiAgICAgICAgdXRpbHMuc2V0U3R5bGUoPEhUTUxFbGVtZW50Pjx1bmtub3duPnRoaXMuZG9tRWxlbWVudCwgdmFsKTtcclxuICAgIH1cclxufTtcclxuXHJcbmV4cG9ydCBjbGFzcyBSZWN0IGV4dGVuZHMgU1ZHU2hhcGV7XHJcbiAgICBjb25zdHJ1Y3Rvcihkb21FbGVtZW50OiBTVkdSZWN0RWxlbWVudCkge1xyXG4gICAgICAgIHN1cGVyKGRvbUVsZW1lbnQpO1xyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSBfeDogbnVtYmVyO1xyXG4gICAgcHJpdmF0ZSBfeTogbnVtYmVyO1xyXG4gICAgcHJpdmF0ZSBfd2lkdGg6IG51bWJlcjtcclxuICAgIHByaXZhdGUgX2hlaWdodDogbnVtYmVyO1xyXG4gICAgc2V0UG9zKHg6IG51bWJlciwgeTogbnVtYmVyKSB7XHJcbiAgICAgICAgdXRpbHMuc2V0QXR0cmlidXRlcyh0aGlzLmRvbUVsZW1lbnQsIHtcclxuICAgICAgICAgICAgXCJ4XCI6IGAke3h9YCwgXCJ5XCI6IGAke3l9YFxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgc2V0U2hhcGUod2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIpIHtcclxuICAgICAgICB1dGlscy5zZXRBdHRyaWJ1dGVzKHRoaXMuZG9tRWxlbWVudCwge1xyXG4gICAgICAgICAgICBcIndpZHRoXCI6IGAke3dpZHRofWAsIFwiaGVpZ2h0XCI6IGAke2hlaWdodH1gXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IHgodmFsOiBudW1iZXIpIHtcclxuICAgICAgICBpZih0aGlzLl94ICE9PSB2YWwpe1xyXG4gICAgICAgICAgICB0aGlzLl94ID0gdmFsO1xyXG4gICAgICAgICAgICB1dGlscy5zZXRBdHRyaWJ1dGVzKHRoaXMuZG9tRWxlbWVudCwge1xyXG4gICAgICAgICAgICAgICAgeDogYCR7dmFsfWBcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldCB4KCk6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3g7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IHkodmFsOiBudW1iZXIpe1xyXG4gICAgICAgIGlmKHRoaXMuX3kgIT09IHZhbCl7XHJcbiAgICAgICAgICAgIHRoaXMuX3kgPSB2YWw7XHJcbiAgICAgICAgICAgIHV0aWxzLnNldEF0dHJpYnV0ZXModGhpcy5kb21FbGVtZW50LCB7XHJcbiAgICAgICAgICAgICAgICB5OiBgJHt2YWx9YFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHkoKTogbnVtYmVye1xyXG4gICAgICAgIHJldHVybiB0aGlzLl95O1xyXG4gICAgfVxyXG5cclxuICAgIHNldCB3aWR0aCh2YWw6IG51bWJlcil7XHJcbiAgICAgICAgaWYodGhpcy5fd2lkdGggIT09IHZhbCl7XHJcbiAgICAgICAgICAgIHRoaXMuX3dpZHRoID0gdmFsO1xyXG4gICAgICAgICAgICB1dGlscy5zZXRBdHRyaWJ1dGVzKHRoaXMuZG9tRWxlbWVudCwge1xyXG4gICAgICAgICAgICAgICAgd2lkdGg6IGAke3ZhbH1gXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZXQgd2lkdGgoKTogbnVtYmVye1xyXG4gICAgICAgIHJldHVybiB0aGlzLl93aWR0aDtcclxuICAgIH1cclxuICAgIFxyXG4gICAgc2V0IGhlaWdodCh2YWw6IG51bWJlcil7XHJcbiAgICAgICAgaWYodGhpcy5faGVpZ2h0ICE9PSB2YWwpe1xyXG4gICAgICAgICAgICB0aGlzLl9oZWlnaHQgPSB2YWw7XHJcbiAgICAgICAgICAgIHV0aWxzLnNldEF0dHJpYnV0ZXModGhpcy5kb21FbGVtZW50LCB7XHJcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IGAke3ZhbH1gXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZXQgaGVpZ2h0KCk6IG51bWJlcntcclxuICAgICAgICByZXR1cm4gdGhpcy5faGVpZ2h0O1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBzdHJva2VXaWR0aCh2YWw6IG51bWJlcil7XHJcbiAgICAgICAgdXRpbHMuc2V0QXR0cmlidXRlcyh0aGlzLmRvbUVsZW1lbnQsIHtcclxuICAgICAgICAgICAgXCJzdHJva2Utd2lkdGhcIjogYCR7dmFsfWBcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgc3Ryb2tlV2lkdGgoKTogbnVtYmVye1xyXG4gICAgICAgIHJldHVybiBOdW1iZXIodGhpcy5kb21FbGVtZW50LmdldEF0dHJpYnV0ZShcInN0cm9rZS13aWR0aFwiKSk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IGZpbGwodmFsOiBzdHJpbmcpe1xyXG4gICAgICAgIHV0aWxzLnNldEF0dHJpYnV0ZXModGhpcy5kb21FbGVtZW50LCB7XHJcbiAgICAgICAgICAgIGZpbGw6IGAke3ZhbH1gXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGdldCBmaWxsKCk6IHN0cmluZ3tcclxuICAgICAgICByZXR1cm4gdGhpcy5kb21FbGVtZW50LmdldEF0dHJpYnV0ZShcImZpbGxcIik7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBFbGxpcHNlIGV4dGVuZHMgU1ZHU2hhcGV7XHJcbiAgICBwcml2YXRlIF9jeDogbnVtYmVyO1xyXG4gICAgcHJpdmF0ZSBfY3k6IG51bWJlcjtcclxuICAgIHByaXZhdGUgX3J4OiBudW1iZXI7XHJcbiAgICBwcml2YXRlIF9yeTogbnVtYmVyO1xyXG4gICAgY29uc3RydWN0b3IoZG9tRWxlbWVudDogU1ZHRWxsaXBzZUVsZW1lbnQpIHtcclxuICAgICAgICBzdXBlcihkb21FbGVtZW50KTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRQb3MoY3g6IG51bWJlciwgY3k6IG51bWJlcikge1xyXG4gICAgICAgIHV0aWxzLnNldEF0dHJpYnV0ZXModGhpcy5kb21FbGVtZW50LCB7XHJcbiAgICAgICAgICAgIFwiY3hcIjogYCR7Y3h9YCwgXCJjeVwiOiBgJHtjeX1gXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBzZXRTaGFwZShjeDogbnVtYmVyLCBjeTogbnVtYmVyLCByeDogbnVtYmVyLCByeTogbnVtYmVyKSB7XHJcbiAgICAgICAgdXRpbHMuc2V0QXR0cmlidXRlcyh0aGlzLmRvbUVsZW1lbnQsIHtcclxuICAgICAgICAgICAgXCJyeFwiOiBgJHtyeH1gLCBcInJ5XCI6IGAke3J5fWBcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgY3godmFsOiBudW1iZXIpe1xyXG4gICAgICAgIGlmKHRoaXMuX2N4ICE9IHZhbCl7XHJcbiAgICAgICAgICAgIHRoaXMuX2N4ID0gdmFsO1xyXG4gICAgICAgICAgICB1dGlscy5zZXRBdHRyaWJ1dGVzKHRoaXMuZG9tRWxlbWVudCwge1xyXG4gICAgICAgICAgICAgICAgXCJjeFwiOiBgJHt2YWx9YFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGdldCBjeCgpOm51bWJlcntcclxuICAgICAgICByZXR1cm4gdGhpcy5fY3g7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IGN5KHZhbDogbnVtYmVyKXtcclxuICAgICAgICBpZih0aGlzLl9jeSAhPSB2YWwpe1xyXG4gICAgICAgICAgICB0aGlzLl9jeSA9IHZhbDtcclxuICAgICAgICAgICAgdXRpbHMuc2V0QXR0cmlidXRlcyh0aGlzLmRvbUVsZW1lbnQsIHtcclxuICAgICAgICAgICAgICAgIFwiY3lcIjogYCR7dmFsfWBcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldCBjeSgpOiBudW1iZXJ7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2N5O1xyXG4gICAgfVxyXG5cclxuICAgIHNldCByeCh2YWw6IG51bWJlcil7XHJcbiAgICAgICAgaWYodGhpcy5fcnggIT0gdmFsKXtcclxuICAgICAgICAgICAgdGhpcy5fcnggPSB2YWw7XHJcbiAgICAgICAgICAgIHV0aWxzLnNldEF0dHJpYnV0ZXModGhpcy5kb21FbGVtZW50LCB7XHJcbiAgICAgICAgICAgICAgICByeDogYCR7dmFsfWBcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldCByeCgpOiBudW1iZXJ7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3J4O1xyXG4gICAgfVxyXG5cclxuICAgIHNldCByeSh2YWw6IG51bWJlcil7XHJcbiAgICAgICAgaWYodGhpcy5fcnkgIT0gdmFsKXtcclxuICAgICAgICAgICAgdGhpcy5fcnkgPSB2YWw7XHJcbiAgICAgICAgICAgIHV0aWxzLnNldEF0dHJpYnV0ZXModGhpcy5kb21FbGVtZW50LCB7XHJcbiAgICAgICAgICAgICAgICByeTogYCR7dmFsfWBcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldCByeSgpOiBudW1iZXJ7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3J5O1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBmaWxsKHZhbDogc3RyaW5nKXtcclxuICAgICAgICB1dGlscy5zZXRBdHRyaWJ1dGVzKHRoaXMuZG9tRWxlbWVudCwge1xyXG4gICAgICAgICAgICBmaWxsOiBgJHt2YWx9YFxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBmaWxsKCk6IHN0cmluZ3tcclxuICAgICAgICByZXR1cm4gdGhpcy5kb21FbGVtZW50LmdldEF0dHJpYnV0ZShcImZpbGxcIik7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBMaW5lIGV4dGVuZHMgU1ZHU2hhcGV7XHJcbiAgICBwcml2YXRlIF94MTogbnVtYmVyO1xyXG4gICAgcHJpdmF0ZSBfeDI6IG51bWJlcjtcclxuICAgIHByaXZhdGUgX3kxOiBudW1iZXI7XHJcbiAgICBwcml2YXRlIF95MjogbnVtYmVyO1xyXG4gICAgY29uc3RydWN0b3IoZG9tRWxlbWVudDogU1ZHRWxlbWVudCkge1xyXG4gICAgICAgIHN1cGVyKGRvbUVsZW1lbnQpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldEVuZFBvaW50cyh4MTogbnVtYmVyLCB5MTogbnVtYmVyLCB4MjogbnVtYmVyLCB5MjogbnVtYmVyKSB7XHJcbiAgICAgICAgdXRpbHMuc2V0QXR0cmlidXRlcyh0aGlzLmRvbUVsZW1lbnQsIHtcclxuICAgICAgICAgICAgXCJ4MVwiOiBgJHt4MX1gLCBcInkxXCI6IGAke3kxfWAsXHJcbiAgICAgICAgICAgIFwieDJcIjogYCR7eDJ9YCwgXCJ5MlwiOiBgJHt5Mn1gXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IHgxKHZhbDogbnVtYmVyKXtcclxuICAgICAgICBpZih0aGlzLl94MSAhPSB2YWwpe1xyXG4gICAgICAgICAgICB0aGlzLl94MSA9IHZhbDtcclxuICAgICAgICAgICAgdXRpbHMuc2V0QXR0cmlidXRlcyh0aGlzLmRvbUVsZW1lbnQsIHtcclxuICAgICAgICAgICAgICAgIHgxOiBgJHt2YWx9YFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBnZXQgeDEoKTogbnVtYmVye1xyXG4gICAgICAgIHJldHVybiBOdW1iZXIodGhpcy5kb21FbGVtZW50LmdldEF0dHJpYnV0ZShcIngxXCIpKTtcclxuICAgIH1cclxuICAgIHNldCB5MSh2YWw6IG51bWJlcil7XHJcbiAgICAgICAgaWYodGhpcy5feTEgIT0gdmFsKXtcclxuICAgICAgICAgICAgdGhpcy5feTEgPSB2YWw7XHJcbiAgICAgICAgdXRpbHMuc2V0QXR0cmlidXRlcyh0aGlzLmRvbUVsZW1lbnQsIHtcclxuICAgICAgICAgICAgeTE6IGAke3ZhbH1gXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZ2V0IHkxKCk6IG51bWJlcntcclxuICAgICAgICByZXR1cm4gTnVtYmVyKHRoaXMuZG9tRWxlbWVudC5nZXRBdHRyaWJ1dGUoXCJ5MVwiKSk7XHJcbiAgICB9XHJcbiAgICBzZXQgeDIodmFsOiBudW1iZXIpe1xyXG4gICAgICAgIGlmKHRoaXMuX3gyICE9IHZhbCl7XHJcbiAgICAgICAgICAgIHRoaXMuX3gyID0gdmFsO1xyXG4gICAgICAgIHV0aWxzLnNldEF0dHJpYnV0ZXModGhpcy5kb21FbGVtZW50LCB7XHJcbiAgICAgICAgICAgIHgyOiBgJHt2YWx9YFxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGdldCB4MigpOiBudW1iZXJ7XHJcbiAgICAgICAgcmV0dXJuIE51bWJlcih0aGlzLmRvbUVsZW1lbnQuZ2V0QXR0cmlidXRlKFwieDJcIikpO1xyXG4gICAgfVxyXG4gICAgc2V0IHkyKHZhbDogbnVtYmVyKXtcclxuICAgICAgICBpZih0aGlzLl95MiAhPSB2YWwpe1xyXG4gICAgICAgICAgICB0aGlzLl95MiA9IHZhbDtcclxuICAgICAgICB1dGlscy5zZXRBdHRyaWJ1dGVzKHRoaXMuZG9tRWxlbWVudCwge1xyXG4gICAgICAgICAgICB5MjogYCR7dmFsfWBcclxuICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBnZXQgeTIoKTogbnVtYmVye1xyXG4gICAgICAgIHJldHVybiBOdW1iZXIodGhpcy5kb21FbGVtZW50LmdldEF0dHJpYnV0ZShcInkyXCIpKTtcclxuICAgIH1cclxuICAgIHNldCBzdHJva2UodmFsOiBzdHJpbmcpe1xyXG4gICAgICAgIHV0aWxzLnNldEF0dHJpYnV0ZXModGhpcy5kb21FbGVtZW50LCB7XHJcbiAgICAgICAgICAgIHN0cm9rZTogYCR7dmFsfWBcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIGdldCBzdHJva2UoKTogc3RyaW5ne1xyXG4gICAgICAgIHJldHVybiB0aGlzLmRvbUVsZW1lbnQuZ2V0QXR0cmlidXRlKFwic3Ryb2tlXCIpXHJcbiAgICB9XHJcbiAgICBzZXQgc3Ryb2tlV2lkdGgodmFsOiBudW1iZXIpe1xyXG4gICAgICAgIHV0aWxzLnNldEF0dHJpYnV0ZXModGhpcy5kb21FbGVtZW50LCB7XHJcbiAgICAgICAgICAgIFwic3Ryb2tlLXdpZHRoXCI6IGAke3ZhbH1gXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBnZXQgc3Ryb2tlV2lkdGgoKTogbnVtYmVye1xyXG4gICAgICAgIHJldHVybiBOdW1iZXIodGhpcy5kb21FbGVtZW50LmdldEF0dHJpYnV0ZShcInN0cm9rZS13aWR0aFwiKSlcclxuICAgIH1cclxufVxyXG50eXBlIGFuY2hvciA9ICBcImNlbnRlclwiIHwgXCJsZWZ0XCI7XHJcbmV4cG9ydCBjbGFzcyBUZXh0IGV4dGVuZHMgU1ZHU2hhcGV7XHJcbiAgICBwcml2YXRlIF94OiBudW1iZXI7XHJcbiAgICBwcml2YXRlIF95OiBudW1iZXI7XHJcbiAgICBjb25zdHJ1Y3Rvcihkb21FbGVtZW50OiBTVkdUZXh0RWxlbWVudCkge1xyXG4gICAgICAgIHN1cGVyKGRvbUVsZW1lbnQpO1xyXG4gICAgfVxyXG4gICAgc2V0UG9zKHg6IG51bWJlciwgeTogbnVtYmVyKSB7XHJcbiAgICAgICAgdXRpbHMuc2V0QXR0cmlidXRlcyh0aGlzLmRvbUVsZW1lbnQsIHtcclxuICAgICAgICAgICAgXCJ4XCI6IGAke3h9YCwgXCJ5XCI6IGAke3l9YCxcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIHNldCB4KHZhbDogbnVtYmVyKXtcclxuICAgICAgICBpZih0aGlzLl94ICE9IHZhbCl7XHJcbiAgICAgICAgICAgIHRoaXMuX3ggPSB2YWw7XHJcbiAgICAgICAgICAgIHV0aWxzLnNldEF0dHJpYnV0ZXModGhpcy5kb21FbGVtZW50LCB7XHJcbiAgICAgICAgICAgICAgICB4OiBgJHt2YWx9YFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBnZXQgeCgpOiBudW1iZXJ7XHJcbiAgICAgICAgcmV0dXJuIE51bWJlcih0aGlzLmRvbUVsZW1lbnQuZ2V0QXR0cmlidXRlKFwieFwiKSk7XHJcbiAgICB9XHJcbiAgICBzZXQgeSh2YWw6IG51bWJlcil7XHJcbiAgICAgICAgaWYodGhpcy5feSAhPSB2YWwpe1xyXG4gICAgICAgICAgICB0aGlzLl95ID0gdmFsO1xyXG4gICAgICAgICAgICB1dGlscy5zZXRBdHRyaWJ1dGVzKHRoaXMuZG9tRWxlbWVudCwge1xyXG4gICAgICAgICAgICAgICAgeTogYCR7dmFsfWBcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZ2V0IHkoKTogbnVtYmVye1xyXG4gICAgICAgIHJldHVybiBOdW1iZXIodGhpcy5kb21FbGVtZW50LmdldEF0dHJpYnV0ZShcInlcIikpO1xyXG4gICAgfVxyXG4gICAgc2V0IGFuY2hvcih2YWw6IGFuY2hvcil7XHJcbiAgICAgICAgdXRpbHMuc2V0QXR0cmlidXRlcyh0aGlzLmRvbUVsZW1lbnQsIHtcclxuICAgICAgICAgICAgXCJ0ZXh0LWFuY2hvclwiOiBgJHt2YWx9YFxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgZ2V0IGFuY2hvcigpOiBhbmNob3J7XHJcbiAgICAgICAgcmV0dXJuIDxhbmNob3I+dGhpcy5kb21FbGVtZW50LmdldEF0dHJpYnV0ZShcInRleHQtYW5jaG9yXCIpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCB0ZXh0KHZhbDogc3RyaW5nKXtcclxuICAgICAgICBpZih0aGlzLmRvbUVsZW1lbnQuaW5uZXJIVE1MICE9PSB2YWwpe1xyXG4gICAgICAgICAgICB0aGlzLmRvbUVsZW1lbnQuaW5uZXJIVE1MID0gYCR7dmFsfWA7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldCB0ZXh0KCk6IHN0cmluZ3tcclxuICAgICAgICByZXR1cm4gdGhpcy5kb21FbGVtZW50LmlubmVySFRNTDtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgc3Ryb2tlV2lkdGgodmFsOiBudW1iZXIpe1xyXG4gICAgICAgIHV0aWxzLnNldEF0dHJpYnV0ZXModGhpcy5kb21FbGVtZW50LCB7XHJcbiAgICAgICAgICAgIFwic3Ryb2tlLXdpZHRoXCI6IGAke3ZhbH1gXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHN0cm9rZVdpZHRoKCk6IG51bWJlcntcclxuICAgICAgICByZXR1cm4gTnVtYmVyKHRoaXMuZG9tRWxlbWVudC5nZXRBdHRyaWJ1dGUoXCJzdHJva2Utd2lkdGhcIikpO1xyXG4gICAgfVxyXG4gICAgc2V0IGZpbGwodmFsOiBzdHJpbmcpe1xyXG4gICAgICAgIHV0aWxzLnNldEF0dHJpYnV0ZXModGhpcy5kb21FbGVtZW50LCB7XHJcbiAgICAgICAgICAgIGZpbGw6IGAke3ZhbH1gXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmNsYXNzIE5vdGVMYXllciBleHRlbmRzIExheWVyIHtcclxuICAgIG5vdGVFbGVtZW50czogU1ZHTm90ZVtdID0gW107XHJcbiAgICBkb3Q6IEVsbGlwc2VbXSA9IFtdO1xyXG4gICAgY29uc3RydWN0b3IoKXtcclxuICAgICAgICBzdXBlcigpO1xyXG4gICAgICAgIHRoaXMuZG9tRWxlbWVudC5pbm5lckhUTUwgPSBgXHJcbiAgICAgICAgPGRlZnM+XHJcbiAgICAgICAgICAgIDxwYXRoIGlkPVwiU1ZHVEFJTDhfMVwiIGQ9XCJNLTQuNzI4LDE1MS4zMTNsMTAuMzAzLDIuMDYxbDM5LjE1My0zMy44NTRjMCwwLDIwLjU0My0yNC4zMTgsMjMuMzM4LTY3LjcwOEw3MC4zNCwwSDQzLjg0NkwyMi4wNjEsNzguMDEyXHJcbiAgICAgICAgICAgICAgICBsLTMzLjg1NCwyMC45MDFMLTQuNzI4LDE1MS4zMTN6XCIvPlxyXG4gICAgICAgIFx0PGNsaXBQYXRoIGlkPVwiU1ZHVEFJTDhfMlwiPlxyXG4gICAgICAgICAgICAgICAgPHVzZSB4bGluazpocmVmPVwiI1NWR1RBSUw4XzFcIiAgc3R5bGU9XCJvdmVyZmxvdzp2aXNpYmxlO1wiLz5cclxuICAgICAgICAgICAgPC9jbGlwUGF0aD5cclxuXHJcbiAgICAgICAgICAgIDxwYXRoIGlkPVwic3RhaWwxNlwiZD1cIk02Ny4zNyw1OS43NzZjMi42OTgtMTkuODQtMi44MDYtMzkuMDEtNy4xMjQtNTguMTczQzYwLjEzOCwxLjEyNyw1OS41MjMsMC43NjUsNTguODI1LDBjMCwzLjQxMS0wLjMxNyw2LjI2NiwwLjA1NCw5LjAyOVxyXG4gICAgICAgICAgICBjMS42OSwxMi41NzYsMC43MDcsMjUuMDYyLTIuNDc4LDM3LjE3NWMtNS40OTQsMjAuODk3LTE1LjE2MywzOS4zMi0zNS4zOTQsNDkuNjljLTYuMzk3LDMuMjc5LTEzLjU5OSw0Ljk5LTIwLjYxMiw3LjQ0M1xyXG4gICAgICAgICAgICBsLTAuMTY4LDQyLjg0MmMwLjQyOS0xLjQ1OSwxLjAzMS0yLjg5OSwxLjg4MS00LjMxOGM1LjcxMi05LjUzNSwxMy4zNzktMTcuMjc1LDIzLjQyMi0yMS43MzFcclxuICAgICAgICAgICAgYzExLjcyOC01LjIwMywyMS4zNzItMTIuNjM0LDI5LjQzMi0yMi40MDdjMC40ODYtMC41OSwxLjE1NC0xLjAyOSwyLjAxNy0xLjc4MmMtNi42OTMsMzQuNDEyLTI2Ljg5NCw1NS45NjEtNTYuNzk0LDYwLjU1NVxyXG4gICAgICAgICAgICBMMCwyMDMuODc0YzEuNjM0LTQuMDkyLDIuNTE4LTguNjIxLDQuOTIyLTEyLjE0OGM1LjkwNi04LjY2NCwxNC4wOTItMTQuNzk3LDIzLjcxLTE5LjMwOGMxNi41OTctNy43ODYsMzAuMDE2LTE5LjUzMiwzNS4wODUtMzcuNDk4XHJcbiAgICAgICAgICAgIGMzLjE5OC0xMS4zMzMsNC4yMi0yMy42ODIsMy44NzItMzUuNTA2QzY3LjIsODYuMTg1LDY1LjU1MSw3My4xNDgsNjcuMzcsNTkuNzc2elwiLz5cclxuICAgICAgICBcclxuICAgICAgICAgICAgPHBhdGggaWQ9XCJzdGFpbDhcIiBzdHlsZT1cImNsaXAtcGF0aDp1cmwoI1NWR1RBSUw4XzIpO1wiIGQ9XCJNNjcuMzUyLDY0LjE4NGMyLjY5OC0xOS44NC0yLjgwNi0zOS4wMS03LjEyNC01OC4xNzNcclxuICAgICAgICAgICAgYy0wLjEwNy0wLjQ3Ni0wLjcyMi0wLjgzNy0xLjQyLTEuNjAzYzAsMy40MTEtMC4zMTcsNi4yNjYsMC4wNTQsOS4wMjljMS42OSwxMi41NzYsMC43MDcsMjUuMDYyLTIuNDc4LDM3LjE3NVxyXG4gICAgICAgICAgICBjLTUuNDk0LDIwLjg5Ny0xNS4xNjMsMzkuMzItMzUuMzk0LDQ5LjY5Yy02LjM5NywzLjI3OS0xMy41OTksNC45OS0yMC42MTIsNy40NDNsLTAuMTY4LDQyLjg0MlxyXG4gICAgICAgICAgICBjMC40MjktMS40NTksMS4wMzEtMi44OTksMS44ODEtNC4zMThjNS43MTItOS41MzUsMTMuMzc5LTE3LjI3NSwyMy40MjItMjEuNzMxYzExLjcyOC01LjIwMywyMS4zNzItMTIuNjM0LDI5LjQzMi0yMi40MDdcclxuICAgICAgICAgICAgYzAuNDg2LTAuNTksMS4xNTQtMS4wMjksMi4wMTctMS43ODJjLTYuNjkzLDM0LjQxMi0yNi44OTQsNTUuOTYxLTU2Ljc5NCw2MC41NTVsLTAuMTg2LDQ3LjM3OVxyXG4gICAgICAgICAgICBjMS42MzQtNC4wOTIsMi41MTgtOC42MjEsNC45MjItMTIuMTQ4YzUuOTA2LTguNjY0LDE0LjA5Mi0xNC43OTcsMjMuNzEtMTkuMzA4YzE2LjU5Ny03Ljc4NiwzMC4wMTYtMTkuNTMyLDM1LjA4NS0zNy40OThcclxuICAgICAgICAgICAgYzMuMTk4LTExLjMzMyw0LjIyLTIzLjY4MiwzLjg3Mi0zNS41MDZDNjcuMTgyLDkwLjU5NCw2NS41MzQsNzcuNTU3LDY3LjM1Miw2NC4xODR6XCIvPlxyXG5cclxuICAgICAgICAgICAgPHBhdGggaWQ9XCJTVkdJRF8xX1wiIGQ9XCJNLTQuMTcsMjU1LjU0M2wxMC4zMDMsMi4wNjFsMzkuMTUzLTMzLjg1NGMwLDAsMjAuNTQzLTI0LjMxOCwyMy4zMzgtNjcuNzA4bDIuMjc0LTUxLjgxMkg0NC40MDRcclxuICAgICAgICAgICAgICAgIGwtMjEuNzg0LDc4LjAxMmwtMzMuODU0LDIwLjkwMUwtNC4xNywyNTUuNTQzelwiLz5cclxuICAgICAgICAgICAgPGNsaXBQYXRoIGlkPVwiU1ZHSURfMl9cIj5cclxuICAgICAgICAgICAgICAgIDx1c2UgeGxpbms6aHJlZj1cIiNTVkdJRF8xX1wiICBzdHlsZT1cIm92ZXJmbG93OnZpc2libGU7XCIvPlxyXG4gICAgICAgICAgICA8L2NsaXBQYXRoPlxyXG4gICAgICAgICAgICA8ZyBpZD1cInN0YWlsMzJcIj5cclxuICAgICAgICAgICAgPHBhdGggZD1cIk02Ny4xODMsNTkuNzc2YzIuNjk4LTE5Ljg0LTIuODA2LTM5LjAxLTcuMTI0LTU4LjE3M0M1OS45NTIsMS4xMjcsNTkuMzM3LDAuNzY1LDU4LjYzOSwwYzAsMy40MTEtMC4zMTcsNi4yNjYsMC4wNTQsOS4wMjlcclxuXHRcdGMxLjY5LDEyLjU3NiwwLjcwNywyNS4wNjItMi40NzgsMzcuMTc1Yy01LjQ5NCwyMC44OTctMTUuMTYzLDM5LjMyLTM1LjM5NCw0OS42OWMtNi4zOTcsMy4yNzktMTMuNTk5LDQuOTktMjAuNjEyLDcuNDQzXHJcblx0XHRsLTAuMTY4LDQyLjg0MmMwLjQyOS0xLjQ1OSwxLjAzMS0yLjg5OSwxLjg4MS00LjMxOGM1LjcxMi05LjUzNSwxMy4zNzktMTcuMjc1LDIzLjQyMi0yMS43MzFcclxuXHRcdGMxMS43MjgtNS4yMDMsMjEuMzcyLTEyLjYzNCwyOS40MzItMjIuNDA3YzAuNDg2LTAuNTksMS4xNTQtMS4wMjksMi4wMTctMS43ODJDNTAuMTAxLDEzMC4zNTIsMjkuOSwxNTEuOTAxLDAsMTU2LjQ5NVxyXG5cdFx0bC0wLjE4Niw0Ny4zNzljMS42MzQtNC4wOTIsMi41MTgtOC42MjEsNC45MjItMTIuMTQ4YzUuOTA2LTguNjY0LDE0LjA5Mi0xNC43OTcsMjMuNzEtMTkuMzA4XHJcblx0XHRjMTYuNTk3LTcuNzg2LDMwLjAxNi0xOS41MzIsMzUuMDg1LTM3LjQ5OGMzLjE5OC0xMS4zMzMsNC4yMi0yMy42ODIsMy44NzItMzUuNTA2QzY3LjAxMyw4Ni4xODUsNjUuMzY1LDczLjE0OCw2Ny4xODMsNTkuNzc2elwiLz5cclxuICAgICAgICAgICAgPHBhdGggc3R5bGU9XCJjbGlwLXBhdGg6dXJsKCNTVkdJRF8yXyk7XCIgZD1cIk02Ny45MSwxNjguNDE0YzIuNjk4LTE5Ljg0LTIuODA2LTM5LjAxLTcuMTI0LTU4LjE3M1xyXG5cdFx0XHRjLTAuMTA3LTAuNDc2LTAuNzIyLTAuODM3LTEuNDItMS42MDNjMCwzLjQxMS0wLjMxNyw2LjI2NiwwLjA1NCw5LjAyOWMxLjY5LDEyLjU3NiwwLjcwNywyNS4wNjItMi40NzgsMzcuMTc1XHJcblx0XHRcdGMtNS40OTQsMjAuODk3LTE1LjE2MywzOS4zMi0zNS4zOTQsNDkuNjljLTYuMzk3LDMuMjc5LTEzLjU5OSw0Ljk5LTIwLjYxMiw3LjQ0M2wtMC4xNjgsNDIuODQyXHJcblx0XHRcdGMwLjQyOS0xLjQ1OSwxLjAzMS0yLjg5OSwxLjg4MS00LjMxOGM1LjcxMi05LjUzNSwxMy4zNzktMTcuMjc1LDIzLjQyMi0yMS43MzFjMTEuNzI4LTUuMjAzLDIxLjM3Mi0xMi42MzQsMjkuNDMyLTIyLjQwN1xyXG5cdFx0XHRjMC40ODYtMC41OSwxLjE1NC0xLjAyOSwyLjAxNy0xLjc4MmMtNi42OTMsMzQuNDEyLTI2Ljg5NCw1NS45Ni01Ni43OTQsNjAuNTU1TDAuNTQsMzEyLjUxMlxyXG5cdFx0XHRjMS42MzQtNC4wOTIsMi41MTgtOC42MjEsNC45MjItMTIuMTQ4YzUuOTA2LTguNjY0LDE0LjA5Mi0xNC43OTcsMjMuNzEtMTkuMzA4YzE2LjU5Ny03Ljc4NiwzMC4wMTYtMTkuNTMyLDM1LjA4NS0zNy40OThcclxuICAgICAgICAgICAgYzMuMTk4LTExLjMzMyw0LjIyLTIzLjY4MiwzLjg3Mi0zNS41MDZDNjcuNzQsMTk0LjgyMyw2Ni4wOTIsMTgxLjc4Niw2Ny45MSwxNjguNDE0elwiLz5cclxuICAgICAgICAgICAgPC9nPlxyXG4gICAgICAgIDwvZGVmcz5cclxuICAgICAgICBgO1xyXG4gICAgICAgIHV0aWxzLnNldEF0dHJpYnV0ZXModGhpcy5kb21FbGVtZW50LHtcImRhdGEtbGF5ZXJcIjogXCJOb3RlTGF5ZXJcIn0pXHJcbiAgICB9XHJcbiAgICBjcmVhdGVOb3RlKGluc2VydEluZGV4OiBudW1iZXIgPSAtMSk6IFNWR0VsZW1lbnQge1xyXG4gICAgICAgIGNvbnN0IG5vdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyxcImdcIik7XHJcbiAgICAgICAgY29uc3QgYmxvY2tHcm91cCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLFwiZ1wiKTtcclxuICAgICAgICBjb25zdCBibG9ja0FycmF5OiBOb3RlQmxvY2tbXSA9IFtdO1xyXG4gICAgICAgIGNvbnN0IGxpbmVHcm91cCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLFwiZ1wiKTtcclxuICAgICAgICBjb25zdCBsZzogTGluZVtdID0gW107XHJcbiAgICAgICAgbGcucHVzaCh0aGlzLmNyZWF0ZUxpbmUoMCwgMCwgMCwgMCwgMSwgXCJ3aGl0ZVwiLCBsaW5lR3JvdXApKTtcclxuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgMyA7IGkrKyl7XHJcbiAgICAgICAgICAgIGxnLnB1c2godGhpcy5jcmVhdGVMaW5lKDAsIDAsIDAsIDAsIDIsIFwid2hpdGVcIiwgbGluZUdyb3VwKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG5vdGUuYXBwZW5kKGxpbmVHcm91cCk7XHJcbiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IDYgOyBpKyspe1xyXG4gICAgICAgICAgICBjb25zdCB3b3JkR3JvdXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyxcImdcIik7XHJcbiAgICAgICAgICAgIGNvbnN0IGV4dGVuZFJlY3QgPSB0aGlzLmNyZWF0ZVJlY3QoMCwgMCwgMCwgMCwgMCwgXCJyZ2JhKDAsIDAsIDAsIDApXCIsd29yZEdyb3VwKTtcclxuICAgICAgICAgICAgY29uc3Qgd29yZEJhY2sgPSB0aGlzLmNyZWF0ZVRleHQoMCwgMCwgXCJcIiwgXCJtaWRkbGVcIiwgd29yZEdyb3VwKTtcclxuICAgICAgICAgICAgY29uc3Qgd29yZCA9IHRoaXMuY3JlYXRlVGV4dCgwLCAwLCBcIlwiLCBcIm1pZGRsZVwiLCB3b3JkR3JvdXApO1xyXG4gICAgICAgICAgICB1dGlscy5zZXRBdHRyaWJ1dGVzKHdvcmRHcm91cCwge1wic3Ryb2tlLXdpZHRoXCI6ICcwJywgXCJzdHJva2VcIjogXCJibGFja1wiLCBzdHlsZTogXCJjdXJzb3I6cG9pbnRlcjtcIn0pO1xyXG4gICAgICAgICAgICB3b3JkQmFjay5zdHJva2VXaWR0aCA9IDM7IFxyXG4gICAgICAgICAgICB3b3JkQmFjay5zdHlsZSA9IHtmb250OiBcIjEycHggU2Fucy1zZXJmXCJ9XHJcbiAgICAgICAgICAgIHdvcmQuc3R5bGUgPSB7XCJmb250XCI6IFwiMTJweCBTYW5zLXNlcmlmXCIsIFwiZmlsbFwiOiBcIiNmZmZcIn07XHJcbiAgICAgICAgICAgIGJsb2NrR3JvdXAuYXBwZW5kKHdvcmRHcm91cCk7XHJcbiAgICAgICAgICAgIGJsb2NrQXJyYXkucHVzaChuZXcgTm90ZUJsb2NrKDxIVE1MRWxlbWVudD48dW5rbm93bj53b3JkR3JvdXAsIHdvcmQsIHdvcmRCYWNrLCBleHRlbmRSZWN0KSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG5vdGUuYXBwZW5kKGJsb2NrR3JvdXApO1xyXG4gICAgICAgIGlmKGluc2VydEluZGV4ID09PSAtMSlpbnNlcnRJbmRleCA9IHRoaXMubm90ZUVsZW1lbnRzLmxlbmd0aDtcclxuICAgICAgICB0aGlzLm5vdGVFbGVtZW50cy5zcGxpY2UoaW5zZXJ0SW5kZXgsIDAsIG5ldyBTVkdOb3RlKDxIVE1MRWxlbWVudD48dW5rbm93bj5ub3RlLCBibG9ja0FycmF5LCBsZykpO1xyXG4gICAgICAgIC8vdGhpcy5ub3RlRWxlbWVudHMucHVzaChuZXcgU1ZHTm90ZSg8SFRNTEVsZW1lbnQ+PHVua25vd24+bm90ZSwgYmxvY2tBcnJheSwgbGcpKTtcclxuICAgICAgICB0aGlzLmRvbUVsZW1lbnQuYXBwZW5kKG5vdGUpO1xyXG4gICAgICAgIHJldHVybiBub3RlO1xyXG4gICAgfVxyXG5cclxuICAgIHJlbW92ZU5vdGUobm90ZUluZGV4OiBudW1iZXIsIG51bTogbnVtYmVyID0gMSl7XHJcbiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IG51bTsgaSsrKXtcclxuICAgICAgICAgICAgaWYodGhpcy5ub3RlRWxlbWVudHNbbm90ZUluZGV4ICsgaV0pXHJcbiAgICAgICAgICAgICAgICB0aGlzLmRvbUVsZW1lbnQucmVtb3ZlQ2hpbGQodGhpcy5ub3RlRWxlbWVudHNbbm90ZUluZGV4ICsgaV0uZG9tZWxlbWVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHRoaXMubm90ZUVsZW1lbnRzLnNwbGljZShub3RlSW5kZXgsIG51bSk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmNsYXNzIFNoZWV0TGF5ZXIgZXh0ZW5kcyBMYXllciB7XHJcbiAgICByZWFkb25seSByb3c6IEhUTUxFbGVtZW50W10gPSBbXTtcclxuICAgIHJlYWRvbmx5IGJhcjogTGluZVtdID0gW107XHJcbiAgICBjb25zdHJ1Y3Rvcigpe1xyXG4gICAgICAgIHN1cGVyKCk7XHJcbiAgICAgICAgdXRpbHMuc2V0QXR0cmlidXRlcyh0aGlzLmRvbUVsZW1lbnQse1wiZGF0YS1sYXllclwiOiBcIlNoZWV0TGF5ZXJcIn0pXHJcbiAgICB9XHJcbiAgICBjcmVhdGVSb3coeDogbnVtYmVyLCB5OiBudW1iZXIsIGxpbmVXaWR0aDpudW1iZXIsIGxpbmVQYWRkaW5nOiBbbnVtYmVyLCBudW1iZXJdLCBzdHJpbmdQYWRkaW5nOiBudW1iZXIsIHNlY3Rpb25QZXJMaW5lOiBudW1iZXIpOiBTVkdFbGVtZW50IHtcclxuICAgICAgICBsZXQgbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyxcImdcIik7XHJcbiAgICAgICAgbGV0IGxpbmVCYWNrID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsXCJyZWN0XCIpO1xyXG4gICAgICAgIHV0aWxzLnNldEF0dHJpYnV0ZXMobGluZUJhY2sse3g6IGAke3h9YCwgeTpgJHt5fWAsc3R5bGU6IFwiZmlsbDogcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjA5KVwiLCB3aWR0aDpgJHtsaW5lUGFkZGluZ1swXSoyICsgbGluZVdpZHRofWAsIGhlaWdodDogYCR7bGluZVBhZGRpbmdbMV0qMiArIHN0cmluZ1BhZGRpbmcgKiA1fWB9KTtcclxuICAgICAgICBuZy5hcHBlbmRDaGlsZChsaW5lQmFjayk7XHJcbiAgICAgICAgeCArPSBsaW5lUGFkZGluZ1swXTtcclxuICAgICAgICB5ICs9IGxpbmVQYWRkaW5nWzFdO1xyXG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCA2OyBpKyspe1xyXG4gICAgICAgICAgICBsZXQgbCA9IGxpbmVXaWR0aDtcclxuICAgICAgICAgICAgdGhpcy5jcmVhdGVMaW5lKHgsIHkgKyBpKnN0cmluZ1BhZGRpbmcsIHggKyBsLCB5ICsgaSAqIHN0cmluZ1BhZGRpbmcsIDIsIFwicmdiYSgyNTUsIDI1NSwgMjU1LCAwLjI0KVwiLCBuZyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZHJhd1Jvd1RpdGxlKHggLSAzMCwgeSwgbmcpO1xyXG4gICAgICAgIHRoaXMuY3JlYXRlTGluZSh4LCB5LCB4LCB5ICsgc3RyaW5nUGFkZGluZyAqIDUsIDIsIFwicmdiYSgyNTUsIDI1NSwgMjU1LCAwLjI0KVwiLCBuZyk7XHJcbiAgICAgICAgZm9yKGxldCBpPSAwOyBpIDwgc2VjdGlvblBlckxpbmU7IGkrKyl7XHJcbiAgICAgICAgICAgIGxldCBuYiA9IHRoaXMuY3JlYXRlTGluZSgwLCB5LCAwLCB5ICsgc3RyaW5nUGFkZGluZyAqIDUsIDIsIFwicmdiYSgyNTUsIDI1NSwgMjU1LCAwLjI0KVwiLCB0aGlzLmRvbUVsZW1lbnQpO1xyXG4gICAgICAgICAgICB0aGlzLmJhci5wdXNoKG5iKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5kb21FbGVtZW50LmFwcGVuZChuZyk7XHJcbiAgICAgICAgdGhpcy5yb3cucHVzaCg8SFRNTEVsZW1lbnQ+PHVua25vd24+bmcpO1xyXG4gICAgICAgIHJldHVybiBuZztcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGRyYXdSb3dUaXRsZSh4OiBudW1iZXIsIHk6IG51bWJlciwgdGFyZ2V0PzogU1ZHRWxlbWVudCk6IFNWR0VsZW1lbnQge1xyXG4gICAgICAgIGxldCB0aXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLFwiZ1wiKTtcclxuICAgICAgICB0aXRsZS5pbm5lckhUTUwgPSBgXHJcbiAgICAgICAgPHRleHQgc3R5bGU9XCJmaWxsOiM5NTk1OTU7Zm9udDoxN3B4IGFyaWFsO1wiPlxyXG4gICAgICAgICAgICA8dHNwYW4geD0nJHt4ICsgMTB9JyB5PScke3kgKyAyNn0nPlQ8L3RzcGFuPlxyXG4gICAgICAgICAgICA8dHNwYW4geD0nJHt4ICsgMTB9JyB5PScke3kgKyAyMiArIDI2fSc+QTwvdHNwYW4+XHJcbiAgICAgICAgICAgIDx0c3BhbiB4PScke3ggKyAxMH0nIHk9JyR7eSArIDQ0ICsgMjZ9Jz5CPC90c3Bhbj5cclxuICAgICAgICA8L3RleHQ+XHJcbiAgICAgICAgYDtcclxuICAgICAgICBpZih0YXJnZXQpdGFyZ2V0LmFwcGVuZCh0aXRsZSk7XHJcbiAgICAgICAgcmV0dXJuIHRpdGxlO1xyXG4gICAgfVxyXG59XHJcblxyXG5jbGFzcyBVSUxheWVyIGV4dGVuZHMgTGF5ZXIge1xyXG4gICAgcmVhZG9ubHkgc2VjdGlvbkluZGljYXRvcjogUmVjdFtdID0gW107XHJcbiAgICBjb25zdHJ1Y3Rvcigpe1xyXG4gICAgICAgIHN1cGVyKCk7XHJcbiAgICAgICAgdXRpbHMuc2V0QXR0cmlidXRlcyh0aGlzLmRvbUVsZW1lbnQse1wiZGF0YS1sYXllclwiOiBcIlVJTGF5ZXJcIn0pXHJcbiAgICB9XHJcbiAgICBjcmVhdGVTZWN0aW9uSW5kaWNhdG9yKCl7XHJcbiAgICAgICAgbGV0IG5ld1NxdWFyZSA9IHRoaXMuY3JlYXRlUmVjdCgwLCAwLCAwLCAwLCAwLFwicmdiYSgwLCAyNTUsIDI1NSwgMClcIik7XHJcbiAgICAgICAgLy91dGlscy5zZXRBdHRyaWJ1dGVzKG5ld1NxdWFyZSwge3N0eWxlOiBcImRpc3BsYXk6IG5vbmVcIn0pO1xyXG4gICAgICAgIHRoaXMuc2VjdGlvbkluZGljYXRvci5wdXNoKG5ld1NxdWFyZSk7XHJcbiAgICAgICAgcmV0dXJuIG5ld1NxdWFyZTtcclxuICAgIH1cclxuICAgIGhpZ2h0TGlnaHRTZWN0aW9uKHNlY3Rpb246IG51bWJlcil7XHJcbiAgICAgICAgdXRpbHMuc2V0QXR0cmlidXRlcyh0aGlzLnNlY3Rpb25JbmRpY2F0b3Jbc2VjdGlvbl0uZG9tRWxlbWVudCwge2ZpbGw6IFwicmdiYSgwLCAyNTUsIDI1NSwgMC4xMylcIn0pO1xyXG4gICAgfVxyXG4gICAgaGlkZVNlY3Rpb25JbmRpY2F0b3Ioc2VjdGlvbjogbnVtYmVyKXtcclxuICAgICAgICB1dGlscy5zZXRBdHRyaWJ1dGVzKHRoaXMuc2VjdGlvbkluZGljYXRvcltzZWN0aW9uXS5kb21FbGVtZW50LCB7ZmlsbDogXCJyZ2JhKDAsIDI1NSwgMjU1LCAwKVwifSk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBMYXllcnMge1xyXG4gICAgcmVhZG9ubHkgYmFja2dyb3VuZDogTGF5ZXI7XHJcbiAgICByZWFkb25seSBzaGVldDogU2hlZXRMYXllcjtcclxuICAgIHJlYWRvbmx5IG5vdGVzOiBOb3RlTGF5ZXI7XHJcbiAgICByZWFkb25seSBmb3JlZ3JvdW5kOiBMYXllcjtcclxuICAgIGNvbnN0cnVjdG9yKCl7XHJcbiAgICAgICAgdGhpcy5iYWNrZ3JvdW5kID0gbmV3IExheWVyKCk7XHJcbiAgICAgICAgdGhpcy5zaGVldCA9IG5ldyBTaGVldExheWVyKCk7XHJcbiAgICAgICAgdGhpcy5ub3RlcyA9IG5ldyBOb3RlTGF5ZXIoKTtcclxuICAgICAgICB0aGlzLmZvcmVncm91bmQgPSBuZXcgTGF5ZXIoKTtcclxuICAgIH1cclxuICAgIGdldCBmbGF0dGVuZWQoKTogTGF5ZXJbXSB7XHJcbiAgICAgICAgcmV0dXJuIFt0aGlzLmJhY2tncm91bmQsIHRoaXMuc2hlZXQsIHRoaXMubm90ZXMsIHRoaXMuZm9yZWdyb3VuZF07XHJcbiAgICB9XHJcblxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgU0xMYXllciBleHRlbmRzIExheWVyc3tcclxuICAgIHJlYWRvbmx5IHVpOiBVSUxheWVyO1xyXG4gICAgY29uc3RydWN0b3IoKXtcclxuICAgICAgICBzdXBlcigpO1xyXG4gICAgICAgIHRoaXMudWkgPSBuZXcgVUlMYXllcigpO1xyXG4gICAgfVxyXG4gICAgZ2V0IGZsYXR0ZW5lZCgpOiBMYXllcltdIHtcclxuICAgICAgICByZXR1cm4gW3RoaXMuYmFja2dyb3VuZCwgdGhpcy5zaGVldCwgdGhpcy51aSwgdGhpcy5ub3RlcywgdGhpcy5mb3JlZ3JvdW5kXTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIFNMQ2FudmFzPFQgZXh0ZW5kcyBMYXllcnM+IHtcclxuICAgIHJlYWRvbmx5IGRvbUVsZW1lbnQ6IFNWR0VsZW1lbnQ7XHJcbiAgICByZWFkb25seSBsYXllcnM6IFQ7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBsYXllclR5cGU6IG5ldyAoKSA9PiBUKSB7XHJcbiAgICAgICAgdGhpcy5sYXllcnMgPSBuZXcgbGF5ZXJUeXBlKCk7XHJcblxyXG4gICAgICAgIHRoaXMuZG9tRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLFwic3ZnXCIpO1xyXG4gICAgICAgIHV0aWxzLnNldFN0eWxlKDxIVE1MRWxlbWVudD48dW5rbm93bj50aGlzLmRvbUVsZW1lbnQsIHtcInVzZXItc2VsZWN0XCI6IFwibm9uZVwiLCBcIm91dGxpbmVcIjogXCJub25lXCJ9KTtcclxuXHJcbiAgICAgICAgdGhpcy5sYXllcnMuZmxhdHRlbmVkLmZvckVhY2gobGF5ZXIgPT4gdGhpcy5kb21FbGVtZW50LmFwcGVuZENoaWxkKGxheWVyLmRvbUVsZW1lbnQpKTtcclxuICAgIH1cclxufSJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQVNBO0FBWUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVVBO0FBUkE7QUFDQTtBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBS0E7QUFEQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFEQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBS0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFLQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFHQTtBQUNBO0FBSEE7QUFDQTtBQUdBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTRDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUdBO0FBQ0E7QUFIQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBRkE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFJQTtBQUFBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/SlimTabV2Canvas.ts\n");

/***/ }),

/***/ "./src/SlimTabV2Editor.ts":
/*!********************************!*\
  !*** ./src/SlimTabV2Editor.ts ***!
  \********************************/
/*! exports provided: SLEditor */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"SLEditor\", function() { return SLEditor; });\n/* harmony import */ var _SlimTabV2Types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./SlimTabV2Types */ \"./src/SlimTabV2Types.ts\");\n\r\nclass SLEditor {\r\n    constructor(controlTab) {\r\n        this.inputBlock = 0;\r\n        this.mouseDown = false;\r\n        this.mouseMove = false;\r\n        this.selectNotesIndicator = [];\r\n        this.selectNotesIndicatorPadding = 8;\r\n        this.controlTab = controlTab;\r\n        this.indicator = this.controlTab.tabCanvas.layers.ui.createEllipse(0, 0, 8, 8);\r\n        this.shadowIndicator = this.controlTab.tabCanvas.layers.ui.createEllipse(0, 0, 8, 8);\r\n        this.indicator.cx = -20;\r\n        this.indicator.cy = -20;\r\n        this.indicator.fill = \"rgb(255, 50, 0)\";\r\n        this.shadowIndicator.cx = -20;\r\n        this.shadowIndicator.cy = -20;\r\n        this.shadowIndicator.fill = \"rgba(255, 50, 0, 0.6)\";\r\n        this.dragNDropSection = this.controlTab.tabCanvas.layers.ui.createRect(0, 0, 0, 0, 0, \"rgba(255, 50, 0, 0.6)\");\r\n        this.setEvents();\r\n    }\r\n    get selectedNote() {\r\n        return this.selectedSVGNote;\r\n    }\r\n    get SelectedNotes() {\r\n        return this.selectedSVGNotes;\r\n    }\r\n    undisplayIndicator() {\r\n        this.indicator.style = { display: \"none\" };\r\n        this.shadowIndicator.style = { display: \"none\" };\r\n        this.selectNotesIndicator.forEach((elem, index, self) => {\r\n            elem.style = { display: \"none\" };\r\n        });\r\n    }\r\n    displayIndicator() {\r\n        this.indicator.style = { display: \"unset\" };\r\n        this.shadowIndicator.style = { display: \"unset\" };\r\n        this.selectNotesIndicator.forEach((elem, index, self) => {\r\n            elem.style = { display: \"unset\" };\r\n        });\r\n    }\r\n    resetIndicator() {\r\n        this.selectedBlock = null;\r\n        this.unselectNoteBlock();\r\n    }\r\n    setEvents() {\r\n        this.controlTab.on(\"noteclick\", (section, note, string, position) => {\r\n            this.selectNoteAndMoveIndicator(section, note, string);\r\n            this.selectedSVGNote = this.controlTab.getSVGNote(section, note);\r\n            this.unselectSVGNotes();\r\n        });\r\n        this.controlTab.on(\"noteshiftclick\", (section, note, string, position) => {\r\n            this.unselectSVGNotes();\r\n            this.controlTab.getSVGNote(section, note);\r\n            this.selectedSVGNotes = this.controlTab.endsSelect(this.controlTab.noteIndex(this.selectedSVGNote), this.controlTab.noteIndex(this.controlTab.getSVGNote(section, note)));\r\n            this.drawMultiSelectRect(this.selectedSVGNotes);\r\n        });\r\n        this.controlTab.on(\"keydown\", (key, keyCode) => {\r\n            if (key.toLowerCase() !== \" \" && !isNaN(Number(key))) {\r\n                if (this.selectedBlock) {\r\n                    let tb = this.inputBlock * 10 + Number(key);\r\n                    if (tb < 40) {\r\n                        this.inputBlock = tb;\r\n                    }\r\n                    else {\r\n                        this.inputBlock = Number(key);\r\n                    }\r\n                    this.controlTab.setStringDataOfNote(this.selectedBlock.section, this.selectedBlock.note, this.selectedBlock.string, this.inputBlock);\r\n                    this.controlTab.render();\r\n                }\r\n            }\r\n            else {\r\n                this.inputBlock = 0;\r\n            }\r\n            if (key.toLowerCase() === \"d\" || key.toLowerCase() === \"arrowright\") {\r\n                if (this.selectedSVGNotes.length > 0) {\r\n                    let rightSideBlock = this.selectedSVGNotes[this.selectedSVGNotes.length - 1].blockGroup[0];\r\n                    this.selectedBlock = { section: rightSideBlock.section, note: rightSideBlock.note, string: rightSideBlock.string };\r\n                    this.unselectSVGNotes();\r\n                }\r\n                if (this.selectedBlock) {\r\n                    this.selectRight(this.selectedBlock, this.controlTab);\r\n                }\r\n            }\r\n            if (key.toLowerCase() === \"a\" || key.toLowerCase() === \"arrowleft\") {\r\n                if (this.selectedSVGNotes.length > 0) {\r\n                    let leftSideBlock = this.selectedSVGNotes[0].blockGroup[0];\r\n                    this.selectedBlock = { section: leftSideBlock.section, note: leftSideBlock.note, string: leftSideBlock.string };\r\n                    this.unselectSVGNotes();\r\n                }\r\n                if (this.selectedBlock) {\r\n                    this.selectLeft(this.selectedBlock, this.controlTab);\r\n                }\r\n            }\r\n            if (key.toLowerCase() === \"w\" || key.toLowerCase() === \"arrowup\") {\r\n                if (this.selectedSVGNotes.length > 0) {\r\n                    let rightSideBlock = this.selectedSVGNotes[this.selectedSVGNotes.length - 1].blockGroup[0];\r\n                    this.selectedBlock = { section: rightSideBlock.section, note: rightSideBlock.note, string: rightSideBlock.string };\r\n                    this.unselectSVGNotes();\r\n                }\r\n                if (this.selectedBlock) {\r\n                    this.selectUp(this.selectedBlock, this.controlTab);\r\n                }\r\n            }\r\n            if (key.toLowerCase() === \"s\" || key.toLowerCase() === \"arrowdown\") {\r\n                if (this.selectedSVGNotes.length > 0) {\r\n                    let rightSideBlock = this.selectedSVGNotes[this.selectedSVGNotes.length - 1].blockGroup[0];\r\n                    this.selectedBlock = { section: rightSideBlock.section, note: rightSideBlock.note, string: rightSideBlock.string };\r\n                    this.unselectSVGNotes();\r\n                }\r\n                if (this.selectedBlock) {\r\n                    this.selectDown(this.selectedBlock, this.controlTab);\r\n                }\r\n            }\r\n            if (key.toLowerCase() === \"i\") {\r\n                if (this.selectedSVGNotes.length > 0) {\r\n                    this.selectedBlock = { section: this.selectedSVGNotes[0].section, note: this.selectedSVGNotes[0].note, string: 0 };\r\n                    this.unselectSVGNotes();\r\n                }\r\n                if (this.selectedBlock) {\r\n                    let emptyNote = this.insertEmptyNote(this.selectedBlock);\r\n                    this.controlTab.render();\r\n                    this.selectNoteAndMoveIndicator(emptyNote.section, emptyNote.note, emptyNote.string);\r\n                }\r\n                this.controlTab.render();\r\n            }\r\n            if (key.toLowerCase() === \"delete\" || key.toLowerCase() === \"backspace\") {\r\n                if (this.selectedSVGNotes.length > 0) {\r\n                    for (let i = this.selectedSVGNotes.length - 1; i >= 0; i--) {\r\n                        this.controlTab.deleteNote(this.selectedSVGNotes[i].section, this.selectedSVGNotes[i].note);\r\n                        this.controlTab.render();\r\n                    }\r\n                    this.unselectSVGNotes();\r\n                }\r\n                else if (this.selectedBlock) {\r\n                    this.deleteNoteBlock(this.selectedBlock, this.controlTab);\r\n                }\r\n            }\r\n            if (key.toLowerCase() === \"+\") {\r\n                this.changeNoteLength(\"+\");\r\n            }\r\n            if (key.toLowerCase() === \"-\") {\r\n                this.changeNoteLength(\"-\");\r\n            }\r\n            if (keyCode === 110 || keyCode === 190) { // press \".\"\r\n                if (this.selectedBlock) {\r\n                    let data = this.controlTab.getNoteData(this.selectedBlock.section, this.selectedBlock.note);\r\n                    if (Math.floor(data[0]) === data[0]) {\r\n                        data[0] = 2 * data[0] / 3;\r\n                    }\r\n                    else {\r\n                        data[0] = data[0] * 3 / 2;\r\n                    }\r\n                    this.controlTab.setNoteData(this.selectedBlock.section, this.selectedBlock.note, data);\r\n                    this.controlTab.render();\r\n                    this.selectNoteAndMoveIndicator(this.selectedBlock.section, this.selectedBlock.note, this.selectedBlock.string);\r\n                }\r\n            }\r\n        });\r\n        this.controlTab.on(\"mouseovernote\", (section, note, string, position) => {\r\n            this.shadowIndicator.cx = position[0];\r\n            this.shadowIndicator.cy = position[1];\r\n        });\r\n        this.controlTab.on(\"mouseoutnote\", (section, note, string, position) => {\r\n            this.shadowIndicator.cx = -20;\r\n            this.shadowIndicator.cy = -20;\r\n        });\r\n        this.controlTab.on(\"mousedown\", (x, y) => {\r\n            y += this.controlTab.domElement.scrollTop;\r\n            if (this.dragNDropSection != null) {\r\n                this.dragNDropSection.remove();\r\n            }\r\n            this.dragNDropSection = this.controlTab.tabCanvas.layers.ui.createRect(0, 0, 0, 0, 5, \"rgba(255, 50, 0, 0.6)\");\r\n            this.dragStartPos = [x, y];\r\n            this.dragNDropSection.style = { display: \"none\" };\r\n            this.mouseDown = true;\r\n            this.mouseMove = false;\r\n            this.unselectSVGNotes();\r\n        });\r\n        //Mouse move event, handle with all quadrant of direction.\r\n        this.controlTab.on(\"mousemove\", (x, y) => {\r\n            y += this.controlTab.domElement.scrollTop;\r\n            if (this.mouseDown) {\r\n                if (Math.sqrt(Math.pow(x - this.dragStartPos[0], 2) + Math.pow(y - this.dragStartPos[1], 2)) > 1) {\r\n                    this.mouseMove = true;\r\n                    //Clear the empty note when clicking \r\n                    if (this.selectedBlock && this.controlTab.isBlankNote(this.selectedBlock.section, this.selectedBlock.note)) {\r\n                        this.controlTab.deleteNote(this.selectedBlock.section, this.selectedBlock.note);\r\n                        this.unselectNoteBlock();\r\n                        this.controlTab.render();\r\n                    }\r\n                }\r\n                if (this.mouseMove) {\r\n                    if (x - this.dragStartPos[0] >= 0) {\r\n                        this.dragNDropSection.x = this.dragStartPos[0];\r\n                    }\r\n                    else {\r\n                        this.dragNDropSection.x = x;\r\n                    }\r\n                    if (y - this.dragStartPos[1] >= 0) {\r\n                        this.dragNDropSection.y = this.dragStartPos[1];\r\n                    }\r\n                    else {\r\n                        this.dragNDropSection.y = y;\r\n                    }\r\n                    this.dragNDropSection.setShape(Math.abs(x - this.dragStartPos[0]), Math.abs(y - this.dragStartPos[1]));\r\n                    this.dragNDropSection.style = { display: \"unset\" };\r\n                }\r\n            }\r\n        });\r\n        this.controlTab.on(\"mouseup\", (x, y) => {\r\n            y += this.controlTab.domElement.scrollTop;\r\n            this.mouseDown = false;\r\n            if (this.mouseMove) {\r\n                let x1;\r\n                let y1;\r\n                let x2;\r\n                let y2;\r\n                this.dragNDropSection.remove();\r\n                if (x >= this.dragStartPos[0]) {\r\n                    x1 = this.dragStartPos[0];\r\n                    x2 = x;\r\n                }\r\n                else {\r\n                    x1 = x;\r\n                    x2 = this.dragStartPos[0];\r\n                }\r\n                if (y >= this.dragStartPos[1]) {\r\n                    y1 = this.dragStartPos[1];\r\n                    y2 = y;\r\n                }\r\n                else {\r\n                    y1 = y;\r\n                    y2 = this.dragStartPos[1];\r\n                }\r\n                this.selectedSVGNotes = this.controlTab.areaSelect(x1, y1, x2, y2);\r\n                this.drawMultiSelectRect(this.selectedSVGNotes);\r\n            }\r\n        });\r\n        this.controlTab.on(\"sectionhover\", (section) => {\r\n            this.controlTab.tabCanvas.layers.ui.hightLightSection(section);\r\n        });\r\n        this.controlTab.on(\"sectionhout\", (section) => {\r\n            this.controlTab.tabCanvas.layers.ui.hideSectionIndicator(section);\r\n        });\r\n        this.controlTab.on(\"sectionclick\", (section, string) => {\r\n            this.selectNoteAndMoveIndicator(section, this.controlTab.getNoteNumberOfSection(section) - 1, string);\r\n            if (this.selectedBlock &&\r\n                this.selectedBlock.section === section &&\r\n                this.selectedBlock.note === this.controlTab.getNoteNumberOfSection(section) - 1 &&\r\n                this.controlTab.isBlankNote(section, this.selectedBlock.note)) {\r\n                return;\r\n            }\r\n            this.controlTab.addNote(section, -1, new _SlimTabV2Types__WEBPACK_IMPORTED_MODULE_0__[\"Note\"]());\r\n            this.controlTab.render();\r\n            this.selectNoteAndMoveIndicator(section, this.controlTab.getNoteNumberOfSection(section) - 1, string);\r\n        });\r\n    }\r\n    selectNoteAndMoveIndicator(section, note, string) {\r\n        let sp = this.controlTab.getSectionLeftTopPos(section);\r\n        let np = this.controlTab.getNotePosition(section, note, string);\r\n        if (np[0] === -1)\r\n            return false;\r\n        if (this.selectedBlock && (this.selectedBlock.section != section || this.selectedBlock.note != note)) {\r\n            if (this.controlTab.getNoteNumberOfSection(this.selectedBlock.section) > 1 && this.controlTab.isBlankNote(this.selectedBlock.section, this.selectedBlock.note)) {\r\n                this.controlTab.deleteNote(this.selectedBlock.section, this.selectedBlock.note);\r\n                this.controlTab.render();\r\n                if (this.selectedBlock.section === section && this.selectedBlock.note < note)\r\n                    note--;\r\n                sp = this.controlTab.getSectionLeftTopPos(section);\r\n                np = this.controlTab.getNotePosition(section, note, string);\r\n            }\r\n        }\r\n        this.setSelectNote(section, note, string);\r\n        this.setIndicator(np);\r\n        this.controlTab.adjustPostion(sp[1]);\r\n        return true;\r\n    }\r\n    setSelectNote(section, note, string) {\r\n        this.selectedBlock = { section: section, note: note, string: string };\r\n    }\r\n    setIndicator(position) {\r\n        this.indicator.cx = position[0];\r\n        this.indicator.cy = position[1];\r\n    }\r\n    changeNoteLength(operater) {\r\n        let factor;\r\n        if (operater === \"+\") {\r\n            factor = 1;\r\n        }\r\n        else if (operater === \"-\") {\r\n            factor = 0;\r\n        }\r\n        else {\r\n            return;\r\n        }\r\n        if (this.selectedBlock) {\r\n            let lengthArray = [1, 2, 4, 8, 16, 32];\r\n            let selectData = this.controlTab.getNoteData(this.selectedBlock.section, this.selectedBlock.note);\r\n            for (let i = 1 - factor; i < lengthArray.length - factor; i++) {\r\n                if (lengthArray[i] >= selectData[0]) {\r\n                    selectData[0] = lengthArray[i - 1 + factor * 2];\r\n                    this.controlTab.setNoteData(this.selectedBlock.section, this.selectedBlock.note, selectData);\r\n                    this.controlTab.render();\r\n                    this.selectNoteAndMoveIndicator(this.selectedBlock.section, this.selectedBlock.note, this.selectedBlock.string);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    selectRight(selectNote, controlTab) {\r\n        let s = this.selectNoteAndMoveIndicator(selectNote.section, selectNote.note + 1, selectNote.string);\r\n        if (!s) { // the current selection is the last note of the section\r\n            if (controlTab.isBlankNote(selectNote.section, selectNote.note)) {\r\n                s = this.selectNoteAndMoveIndicator(selectNote.section + 1, 0, selectNote.string);\r\n                if (!s) { // the current selection is the last section and the last note\r\n                    controlTab.addNote(selectNote.section + 1, 0, new _SlimTabV2Types__WEBPACK_IMPORTED_MODULE_0__[\"Note\"]());\r\n                    controlTab.render();\r\n                    this.selectNoteAndMoveIndicator(selectNote.section + 1, 0, selectNote.string);\r\n                }\r\n            }\r\n            else {\r\n                controlTab.addNote(selectNote.section, selectNote.note + 1, new _SlimTabV2Types__WEBPACK_IMPORTED_MODULE_0__[\"Note\"]());\r\n                controlTab.render();\r\n                this.selectNoteAndMoveIndicator(selectNote.section, selectNote.note + 1, selectNote.string);\r\n            }\r\n        }\r\n    }\r\n    selectLeft(selectNoteBlock, controlTab) {\r\n        if (selectNoteBlock.note === 0) {\r\n            if (controlTab.isBlankNote(selectNoteBlock.section, selectNoteBlock.note)) {\r\n                if (selectNoteBlock.section > 0) {\r\n                    this.selectNoteAndMoveIndicator(selectNoteBlock.section - 1, this.controlTab.getNoteNumberOfSection(selectNoteBlock.section - 1) - 1, selectNoteBlock.string);\r\n                }\r\n            }\r\n            else {\r\n                controlTab.addNote(selectNoteBlock.section, 0, new _SlimTabV2Types__WEBPACK_IMPORTED_MODULE_0__[\"Note\"]());\r\n                controlTab.render();\r\n                this.selectNoteAndMoveIndicator(selectNoteBlock.section, 0, selectNoteBlock.string);\r\n            }\r\n        }\r\n        else {\r\n            this.selectNoteAndMoveIndicator(selectNoteBlock.section, selectNoteBlock.note - 1, selectNoteBlock.string);\r\n        }\r\n    }\r\n    selectUp(selectNoteBlock, controlTab) {\r\n        if (selectNoteBlock.string > 0) {\r\n            this.selectNoteAndMoveIndicator(selectNoteBlock.section, selectNoteBlock.note, selectNoteBlock.string - 1);\r\n        }\r\n    }\r\n    selectDown(selectNoteBlock, controlTab) {\r\n        if (selectNoteBlock.string < 5) {\r\n            this.selectNoteAndMoveIndicator(selectNoteBlock.section, selectNoteBlock.note, selectNoteBlock.string + 1);\r\n        }\r\n    }\r\n    insertEmptyNote(selectedBlock) {\r\n        if (!this.controlTab.isBlankNote(this.selectedBlock.section, this.selectedBlock.note)) {\r\n            this.controlTab.addNote(this.selectedBlock.section, this.selectedBlock.note, new _SlimTabV2Types__WEBPACK_IMPORTED_MODULE_0__[\"Note\"]());\r\n            this.selectedBlock = { section: this.selectedBlock.section, note: this.selectedBlock.note, string: this.selectedBlock.string };\r\n        }\r\n        return this.selectedBlock;\r\n    }\r\n    deleteNoteBlock(selectNoteBlock, controlTab) {\r\n        this.controlTab.setStringDataOfNote(selectNoteBlock.section, selectNoteBlock.note, selectNoteBlock.string, -1);\r\n        controlTab.render();\r\n    }\r\n    drawMultiSelectRect(selectedSVGNotes) {\r\n        //Sort out the selected lines.\r\n        let selectedLines = [];\r\n        for (let i = 0; i < selectedSVGNotes.length; i++) {\r\n            selectedLines.push(selectedSVGNotes[i].line);\r\n        }\r\n        let uniqueSelectedLines = selectedLines.filter(function (elem, index, self) {\r\n            return index == self.indexOf(elem);\r\n        });\r\n        if (selectedSVGNotes.length > 0) {\r\n            this.unselectNoteBlock();\r\n            let lineNotes = [];\r\n            for (let i = 0; i < uniqueSelectedLines.length; i++) {\r\n                let pushNotes = selectedSVGNotes.filter(function (elem, index, self) {\r\n                    return elem.line == uniqueSelectedLines[i];\r\n                });\r\n                lineNotes.push({ lineIndex: uniqueSelectedLines[i], notes: pushNotes });\r\n            }\r\n            for (let i = 0; i < lineNotes.length; i++) {\r\n                //let rectIndicatorLT = this.selectedNotes[0].blockGroup[0];\r\n                let rectIndicatorLT = lineNotes[i].notes[0].blockGroup[0];\r\n                //Indicator's right bottom note, which provideds position.\r\n                //let rectIndicatorRB = this.selectedNotes[this.selectedNotes.length-1].blockGroup[this.selectedNotes[this.selectedNotes.length-1].blockGroup.length-1];\r\n                let rectIndicatorRB = lineNotes[i].notes[lineNotes[i].notes.length - 1].blockGroup[lineNotes[i].notes[lineNotes[i].notes.length - 1].blockGroup.length - 1];\r\n                this.selectNotesIndicator.push(this.controlTab.tabCanvas.layers.ui.createRect(rectIndicatorLT.x - this.selectNotesIndicatorPadding, rectIndicatorLT.y - this.selectNotesIndicatorPadding, rectIndicatorRB.x - rectIndicatorLT.x + 2 * this.selectNotesIndicatorPadding, rectIndicatorRB.y - rectIndicatorLT.y + 2 * this.selectNotesIndicatorPadding, 5, \"rgba(255, 182, 45, 0.6)\"));\r\n            }\r\n        }\r\n    }\r\n    unselectSVGNotes() {\r\n        this.selectedSVGNotes = [];\r\n        if (this.selectNotesIndicator.length > 0) {\r\n            this.selectNotesIndicator.forEach((elem, index, self) => {\r\n                elem.remove();\r\n            });\r\n        }\r\n    }\r\n    unselectNoteBlock() {\r\n        this.selectedBlock = null;\r\n        this.setIndicator([-20, -20]);\r\n    }\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvU2xpbVRhYlYyRWRpdG9yLnRzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vc3JjL1NsaW1UYWJWMkVkaXRvci50cz9jNGUyIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5vdGUgfSBmcm9tIFwiLi9TbGltVGFiVjJUeXBlc1wiXHJcbmltcG9ydCB7IFNMVGFiIH0gZnJvbSBcIi4vU2xpbVRhYlYyXCJcclxuaW1wb3J0IHsgdXRpbHMgfSBmcm9tIFwiLi91dGlsc1wiO1xyXG5pbXBvcnQgeyBSZWN0LCBFbGxpcHNlLCBUZXh0LCBMaW5lLCBTVkdOb3RlLCBOb3RlQmxvY2t9IGZyb20gXCIuL1NsaW1UYWJWMkNhbnZhc1wiXHJcblxyXG5pbnRlcmZhY2UgTm90ZUJsb2NrSW5kZXh7XHJcbiAgICBzZWN0aW9uOiBudW1iZXI7XHJcbiAgICBub3RlOiBudW1iZXI7XHJcbiAgICBzdHJpbmc6IG51bWJlcjtcclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIFNMRWRpdG9yIHtcclxuICAgIHByaXZhdGUgc2VsZWN0ZWRCbG9jazogTm90ZUJsb2NrSW5kZXg7XHJcbiAgICBwcml2YXRlIHNlbGVjdGVkU1ZHTm90ZTogU1ZHTm90ZTtcclxuICAgIHByaXZhdGUgY29udHJvbFRhYjogU0xUYWI7XHJcbiAgICBwcml2YXRlIGluZGljYXRvcjogRWxsaXBzZTtcclxuICAgIHByaXZhdGUgc2hhZG93SW5kaWNhdG9yOiBFbGxpcHNlO1xyXG4gICAgcHJpdmF0ZSBpbnB1dEJsb2NrOiBudW1iZXIgPSAwO1xyXG4gICAgcHJpdmF0ZSBkcmFnTkRyb3BTZWN0aW9uOiBSZWN0O1xyXG4gICAgcHJpdmF0ZSBkcmFnU3RhcnRQb3M6IG51bWJlcltdO1xyXG4gICAgcHJpdmF0ZSBzZWxlY3RlZFNWR05vdGVzOiBTVkdOb3RlW107XHJcbiAgICBwcml2YXRlIG1vdXNlRG93bjogYm9vbGVhbiA9IGZhbHNlO1xyXG4gICAgcHJpdmF0ZSBtb3VzZU1vdmU6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgIHByaXZhdGUgc2VsZWN0Tm90ZXNJbmRpY2F0b3I6IFJlY3RbXSA9IFtdO1xyXG4gICAgcHJpdmF0ZSBzZWxlY3ROb3Rlc0luZGljYXRvclBhZGRpbmc6IG51bWJlciA9IDg7XHJcblxyXG4gICAgY29uc3RydWN0b3IoY29udHJvbFRhYjogU0xUYWIpe1xyXG4gICAgICAgIHRoaXMuY29udHJvbFRhYiA9IGNvbnRyb2xUYWI7XHJcbiAgICAgICAgdGhpcy5pbmRpY2F0b3IgPSB0aGlzLmNvbnRyb2xUYWIudGFiQ2FudmFzLmxheWVycy51aS5jcmVhdGVFbGxpcHNlKDAsIDAgLCA4LCA4KTtcclxuICAgICAgICB0aGlzLnNoYWRvd0luZGljYXRvciA9IHRoaXMuY29udHJvbFRhYi50YWJDYW52YXMubGF5ZXJzLnVpLmNyZWF0ZUVsbGlwc2UoMCwgMCAsIDgsIDgpO1xyXG4gICAgICAgIHRoaXMuaW5kaWNhdG9yLmN4ID0gLTIwO1xyXG4gICAgICAgIHRoaXMuaW5kaWNhdG9yLmN5ID0gLTIwO1xyXG4gICAgICAgIHRoaXMuaW5kaWNhdG9yLmZpbGwgPSBcInJnYigyNTUsIDUwLCAwKVwiXHJcbiAgICAgICAgdGhpcy5zaGFkb3dJbmRpY2F0b3IuY3ggPSAtMjA7XHJcbiAgICAgICAgdGhpcy5zaGFkb3dJbmRpY2F0b3IuY3kgPSAtMjA7XHJcbiAgICAgICAgdGhpcy5zaGFkb3dJbmRpY2F0b3IuZmlsbCA9IFwicmdiYSgyNTUsIDUwLCAwLCAwLjYpXCI7XHJcbiAgICAgICAgdGhpcy5kcmFnTkRyb3BTZWN0aW9uID0gdGhpcy5jb250cm9sVGFiLnRhYkNhbnZhcy5sYXllcnMudWkuY3JlYXRlUmVjdCgwLCAwLCAwLCAwLCAwLCBcInJnYmEoMjU1LCA1MCwgMCwgMC42KVwiKTtcclxuICAgICAgICB0aGlzLnNldEV2ZW50cygpO1xyXG4gICAgfVxyXG4gICAgZ2V0IHNlbGVjdGVkTm90ZSgpOiBTVkdOb3Rle1xyXG4gICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGVkU1ZHTm90ZTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgU2VsZWN0ZWROb3RlcygpOlNWR05vdGVbXXtcclxuICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3RlZFNWR05vdGVzO1xyXG4gICAgfVxyXG5cclxuICAgIHVuZGlzcGxheUluZGljYXRvcigpe1xyXG4gICAgICAgIHRoaXMuaW5kaWNhdG9yLnN0eWxlID0ge2Rpc3BsYXk6IFwibm9uZVwifTtcclxuICAgICAgICB0aGlzLnNoYWRvd0luZGljYXRvci5zdHlsZSA9IHtkaXNwbGF5OiBcIm5vbmVcIn07XHJcbiAgICAgICAgdGhpcy5zZWxlY3ROb3Rlc0luZGljYXRvci5mb3JFYWNoKChlbGVtLCBpbmRleCwgc2VsZikgPT57XHJcbiAgICAgICAgICAgIGVsZW0uc3R5bGUgPSB7ZGlzcGxheTogXCJub25lXCJ9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgZGlzcGxheUluZGljYXRvcigpe1xyXG4gICAgICAgIHRoaXMuaW5kaWNhdG9yLnN0eWxlID0ge2Rpc3BsYXk6IFwidW5zZXRcIn07XHJcbiAgICAgICAgdGhpcy5zaGFkb3dJbmRpY2F0b3Iuc3R5bGUgPSB7ZGlzcGxheTogXCJ1bnNldFwifTtcclxuICAgICAgICB0aGlzLnNlbGVjdE5vdGVzSW5kaWNhdG9yLmZvckVhY2goKGVsZW0sIGluZGV4LCBzZWxmKSA9PntcclxuICAgICAgICAgICAgZWxlbS5zdHlsZSA9IHtkaXNwbGF5OiBcInVuc2V0XCJ9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVzZXRJbmRpY2F0b3IoKXtcclxuICAgICAgICB0aGlzLnNlbGVjdGVkQmxvY2sgPSBudWxsO1xyXG4gICAgICAgIHRoaXMudW5zZWxlY3ROb3RlQmxvY2soKTtcclxuICAgIH1cclxuICAgIHByaXZhdGUgc2V0RXZlbnRzKCl7XHJcbiAgICAgICAgdGhpcy5jb250cm9sVGFiLm9uKFwibm90ZWNsaWNrXCIsIChzZWN0aW9uLCBub3RlLCBzdHJpbmcsIHBvc2l0aW9uKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0Tm90ZUFuZE1vdmVJbmRpY2F0b3Ioc2VjdGlvbiwgbm90ZSwgc3RyaW5nKTtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZFNWR05vdGUgPSB0aGlzLmNvbnRyb2xUYWIuZ2V0U1ZHTm90ZShzZWN0aW9uLCBub3RlKTtcclxuICAgICAgICAgICAgdGhpcy51bnNlbGVjdFNWR05vdGVzKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5jb250cm9sVGFiLm9uKFwibm90ZXNoaWZ0Y2xpY2tcIiwgKHNlY3Rpb24sIG5vdGUsIHN0cmluZywgcG9zaXRpb24pID0+IHtcclxuICAgICAgICAgICAgdGhpcy51bnNlbGVjdFNWR05vdGVzKCk7XHJcbiAgICAgICAgICAgIHRoaXMuY29udHJvbFRhYi5nZXRTVkdOb3RlKHNlY3Rpb24sIG5vdGUpXHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRTVkdOb3RlcyA9IHRoaXMuY29udHJvbFRhYi5lbmRzU2VsZWN0KHRoaXMuY29udHJvbFRhYi5ub3RlSW5kZXgodGhpcy5zZWxlY3RlZFNWR05vdGUpLCB0aGlzLmNvbnRyb2xUYWIubm90ZUluZGV4KHRoaXMuY29udHJvbFRhYi5nZXRTVkdOb3RlKHNlY3Rpb24sIG5vdGUpKSlcclxuICAgICAgICAgICAgdGhpcy5kcmF3TXVsdGlTZWxlY3RSZWN0KHRoaXMuc2VsZWN0ZWRTVkdOb3Rlcyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5jb250cm9sVGFiLm9uKFwia2V5ZG93blwiLCAoa2V5LCBrZXlDb2RlKSA9PiB7XHJcbiAgICAgICAgICAgIGlmKCg8c3RyaW5nPmtleSkudG9Mb3dlckNhc2UoKSAhPT0gXCIgXCIgJiYgIWlzTmFOKE51bWJlcihrZXkpKSl7XHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLnNlbGVjdGVkQmxvY2spe1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCB0YiA9IHRoaXMuaW5wdXRCbG9jayAqIDEwICsgTnVtYmVyKGtleSlcclxuICAgICAgICAgICAgICAgICAgICBpZih0YiA8IDQwKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnB1dEJsb2NrID0gdGI7XHJcbiAgICAgICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5wdXRCbG9jayA9IE51bWJlcihrZXkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xUYWIuc2V0U3RyaW5nRGF0YU9mTm90ZSh0aGlzLnNlbGVjdGVkQmxvY2suc2VjdGlvbiwgdGhpcy5zZWxlY3RlZEJsb2NrLm5vdGUsIHRoaXMuc2VsZWN0ZWRCbG9jay5zdHJpbmcsIHRoaXMuaW5wdXRCbG9jayk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250cm9sVGFiLnJlbmRlcigpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5wdXRCbG9jayA9IDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYoKDxzdHJpbmc+a2V5KS50b0xvd2VyQ2FzZSgpID09PSBcImRcIiB8fCAoPHN0cmluZz5rZXkpLnRvTG93ZXJDYXNlKCkgPT09IFwiYXJyb3dyaWdodFwiKXtcclxuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2VsZWN0ZWRTVkdOb3Rlcy5sZW5ndGggPiAwKXtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgcmlnaHRTaWRlQmxvY2sgPSB0aGlzLnNlbGVjdGVkU1ZHTm90ZXNbdGhpcy5zZWxlY3RlZFNWR05vdGVzLmxlbmd0aC0xXS5ibG9ja0dyb3VwWzBdXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEJsb2NrID0ge3NlY3Rpb246IHJpZ2h0U2lkZUJsb2NrLnNlY3Rpb24sIG5vdGU6cmlnaHRTaWRlQmxvY2subm90ZSwgc3RyaW5nOiByaWdodFNpZGVCbG9jay5zdHJpbmd9XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51bnNlbGVjdFNWR05vdGVzKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLnNlbGVjdGVkQmxvY2spe1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0UmlnaHQodGhpcy5zZWxlY3RlZEJsb2NrLCB0aGlzLmNvbnRyb2xUYWIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKCg8c3RyaW5nPmtleSkudG9Mb3dlckNhc2UoKSA9PT0gXCJhXCIgfHwgKDxzdHJpbmc+a2V5KS50b0xvd2VyQ2FzZSgpID09PSBcImFycm93bGVmdFwiKXtcclxuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2VsZWN0ZWRTVkdOb3Rlcy5sZW5ndGggPiAwKXtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgbGVmdFNpZGVCbG9jayA9IHRoaXMuc2VsZWN0ZWRTVkdOb3Rlc1swXS5ibG9ja0dyb3VwWzBdXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEJsb2NrID0ge3NlY3Rpb246IGxlZnRTaWRlQmxvY2suc2VjdGlvbiwgbm90ZTpsZWZ0U2lkZUJsb2NrLm5vdGUsIHN0cmluZzogbGVmdFNpZGVCbG9jay5zdHJpbmd9XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51bnNlbGVjdFNWR05vdGVzKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLnNlbGVjdGVkQmxvY2spe1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0TGVmdCh0aGlzLnNlbGVjdGVkQmxvY2ssIHRoaXMuY29udHJvbFRhYik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYoKDxzdHJpbmc+a2V5KS50b0xvd2VyQ2FzZSgpID09PSBcIndcIiB8fCAoPHN0cmluZz5rZXkpLnRvTG93ZXJDYXNlKCkgPT09IFwiYXJyb3d1cFwiKXtcclxuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2VsZWN0ZWRTVkdOb3Rlcy5sZW5ndGggPiAwKXtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgcmlnaHRTaWRlQmxvY2sgPSB0aGlzLnNlbGVjdGVkU1ZHTm90ZXNbdGhpcy5zZWxlY3RlZFNWR05vdGVzLmxlbmd0aC0xXS5ibG9ja0dyb3VwWzBdXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEJsb2NrID0ge3NlY3Rpb246IHJpZ2h0U2lkZUJsb2NrLnNlY3Rpb24sIG5vdGU6cmlnaHRTaWRlQmxvY2subm90ZSwgc3RyaW5nOiByaWdodFNpZGVCbG9jay5zdHJpbmd9XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51bnNlbGVjdFNWR05vdGVzKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLnNlbGVjdGVkQmxvY2spe1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0VXAodGhpcy5zZWxlY3RlZEJsb2NrLCB0aGlzLmNvbnRyb2xUYWIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKCg8c3RyaW5nPmtleSkudG9Mb3dlckNhc2UoKSA9PT0gXCJzXCIgfHwgKDxzdHJpbmc+a2V5KS50b0xvd2VyQ2FzZSgpID09PSBcImFycm93ZG93blwiKXtcclxuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2VsZWN0ZWRTVkdOb3Rlcy5sZW5ndGggPiAwKXtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgcmlnaHRTaWRlQmxvY2sgPSB0aGlzLnNlbGVjdGVkU1ZHTm90ZXNbdGhpcy5zZWxlY3RlZFNWR05vdGVzLmxlbmd0aC0xXS5ibG9ja0dyb3VwWzBdXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEJsb2NrID0ge3NlY3Rpb246IHJpZ2h0U2lkZUJsb2NrLnNlY3Rpb24sIG5vdGU6cmlnaHRTaWRlQmxvY2subm90ZSwgc3RyaW5nOiByaWdodFNpZGVCbG9jay5zdHJpbmd9XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51bnNlbGVjdFNWR05vdGVzKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLnNlbGVjdGVkQmxvY2spe1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0RG93bih0aGlzLnNlbGVjdGVkQmxvY2ssIHRoaXMuY29udHJvbFRhYik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYoKDxzdHJpbmc+a2V5KS50b0xvd2VyQ2FzZSgpID09PSBcImlcIiApe1xyXG4gICAgICAgICAgICAgICAgaWYodGhpcy5zZWxlY3RlZFNWR05vdGVzLmxlbmd0aCA+IDApe1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRCbG9jayA9IHtzZWN0aW9uOiB0aGlzLnNlbGVjdGVkU1ZHTm90ZXNbMF0uc2VjdGlvbiwgbm90ZTogdGhpcy5zZWxlY3RlZFNWR05vdGVzWzBdLm5vdGUsIHN0cmluZzogMH07XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51bnNlbGVjdFNWR05vdGVzKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLnNlbGVjdGVkQmxvY2spe1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBlbXB0eU5vdGUgPSB0aGlzLmluc2VydEVtcHR5Tm90ZSh0aGlzLnNlbGVjdGVkQmxvY2spO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29udHJvbFRhYi5yZW5kZXIoKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdE5vdGVBbmRNb3ZlSW5kaWNhdG9yKGVtcHR5Tm90ZS5zZWN0aW9uLCBlbXB0eU5vdGUubm90ZSAsZW1wdHlOb3RlLnN0cmluZyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xUYWIucmVuZGVyKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYoKDxzdHJpbmc+a2V5KS50b0xvd2VyQ2FzZSgpID09PSBcImRlbGV0ZVwiIHx8ICg8c3RyaW5nPmtleSkudG9Mb3dlckNhc2UoKSA9PT0gXCJiYWNrc3BhY2VcIil7XHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLnNlbGVjdGVkU1ZHTm90ZXMubGVuZ3RoID4gMCl7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yKGxldCBpID0gdGhpcy5zZWxlY3RlZFNWR05vdGVzLmxlbmd0aCAtMTsgaSA+PSAwOyBpLS0pe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xUYWIuZGVsZXRlTm90ZSh0aGlzLnNlbGVjdGVkU1ZHTm90ZXNbaV0uc2VjdGlvbiwgdGhpcy5zZWxlY3RlZFNWR05vdGVzW2ldLm5vdGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xUYWIucmVuZGVyKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudW5zZWxlY3RTVkdOb3RlcygpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZih0aGlzLnNlbGVjdGVkQmxvY2spe1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGVsZXRlTm90ZUJsb2NrKHRoaXMuc2VsZWN0ZWRCbG9jaywgdGhpcy5jb250cm9sVGFiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZigoPHN0cmluZz5rZXkpLnRvTG93ZXJDYXNlKCkgPT09IFwiK1wiKXtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2hhbmdlTm90ZUxlbmd0aChcIitcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYoKDxzdHJpbmc+a2V5KS50b0xvd2VyQ2FzZSgpID09PSBcIi1cIil7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNoYW5nZU5vdGVMZW5ndGgoXCItXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKGtleUNvZGUgPT09IDExMCB8fCBrZXlDb2RlID09PSAxOTApeyAvLyBwcmVzcyBcIi5cIlxyXG4gICAgICAgICAgICAgICAgaWYodGhpcy5zZWxlY3RlZEJsb2NrKXtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgZGF0YSA9IHRoaXMuY29udHJvbFRhYi5nZXROb3RlRGF0YSh0aGlzLnNlbGVjdGVkQmxvY2suc2VjdGlvbiwgdGhpcy5zZWxlY3RlZEJsb2NrLm5vdGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKE1hdGguZmxvb3IoZGF0YVswXSkgPT09IGRhdGFbMF0pe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhWzBdID0gMiAqIGRhdGFbMF0gLyAzO1xyXG4gICAgICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhWzBdID0gZGF0YVswXSAqIDMgLyAyO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xUYWIuc2V0Tm90ZURhdGEodGhpcy5zZWxlY3RlZEJsb2NrLnNlY3Rpb24sIHRoaXMuc2VsZWN0ZWRCbG9jay5ub3RlLCBkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xUYWIucmVuZGVyKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3ROb3RlQW5kTW92ZUluZGljYXRvcih0aGlzLnNlbGVjdGVkQmxvY2suc2VjdGlvbiwgdGhpcy5zZWxlY3RlZEJsb2NrLm5vdGUsIHRoaXMuc2VsZWN0ZWRCbG9jay5zdHJpbmcpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5jb250cm9sVGFiLm9uKFwibW91c2VvdmVybm90ZVwiLCAoc2VjdGlvbiwgbm90ZSwgc3RyaW5nLCBwb3NpdGlvbikgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnNoYWRvd0luZGljYXRvci5jeCA9IHBvc2l0aW9uWzBdO1xyXG4gICAgICAgICAgICB0aGlzLnNoYWRvd0luZGljYXRvci5jeSA9IHBvc2l0aW9uWzFdO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuY29udHJvbFRhYi5vbihcIm1vdXNlb3V0bm90ZVwiLCAoc2VjdGlvbiwgbm90ZSwgc3RyaW5nLCBwb3NpdGlvbikgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnNoYWRvd0luZGljYXRvci5jeCA9IC0yMDtcclxuICAgICAgICAgICAgdGhpcy5zaGFkb3dJbmRpY2F0b3IuY3kgPSAtMjA7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5jb250cm9sVGFiLm9uKFwibW91c2Vkb3duXCIsICh4LCB5KSA9PiB7XHJcbiAgICAgICAgICAgIHkgKz0gdGhpcy5jb250cm9sVGFiLmRvbUVsZW1lbnQuc2Nyb2xsVG9wO1xyXG4gICAgICAgICAgICBpZih0aGlzLmRyYWdORHJvcFNlY3Rpb24gIT0gbnVsbCl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRyYWdORHJvcFNlY3Rpb24ucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5kcmFnTkRyb3BTZWN0aW9uID0gdGhpcy5jb250cm9sVGFiLnRhYkNhbnZhcy5sYXllcnMudWkuY3JlYXRlUmVjdCgwLCAwLCAwLCAwLCA1LCBcInJnYmEoMjU1LCA1MCwgMCwgMC42KVwiKTtcclxuICAgICAgICAgICAgdGhpcy5kcmFnU3RhcnRQb3MgPSBbeCwgeV07XHJcbiAgICAgICAgICAgIHRoaXMuZHJhZ05Ecm9wU2VjdGlvbi5zdHlsZSA9IHtkaXNwbGF5OiBcIm5vbmVcIn07XHJcbiAgICAgICAgICAgIHRoaXMubW91c2VEb3duID0gdHJ1ZTtcclxuICAgICAgICAgICAgdGhpcy5tb3VzZU1vdmUgPSBmYWxzZTtcclxuICAgICAgICAgICAgdGhpcy51bnNlbGVjdFNWR05vdGVzKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy9Nb3VzZSBtb3ZlIGV2ZW50LCBoYW5kbGUgd2l0aCBhbGwgcXVhZHJhbnQgb2YgZGlyZWN0aW9uLlxyXG4gICAgICAgIHRoaXMuY29udHJvbFRhYi5vbihcIm1vdXNlbW92ZVwiLCAoeCwgeSkgPT4ge1xyXG4gICAgICAgICAgICB5ICs9IHRoaXMuY29udHJvbFRhYi5kb21FbGVtZW50LnNjcm9sbFRvcDtcclxuICAgICAgICAgICAgaWYgKHRoaXMubW91c2VEb3duKSB7XHJcbiAgICAgICAgICAgICAgICBpZihNYXRoLnNxcnQoTWF0aC5wb3coeCAtIHRoaXMuZHJhZ1N0YXJ0UG9zWzBdLCAyKSArIE1hdGgucG93KHkgLSB0aGlzLmRyYWdTdGFydFBvc1sxXSwgMikpID4gMSl7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3VzZU1vdmUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vQ2xlYXIgdGhlIGVtcHR5IG5vdGUgd2hlbiBjbGlja2luZyBcclxuICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnNlbGVjdGVkQmxvY2sgJiYgdGhpcy5jb250cm9sVGFiLmlzQmxhbmtOb3RlKHRoaXMuc2VsZWN0ZWRCbG9jay5zZWN0aW9uLCB0aGlzLnNlbGVjdGVkQmxvY2subm90ZSkpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xUYWIuZGVsZXRlTm90ZSh0aGlzLnNlbGVjdGVkQmxvY2suc2VjdGlvbiAsIHRoaXMuc2VsZWN0ZWRCbG9jay5ub3RlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51bnNlbGVjdE5vdGVCbG9jaygpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29udHJvbFRhYi5yZW5kZXIoKVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gXHJcblxyXG4gICAgICAgICAgICAgICAgaWYodGhpcy5tb3VzZU1vdmUpe1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKHggLSB0aGlzLmRyYWdTdGFydFBvc1swXSA+PSAwKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kcmFnTkRyb3BTZWN0aW9uLnggPSB0aGlzLmRyYWdTdGFydFBvc1swXTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kcmFnTkRyb3BTZWN0aW9uLnggPSB4O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZih5IC0gdGhpcy5kcmFnU3RhcnRQb3NbMV0gPj0gMCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZHJhZ05Ecm9wU2VjdGlvbi55ID0gdGhpcy5kcmFnU3RhcnRQb3NbMV07XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZHJhZ05Ecm9wU2VjdGlvbi55ID0geTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kcmFnTkRyb3BTZWN0aW9uLnNldFNoYXBlKE1hdGguYWJzKHggLSB0aGlzLmRyYWdTdGFydFBvc1swXSksIE1hdGguYWJzKHkgLSB0aGlzLmRyYWdTdGFydFBvc1sxXSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZHJhZ05Ecm9wU2VjdGlvbi5zdHlsZSA9IHtkaXNwbGF5OiBcInVuc2V0XCJ9O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5jb250cm9sVGFiLm9uKFwibW91c2V1cFwiLCAoeCwgeSkgPT57XHJcbiAgICAgICAgICAgIHkgKz0gdGhpcy5jb250cm9sVGFiLmRvbUVsZW1lbnQuc2Nyb2xsVG9wO1xyXG4gICAgICAgICAgICB0aGlzLm1vdXNlRG93biA9IGZhbHNlO1xyXG4gICAgICAgICAgICBpZih0aGlzLm1vdXNlTW92ZSl7XHJcbiAgICAgICAgICAgICAgICBsZXQgeDE6IG51bWJlcjtcclxuICAgICAgICAgICAgICAgIGxldCB5MTogbnVtYmVyO1xyXG4gICAgICAgICAgICAgICAgbGV0IHgyOiBudW1iZXI7XHJcbiAgICAgICAgICAgICAgICBsZXQgeTI6IG51bWJlcjtcclxuICAgICAgICAgICAgICAgIHRoaXMuZHJhZ05Ecm9wU2VjdGlvbi5yZW1vdmUoKTtcclxuICAgICAgICAgICAgICAgIGlmICh4ID49IHRoaXMuZHJhZ1N0YXJ0UG9zWzBdKXtcclxuICAgICAgICAgICAgICAgICAgICB4MSA9IHRoaXMuZHJhZ1N0YXJ0UG9zWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgIHgyID0geDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgeDEgPSB4O1xyXG4gICAgICAgICAgICAgICAgICAgIHgyID0gdGhpcy5kcmFnU3RhcnRQb3NbMF07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZih5ID49IHRoaXMuZHJhZ1N0YXJ0UG9zWzFdKXtcclxuICAgICAgICAgICAgICAgICAgICB5MSA9IHRoaXMuZHJhZ1N0YXJ0UG9zWzFdO1xyXG4gICAgICAgICAgICAgICAgICAgIHkyID0geTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgeTEgPSB5O1xyXG4gICAgICAgICAgICAgICAgICAgIHkyID0gdGhpcy5kcmFnU3RhcnRQb3NbMV07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkU1ZHTm90ZXMgPSB0aGlzLmNvbnRyb2xUYWIuYXJlYVNlbGVjdCh4MSwgeTEsIHgyLCB5Mik7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRyYXdNdWx0aVNlbGVjdFJlY3QodGhpcy5zZWxlY3RlZFNWR05vdGVzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuY29udHJvbFRhYi5vbihcInNlY3Rpb25ob3ZlclwiLCAoc2VjdGlvbikgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRyb2xUYWIudGFiQ2FudmFzLmxheWVycy51aS5oaWdodExpZ2h0U2VjdGlvbihzZWN0aW9uKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmNvbnRyb2xUYWIub24oXCJzZWN0aW9uaG91dFwiLCAoc2VjdGlvbikgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRyb2xUYWIudGFiQ2FudmFzLmxheWVycy51aS5oaWRlU2VjdGlvbkluZGljYXRvcihzZWN0aW9uKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmNvbnRyb2xUYWIub24oXCJzZWN0aW9uY2xpY2tcIiwoc2VjdGlvbiwgc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0Tm90ZUFuZE1vdmVJbmRpY2F0b3Ioc2VjdGlvbiwgdGhpcy5jb250cm9sVGFiLmdldE5vdGVOdW1iZXJPZlNlY3Rpb24oc2VjdGlvbikgLSAxLCBzdHJpbmcpO1xyXG4gICAgICAgICAgICBpZih0aGlzLnNlbGVjdGVkQmxvY2sgJiZcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEJsb2NrLnNlY3Rpb24gPT09IHNlY3Rpb24gJiYgXHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRCbG9jay5ub3RlID09PSB0aGlzLmNvbnRyb2xUYWIuZ2V0Tm90ZU51bWJlck9mU2VjdGlvbihzZWN0aW9uKSAtIDEgJiZcclxuICAgICAgICAgICAgdGhpcy5jb250cm9sVGFiLmlzQmxhbmtOb3RlKHNlY3Rpb24sIHRoaXMuc2VsZWN0ZWRCbG9jay5ub3RlKSl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5jb250cm9sVGFiLmFkZE5vdGUoc2VjdGlvbiwgLTEsIG5ldyBOb3RlKCkpO1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRyb2xUYWIucmVuZGVyKCk7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0Tm90ZUFuZE1vdmVJbmRpY2F0b3Ioc2VjdGlvbiwgdGhpcy5jb250cm9sVGFiLmdldE5vdGVOdW1iZXJPZlNlY3Rpb24oc2VjdGlvbikgLSAxLCBzdHJpbmcpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSBzZWxlY3ROb3RlQW5kTW92ZUluZGljYXRvcihzZWN0aW9uOiBudW1iZXIsIG5vdGU6IG51bWJlciwgc3RyaW5nOiBudW1iZXIpOiBib29sZWFue1xyXG4gICAgICAgIGxldCBzcCA9IHRoaXMuY29udHJvbFRhYi5nZXRTZWN0aW9uTGVmdFRvcFBvcyhzZWN0aW9uKTtcclxuICAgICAgICBsZXQgbnAgPSB0aGlzLmNvbnRyb2xUYWIuZ2V0Tm90ZVBvc2l0aW9uKHNlY3Rpb24sIG5vdGUsIHN0cmluZyk7XHJcbiAgICAgICAgaWYobnBbMF0gPT09IC0xKXJldHVybiBmYWxzZTtcclxuICAgICAgICBpZih0aGlzLnNlbGVjdGVkQmxvY2sgJiYgKHRoaXMuc2VsZWN0ZWRCbG9jay5zZWN0aW9uICE9IHNlY3Rpb24gfHwgdGhpcy5zZWxlY3RlZEJsb2NrLm5vdGUgIT0gbm90ZSkpe1xyXG4gICAgICAgICAgICBpZih0aGlzLmNvbnRyb2xUYWIuZ2V0Tm90ZU51bWJlck9mU2VjdGlvbih0aGlzLnNlbGVjdGVkQmxvY2suc2VjdGlvbikgPiAxICYmIHRoaXMuY29udHJvbFRhYi5pc0JsYW5rTm90ZSh0aGlzLnNlbGVjdGVkQmxvY2suc2VjdGlvbiwgdGhpcy5zZWxlY3RlZEJsb2NrLm5vdGUpKXtcclxuICAgICAgICAgICAgICAgIHRoaXMuY29udHJvbFRhYi5kZWxldGVOb3RlKHRoaXMuc2VsZWN0ZWRCbG9jay5zZWN0aW9uLCB0aGlzLnNlbGVjdGVkQmxvY2subm90ZSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xUYWIucmVuZGVyKCk7XHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLnNlbGVjdGVkQmxvY2suc2VjdGlvbiA9PT0gc2VjdGlvbiAmJiB0aGlzLnNlbGVjdGVkQmxvY2subm90ZSA8IG5vdGUpIG5vdGUtLTtcclxuICAgICAgICAgICAgICAgIHNwID0gdGhpcy5jb250cm9sVGFiLmdldFNlY3Rpb25MZWZ0VG9wUG9zKHNlY3Rpb24pO1xyXG4gICAgICAgICAgICAgICAgbnAgPSB0aGlzLmNvbnRyb2xUYWIuZ2V0Tm90ZVBvc2l0aW9uKHNlY3Rpb24sIG5vdGUsIHN0cmluZyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zZXRTZWxlY3ROb3RlKHNlY3Rpb24sIG5vdGUsIHN0cmluZyk7XHJcbiAgICAgICAgdGhpcy5zZXRJbmRpY2F0b3IobnApO1xyXG4gICAgICAgIHRoaXMuY29udHJvbFRhYi5hZGp1c3RQb3N0aW9uKHNwWzFdKTtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuICAgIHByaXZhdGUgc2V0U2VsZWN0Tm90ZShzZWN0aW9uOiBudW1iZXIsIG5vdGU6IG51bWJlciwgc3RyaW5nOiBudW1iZXIpe1xyXG4gICAgICAgIHRoaXMuc2VsZWN0ZWRCbG9jayA9IHtzZWN0aW9uOiBzZWN0aW9uLCBub3RlOiBub3RlLCBzdHJpbmc6IHN0cmluZ307XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIHNldEluZGljYXRvcihwb3NpdGlvbjogbnVtYmVyW10pe1xyXG4gICAgICAgIHRoaXMuaW5kaWNhdG9yLmN4ID0gcG9zaXRpb25bMF07XHJcbiAgICAgICAgdGhpcy5pbmRpY2F0b3IuY3kgPSBwb3NpdGlvblsxXTtcclxuICAgIH1cclxuICAgIHByaXZhdGUgY2hhbmdlTm90ZUxlbmd0aChvcGVyYXRlcjogc3RyaW5nKXtcclxuICAgICAgICBsZXQgZmFjdG9yOiBudW1iZXI7XHJcbiAgICAgICAgaWYob3BlcmF0ZXIgPT09IFwiK1wiKXtcclxuICAgICAgICAgICAgZmFjdG9yID0gMTtcclxuICAgICAgICB9ZWxzZSBpZihvcGVyYXRlciA9PT0gXCItXCIpe1xyXG4gICAgICAgICAgICBmYWN0b3IgPSAwO1xyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKHRoaXMuc2VsZWN0ZWRCbG9jayl7XHJcbiAgICAgICAgICAgIGxldCBsZW5ndGhBcnJheSA9IFsxLCAyLCA0LCA4LCAxNiwgMzJdO1xyXG4gICAgICAgICAgICBsZXQgc2VsZWN0RGF0YSA9IHRoaXMuY29udHJvbFRhYi5nZXROb3RlRGF0YSh0aGlzLnNlbGVjdGVkQmxvY2suc2VjdGlvbiwgdGhpcy5zZWxlY3RlZEJsb2NrLm5vdGUpO1xyXG4gICAgICAgICAgICBmb3IobGV0IGkgPSAxIC0gZmFjdG9yIDsgaSA8IGxlbmd0aEFycmF5Lmxlbmd0aCAtIGZhY3RvcjsgaSsrKXtcclxuICAgICAgICAgICAgICAgIGlmKGxlbmd0aEFycmF5W2ldID49IHNlbGVjdERhdGFbMF0pe1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdERhdGFbMF0gPSBsZW5ndGhBcnJheVtpIC0gMSArIGZhY3RvciAqIDJdO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29udHJvbFRhYi5zZXROb3RlRGF0YSh0aGlzLnNlbGVjdGVkQmxvY2suc2VjdGlvbiwgdGhpcy5zZWxlY3RlZEJsb2NrLm5vdGUsIHNlbGVjdERhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29udHJvbFRhYi5yZW5kZXIoKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdE5vdGVBbmRNb3ZlSW5kaWNhdG9yKHRoaXMuc2VsZWN0ZWRCbG9jay5zZWN0aW9uLCB0aGlzLnNlbGVjdGVkQmxvY2subm90ZSwgdGhpcy5zZWxlY3RlZEJsb2NrLnN0cmluZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIHNlbGVjdFJpZ2h0KHNlbGVjdE5vdGU6IE5vdGVCbG9ja0luZGV4LCBjb250cm9sVGFiOiBTTFRhYil7XHJcbiAgICAgICAgbGV0IHMgPSB0aGlzLnNlbGVjdE5vdGVBbmRNb3ZlSW5kaWNhdG9yKHNlbGVjdE5vdGUuc2VjdGlvbiwgc2VsZWN0Tm90ZS5ub3RlICsgMSwgc2VsZWN0Tm90ZS5zdHJpbmcpO1xyXG4gICAgICAgIGlmKCFzKXsgLy8gdGhlIGN1cnJlbnQgc2VsZWN0aW9uIGlzIHRoZSBsYXN0IG5vdGUgb2YgdGhlIHNlY3Rpb25cclxuICAgICAgICAgICAgaWYoY29udHJvbFRhYi5pc0JsYW5rTm90ZShzZWxlY3ROb3RlLnNlY3Rpb24sIHNlbGVjdE5vdGUubm90ZSkpe1xyXG4gICAgICAgICAgICAgICAgcyA9IHRoaXMuc2VsZWN0Tm90ZUFuZE1vdmVJbmRpY2F0b3Ioc2VsZWN0Tm90ZS5zZWN0aW9uICsgMSwgMCwgc2VsZWN0Tm90ZS5zdHJpbmcpO1xyXG4gICAgICAgICAgICAgICAgaWYoIXMpeyAvLyB0aGUgY3VycmVudCBzZWxlY3Rpb24gaXMgdGhlIGxhc3Qgc2VjdGlvbiBhbmQgdGhlIGxhc3Qgbm90ZVxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xUYWIuYWRkTm90ZShzZWxlY3ROb3RlLnNlY3Rpb24gKyAxLCAwLCBuZXcgTm90ZSgpKTtcclxuICAgICAgICAgICAgICAgICAgICBjb250cm9sVGFiLnJlbmRlcigpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0Tm90ZUFuZE1vdmVJbmRpY2F0b3Ioc2VsZWN0Tm90ZS5zZWN0aW9uICsgMSwgMCwgc2VsZWN0Tm90ZS5zdHJpbmcpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xUYWIuYWRkTm90ZShzZWxlY3ROb3RlLnNlY3Rpb24sIHNlbGVjdE5vdGUubm90ZSArIDEsIG5ldyBOb3RlKCkpO1xyXG4gICAgICAgICAgICAgICAgY29udHJvbFRhYi5yZW5kZXIoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0Tm90ZUFuZE1vdmVJbmRpY2F0b3Ioc2VsZWN0Tm90ZS5zZWN0aW9uLCBzZWxlY3ROb3RlLm5vdGUgKyAxLCBzZWxlY3ROb3RlLnN0cmluZyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIHNlbGVjdExlZnQoc2VsZWN0Tm90ZUJsb2NrOiBOb3RlQmxvY2tJbmRleCwgY29udHJvbFRhYjogU0xUYWIpe1xyXG4gICAgICAgIGlmKHNlbGVjdE5vdGVCbG9jay5ub3RlID09PSAwKXtcclxuICAgICAgICAgICAgaWYoY29udHJvbFRhYi5pc0JsYW5rTm90ZShzZWxlY3ROb3RlQmxvY2suc2VjdGlvbiwgc2VsZWN0Tm90ZUJsb2NrLm5vdGUpKXtcclxuICAgICAgICAgICAgICAgIGlmKHNlbGVjdE5vdGVCbG9jay5zZWN0aW9uID4gMCl7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3ROb3RlQW5kTW92ZUluZGljYXRvcihzZWxlY3ROb3RlQmxvY2suc2VjdGlvbiAtIDEsIHRoaXMuY29udHJvbFRhYi5nZXROb3RlTnVtYmVyT2ZTZWN0aW9uKHNlbGVjdE5vdGVCbG9jay5zZWN0aW9uIC0gMSkgLSAxLCBzZWxlY3ROb3RlQmxvY2suc3RyaW5nKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICBjb250cm9sVGFiLmFkZE5vdGUoc2VsZWN0Tm90ZUJsb2NrLnNlY3Rpb24sIDAsIG5ldyBOb3RlKCkpO1xyXG4gICAgICAgICAgICAgICAgY29udHJvbFRhYi5yZW5kZXIoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0Tm90ZUFuZE1vdmVJbmRpY2F0b3Ioc2VsZWN0Tm90ZUJsb2NrLnNlY3Rpb24sIDAsIHNlbGVjdE5vdGVCbG9jay5zdHJpbmcpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0Tm90ZUFuZE1vdmVJbmRpY2F0b3Ioc2VsZWN0Tm90ZUJsb2NrLnNlY3Rpb24sIHNlbGVjdE5vdGVCbG9jay5ub3RlIC0gMSAsc2VsZWN0Tm90ZUJsb2NrLnN0cmluZyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSBzZWxlY3RVcChzZWxlY3ROb3RlQmxvY2s6IE5vdGVCbG9ja0luZGV4LCBjb250cm9sVGFiOiBTTFRhYil7XHJcbiAgICAgICAgaWYoc2VsZWN0Tm90ZUJsb2NrLnN0cmluZyA+IDApe1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdE5vdGVBbmRNb3ZlSW5kaWNhdG9yKHNlbGVjdE5vdGVCbG9jay5zZWN0aW9uLCBzZWxlY3ROb3RlQmxvY2subm90ZSAsc2VsZWN0Tm90ZUJsb2NrLnN0cmluZyAtIDEpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHByaXZhdGUgc2VsZWN0RG93bihzZWxlY3ROb3RlQmxvY2s6IE5vdGVCbG9ja0luZGV4LCBjb250cm9sVGFiOiBTTFRhYil7XHJcbiAgICAgICAgaWYoc2VsZWN0Tm90ZUJsb2NrLnN0cmluZyA8IDUpe1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdE5vdGVBbmRNb3ZlSW5kaWNhdG9yKHNlbGVjdE5vdGVCbG9jay5zZWN0aW9uLCBzZWxlY3ROb3RlQmxvY2subm90ZSAsc2VsZWN0Tm90ZUJsb2NrLnN0cmluZyArIDEpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHByaXZhdGUgaW5zZXJ0RW1wdHlOb3RlKHNlbGVjdGVkQmxvY2s6IE5vdGVCbG9ja0luZGV4KTogTm90ZUJsb2NrSW5kZXh7XHJcbiAgICAgICAgaWYoIXRoaXMuY29udHJvbFRhYi5pc0JsYW5rTm90ZSh0aGlzLnNlbGVjdGVkQmxvY2suc2VjdGlvbiwgdGhpcy5zZWxlY3RlZEJsb2NrLm5vdGUpKXtcclxuICAgICAgICAgICAgdGhpcy5jb250cm9sVGFiLmFkZE5vdGUodGhpcy5zZWxlY3RlZEJsb2NrLnNlY3Rpb24sIHRoaXMuc2VsZWN0ZWRCbG9jay5ub3RlLCBuZXcgTm90ZSgpKTtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEJsb2NrID0ge3NlY3Rpb246IHRoaXMuc2VsZWN0ZWRCbG9jay5zZWN0aW9uLCBub3RlOiB0aGlzLnNlbGVjdGVkQmxvY2subm90ZSwgc3RyaW5nOiB0aGlzLnNlbGVjdGVkQmxvY2suc3RyaW5nfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0ZWRCbG9ja1xyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSBkZWxldGVOb3RlQmxvY2soc2VsZWN0Tm90ZUJsb2NrOiBOb3RlQmxvY2tJbmRleCwgY29udHJvbFRhYjogU0xUYWIpe1xyXG4gICAgICAgIHRoaXMuY29udHJvbFRhYi5zZXRTdHJpbmdEYXRhT2ZOb3RlKHNlbGVjdE5vdGVCbG9jay5zZWN0aW9uLCBzZWxlY3ROb3RlQmxvY2subm90ZSwgc2VsZWN0Tm90ZUJsb2NrLnN0cmluZywgLTEpO1xyXG4gICAgICAgIGNvbnRyb2xUYWIucmVuZGVyKCk7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIGRyYXdNdWx0aVNlbGVjdFJlY3Qoc2VsZWN0ZWRTVkdOb3RlczogU1ZHTm90ZVtdKXtcclxuICAgICAgICAvL1NvcnQgb3V0IHRoZSBzZWxlY3RlZCBsaW5lcy5cclxuICAgICAgICBsZXQgc2VsZWN0ZWRMaW5lczogbnVtYmVyW10gPSBbXTtcclxuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgc2VsZWN0ZWRTVkdOb3Rlcy5sZW5ndGg7IGkrKyl7XHJcbiAgICAgICAgICAgIHNlbGVjdGVkTGluZXMucHVzaChzZWxlY3RlZFNWR05vdGVzW2ldLmxpbmUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgdW5pcXVlU2VsZWN0ZWRMaW5lcyA9IHNlbGVjdGVkTGluZXMuZmlsdGVyKGZ1bmN0aW9uKGVsZW0sIGluZGV4LCBzZWxmKXtcclxuICAgICAgICAgICAgcmV0dXJuIGluZGV4ID09IHNlbGYuaW5kZXhPZihlbGVtKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaWYgKHNlbGVjdGVkU1ZHTm90ZXMubGVuZ3RoID4gMCl7XHJcbiAgICAgICAgICAgIHRoaXMudW5zZWxlY3ROb3RlQmxvY2soKTtcclxuICAgICAgICAgICAgdHlwZSBsaW5lT2JqID0ge1xyXG4gICAgICAgICAgICAgICAgbGluZUluZGV4OiBudW1iZXI7XHJcbiAgICAgICAgICAgICAgICBub3RlczogU1ZHTm90ZVtdO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBsZXQgbGluZU5vdGVzOiBsaW5lT2JqW10gPSBbXTtcclxuICAgICAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IHVuaXF1ZVNlbGVjdGVkTGluZXMubGVuZ3RoOyBpKyspe1xyXG4gICAgICAgICAgICAgICAgbGV0IHB1c2hOb3RlcyA9IHNlbGVjdGVkU1ZHTm90ZXMuZmlsdGVyKGZ1bmN0aW9uKGVsZW0sIGluZGV4LCBzZWxmKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbS5saW5lID09IHVuaXF1ZVNlbGVjdGVkTGluZXNbaV1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgbGluZU5vdGVzLnB1c2goe2xpbmVJbmRleDogdW5pcXVlU2VsZWN0ZWRMaW5lc1tpXSwgbm90ZXM6IHB1c2hOb3Rlc30pXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IGxpbmVOb3Rlcy5sZW5ndGg7IGkrKyl7XHJcbiAgICAgICAgICAgICAgICAvL2xldCByZWN0SW5kaWNhdG9yTFQgPSB0aGlzLnNlbGVjdGVkTm90ZXNbMF0uYmxvY2tHcm91cFswXTtcclxuICAgICAgICAgICAgICAgIGxldCByZWN0SW5kaWNhdG9yTFQgPSBsaW5lTm90ZXNbaV0ubm90ZXNbMF0uYmxvY2tHcm91cFswXTtcclxuICAgICAgICAgICAgICAgIC8vSW5kaWNhdG9yJ3MgcmlnaHQgYm90dG9tIG5vdGUsIHdoaWNoIHByb3ZpZGVkcyBwb3NpdGlvbi5cclxuICAgICAgICAgICAgICAgIC8vbGV0IHJlY3RJbmRpY2F0b3JSQiA9IHRoaXMuc2VsZWN0ZWROb3Rlc1t0aGlzLnNlbGVjdGVkTm90ZXMubGVuZ3RoLTFdLmJsb2NrR3JvdXBbdGhpcy5zZWxlY3RlZE5vdGVzW3RoaXMuc2VsZWN0ZWROb3Rlcy5sZW5ndGgtMV0uYmxvY2tHcm91cC5sZW5ndGgtMV07XHJcbiAgICAgICAgICAgICAgICBsZXQgcmVjdEluZGljYXRvclJCID0gbGluZU5vdGVzW2ldLm5vdGVzW2xpbmVOb3Rlc1tpXS5ub3Rlcy5sZW5ndGggLSAxXS5ibG9ja0dyb3VwW2xpbmVOb3Rlc1tpXS5ub3Rlc1tsaW5lTm90ZXNbaV0ubm90ZXMubGVuZ3RoIC0gMV0uYmxvY2tHcm91cC5sZW5ndGggLSAxXTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0Tm90ZXNJbmRpY2F0b3IucHVzaCh0aGlzLmNvbnRyb2xUYWIudGFiQ2FudmFzLmxheWVycy51aS5jcmVhdGVSZWN0KFxyXG4gICAgICAgICAgICAgICAgICAgIHJlY3RJbmRpY2F0b3JMVC54IC0gdGhpcy5zZWxlY3ROb3Rlc0luZGljYXRvclBhZGRpbmcsIFxyXG4gICAgICAgICAgICAgICAgICAgIHJlY3RJbmRpY2F0b3JMVC55IC0gdGhpcy5zZWxlY3ROb3Rlc0luZGljYXRvclBhZGRpbmcsIFxyXG4gICAgICAgICAgICAgICAgICAgIHJlY3RJbmRpY2F0b3JSQi54IC0gcmVjdEluZGljYXRvckxULnggKyAyICogdGhpcy5zZWxlY3ROb3Rlc0luZGljYXRvclBhZGRpbmcsIFxyXG4gICAgICAgICAgICAgICAgICAgIHJlY3RJbmRpY2F0b3JSQi55IC0gcmVjdEluZGljYXRvckxULnkgKyAyICogdGhpcy5zZWxlY3ROb3Rlc0luZGljYXRvclBhZGRpbmcsIFxyXG4gICAgICAgICAgICAgICAgICAgIDUsIFxyXG4gICAgICAgICAgICAgICAgICAgIFwicmdiYSgyNTUsIDE4MiwgNDUsIDAuNilcIlxyXG4gICAgICAgICAgICAgICAgKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIHVuc2VsZWN0U1ZHTm90ZXMoKXtcclxuICAgICAgICB0aGlzLnNlbGVjdGVkU1ZHTm90ZXMgPSBbXVxyXG4gICAgICAgIGlmKHRoaXMuc2VsZWN0Tm90ZXNJbmRpY2F0b3IubGVuZ3RoID4gMCl7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0Tm90ZXNJbmRpY2F0b3IuZm9yRWFjaCgoZWxlbSwgaW5kZXgsIHNlbGYpID0+e1xyXG4gICAgICAgICAgICAgICAgZWxlbS5yZW1vdmUoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSB1bnNlbGVjdE5vdGVCbG9jaygpe1xyXG4gICAgICAgIHRoaXMuc2VsZWN0ZWRCbG9jayA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5zZXRJbmRpY2F0b3IoWy0yMCwgLTIwXSk7XHJcbiAgICB9XHJcbn0iXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBV0E7QUFlQTtBQVRBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/SlimTabV2Editor.ts\n");

/***/ }),

/***/ "./src/SlimTabV2Types.ts":
/*!*******************************!*\
  !*** ./src/SlimTabV2Types.ts ***!
  \*******************************/
/*! exports provided: Note */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Note\", function() { return Note; });\nclass Note {\r\n    constructor(data = {}) {\r\n        if (data[0]) {\r\n            this[0] = data[0];\r\n            this[1] = data[1] || [-1, -1, -1, -1, -1, -1];\r\n            this[2] = data[2] || null;\r\n            return;\r\n        }\r\n        this[0] = data.noteValue || 4;\r\n        this[1] = data.stringContent || [-1, -1, -1, -1, -1, -1];\r\n        this[2] = data.userData || null;\r\n    }\r\n    get noteValue() {\r\n        return this[0];\r\n    }\r\n    set noteValue(l) {\r\n        this[0] = l;\r\n    }\r\n    get stringContent() {\r\n        return this[1];\r\n    }\r\n    set stringContent(v) {\r\n        this[1] = v;\r\n    }\r\n    get userData() {\r\n        return this[2];\r\n    }\r\n    set userData(v) {\r\n        this[2] = v;\r\n    }\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvU2xpbVRhYlYyVHlwZXMudHMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvU2xpbVRhYlYyVHlwZXMudHM/YmVjMCJdLCJzb3VyY2VzQ29udGVudCI6WyIvL2V4cG9ydCB0eXBlIG5vdGUgPSBbbnVtYmVyLCBudW1iZXJbXSwgYW55XTsvLyBbNCwgWzMsIC0xLCAtMSwgNCwgLTEsIC0xXSwgbnVsbF0sLy8gbm90ZSBsZW5ndGgsIFtibG9jayBudW1iZXIsIGluZGV4IGlzIHN0cmluZyBudW1iZXIsXSwgdXNlciBkYXRhXHJcbmV4cG9ydCB0eXBlIHNlY3Rpb24gPSBOb3RlW107XHJcbmV4cG9ydCBjbGFzcyBOb3RlIHtcclxuICAgIDA6IG51bWJlcjtcclxuICAgIDE6IG51bWJlcltdO1xyXG4gICAgMjogYW55O1xyXG4gICAgY29uc3RydWN0b3IoZGF0YToge25vdGVWYWx1ZT86IG51bWJlciwgc3RyaW5nQ29udGVudD86IG51bWJlcltdLCB1c2VyRGF0YT86IGFueSwgMD86IG51bWJlciwgMT86IG51bWJlcltdLCAyPzogYW55fSA9IHt9KXtcclxuICAgICAgICBpZihkYXRhWzBdKXtcclxuICAgICAgICAgICAgdGhpc1swXSA9IGRhdGFbMF07XHJcbiAgICAgICAgICAgIHRoaXNbMV0gPSBkYXRhWzFdIHx8IFstMSwgLTEsIC0xLCAtMSwgLTEsIC0xXTtcclxuICAgICAgICAgICAgdGhpc1syXSA9IGRhdGFbMl0gfHwgbnVsbDtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzWzBdID0gZGF0YS5ub3RlVmFsdWUgfHwgNDtcclxuICAgICAgICB0aGlzWzFdID0gZGF0YS5zdHJpbmdDb250ZW50IHx8IFstMSwgLTEsIC0xLCAtMSwgLTEsIC0xXTtcclxuICAgICAgICB0aGlzWzJdID0gZGF0YS51c2VyRGF0YSB8fCBudWxsO1xyXG4gICAgfVxyXG4gICAgZ2V0IG5vdGVWYWx1ZSgpOiBudW1iZXJ7XHJcbiAgICAgICAgcmV0dXJuIHRoaXNbMF07XHJcbiAgICB9XHJcbiAgICBzZXQgbm90ZVZhbHVlKGw6IG51bWJlcil7XHJcbiAgICAgICAgdGhpc1swXSA9IGw7XHJcbiAgICB9XHJcbiAgICBnZXQgc3RyaW5nQ29udGVudCgpe1xyXG4gICAgICAgIHJldHVybiB0aGlzWzFdO1xyXG4gICAgfVxyXG4gICAgc2V0IHN0cmluZ0NvbnRlbnQodjogbnVtYmVyW10pe1xyXG4gICAgICAgIHRoaXNbMV0gPSB2O1xyXG4gICAgfVxyXG4gICAgZ2V0IHVzZXJEYXRhKCl7XHJcbiAgICAgICAgcmV0dXJuIHRoaXNbMl07XHJcbiAgICB9XHJcbiAgICBzZXQgdXNlckRhdGEodjogYW55KXtcclxuICAgICAgICB0aGlzWzJdID0gdjtcclxuICAgIH1cclxufSJdLCJtYXBwaW5ncyI6IkFBRUE7QUFBQTtBQUFBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/SlimTabV2Types.ts\n");

/***/ }),

/***/ "./src/Timer.ts":
/*!**********************!*\
  !*** ./src/Timer.ts ***!
  \**********************/
/*! exports provided: Timer */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Timer\", function() { return Timer; });\nclass Timer {\r\n    constructor() {\r\n        this._running = false;\r\n        this._systemTime = 0;\r\n        this.lastTime = 0;\r\n        this.delay = 33;\r\n        this.funcs = [];\r\n        this.timerId = null;\r\n        this.executeFuncs = [];\r\n    }\r\n    searchIndex(time) {\r\n        let funcs = this.executeFuncs;\r\n        let low = 0;\r\n        let high = funcs.length;\r\n        let mid = 0;\r\n        while (low < high) {\r\n            mid = Math.floor(low + (high - low) / 2);\r\n            if (time >= funcs[mid].time) {\r\n                low = mid + 1;\r\n            }\r\n            else {\r\n                high = mid - 1;\r\n            }\r\n        }\r\n        return low;\r\n    }\r\n    register(func) {\r\n        if (this.funcs.indexOf(func)) {\r\n            return;\r\n        }\r\n        this.funcs.push(func);\r\n    }\r\n    registerDelay(func, delay, loop = 1) {\r\n        let time = this._systemTime + delay;\r\n        this.registerDelayP(func, delay, time, loop);\r\n    }\r\n    unregister(func) {\r\n        this.funcs.map((value, index) => {\r\n            if (func === value) {\r\n                this.funcs.splice(index, 1);\r\n            }\r\n        });\r\n    }\r\n    start(systemTime = 0) {\r\n        if (this._running) {\r\n            return;\r\n        }\r\n        this._running = true;\r\n        this._systemTime = systemTime;\r\n        this.lastTime = new Date().getTime();\r\n        this.update();\r\n    }\r\n    stop() {\r\n        if (this.timerId) {\r\n            clearTimeout(this.timerId);\r\n            this.timerId = null;\r\n        }\r\n        this._running = false;\r\n        this._systemTime = 0;\r\n        this.lastTime = 0;\r\n        this.clearFuncs();\r\n        this.clearDelayFuncs();\r\n    }\r\n    update() {\r\n        let currentTime = new Date().getTime();\r\n        let delay = currentTime - this.lastTime;\r\n        this._systemTime += delay;\r\n        this.funcs.forEach((value) => {\r\n            value(delay);\r\n        });\r\n        this.executeFunc();\r\n        this.lastTime = currentTime;\r\n        if (this._running)\r\n            this.timerId = setTimeout(this.update.bind(this), this.delay);\r\n    }\r\n    executeFunc() {\r\n        if (this.executeFuncs[0] && this.executeFuncs[0].time < this._systemTime) {\r\n            let value = this.executeFuncs.shift();\r\n            value.func();\r\n            this.executeFunc();\r\n            // loop <= 0 will be infinite loop\r\n            if (value.loop > 0 && --value.loop === 0) {\r\n                return;\r\n            }\r\n            let nextTime = value.time + value.delay;\r\n            this.registerDelayP(value.func, value.delay, nextTime, value.loop);\r\n        }\r\n    }\r\n    clearFuncs() {\r\n        this.funcs = [];\r\n    }\r\n    clearDelayFuncs() {\r\n        this.executeFuncs = [];\r\n    }\r\n    registerDelayP(func, delay, time, loop) {\r\n        let index = this.searchIndex(time);\r\n        let value = { func: func, delay: delay, time: time, loop: loop };\r\n        this.executeFuncs.splice(index, 0, value);\r\n    }\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvVGltZXIudHMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvVGltZXIudHM/NTBkOCJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY2xhc3MgVGltZXJ7XHJcbiAgICBfcnVubmluZzogYm9vbGVhbiA9IGZhbHNlO1xyXG4gICAgX3N5c3RlbVRpbWU6IG51bWJlciA9IDA7XHJcbiAgICBsYXN0VGltZTogbnVtYmVyID0gMDtcclxuICAgIGRlbGF5OiBudW1iZXIgPSAzMztcclxuICAgIGZ1bmNzOiBBcnJheTxGdW5jdGlvbj4gPSBbXTtcclxuICAgIHRpbWVySWQ6IG51bWJlciA9IG51bGw7XHJcbiAgICBleGVjdXRlRnVuY3M6IEFycmF5PEV4ZWN1dGVWYWx1ZT4gPSBbXTtcclxuXHJcblxyXG4gICAgY29uc3RydWN0b3IoKXt9XHJcblxyXG4gICAgc2VhcmNoSW5kZXgodGltZTogbnVtYmVyKXtcclxuICAgICAgICBsZXQgZnVuY3M6IEFycmF5PEV4ZWN1dGVWYWx1ZT4gPSB0aGlzLmV4ZWN1dGVGdW5jcztcclxuICAgICAgICBsZXQgbG93OiBudW1iZXIgPSAwO1xyXG4gICAgICAgIGxldCBoaWdoOiBudW1iZXIgPSBmdW5jcy5sZW5ndGg7XHJcbiAgICAgICAgbGV0IG1pZDogbnVtYmVyID0gMDtcclxuICAgICAgICB3aGlsZSAobG93IDwgaGlnaCl7XHJcbiAgICAgICAgICAgIG1pZCA9IE1hdGguZmxvb3IobG93ICsgKGhpZ2ggLSBsb3cpLzIpO1xyXG4gICAgICAgICAgICBpZih0aW1lID49IGZ1bmNzW21pZF0udGltZSl7XHJcbiAgICAgICAgICAgICAgICBsb3cgPSBtaWQgKzE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZXtcclxuICAgICAgICAgICAgICAgIGhpZ2ggPSBtaWQgLTE7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBsb3c7XHJcbiAgICB9XHJcblxyXG4gICAgcmVnaXN0ZXIoZnVuYzogRnVuY3Rpb24pe1xyXG4gICAgICAgIGlmICh0aGlzLmZ1bmNzLmluZGV4T2YoZnVuYykpe1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZnVuY3MucHVzaChmdW5jKTtcclxuICAgIH1cclxuXHJcbiAgICByZWdpc3RlckRlbGF5KGZ1bmM6IEZ1bmN0aW9uLCBkZWxheTpudW1iZXIsIGxvb3A6IG51bWJlciA9IDEpe1xyXG4gICAgICAgIGxldCB0aW1lOiBudW1iZXIgPSB0aGlzLl9zeXN0ZW1UaW1lICsgZGVsYXk7XHJcbiAgICAgICAgdGhpcy5yZWdpc3RlckRlbGF5UChmdW5jLCBkZWxheSwgdGltZSwgbG9vcCk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHVucmVnaXN0ZXIgKGZ1bmM6IEZ1bmN0aW9uKSB7XHJcbiAgICAgICAgdGhpcy5mdW5jcy5tYXAoKHZhbHVlOiBGdW5jdGlvbiwgaW5kZXg6IG51bWJlcikgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZnVuYyA9PT0gdmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZnVuY3Muc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXJ0KHN5c3RlbVRpbWU6IG51bWJlciA9IDApe1xyXG4gICAgICAgIGlmKHRoaXMuX3J1bm5pbmcpe1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuX3J1bm5pbmcgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuX3N5c3RlbVRpbWUgPSBzeXN0ZW1UaW1lO1xyXG4gICAgICAgIHRoaXMubGFzdFRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcclxuICAgICAgICB0aGlzLnVwZGF0ZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHN0b3AoKXtcclxuICAgICAgICBpZih0aGlzLnRpbWVySWQpe1xyXG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy50aW1lcklkKTtcclxuICAgICAgICAgICAgdGhpcy50aW1lcklkID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5fcnVubmluZyA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuX3N5c3RlbVRpbWUgPSAwO1xyXG4gICAgICAgIHRoaXMubGFzdFRpbWUgPSAwO1xyXG4gICAgICAgIHRoaXMuY2xlYXJGdW5jcygpO1xyXG4gICAgICAgIHRoaXMuY2xlYXJEZWxheUZ1bmNzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgdXBkYXRlKCl7XHJcbiAgICAgICAgbGV0IGN1cnJlbnRUaW1lOiBudW1iZXIgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsgXHJcbiAgICAgICAgbGV0IGRlbGF5OiBudW1iZXIgPSBjdXJyZW50VGltZSAtIHRoaXMubGFzdFRpbWU7XHJcbiAgICAgICAgdGhpcy5fc3lzdGVtVGltZSArPSBkZWxheTtcclxuICAgICAgICB0aGlzLmZ1bmNzLmZvckVhY2goKHZhbHVlOiBGdW5jdGlvbikgPT57XHJcbiAgICAgICAgICAgIHZhbHVlKGRlbGF5KTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmV4ZWN1dGVGdW5jKCk7XHJcbiAgICAgICAgdGhpcy5sYXN0VGltZSA9Y3VycmVudFRpbWU7XHJcbiAgICAgICAgaWYodGhpcy5fcnVubmluZylcclxuICAgICAgICAgICAgdGhpcy50aW1lcklkID0gc2V0VGltZW91dCh0aGlzLnVwZGF0ZS5iaW5kKHRoaXMpLCB0aGlzLmRlbGF5KTtcclxuICAgIH1cclxuXHJcbiAgICBleGVjdXRlRnVuYygpe1xyXG4gICAgICAgIGlmKHRoaXMuZXhlY3V0ZUZ1bmNzWzBdICYmIHRoaXMuZXhlY3V0ZUZ1bmNzWzBdLnRpbWUgPCB0aGlzLl9zeXN0ZW1UaW1lKXtcclxuICAgICAgICAgICAgbGV0IHZhbHVlOiBFeGVjdXRlVmFsdWUgPSB0aGlzLmV4ZWN1dGVGdW5jcy5zaGlmdCgpO1xyXG4gICAgICAgICAgICB2YWx1ZS5mdW5jKCk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmV4ZWN1dGVGdW5jKCk7XHJcblxyXG4gICAgICAgICAgICAvLyBsb29wIDw9IDAgd2lsbCBiZSBpbmZpbml0ZSBsb29wXHJcbiAgICAgICAgICAgIGlmICh2YWx1ZS5sb29wID4gMCAmJiAtLXZhbHVlLmxvb3AgPT09MCl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbGV0IG5leHRUaW1lOiBudW1iZXIgPSB2YWx1ZS50aW1lICsgdmFsdWUuZGVsYXk7XHJcbiAgICAgICAgICAgIHRoaXMucmVnaXN0ZXJEZWxheVAodmFsdWUuZnVuYywgdmFsdWUuZGVsYXksIG5leHRUaW1lLCB2YWx1ZS5sb29wKVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGNsZWFyRnVuY3MoKXtcclxuICAgICAgICB0aGlzLmZ1bmNzPSBbXTtcclxuICAgIH1cclxuICAgIGNsZWFyRGVsYXlGdW5jcygpe1xyXG4gICAgICAgIHRoaXMuZXhlY3V0ZUZ1bmNzID0gW107XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSByZWdpc3RlckRlbGF5UChmdW5jOiBGdW5jdGlvbiwgZGVsYXk6IG51bWJlciwgdGltZTogbnVtYmVyLCBsb29wOiBudW1iZXIpe1xyXG4gICAgICAgIGxldCBpbmRleDogbnVtYmVyID0gdGhpcy5zZWFyY2hJbmRleCh0aW1lKTtcclxuICAgICAgICBsZXQgdmFsdWU6IEV4ZWN1dGVWYWx1ZSA9IHtmdW5jOiBmdW5jLCBkZWxheTogZGVsYXksIHRpbWU6IHRpbWUsIGxvb3A6IGxvb3B9O1xyXG4gICAgICAgIHRoaXMuZXhlY3V0ZUZ1bmNzLnNwbGljZShpbmRleCwgMCwgdmFsdWUpO1xyXG4gICAgfVxyXG59XHJcblxyXG5pbnRlcmZhY2UgRXhlY3V0ZVZhbHVlIHtcclxuICAgIGZ1bmM6IEZ1bmN0aW9uO1xyXG4gICAgdGltZTogbnVtYmVyO1xyXG4gICAgZGVsYXk6IG51bWJlcjtcclxuICAgIGxvb3A6IG51bWJlcjtcclxufSJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBVUE7QUFUQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/Timer.ts\n");

/***/ }),

/***/ "./src/demo.ts":
/*!*********************!*\
  !*** ./src/demo.ts ***!
  \*********************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _SlimTabV2Types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./SlimTabV2Types */ \"./src/SlimTabV2Types.ts\");\n/* harmony import */ var _SlimTabV2__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./SlimTabV2 */ \"./src/SlimTabV2.ts\");\n/* harmony import */ var _DataAdapter__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./DataAdapter */ \"./src/DataAdapter.ts\");\n/* harmony import */ var _LiCAP__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./LiCAP */ \"./src/LiCAP.ts\");\n/* harmony import */ var _Metronome__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./Metronome */ \"./src/Metronome.ts\");\n/* harmony import */ var _instrumentCorrection__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./instrumentCorrection */ \"./src/instrumentCorrection.ts\");\n/* harmony import */ var _SlimTabV2Editor__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./SlimTabV2Editor */ \"./src/SlimTabV2Editor.ts\");\n/* harmony import */ var _LiCAPStream__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./LiCAPStream */ \"./src/LiCAPStream.ts\");\n/* harmony import */ var _SLPract__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./SLPract */ \"./src/SLPract.ts\");\n/* harmony import */ var _KeyBoardAdapter__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./KeyBoardAdapter */ \"./src/KeyBoardAdapter.ts\");\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nlet ka = new _KeyBoardAdapter__WEBPACK_IMPORTED_MODULE_9__[\"KeyBoardAdapter\"]();\r\nlet nt = new _SlimTabV2__WEBPACK_IMPORTED_MODULE_1__[\"SLTab\"]();\r\nlet data = [\r\n    []\r\n    // [// section\r\n    //     // [4, [3, -1, -1, 4, -1, -1], null],// note length, [block number, index is string number,], user data\r\n    //     [4, [3, 5, 2, -1, -1, -1], null],\r\n    //     [4, [-1, 5, 2, -1, -1, -1], null],\r\n    //     [4, [-1, 5, 2, -1, -1, -1], null],\r\n    //     [8, [-1, 5, 2, -1, -1, -1], null],\r\n    // ],\r\n    // [\r\n    //     [8, [-1, 5, 2, -1, -1, -1], null],\r\n    //     [4, [-1, 5, 2, -1, -1, -1], null],\r\n    //     [4, [-1, 5, 2, -1, -1, -1], null],\r\n    //     [8, [-1, 5, 2, -1, -1, -1], null],\r\n    //     [8, [-1, 5, 2, -1, -1, -1], null],\r\n    // ]\r\n];\r\nnt.setData(data);\r\nlet tabEditor = new _SlimTabV2Editor__WEBPACK_IMPORTED_MODULE_6__[\"SLEditor\"](nt);\r\nnt.attach(document.getElementById(\"slimtab\"));\r\ndocument.addEventListener(\"keydown\", (e) => {\r\n    let ka = [32, 37, 38, 39, 40]; //space: 32, left: 37, up: 38, right: 39, down: 40,\r\n    if (ka.includes(e.keyCode)) {\r\n        e.preventDefault();\r\n        e.returnValue = false;\r\n    }\r\n});\r\nnt.render();\r\nlet da = new _DataAdapter__WEBPACK_IMPORTED_MODULE_2__[\"DataAdapter\"]();\r\nda.timeOffset = 40;\r\nlet device;\r\nlet beep = new _Metronome__WEBPACK_IMPORTED_MODULE_4__[\"Metronome\"](120);\r\n_LiCAP__WEBPACK_IMPORTED_MODULE_3__[\"LiCAP\"].enumerate().then((devs) => {\r\n    if (devs.length > 0) {\r\n        device = devs[0];\r\n        devs[0].on(\"pick\", (strIndex, note, amp, time) => {\r\n            da.startTimeOffset = -beep.getStartTime();\r\n            da.receiveData(strIndex, note, amp, time);\r\n        });\r\n        devs[0].on(\"message\", (e) => {\r\n            da.startTimeOffset = -beep.getStartTime();\r\n            let freq = ka.noteKeyToFrequency(e.data[1]);\r\n            let [string, block] = ka.frequencyToStringData(freq);\r\n            da.receiveData(string, block, e.data[2], e.timeStamp);\r\n        });\r\n    }\r\n});\r\nda.addPackListener((data) => {\r\n    if (data.userData === \"undefined-value\") {\r\n        if (nt.isSectionFull(nt.getSectionNumber() - 1)) {\r\n            nt.addNote(-1, -1, data);\r\n        }\r\n        else {\r\n            nt.addNote(nt.getSectionNumber() - 1, -1, data);\r\n        }\r\n        nt.render();\r\n    }\r\n    else {\r\n        nt.deleteNote(-1, -1);\r\n        nt.instrumentNoteInput(_instrumentCorrection__WEBPACK_IMPORTED_MODULE_5__[\"instrumentCorrection\"], data);\r\n    }\r\n    nt.adjustPostion(nt.getSectionLeftTopPos(nt.getSectionNumber() - 1)[1]);\r\n});\r\nda.addDataListener((string, note, time) => {\r\n    pt.onPluck(string, note, performance.now() - 30 - 50 /*play lag*/);\r\n});\r\nlet bs = 0;\r\nlet beepEle = document.getElementById(\"metronome\");\r\nlet bpmDom = document.getElementById(\"metronome-bpm\");\r\nbpmDom.addEventListener(\"change\", () => {\r\n    beep.setBpm(Number(bpmDom.value));\r\n    da.setBpm(Number(bpmDom.value));\r\n    document.getElementById(\"bpm-display\").innerHTML = bpmDom.value;\r\n    console.log(bpmDom.value);\r\n});\r\nbeepEle.onclick = function (event) {\r\n    if (bs == 0) {\r\n        beep.startTick();\r\n        beepEle.style.background = \"#e99415\";\r\n        da.activate();\r\n        bs = 1;\r\n    }\r\n    else {\r\n        beep.stopTick();\r\n        beepEle.style.background = \"\";\r\n        da.deactivate();\r\n        bs = 0;\r\n    }\r\n};\r\nlet win = window;\r\nlet s;\r\nwindow.gg = () => { s = setInterval(function () { nt.instrumentNoteInput(_instrumentCorrection__WEBPACK_IMPORTED_MODULE_5__[\"instrumentCorrection\"], new _SlimTabV2Types__WEBPACK_IMPORTED_MODULE_0__[\"Note\"]([8, [-1, -1, -1, 4, -1, 6], null])); }, 100); };\r\nwindow.gx = () => { clearInterval(s); };\r\n//s= setInterval(function(){nt.instrumentNoteInput(instrumentCorrection,new Note([8, [-1, -1, -1, 4, -1, 6], null]))}, 100);\r\n//nt.instrumentNoteInput(instrumentCorrection,[4, [-1, -1, -1, 4, -1, 6], null]);\r\n//nt.instrumentNoteInput(instrumentCorrection,[4, [-1, -1, -1, 4, -1, 6], null]);\r\n// nt.instrumentNoteInput(instrumentCorrection,[8/3, [-1, -1, -1, 4, -1, 6], null]);\r\n//nt.instrumentNoteInput(instrumentCorrection,[4, [-1, -1, -1, 4, -1, 6], null], 0, 2);\r\nfunction pad(num, size) { return ('000000000' + num).substr(-size); }\r\nnt.on(\"noteclick\", (sectionIdx, noteIdx, stringIdx) => {\r\n    document.getElementById(\"section-idx\").innerText = pad(String(sectionIdx + 1), 3) + \".\";\r\n});\r\nlet stream = new _LiCAPStream__WEBPACK_IMPORTED_MODULE_7__[\"LiCAPStream\"]();\r\ndocument.getElementById('playstream').addEventListener('click', () => {\r\n    stream.play();\r\n});\r\nconsole.log(nt);\r\nlet pt = new _SLPract__WEBPACK_IMPORTED_MODULE_8__[\"SLPract\"](nt, tabEditor, beep);\r\ndocument.addEventListener(\"keydown\", (ev) => {\r\n    if ((ev.key).toLowerCase() === \" \") {\r\n        da.activate();\r\n        setTimeout(() => device.resetTimer(), 2000);\r\n    }\r\n    if (ev.key == \"r\" || ev.key == \"e\") {\r\n        //console.log(ev.timeStamp - beep.getStartTime());\r\n        da.startTimeOffset = -beep.getStartTime();\r\n        da.receiveData(1, 5, 2, ev.timeStamp);\r\n    }\r\n});\r\ndocument.getElementById('save-file').addEventListener('click', saveFile);\r\nfunction saveFile() {\r\n    let dl = document.createElement(\"a\");\r\n    dl.setAttribute(\"download\", \"tablature.tab\");\r\n    dl.style.display = \"none\";\r\n    dl.setAttribute(\"href\", `data:text/plain;charset=utf-8,${JSON.stringify(nt.notes)}`);\r\n    document.body.append(dl);\r\n    dl.click();\r\n    document.body.removeChild(dl);\r\n}\r\nlet loadFileEle = document.getElementById(\"load-file\");\r\nloadFileEle.style.display = \"none\";\r\nloadFileEle.addEventListener(\"change\", (ev) => {\r\n    let reader = new FileReader();\r\n    reader.onload = (e) => {\r\n        let ldata = JSON.parse(e.target.result);\r\n        tabEditor.resetIndicator();\r\n        nt.setData(ldata);\r\n        nt.render();\r\n    };\r\n    reader.readAsText(loadFileEle.files[0]);\r\n    loadFileEle.value = \"\";\r\n});\r\ndocument.getElementById(\"load-f\").addEventListener('click', () => {\r\n    loadFileEle.click();\r\n});\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZGVtby50cy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovL1tuYW1lXS8uL3NyYy9kZW1vLnRzPzJjY2QiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgc2VjdGlvbiwgTm90ZSB9IGZyb20gXCIuL1NsaW1UYWJWMlR5cGVzXCJcclxuaW1wb3J0IHsgU0xUYWIgfSBmcm9tIFwiLi9TbGltVGFiVjJcIjtcclxuaW1wb3J0IHsgRGF0YUFkYXB0ZXIgfSBmcm9tIFwiLi9EYXRhQWRhcHRlclwiXHJcbmltcG9ydCB7IExpQ0FQLCBMaUNBUERldmljZSB9IGZyb20gXCIuL0xpQ0FQXCJcclxuaW1wb3J0IHsgTWV0cm9ub21lIH0gZnJvbSBcIi4vTWV0cm9ub21lXCJcclxuaW1wb3J0IHsgaW5zdHJ1bWVudENvcnJlY3Rpb24gfSBmcm9tIFwiLi9pbnN0cnVtZW50Q29ycmVjdGlvblwiXHJcbmltcG9ydCB7IFNMRWRpdG9yIH0gZnJvbSBcIi4vU2xpbVRhYlYyRWRpdG9yXCJcclxuaW1wb3J0IHsgTGlDQVBTdHJlYW0gfSBmcm9tIFwiLi9MaUNBUFN0cmVhbVwiXHJcbmltcG9ydCB7U0xQcmFjdH0gZnJvbSBcIi4vU0xQcmFjdFwiXHJcbmltcG9ydCB7IEtleUJvYXJkQWRhcHRlciB9IGZyb20gXCIuL0tleUJvYXJkQWRhcHRlclwiXHJcbmxldCBrYSA9IG5ldyBLZXlCb2FyZEFkYXB0ZXIoKTtcclxubGV0IG50ID0gbmV3IFNMVGFiKCk7XHJcbmxldCBkYXRhOiBbbnVtYmVyLCBudW1iZXJbXSwgYW55XVtdW10gPSBbXHJcbiAgICBbXVxyXG4gICAgLy8gWy8vIHNlY3Rpb25cclxuICAgIC8vICAgICAvLyBbNCwgWzMsIC0xLCAtMSwgNCwgLTEsIC0xXSwgbnVsbF0sLy8gbm90ZSBsZW5ndGgsIFtibG9jayBudW1iZXIsIGluZGV4IGlzIHN0cmluZyBudW1iZXIsXSwgdXNlciBkYXRhXHJcbiAgICAvLyAgICAgWzQsIFszLCA1LCAyLCAtMSwgLTEsIC0xXSwgbnVsbF0sXHJcbiAgICAvLyAgICAgWzQsIFstMSwgNSwgMiwgLTEsIC0xLCAtMV0sIG51bGxdLFxyXG4gICAgLy8gICAgIFs0LCBbLTEsIDUsIDIsIC0xLCAtMSwgLTFdLCBudWxsXSxcclxuICAgIC8vICAgICBbOCwgWy0xLCA1LCAyLCAtMSwgLTEsIC0xXSwgbnVsbF0sXHJcbiAgICAvLyBdLFxyXG4gICAgLy8gW1xyXG4gICAgLy8gICAgIFs4LCBbLTEsIDUsIDIsIC0xLCAtMSwgLTFdLCBudWxsXSxcclxuICAgIC8vICAgICBbNCwgWy0xLCA1LCAyLCAtMSwgLTEsIC0xXSwgbnVsbF0sXHJcbiAgICAvLyAgICAgWzQsIFstMSwgNSwgMiwgLTEsIC0xLCAtMV0sIG51bGxdLFxyXG4gICAgLy8gICAgIFs4LCBbLTEsIDUsIDIsIC0xLCAtMSwgLTFdLCBudWxsXSxcclxuICAgIC8vICAgICBbOCwgWy0xLCA1LCAyLCAtMSwgLTEsIC0xXSwgbnVsbF0sXHJcbiAgICAvLyBdXHJcbl07XHJcbm50LnNldERhdGEoZGF0YSk7XHJcbmxldCB0YWJFZGl0b3IgPSBuZXcgU0xFZGl0b3IobnQpO1xyXG5udC5hdHRhY2goZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzbGltdGFiXCIpKTtcclxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwoZSkgPT4ge1xyXG4gICAgbGV0IGthID0gWzMyLCAzNywgMzgsIDM5LCA0MF07IC8vc3BhY2U6IDMyLCBsZWZ0OiAzNywgdXA6IDM4LCByaWdodDogMzksIGRvd246IDQwLFxyXG4gICAgaWYoa2EuaW5jbHVkZXMoZS5rZXlDb2RlKSl7XHJcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgIGUucmV0dXJuVmFsdWUgPSBmYWxzZTtcclxuICAgIH1cclxufSk7XHJcbm50LnJlbmRlcigpO1xyXG5cclxubGV0IGRhID0gbmV3IERhdGFBZGFwdGVyKCk7XHJcbmRhLnRpbWVPZmZzZXQgPSA0MDtcclxubGV0IGRldmljZTogTGlDQVBEZXZpY2U7XHJcbmxldCBiZWVwOiBNZXRyb25vbWUgPSBuZXcgTWV0cm9ub21lKDEyMCk7XHJcbkxpQ0FQLmVudW1lcmF0ZSgpLnRoZW4oKGRldnMpPT57XHJcbiAgICBpZihkZXZzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICBkZXZpY2UgPSBkZXZzWzBdO1xyXG4gICAgICAgIGRldnNbMF0ub24oXCJwaWNrXCIsIChzdHJJbmRleCwgbm90ZSwgYW1wLCB0aW1lKT0+e1xyXG4gICAgICAgICAgICBkYS5zdGFydFRpbWVPZmZzZXQgPSAtYmVlcC5nZXRTdGFydFRpbWUoKTtcclxuICAgICAgICAgICAgZGEucmVjZWl2ZURhdGEoc3RySW5kZXgsIG5vdGUsIGFtcCwgdGltZSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgZGV2c1swXS5vbihcIm1lc3NhZ2VcIiwgKGUpID0+IHtcclxuICAgICAgICAgICAgZGEuc3RhcnRUaW1lT2Zmc2V0ID0gLWJlZXAuZ2V0U3RhcnRUaW1lKCk7XHJcbiAgICAgICAgICAgIGxldCBmcmVxID0ga2Eubm90ZUtleVRvRnJlcXVlbmN5KGUuZGF0YVsxXSk7XHJcbiAgICAgICAgICAgIGxldCBbc3RyaW5nLCBibG9ja10gPSBrYS5mcmVxdWVuY3lUb1N0cmluZ0RhdGEoZnJlcSk7XHJcbiAgICAgICAgICAgIGRhLnJlY2VpdmVEYXRhKHN0cmluZywgYmxvY2ssIGUuZGF0YVsyXSwgZS50aW1lU3RhbXApO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59KTtcclxuXHJcbmRhLmFkZFBhY2tMaXN0ZW5lcigoZGF0YTogTm90ZSk9PntcclxuICAgIGlmKGRhdGEudXNlckRhdGEgPT09IFwidW5kZWZpbmVkLXZhbHVlXCIpe1xyXG4gICAgICAgIGlmKG50LmlzU2VjdGlvbkZ1bGwobnQuZ2V0U2VjdGlvbk51bWJlcigpIC0xKSl7XHJcbiAgICAgICAgICAgIG50LmFkZE5vdGUoLTEgLCAtMSwgZGF0YSk7XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIG50LmFkZE5vdGUobnQuZ2V0U2VjdGlvbk51bWJlcigpIC0xICwgLTEsIGRhdGEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBudC5yZW5kZXIoKTtcclxuICAgIH1lbHNleyAgXHJcbiAgICAgICAgbnQuZGVsZXRlTm90ZSgtMSwgLTEpO1xyXG4gICAgICAgIG50Lmluc3RydW1lbnROb3RlSW5wdXQoaW5zdHJ1bWVudENvcnJlY3Rpb24sIGRhdGEpO1xyXG4gICAgfVxyXG4gICAgbnQuYWRqdXN0UG9zdGlvbihudC5nZXRTZWN0aW9uTGVmdFRvcFBvcyhudC5nZXRTZWN0aW9uTnVtYmVyKCkgLSAxKVsxXSk7XHJcbn0pO1xyXG5kYS5hZGREYXRhTGlzdGVuZXIoKHN0cmluZzpudW1iZXIsIG5vdGU6IG51bWJlciwgdGltZTpudW1iZXIpPT57XHJcbiAgICBwdC5vblBsdWNrKHN0cmluZywgbm90ZSwgcGVyZm9ybWFuY2Uubm93KCkgLSAzMCAtIDUwIC8qcGxheSBsYWcqLyk7XHJcbn0pXHJcbmxldCBicyA9IDA7XHJcbmxldCBiZWVwRWxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJtZXRyb25vbWVcIik7XHJcbmxldCBicG1Eb20gPSA8SFRNTElucHV0RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm1ldHJvbm9tZS1icG1cIik7XHJcbmJwbURvbS5hZGRFdmVudExpc3RlbmVyKFwiY2hhbmdlXCIsKCkgPT57XHJcbiAgICBiZWVwLnNldEJwbShOdW1iZXIoYnBtRG9tLnZhbHVlKSk7XHJcbiAgICBkYS5zZXRCcG0oTnVtYmVyKGJwbURvbS52YWx1ZSkpO1xyXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJicG0tZGlzcGxheVwiKS5pbm5lckhUTUwgPSBicG1Eb20udmFsdWU7XHJcbiAgICBjb25zb2xlLmxvZyhicG1Eb20udmFsdWUpO1xyXG59KTtcclxuYmVlcEVsZS5vbmNsaWNrID0gZnVuY3Rpb24oZXZlbnQpe1xyXG4gICAgaWYoYnMgPT0gMCl7XHJcbiAgICAgICAgYmVlcC5zdGFydFRpY2soKTtcclxuICAgICAgICBiZWVwRWxlLnN0eWxlLmJhY2tncm91bmQgPSBcIiNlOTk0MTVcIjtcclxuICAgICAgICBkYS5hY3RpdmF0ZSgpO1xyXG4gICAgICAgIGJzID0gMTtcclxuICAgIH1lbHNle1xyXG4gICAgICAgIGJlZXAuc3RvcFRpY2soKTtcclxuICAgICAgICBiZWVwRWxlLnN0eWxlLmJhY2tncm91bmQgPSBcIlwiO1xyXG4gICAgICAgIGRhLmRlYWN0aXZhdGUoKTtcclxuICAgICAgICBicyA9IDA7XHJcbiAgICB9XHJcbn1cclxuIGxldCB3aW4gPSB3aW5kb3c7XHJcbiBsZXQgczogYW55O1xyXG4gKHdpbmRvdyBhcyBhbnkpLmdnID0gKCkgPT4ge3MgPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpe250Lmluc3RydW1lbnROb3RlSW5wdXQoaW5zdHJ1bWVudENvcnJlY3Rpb24sbmV3IE5vdGUoWzgsIFstMSwgLTEsIC0xLCA0LCAtMSwgNl0sIG51bGxdKSl9LCAxMDApO307XHJcbiAod2luZG93IGFzIGFueSkuZ3ggPSAoKSA9PiB7Y2xlYXJJbnRlcnZhbChzKTt9XHJcbi8vcz0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKXtudC5pbnN0cnVtZW50Tm90ZUlucHV0KGluc3RydW1lbnRDb3JyZWN0aW9uLG5ldyBOb3RlKFs4LCBbLTEsIC0xLCAtMSwgNCwgLTEsIDZdLCBudWxsXSkpfSwgMTAwKTtcclxuLy9udC5pbnN0cnVtZW50Tm90ZUlucHV0KGluc3RydW1lbnRDb3JyZWN0aW9uLFs0LCBbLTEsIC0xLCAtMSwgNCwgLTEsIDZdLCBudWxsXSk7XHJcbi8vbnQuaW5zdHJ1bWVudE5vdGVJbnB1dChpbnN0cnVtZW50Q29ycmVjdGlvbixbNCwgWy0xLCAtMSwgLTEsIDQsIC0xLCA2XSwgbnVsbF0pO1xyXG4vLyBudC5pbnN0cnVtZW50Tm90ZUlucHV0KGluc3RydW1lbnRDb3JyZWN0aW9uLFs4LzMsIFstMSwgLTEsIC0xLCA0LCAtMSwgNl0sIG51bGxdKTtcclxuLy9udC5pbnN0cnVtZW50Tm90ZUlucHV0KGluc3RydW1lbnRDb3JyZWN0aW9uLFs0LCBbLTEsIC0xLCAtMSwgNCwgLTEsIDZdLCBudWxsXSwgMCwgMik7XHJcblxyXG5cclxuZnVuY3Rpb24gcGFkKG51bTogc3RyaW5nLCBzaXplOiBudW1iZXIpeyByZXR1cm4gKCcwMDAwMDAwMDAnICsgbnVtKS5zdWJzdHIoLXNpemUpOyB9XHJcblxyXG5udC5vbihcIm5vdGVjbGlja1wiLCAoc2VjdGlvbklkeCwgbm90ZUlkeCwgc3RyaW5nSWR4KSA9PiB7XHJcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNlY3Rpb24taWR4XCIpLmlubmVyVGV4dCA9IHBhZChTdHJpbmcoc2VjdGlvbklkeCsxKSwgMykgKyBcIi5cIjtcclxufSlcclxuXHJcbmxldCBzdHJlYW0gPSBuZXcgTGlDQVBTdHJlYW0oKTtcclxuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BsYXlzdHJlYW0nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcclxuICAgIHN0cmVhbS5wbGF5KCk7XHJcbn0pXHJcbmNvbnNvbGUubG9nKG50KVxyXG5sZXQgcHQgPSBuZXcgU0xQcmFjdChudCwgdGFiRWRpdG9yLCBiZWVwKTtcclxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwoZXYpPT57XHJcbiAgICBpZigoZXYua2V5KS50b0xvd2VyQ2FzZSgpID09PSBcIiBcIil7XHJcbiAgICAgICAgZGEuYWN0aXZhdGUoKVxyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4gZGV2aWNlLnJlc2V0VGltZXIoKSwgMjAwMCk7XHJcbiAgICB9XHJcbiAgICBpZihldi5rZXkgPT0gXCJyXCIgfHwgZXYua2V5ID09IFwiZVwiKXtcclxuICAgICAgICAvL2NvbnNvbGUubG9nKGV2LnRpbWVTdGFtcCAtIGJlZXAuZ2V0U3RhcnRUaW1lKCkpO1xyXG4gICAgICAgIGRhLnN0YXJ0VGltZU9mZnNldCA9IC1iZWVwLmdldFN0YXJ0VGltZSgpO1xyXG4gICAgICAgIGRhLnJlY2VpdmVEYXRhKDEsIDUsIDIsIGV2LnRpbWVTdGFtcCk7XHJcbiAgICB9XHJcbn0pO1xyXG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2F2ZS1maWxlJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzYXZlRmlsZSk7XHJcbmZ1bmN0aW9uIHNhdmVGaWxlKCl7XHJcbiAgICBsZXQgZGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYVwiKTtcclxuICAgIGRsLnNldEF0dHJpYnV0ZShcImRvd25sb2FkXCIsIFwidGFibGF0dXJlLnRhYlwiKTtcclxuICAgIGRsLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcclxuICAgIGRsLnNldEF0dHJpYnV0ZShcImhyZWZcIiwgYGRhdGE6dGV4dC9wbGFpbjtjaGFyc2V0PXV0Zi04LCR7SlNPTi5zdHJpbmdpZnkobnQubm90ZXMpfWApO1xyXG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmQoZGwpO1xyXG4gICAgZGwuY2xpY2soKTtcclxuICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoZGwpO1xyXG59XHJcbmxldCBsb2FkRmlsZUVsZSA9IDxIVE1MSW5wdXRFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibG9hZC1maWxlXCIpO1xyXG5sb2FkRmlsZUVsZS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XHJcbmxvYWRGaWxlRWxlLmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgKGV2KSA9PiB7XHJcbiAgICBsZXQgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcclxuICAgIHJlYWRlci5vbmxvYWQgPSAoZSk9PntcclxuICAgICAgICBsZXQgbGRhdGEgPSA8W251bWJlciwgbnVtYmVyW10sIGFueV1bXVtdPkpTT04ucGFyc2UoPHN0cmluZz4oPEZpbGVSZWFkZXI+ZS50YXJnZXQpLnJlc3VsdCk7XHJcbiAgICAgICAgdGFiRWRpdG9yLnJlc2V0SW5kaWNhdG9yKCk7XHJcbiAgICAgICAgbnQuc2V0RGF0YShsZGF0YSk7XHJcbiAgICAgICAgbnQucmVuZGVyKCk7XHJcbiAgICB9XHJcbiAgICByZWFkZXIucmVhZEFzVGV4dChsb2FkRmlsZUVsZS5maWxlc1swXSk7XHJcbiAgICBsb2FkRmlsZUVsZS52YWx1ZT1cIlwiO1xyXG59KTtcclxuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJsb2FkLWZcIikuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgICBsb2FkRmlsZUVsZS5jbGljaygpO1xyXG59KTtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/demo.ts\n");

/***/ }),

/***/ "./src/instrumentCorrection.ts":
/*!*************************************!*\
  !*** ./src/instrumentCorrection.ts ***!
  \*************************************/
/*! exports provided: instrumentCorrection */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"instrumentCorrection\", function() { return instrumentCorrection; });\n/* harmony import */ var _SlimTabV2Types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./SlimTabV2Types */ \"./src/SlimTabV2Types.ts\");\n\r\nconst instrumentCorrection = function (sltab, addData, section, note, userData = \"\") {\r\n    sltab.deleteNote(section, note, sltab.getNoteNumberOfSection(section));\r\n    let stackLength = 0; // unit in beat\r\n    for (let i = 0; i < note; i++) {\r\n        stackLength += sltab.lengthPerBeat / sltab.notes[section][i][0];\r\n    }\r\n    addData.userData += ` ${userData}`;\r\n    if (stackLength >= sltab.beatPerSection) {\r\n        sltab.insertSection(-1, []);\r\n        sltab.addNote(section + 1, -1, addData);\r\n    }\r\n    else if (stackLength + sltab.lengthPerBeat / addData[0] > sltab.beatPerSection) {\r\n        let restLength = sltab.beatPerSection - stackLength;\r\n        let addLength = sltab.lengthPerBeat / (sltab.lengthPerBeat / addData[0] - restLength);\r\n        restLength = sltab.lengthPerBeat / restLength;\r\n        sltab.addNote(section, -1, new _SlimTabV2Types__WEBPACK_IMPORTED_MODULE_0__[\"Note\"]({ noteValue: restLength, stringContent: addData[1], userData: \"linkStart \" + userData }));\r\n        sltab.insertSection(-1, []);\r\n        instrumentCorrection(sltab, new _SlimTabV2Types__WEBPACK_IMPORTED_MODULE_0__[\"Note\"]({ noteValue: addLength, stringContent: addData[1], userData: \"\" }), section + 1, 0, \"linkEnd\");\r\n        return;\r\n    }\r\n    else {\r\n        let noteRestLength = 1 - stackLength % 1; // unit in beat\r\n        if (noteRestLength >= sltab.lengthPerBeat / addData[0]) {\r\n            sltab.addNote(section, -1, addData);\r\n        }\r\n        else {\r\n            let noteAddLength = sltab.lengthPerBeat / addData[0] - noteRestLength;\r\n            sltab.addNote(section, -1, new _SlimTabV2Types__WEBPACK_IMPORTED_MODULE_0__[\"Note\"]({ noteValue: sltab.lengthPerBeat / noteRestLength, stringContent: addData[1], userData: \"linkStart \" + userData }));\r\n            sltab.addNote(section, -1, new _SlimTabV2Types__WEBPACK_IMPORTED_MODULE_0__[\"Note\"]({ noteValue: sltab.lengthPerBeat / noteAddLength, stringContent: addData[1], userData: \"linkEnd\" }));\r\n        }\r\n    }\r\n};\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvaW5zdHJ1bWVudENvcnJlY3Rpb24udHMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvaW5zdHJ1bWVudENvcnJlY3Rpb24udHM/MzlhZCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb3JyZWN0aW9uIH0gZnJvbSBcIi4vU2xpbVRhYlYySW50ZXJmYWNlXCJcclxuaW1wb3J0IHsgc2VjdGlvbiwgTm90ZSB9IGZyb20gXCIuL1NsaW1UYWJWMlR5cGVzXCJcclxuaW1wb3J0IHsgU0xUYWIgfSBmcm9tIFwiLi9TbGltVGFiVjJcIlxyXG5jb25zdCBpbnN0cnVtZW50Q29ycmVjdGlvbjogQ29ycmVjdGlvbiA9IGZ1bmN0aW9uKHNsdGFiOiBTTFRhYiwgYWRkRGF0YTogTm90ZSwgc2VjdGlvbjogbnVtYmVyLCBub3RlOiBudW1iZXIsIHVzZXJEYXRhOiBzdHJpbmcgPSBcIlwiKXtcclxuICAgIHNsdGFiLmRlbGV0ZU5vdGUoc2VjdGlvbiwgbm90ZSAsIHNsdGFiLmdldE5vdGVOdW1iZXJPZlNlY3Rpb24oc2VjdGlvbikpO1xyXG4gICAgbGV0IHN0YWNrTGVuZ3RoID0gMDsvLyB1bml0IGluIGJlYXRcclxuICAgIGZvcihsZXQgaSA9IDA7IGkgPCBub3RlOyBpKyspe1xyXG4gICAgICAgIHN0YWNrTGVuZ3RoICs9IHNsdGFiLmxlbmd0aFBlckJlYXQgLyBzbHRhYi5ub3Rlc1tzZWN0aW9uXVtpXVswXTtcclxuICAgIH1cclxuICAgIGFkZERhdGEudXNlckRhdGEgKz0gYCAke3VzZXJEYXRhfWA7XHJcbiAgICBpZihzdGFja0xlbmd0aCA+PSBzbHRhYi5iZWF0UGVyU2VjdGlvbil7XHJcbiAgICAgICAgc2x0YWIuaW5zZXJ0U2VjdGlvbigtMSwgW10pO1xyXG4gICAgICAgIHNsdGFiLmFkZE5vdGUoc2VjdGlvbiArIDEsIC0xLCBhZGREYXRhKTtcclxuICAgIH1lbHNlIGlmKHN0YWNrTGVuZ3RoICsgc2x0YWIubGVuZ3RoUGVyQmVhdCAvIGFkZERhdGFbMF0gPiBzbHRhYi5iZWF0UGVyU2VjdGlvbil7XHJcbiAgICAgICAgbGV0IHJlc3RMZW5ndGggPSBzbHRhYi5iZWF0UGVyU2VjdGlvbiAtIHN0YWNrTGVuZ3RoO1xyXG4gICAgICAgIGxldCBhZGRMZW5ndGggPSBzbHRhYi5sZW5ndGhQZXJCZWF0IC8gKHNsdGFiLmxlbmd0aFBlckJlYXQgLyBhZGREYXRhWzBdIC0gcmVzdExlbmd0aCk7XHJcbiAgICAgICAgcmVzdExlbmd0aCA9IHNsdGFiLmxlbmd0aFBlckJlYXQgLyByZXN0TGVuZ3RoO1xyXG4gICAgICAgIHNsdGFiLmFkZE5vdGUoc2VjdGlvbiwgLTEsIG5ldyBOb3RlKHtub3RlVmFsdWU6IHJlc3RMZW5ndGgsIHN0cmluZ0NvbnRlbnQ6IGFkZERhdGFbMV0sIHVzZXJEYXRhOiBcImxpbmtTdGFydCBcIiArIHVzZXJEYXRhfSkpO1xyXG4gICAgICAgIHNsdGFiLmluc2VydFNlY3Rpb24oLTEsIFtdKTtcclxuICAgICAgICBpbnN0cnVtZW50Q29ycmVjdGlvbihzbHRhYiwgbmV3IE5vdGUoe25vdGVWYWx1ZTogYWRkTGVuZ3RoLCBzdHJpbmdDb250ZW50OiBhZGREYXRhWzFdLCB1c2VyRGF0YTogXCJcIn0pLCBzZWN0aW9uICsgMSwgMCwgXCJsaW5rRW5kXCIpO1xyXG4gICAgICAgIHJldHVybjsgXHJcbiAgICB9ZWxzZXtcclxuICAgICAgICBsZXQgbm90ZVJlc3RMZW5ndGggPSAxIC0gc3RhY2tMZW5ndGggJSAxOyAvLyB1bml0IGluIGJlYXRcclxuICAgICAgICBpZihub3RlUmVzdExlbmd0aCA+PSBzbHRhYi5sZW5ndGhQZXJCZWF0IC8gYWRkRGF0YVswXSl7XHJcbiAgICAgICAgICAgIHNsdGFiLmFkZE5vdGUoc2VjdGlvbiwgLTEsIGFkZERhdGEpO1xyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICBsZXQgbm90ZUFkZExlbmd0aCA9IHNsdGFiLmxlbmd0aFBlckJlYXQgLyBhZGREYXRhWzBdIC0gbm90ZVJlc3RMZW5ndGg7XHJcbiAgICAgICAgICAgIHNsdGFiLmFkZE5vdGUoc2VjdGlvbiwgLTEsIG5ldyBOb3RlKHtub3RlVmFsdWU6IHNsdGFiLmxlbmd0aFBlckJlYXQgLyBub3RlUmVzdExlbmd0aCwgc3RyaW5nQ29udGVudDogYWRkRGF0YVsxXSwgdXNlckRhdGE6IFwibGlua1N0YXJ0IFwiICsgdXNlckRhdGF9KSk7XHJcbiAgICAgICAgICAgIHNsdGFiLmFkZE5vdGUoc2VjdGlvbiwgLTEsIG5ldyBOb3RlKHtub3RlVmFsdWU6IHNsdGFiLmxlbmd0aFBlckJlYXQgLyBub3RlQWRkTGVuZ3RoLCBzdHJpbmdDb250ZW50OiBhZGREYXRhWzFdLCB1c2VyRGF0YTogXCJsaW5rRW5kXCJ9KSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbmV4cG9ydCB7IGluc3RydW1lbnRDb3JyZWN0aW9uIH07Il0sIm1hcHBpbmdzIjoiQUFDQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/instrumentCorrection.ts\n");

/***/ }),

/***/ "./src/utils.ts":
/*!**********************!*\
  !*** ./src/utils.ts ***!
  \**********************/
/*! exports provided: utils, Callbacks */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"utils\", function() { return utils; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Callbacks\", function() { return Callbacks; });\nvar utils;\r\n(function (utils) {\r\n    function setAttributes(el, attr) {\r\n        for (let k in attr) {\r\n            el.setAttribute(k, attr[k]);\r\n        }\r\n    }\r\n    utils.setAttributes = setAttributes;\r\n    function setStyle(el, style) {\r\n        for (let k in style) {\r\n            el.style.setProperty(k, style[k]);\r\n        }\r\n    }\r\n    utils.setStyle = setStyle;\r\n    const noteNumber = { \"C\": 0, \"C#\": 1, \"D\": 2, \"D#\": 3, \"E\": 4, \"F\": 5, \"F#\": 6, \"G\": 7, \"G#\": 8, \"A\": 9, \"A#\": 10, \"B\": 11 };\r\n    const regex = /^([CDEFGAB]#?)([0-9])$/;\r\n    function noteToDecimal(note) {\r\n        let groups = regex.exec(note);\r\n        if (groups.length != 3)\r\n            return -1;\r\n        return noteNumber[groups[1]] + (Number(groups[2]) + 1) * 12;\r\n    }\r\n    utils.noteToDecimal = noteToDecimal;\r\n})(utils || (utils = {}));\r\nclass ArrayFunction {\r\n    constructor() {\r\n        this.funcs = [];\r\n    }\r\n    callAll(...args) {\r\n        this.funcs.forEach((func) => {\r\n            func(...args);\r\n        });\r\n    }\r\n    push(cbk) {\r\n        this.funcs.push(cbk);\r\n    }\r\n}\r\n;\r\nclass Callbacks {\r\n    constructor(eventType) {\r\n        eventType.forEach(element => {\r\n            this[element] = new ArrayFunction();\r\n        });\r\n    }\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvdXRpbHMudHMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvdXRpbHMudHM/N2RkYSJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgbmFtZXNwYWNlIHV0aWxzIHtcclxuICAgIGV4cG9ydCBmdW5jdGlvbiBzZXRBdHRyaWJ1dGVzKGVsOiBFbGVtZW50LCBhdHRyOntba2V5OiBzdHJpbmddOiBzdHJpbmd9KXtcclxuICAgICAgICBmb3IobGV0IGsgaW4gYXR0cil7XHJcbiAgICAgICAgICAgIGVsLnNldEF0dHJpYnV0ZShrLCBhdHRyW2tdKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBleHBvcnQgZnVuY3Rpb24gc2V0U3R5bGUoZWw6IEhUTUxFbGVtZW50LCBzdHlsZTp7W2tleTogc3RyaW5nXTogc3RyaW5nfSl7XHJcbiAgICAgICAgZm9yKGxldCBrIGluIHN0eWxlKXtcclxuICAgICAgICAgICAgZWwuc3R5bGUuc2V0UHJvcGVydHkoaywgc3R5bGVba10pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBub3RlTnVtYmVyID0ge1wiQ1wiOiAwLCBcIkMjXCI6IDEsIFwiRFwiOiAyLCBcIkQjXCI6IDMsIFwiRVwiOiA0LCBcIkZcIjogNSwgXCJGI1wiOiA2LCBcIkdcIjogNywgXCJHI1wiOiA4LCBcIkFcIjogOSwgXCJBI1wiOiAxMCwgXCJCXCI6IDExfTtcclxuICAgIGNvbnN0IHJlZ2V4ID0gL14oW0NERUZHQUJdIz8pKFswLTldKSQvO1xyXG4gICAgZXhwb3J0IGZ1bmN0aW9uIG5vdGVUb0RlY2ltYWwobm90ZTogc3RyaW5nKSB7XHJcbiAgICAgICAgbGV0IGdyb3VwcyA9IHJlZ2V4LmV4ZWMobm90ZSk7XHJcbiAgICAgICAgaWYoZ3JvdXBzLmxlbmd0aCAhPSAzKVxyXG4gICAgICAgICAgICByZXR1cm4gLTE7XHJcbiAgICAgICAgcmV0dXJuIG5vdGVOdW1iZXJbZ3JvdXBzWzFdIGFzIGtleW9mIHR5cGVvZiBub3RlTnVtYmVyXSsoTnVtYmVyKGdyb3Vwc1syXSkrMSkqMTI7XHJcbiAgICB9XHJcbn1cclxuXHJcblxyXG5jbGFzcyBBcnJheUZ1bmN0aW9uIHtcclxuICAgIHByaXZhdGUgZnVuY3M6IEFycmF5PEZ1bmN0aW9uPiA9IFtdO1xyXG4gICAgY2FsbEFsbCguLi5hcmdzOiBhbnlbXSkge1xyXG4gICAgICAgIHRoaXMuZnVuY3MuZm9yRWFjaCgoZnVuYykgPT4ge1xyXG4gICAgICAgICAgICBmdW5jKC4uLmFyZ3MpO1xyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgcHVzaChjYms6ICguLi5hcmdzOiBhbnlbXSkgPT4gdm9pZCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuZnVuY3MucHVzaChjYmspO1xyXG4gICAgfVxyXG59O1xyXG5cclxuZXhwb3J0IGNsYXNzIENhbGxiYWNrcyB7XHJcbiAgICBba2V5OiBzdHJpbmddOiBBcnJheUZ1bmN0aW9uO1xyXG4gICAgY29uc3RydWN0b3IoZXZlbnRUeXBlOiBBcnJheTxzdHJpbmc+KSB7XHJcbiAgICAgICAgZXZlbnRUeXBlLmZvckVhY2goZWxlbWVudCA9PiB7XHJcbiAgICAgICAgICAgIHRoaXNbZWxlbWVudF0gPSBuZXcgQXJyYXlGdW5jdGlvbigpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59XHJcblxyXG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTEE7QUFNQTtBQUdBO0FBQUE7QUFDQTtBQVVBO0FBVEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/utils.ts\n");

/***/ })

/******/ });