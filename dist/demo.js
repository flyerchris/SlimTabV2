var demo =
/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./src/demo.ts");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./src/DataAdapter.ts":
/*!****************************!*\
  !*** ./src/DataAdapter.ts ***!
  \****************************/
/*! exports provided: DataAdapter */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"DataAdapter\", function() { return DataAdapter; });\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./utils */ \"./src/utils.ts\");\n\r\nclass DataAdapter {\r\n    constructor(bpm) {\r\n        this.rawData = [];\r\n        this.spb = 60 * 1000 / 120; // second per beat, defalut value corresponds to 120 bpm\r\n        this.lengthPerBeat = 4;\r\n        if (bpm) {\r\n            this.spb = 60 * 1000 / bpm;\r\n        }\r\n        this.callbacks = new _utils__WEBPACK_IMPORTED_MODULE_0__[\"Callbacks\"]([\"data\"]);\r\n    }\r\n    receiveData(stringIndex, note, amp, time) {\r\n        this.rawData.push([stringIndex, note, time]);\r\n        if (!this.receiveInterval) {\r\n            this.receiveInterval = setTimeout(this.packNote.bind(this), 10);\r\n        }\r\n    }\r\n    addDataListener(cb) {\r\n        this.callbacks[\"data\"].push(cb);\r\n    }\r\n    packNote() {\r\n        let notes = [-1, -1, -1, -1, -1, -1];\r\n        for (let i = 0; i < this.rawData.length; i++) {\r\n            notes[this.rawData[i][0]] = this.rawData[i][1];\r\n        }\r\n        if (this.noteRawData) {\r\n            let duration = this.rawData[0][2] - this.preTime;\r\n            if (duration > this.spb * this.lengthPerBeat) {\r\n                this.noteRawData[0] = 1;\r\n            }\r\n            else {\r\n                let l2 = Math.log(this.spb / duration) / Math.log(2);\r\n                let l3 = Math.log(this.spb / (3 * duration)) / Math.log(2) + 1;\r\n                let bl = Math.pow(2, Math.ceil(l2 - 0.5));\r\n                this.noteRawData[0] = this.lengthPerBeat * bl;\r\n            }\r\n            this.callbacks[\"data\"].callAll(this.noteRawData);\r\n        }\r\n        this.preTime = this.rawData[0][2];\r\n        this.noteRawData = [8, notes, null];\r\n        this.rawData = [];\r\n        this.receiveInterval = null;\r\n    }\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRGF0YUFkYXB0ZXIudHMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvRGF0YUFkYXB0ZXIudHM/MjUyMSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDYWxsYmFja3MgfSBmcm9tIFwiLi91dGlsc1wiXG5pbXBvcnQgeyBub3RlIH0gZnJvbSBcIi4vU2xpbVRhYlYyVHlwZXNcIlxuZXhwb3J0IGNsYXNzIERhdGFBZGFwdGVye1xuICAgIHByaXZhdGUgcmF3RGF0YTogW251bWJlciwgbnVtYmVyLCBudW1iZXJdW10gPSBbXTtcbiAgICBwcml2YXRlIHByZVRpbWU6IG51bWJlcjtcbiAgICBwcml2YXRlIG5vdGVSYXdEYXRhOiBub3RlO1xuICAgIHByaXZhdGUgcmVjZWl2ZUludGVydmFsOm51bWJlcjtcbiAgICBwcml2YXRlIHNwYjogbnVtYmVyID0gNjAgKiAxMDAwIC8gMTIwOyAvLyBzZWNvbmQgcGVyIGJlYXQsIGRlZmFsdXQgdmFsdWUgY29ycmVzcG9uZHMgdG8gMTIwIGJwbVxuICAgIHByaXZhdGUgbGVuZ3RoUGVyQmVhdDogbnVtYmVyID0gNDtcbiAgICBwcml2YXRlIGNhbGxiYWNrczogQ2FsbGJhY2tzO1xuICAgIFxuICAgIGNvbnN0cnVjdG9yKGJwbT86IG51bWJlcil7XG4gICAgICAgIGlmKGJwbSl7XG4gICAgICAgICAgICB0aGlzLnNwYiA9IDYwICoxMDAwIC8gYnBtO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY2FsbGJhY2tzID0gbmV3IENhbGxiYWNrcyhbXCJkYXRhXCJdKTtcbiAgICB9XG4gICAgcmVjZWl2ZURhdGEoc3RyaW5nSW5kZXg6IG51bWJlciwgbm90ZTogbnVtYmVyLCBhbXA6IG51bWJlciwgdGltZTogbnVtYmVyKXtcbiAgICAgICAgdGhpcy5yYXdEYXRhLnB1c2goW3N0cmluZ0luZGV4LCBub3RlLCB0aW1lXSk7XG4gICAgICAgIGlmKCF0aGlzLnJlY2VpdmVJbnRlcnZhbCl7XG4gICAgICAgICAgICB0aGlzLnJlY2VpdmVJbnRlcnZhbCA9IHNldFRpbWVvdXQodGhpcy5wYWNrTm90ZS5iaW5kKHRoaXMpLDEwKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBhZGREYXRhTGlzdGVuZXIoY2I6IChkYXRhOiBub3RlKSA9PiBhbnkpe1xuICAgICAgICB0aGlzLmNhbGxiYWNrc1tcImRhdGFcIl0ucHVzaChjYik7XG4gICAgfVxuICAgIHByaXZhdGUgcGFja05vdGUoKXtcbiAgICAgICAgbGV0IG5vdGVzID0gWy0xLCAtMSwgLTEsIC0xLCAtMSwgLTFdO1xuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgdGhpcy5yYXdEYXRhLmxlbmd0aDsgaSsrKXtcbiAgICAgICAgICAgIG5vdGVzW3RoaXMucmF3RGF0YVtpXVswXV0gPSB0aGlzLnJhd0RhdGFbaV1bMV07XG4gICAgICAgIH1cbiAgICAgICAgaWYodGhpcy5ub3RlUmF3RGF0YSl7XG4gICAgICAgICAgICBsZXQgZHVyYXRpb24gPSB0aGlzLnJhd0RhdGFbMF1bMl0gLSB0aGlzLnByZVRpbWU7XG4gICAgICAgICAgICBpZihkdXJhdGlvbiA+IHRoaXMuc3BiICogdGhpcy5sZW5ndGhQZXJCZWF0KXtcbiAgICAgICAgICAgICAgICB0aGlzLm5vdGVSYXdEYXRhWzBdID0gMTtcbiAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgIGxldCBsMiA9IE1hdGgubG9nKHRoaXMuc3BiIC8gZHVyYXRpb24pIC8gTWF0aC5sb2coMik7XG4gICAgICAgICAgICAgICAgbGV0IGwzID0gTWF0aC5sb2codGhpcy5zcGIgLyAoMyAqIGR1cmF0aW9uKSkgLyBNYXRoLmxvZygyKSArIDE7XG4gICAgICAgICAgICAgICAgbGV0IGJsID0gTWF0aC5wb3coMiwgTWF0aC5jZWlsKGwyIC0gMC41KSk7XG4gICAgICAgICAgICAgICAgdGhpcy5ub3RlUmF3RGF0YVswXSA9IHRoaXMubGVuZ3RoUGVyQmVhdCAqIGJsO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLmNhbGxiYWNrc1tcImRhdGFcIl0uY2FsbEFsbCh0aGlzLm5vdGVSYXdEYXRhKTtcblxuICAgICAgICB9XG4gICAgICAgIHRoaXMucHJlVGltZSA9IHRoaXMucmF3RGF0YVswXVsyXTtcbiAgICAgICAgdGhpcy5ub3RlUmF3RGF0YSA9IFs4LCBub3RlcywgbnVsbF07XG4gICAgICAgIHRoaXMucmF3RGF0YSA9IFtdO1xuICAgICAgICB0aGlzLnJlY2VpdmVJbnRlcnZhbCA9IG51bGw7XG4gICAgfVxufSJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQVNBO0FBUkE7QUFJQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/DataAdapter.ts\n");

/***/ }),

/***/ "./src/LiCAP.ts":
/*!**********************!*\
  !*** ./src/LiCAP.ts ***!
  \**********************/
/*! exports provided: LiCAP */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"LiCAP\", function() { return LiCAP; });\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./utils */ \"./src/utils.ts\");\nvar __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\n\r\nclass LiCAP {\r\n    /**\r\n     * ctor\r\n     * @param device valid MIDIInput\r\n     */\r\n    constructor(device) {\r\n        this.device = device;\r\n        this.callbacks = new _utils__WEBPACK_IMPORTED_MODULE_0__[\"Callbacks\"]([\"pick\"]);\r\n        this.device.onmidimessage = this.onMessage.bind(this);\r\n    }\r\n    on(ename, cbk) {\r\n        if (ename in this.callbacks) {\r\n            this.callbacks[ename].push(cbk);\r\n        }\r\n    }\r\n    /**\r\n     * isSupported\r\n     * Check if LiCAP is supported by computer or not\r\n     */\r\n    static isSupported() {\r\n        return navigator.requestMIDIAccess;\r\n    }\r\n    /**\r\n     * enumerate\r\n     * Enumerate available LiCAP devices\r\n     */\r\n    static enumerate() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            let ret = [];\r\n            if (LiCAP.isSupported()) {\r\n                let access = yield navigator.requestMIDIAccess();\r\n                for (let input of access.inputs.values()) {\r\n                    // console.log(input.name);\r\n                    if (input.name.match(/LiCAP MIDI Device/)) {\r\n                        ret.push(new LiCAP(input));\r\n                        console.log(`use ${input.name}`);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            return ret;\r\n        });\r\n    }\r\n    onMessage(e) {\r\n        // Simply parse the data\r\n        let stringIdx = e.data[0] & 0xF;\r\n        // TODO: \r\n        let string_base_id = [40, 45, 50, 55, 59, 64].reverse();\r\n        console.log(e.data);\r\n        switch ((e.data[0] >> 4) & 0xF) {\r\n            case 8:\r\n                // note off\r\n                break;\r\n            case 9:\r\n                // note on\r\n                this.callbacks[\"pick\"].callAll(stringIdx, e.data[1] - string_base_id[stringIdx], e.data[2] / 255, e.timeStamp); // string idex, note, amp, time stamp\r\n                break;\r\n        }\r\n    }\r\n}\r\n/*\r\n\r\n if(LiCAP.isSupported()) {\r\n     console.log(\"Your browser supports LiCAP\");\r\n\r\n     LiCAP.enumerate().then((devs) => {\r\n         if(devs.length > 0) {\r\n            \r\n             devs[0].on(\"pick\",\r\n                 (stringIdx, note, amp, time) => {\r\n                     console.log(stringIdx, note, time);\r\n             });\r\n         }\r\n     })\r\n } else {\r\n     console.log(\"Your browser does not support LiCAP\");\r\n}\r\n*/ \r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvTGlDQVAudHMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvTGlDQVAudHM/MTkxMiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0NhbGxiYWNrc30gZnJvbSAnLi91dGlscyc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgTGlDQVBEZXZpY2Uge1xuICAgIC8qKlxuICAgICAqIG9uXG4gICAgICogRXZlbnQgcmVnaXN0ZXJhdGlvbihzdXBwb3J0IG11bHRpcGxlIGV2ZW50IHJlZ2lzdGVyYXRpb24pXG4gICAgICogQHBhcmFtIGVuYW1lIG5hbWUgb2YgdGhlIGV2ZW50XG4gICAgICogQHBhcmFtIGNiayBjYWxsYmFja1xuICAgICAqL1xuICAgIG9uKGVuYW1lOiBzdHJpbmcsIGNiazogKC4uLmFyZ3M6IGFueVtdKSA9PiB2b2lkKTogdm9pZDtcbn1cblxuZXhwb3J0IGNsYXNzIExpQ0FQIGltcGxlbWVudHMgTGlDQVBEZXZpY2Uge1xuICAgIHByaXZhdGUgZGV2aWNlOiBXZWJNaWRpLk1JRElJbnB1dDtcbiAgICBwcml2YXRlIGNhbGxiYWNrczogQ2FsbGJhY2tzO1xuXG4gICAgLyoqXG4gICAgICogY3RvclxuICAgICAqIEBwYXJhbSBkZXZpY2UgdmFsaWQgTUlESUlucHV0XG4gICAgICovXG4gICAgcHJpdmF0ZSBjb25zdHJ1Y3RvcihkZXZpY2U6IFdlYk1pZGkuTUlESUlucHV0KSB7XG4gICAgICAgIHRoaXMuZGV2aWNlID0gZGV2aWNlO1xuICAgICAgICB0aGlzLmNhbGxiYWNrcyA9IG5ldyBDYWxsYmFja3MoW1wicGlja1wiXSk7XG4gICAgICAgIFxuICAgICAgICB0aGlzLmRldmljZS5vbm1pZGltZXNzYWdlID0gdGhpcy5vbk1lc3NhZ2UuYmluZCh0aGlzKTtcbiAgICB9XG5cbiAgICBvbihlbmFtZTogc3RyaW5nLCBjYms6ICguLi5hcmdzOiBhbnlbXSkgPT4gdm9pZCk6IHZvaWQge1xuICAgICAgICBpZihlbmFtZSBpbiB0aGlzLmNhbGxiYWNrcykge1xuICAgICAgICAgICAgdGhpcy5jYWxsYmFja3NbZW5hbWVdLnB1c2goY2JrKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIGlzU3VwcG9ydGVkXG4gICAgICogQ2hlY2sgaWYgTGlDQVAgaXMgc3VwcG9ydGVkIGJ5IGNvbXB1dGVyIG9yIG5vdFxuICAgICAqL1xuICAgIHN0YXRpYyBpc1N1cHBvcnRlZCgpOiBib29sZWFuIHwgc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIChuYXZpZ2F0b3IgYXMgYW55KS5yZXF1ZXN0TUlESUFjY2VzcyBhcyBib29sZWFuO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIGVudW1lcmF0ZVxuICAgICAqIEVudW1lcmF0ZSBhdmFpbGFibGUgTGlDQVAgZGV2aWNlc1xuICAgICAqL1xuICAgIHN0YXRpYyBhc3luYyBlbnVtZXJhdGUoKTogUHJvbWlzZTxBcnJheTxMaUNBUERldmljZT4+IHtcbiAgICAgICAgbGV0IHJldDogQXJyYXk8TGlDQVBEZXZpY2U+ID0gW107XG5cbiAgICAgICAgaWYoTGlDQVAuaXNTdXBwb3J0ZWQoKSkge1xuICAgICAgICAgICAgbGV0IGFjY2VzcyA9IGF3YWl0IG5hdmlnYXRvci5yZXF1ZXN0TUlESUFjY2VzcygpO1xuICAgICAgICBcbiAgICAgICAgICAgIGZvcihsZXQgaW5wdXQgb2YgYWNjZXNzLmlucHV0cy52YWx1ZXMoKSkge1xuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGlucHV0Lm5hbWUpO1xuICAgICAgICAgICAgICAgIGlmKGlucHV0Lm5hbWUubWF0Y2goL0xpQ0FQIE1JREkgRGV2aWNlLykpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0LnB1c2gobmV3IExpQ0FQKGlucHV0KSk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGB1c2UgJHtpbnB1dC5uYW1lfWApO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJldDtcbiAgICB9XG5cbiAgICBwcml2YXRlIG9uTWVzc2FnZShlOiBXZWJNaWRpLk1JRElNZXNzYWdlRXZlbnQpOiB2b2lkIHtcbiAgICAgICAgLy8gU2ltcGx5IHBhcnNlIHRoZSBkYXRhXG4gICAgICAgIGxldCBzdHJpbmdJZHggPSBlLmRhdGFbMF0gJiAweEY7XG4gICAgICAgIC8vIFRPRE86IFxuICAgICAgICBsZXQgc3RyaW5nX2Jhc2VfaWQgPSBbNDAsIDQ1LCA1MCwgNTUsIDU5LCA2NF0ucmV2ZXJzZSgpO1xuICAgICAgICBjb25zb2xlLmxvZyhlLmRhdGEpO1xuICAgICAgICBzd2l0Y2goKGUuZGF0YVswXT4+NCkgJiAweEYpIHtcbiAgICAgICAgICAgIGNhc2UgODpcbiAgICAgICAgICAgICAgICAvLyBub3RlIG9mZlxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSA5OlxuICAgICAgICAgICAgICAgIC8vIG5vdGUgb25cbiAgICAgICAgICAgICAgICB0aGlzLmNhbGxiYWNrc1tcInBpY2tcIl0uY2FsbEFsbChzdHJpbmdJZHgsIGUuZGF0YVsxXS1zdHJpbmdfYmFzZV9pZFtzdHJpbmdJZHhdLCBlLmRhdGFbMl0gLyAyNTUsIGUudGltZVN0YW1wKTsvLyBzdHJpbmcgaWRleCwgbm90ZSwgYW1wLCB0aW1lIHN0YW1wXG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgfVxufVxuLypcblxuIGlmKExpQ0FQLmlzU3VwcG9ydGVkKCkpIHtcbiAgICAgY29uc29sZS5sb2coXCJZb3VyIGJyb3dzZXIgc3VwcG9ydHMgTGlDQVBcIik7XG5cbiAgICAgTGlDQVAuZW51bWVyYXRlKCkudGhlbigoZGV2cykgPT4ge1xuICAgICAgICAgaWYoZGV2cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgICBkZXZzWzBdLm9uKFwicGlja1wiLCBcbiAgICAgICAgICAgICAgICAgKHN0cmluZ0lkeCwgbm90ZSwgYW1wLCB0aW1lKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhzdHJpbmdJZHgsIG5vdGUsIHRpbWUpO1xuICAgICAgICAgICAgIH0pO1xuICAgICAgICAgfVxuICAgICB9KVxuIH0gZWxzZSB7XG4gICAgIGNvbnNvbGUubG9nKFwiWW91ciBicm93c2VyIGRvZXMgbm90IHN1cHBvcnQgTGlDQVBcIik7XG59XG4qLyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQUE7QUFZQTtBQUlBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7OztBQUdBO0FBQ0E7O0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7QUFnQkE7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/LiCAP.ts\n");

/***/ }),

/***/ "./src/LiCAPStream.ts":
/*!****************************!*\
  !*** ./src/LiCAPStream.ts ***!
  \****************************/
/*! exports provided: LiCAPStream */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"LiCAPStream\", function() { return LiCAPStream; });\nclass LiCAPStream {\r\n    constructor() {\r\n        this.ctx = new AudioContext();\r\n        this.sampleRate = 32000;\r\n        this.startAt = 0;\r\n        this.wsL = new WebSocket(\"ws://localhost:9002/LiCAP/L/subscribe\");\r\n        this.wsR = new WebSocket(\"ws://localhost:9002/LiCAP/R/subscribe\");\r\n        this.wsL.binaryType = \"arraybuffer\";\r\n        this.wsR.binaryType = \"arraybuffer\";\r\n    }\r\n    play() {\r\n        this.wsL.onmessage = (event) => {\r\n            let floats = new Float32Array(event.data);\r\n            let source = this.ctx.createBufferSource();\r\n            let buffer = this.ctx.createBuffer(1, floats.length, this.sampleRate);\r\n            buffer.getChannelData(0).set(floats);\r\n            source.buffer = buffer;\r\n            source.connect(this.ctx.destination);\r\n            this.startAt = Math.max(this.ctx.currentTime, this.startAt);\r\n            source.start(this.startAt);\r\n            this.startAt += buffer.duration;\r\n        };\r\n    }\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvTGlDQVBTdHJlYW0udHMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvTGlDQVBTdHJlYW0udHM/MzdjYSJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY2xhc3MgTGlDQVBTdHJlYW0ge1xuICAgIHByaXZhdGUgY3R4OiBBdWRpb0NvbnRleHQ7XG4gICAgcHJpdmF0ZSB3c0w6IFdlYlNvY2tldDtcbiAgICBwcml2YXRlIHdzUjogV2ViU29ja2V0O1xuICAgIHByaXZhdGUgc2FtcGxlUmF0ZTogbnVtYmVyO1xuICAgIHByaXZhdGUgc3RhcnRBdDogbnVtYmVyO1xuXG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5jdHggPSBuZXcgQXVkaW9Db250ZXh0KCk7XG4gICAgICAgIHRoaXMuc2FtcGxlUmF0ZSA9IDMyMDAwO1xuICAgICAgICB0aGlzLnN0YXJ0QXQgPSAwO1xuXG4gICAgICAgIHRoaXMud3NMID0gbmV3IFdlYlNvY2tldChcIndzOi8vbG9jYWxob3N0OjkwMDIvTGlDQVAvTC9zdWJzY3JpYmVcIik7XG4gICAgICAgIHRoaXMud3NSID0gbmV3IFdlYlNvY2tldChcIndzOi8vbG9jYWxob3N0OjkwMDIvTGlDQVAvUi9zdWJzY3JpYmVcIik7XG5cbiAgICAgICAgdGhpcy53c0wuYmluYXJ5VHlwZSA9IFwiYXJyYXlidWZmZXJcIjtcbiAgICAgICAgdGhpcy53c1IuYmluYXJ5VHlwZSA9IFwiYXJyYXlidWZmZXJcIjtcbiAgICB9XG5cbiAgICBwbGF5KCkge1xuXG4gICAgICAgIHRoaXMud3NMLm9ubWVzc2FnZSA9IChldmVudCkgPT4ge1xuXG4gICAgICAgICAgICBsZXQgZmxvYXRzID0gbmV3IEZsb2F0MzJBcnJheShldmVudC5kYXRhKTtcbiAgICAgICAgICAgIGxldCBzb3VyY2UgPSB0aGlzLmN0eC5jcmVhdGVCdWZmZXJTb3VyY2UoKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgbGV0IGJ1ZmZlciA9IHRoaXMuY3R4LmNyZWF0ZUJ1ZmZlcigxLCBmbG9hdHMubGVuZ3RoLCB0aGlzLnNhbXBsZVJhdGUpO1xuICAgICAgICAgICAgYnVmZmVyLmdldENoYW5uZWxEYXRhKDApLnNldChmbG9hdHMpO1xuICAgICAgICAgICAgc291cmNlLmJ1ZmZlciA9IGJ1ZmZlcjtcbiAgICAgICAgICAgIHNvdXJjZS5jb25uZWN0KHRoaXMuY3R4LmRlc3RpbmF0aW9uKTtcbiAgICAgICAgICAgIHRoaXMuc3RhcnRBdCA9IE1hdGgubWF4KHRoaXMuY3R4LmN1cnJlbnRUaW1lLCB0aGlzLnN0YXJ0QXQpO1xuICAgICAgICAgICAgc291cmNlLnN0YXJ0KHRoaXMuc3RhcnRBdCk7XG4gICAgICAgICAgICB0aGlzLnN0YXJ0QXQgKz0gYnVmZmVyLmR1cmF0aW9uO1xuICAgICAgICB9O1xuICAgIH1cbn0iXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/LiCAPStream.ts\n");

/***/ }),

/***/ "./src/Metronome.ts":
/*!**************************!*\
  !*** ./src/Metronome.ts ***!
  \**************************/
/*! exports provided: Metronome */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Metronome\", function() { return Metronome; });\nclass Metronome {\r\n    constructor(bpm) {\r\n        this.bpm = 120;\r\n        this.timeOffset = 0.05;\r\n        this.currentTime = 0;\r\n        this.scheduleOsc = [];\r\n        this.audioContext = new AudioContext();\r\n        if (bpm)\r\n            this.bpm = bpm;\r\n        this.gainNode = this.audioContext.createGain();\r\n        this.gainNode.gain.value = 0.6;\r\n        this.gainNode.connect(this.audioContext.destination);\r\n        this.base64toAudioBuffer(beep).then(decodeBuffer => this.sound = decodeBuffer);\r\n        this.base64toAudioBuffer(beep2).then(decodeBuffer => this.sound2 = decodeBuffer);\r\n    }\r\n    startTick() {\r\n        if (!this.tickTimer) {\r\n            let cycleTime = 60 / this.bpm;\r\n            this.audioContext.suspend();\r\n            let at = this.audioContext.currentTime;\r\n            this.nextTime = at + cycleTime;\r\n            this.tickTimer = -1 * setTimeout(() => {\r\n                this.tick();\r\n                this.tickTimer = setInterval(() => this.tick(), cycleTime * 1000);\r\n            }, cycleTime * 1000 - this.timeOffset * 1000);\r\n            this.makeSound(at);\r\n            this.audioContext.resume();\r\n        }\r\n    }\r\n    stopTick() {\r\n        if (this.tickTimer < 0) {\r\n            clearTimeout(-1 * this.tickTimer);\r\n        }\r\n        else {\r\n            clearInterval(this.tickTimer);\r\n        }\r\n        this.audioContext.suspend();\r\n        this.clearScheduleOsc();\r\n        this.currentTime = this.audioContext.currentTime;\r\n        this.tickTimer = null;\r\n    }\r\n    setBpm(bpm) {\r\n        this.bpm = bpm;\r\n    }\r\n    scheduleTick(time, type = \"normal\") {\r\n        let scheduleTime = this.currentTime * 1000 + time;\r\n        if (type === \"normal\") {\r\n            this.scheduleOsc.push(this.makeSound(scheduleTime / 1000));\r\n        }\r\n        else {\r\n            this.scheduleOsc.push(this.makeSound(scheduleTime / 1000, this.sound2));\r\n        }\r\n    }\r\n    play() {\r\n        this.audioContext.resume();\r\n    }\r\n    base64toAudioBuffer(b64string) {\r\n        return fetch(b64string)\r\n            .then(res => res.arrayBuffer())\r\n            .then(buffer => this.audioContext.decodeAudioData(buffer));\r\n    }\r\n    clearScheduleOsc() {\r\n        for (let i = 0; i < this.scheduleOsc.length; i++) {\r\n            this.scheduleOsc[i].disconnect();\r\n        }\r\n        this.scheduleOsc = [];\r\n    }\r\n    tick() {\r\n        let at = this.audioContext.currentTime;\r\n        let cycleTime = 60 / this.bpm;\r\n        if (at > this.nextTime) {\r\n            this.timeOffset += 0.05;\r\n            this.makeSound(at + this.timeOffset);\r\n            this.nextTime = at + this.timeOffset + cycleTime;\r\n        }\r\n        else {\r\n            this.makeSound(this.nextTime);\r\n            this.nextTime += cycleTime;\r\n        }\r\n    }\r\n    makeSound(startTime, sound = this.sound) {\r\n        let osc = this.audioContext.createBufferSource();\r\n        osc.buffer = sound;\r\n        osc.connect(this.gainNode);\r\n        osc.start(startTime);\r\n        osc.stop(startTime + 0.05);\r\n        return osc;\r\n    }\r\n}\r\nlet beep = \"data:audio/wav;base64,UklGRigHAABXQVZFZm10IBAAAAABAAEAgLsAAAB3AQACABAAZGF0YQQHAADw/wAAGAAgAOD+AP0I/Bj7OPr4+Uj5gPhw+BD4gPeQ96j5qPyo/vj9GPwo++j8wP9oAbAC6AOIBBADgADI/kj96PtI+9AB0AtgEYAZyCK4JlAimBkgBmjwAOUI3gDZKNco3LjlEO2o/CAQqBr4FqAM2ASw+njvCOpA+JAPOBzYDejzUOYw8PACmA1IEGAQkA8IC2AE8P44+rj2iPnQ7iDaQNOQ3QjscO6g57DjCOlA8qDzQPHY8QjzGPswBoANSBfAIGgooD51V+Ve1VDAOmgoGCAoHqggqCCYG7gQ4AJo+bj5uPEQ4jDZ2NNQ0HjPwMTbttOyy7kIweDJCNWI4YDwsPwQAwAQqB7II5AaiAxwAwgJ4BUgF6AM8APYAeAEiAZABej3oOjw4hjfGN4Q4ejo4PNQ+xj80Pzg/ggHoBboIegnWDBANZg2yCyQINAgiCcIKxAoQB9YFfAP2AbI/0D9wPqI90j0UOfQ2xjVeNUA3LDfMOXg6uDosOYg6GDrmPIQ+xAAMAoQFYAZCBRoD9gOMA+QD/APcApgEKgbYB3AFigOuAOg77jfgNwY4UDpSO/w7+DvAPE49WD++AV4Avj4cPKQ+qgKmBXgHigiWB+oFagM8AjYFZghUCLgHngX2BC4CEgC2ADQ/3AB8ANgA8j7uPMg71joyONA5ODowO6I8nD4aP44AbAKwBVgGvAY+BNwD+Ab6CzIM/gnYBUICugDsAIwBEgEIAEw/dD2OPEA8MDn4N7Q1+jVUNoQ51j02Pp4/Dj9CP6YBYAOaBLoETATkBRgF7AYcBZgD0ADwPlQ+Dj8OAFQ/wD5APUA/PAHwBCIEdAJqP+w/LgDmA1wFYAZUBewEJgI6ASABcgL8BPQFmgTwA0oCfAEWPxQ9dDzWPYw+jD9kPOQ5gjiaOag7oD2kPyI/iD9UPRA7MjrGPMY/GABCAAI+2j3iABQDsgUYBJICxgCYPz49hD22Pnw/iACMAPYBqAMgA8YDYAIKAaQATj+YP64+7D26PJ49bD70ADAA0ACGP5Y/CgAiAVYCWgJgAWo/xD9mP8gA5gF0AZgCkANyAxgCvgDSP2Y9jjzsPRg+Bj8YP5A/mD64Pao+TgA+ATIAYD6iPVI+EgCSAsIDwgNoAeYAtgA4P+YAVAEgAUgBCACaALAAAj+oPwg+Tj2WPVY9tj5EP6A/1j7+PUI9MjyYPKI9Oj0gPPQ8mj14Pmw/RABSAMYA5ADKAWIBggHcAbgBFAEmARYBIgAOPug+Bj54Pr4/IgAiAR4BmgGiAVgBKgDeAMQA0ACUAF4ADgBaAMABVgEIAIwALD/cABoAagBKAGAAOj+6Pwo/PD9+AAIA4gE8AVIBjgEgABo/Sj7aPkA+Wj5EPog+0D7APpA+XD6mPxI/jD/4P54/Uj86PsQ/Jj8IP14/cj9yP6IABgCQAS4BqgHGAcgBrgE+AHA/uD8CPyI++j7qP3Q/zgBKAE4AFj/sP5Y/mD+EABoAnADaAGI/dj6+PvI/8gCkATgBUgGsAXoBDAE4APQA3AD0AJoAjgCmAIQA/ACkAGw/4j+iP8QAvADGANoAHD+6P0Y/oj+wP6w/qj+QP9QADgBYAAo/oj86Pvg+1D70PpI+8j8wP5oAOD/KP2Q+jD5cPgQ+Pj36Pcw+OD4CPmA+Kj3MPeg9wD6gP3I/9gAwAEYAiACSAJQAqgCoAOoBDgG+AdQCQAKCAs4DIgM+AqgCCAHiAYwBgAGcAWIBOgD+AJoARAAQACoAdgCeALoAIj/YP1Y+jj4ePhg+mD8WP1Y/fj8yPyw/HD8cPtI+iD64Pqw+yj8kPwQ/bD9oP3I/MD76Ps4/eD+uABgAsgCCAIoAXgAMABoAOAAKAIQBGAFkAUQBQAEyAIYAtgBuAFwAVgBcAGAAZABqAFAATgAKAAYAbABCAG4/+D+2P5A/6j/CACAAPgAKAHYAGgAOABAAEAAGAD4/9j/sP9w/+D/+ADQARAC8AGYAWAAcP4A/eD8yP3Q/lD/UP8g/5D+mP3I/LD8MP3I/Vj+mP5o/vj9wP3o/fD9CP6A/lD/0P+w/yj/QP6I/cD8ePz4/PD9EP8IAGgA8ACwAQgCwAFAAagAoAAwAZABKAIYA7AD8AMIBKADkAJgAdgA4AAQASABAAEIAbAA+P9Y/4D/GAB4AAgASP84/xD/cP4A/iD+iP7A/rD+oP7Q/qD/gADAAOD/yP4w/lj+0P4g/0D/cP/Q//D/oP8o/0j/0P8gADgAYABQAFgAiACQABAAcP8w/5D/MACQACgAcP8Q/6j+KP7o/cj9yP0o/kD/aADwAHgBCAIwAtABQAGgAIgA4AD4AKAAWAB4AFAAsP8I/6D+wP5I/9j/EAB4/5D++P2o/Uj9OP04/sD/8ADIAUgCeAKQAg==\";\r\nlet beep2 = \"data:audio/wav;base64,UklGRhAHAABXQVZFZm10IBAAAAABAAIARKwAABCxAgAEABAAZGF0YegGAAD6/wQA+v8AADoA6v8k/1YAMgB+/koD6gAuAJQEFPu0/Yr+0vkYAVb/VgB4AQYClgFuBfIERATsBvj9GAPQ+fT6oPoo9xL94Pd+/h77mv/s/5QBVgPWA84DJAUcBOAFngZoBkwILgOYBtT+jgB6/Fb6evhm+wrzBv7Y8yz40vxm8z4D8vKIA071lgT0/IgHeAl0CfIUsgpQHMYK+h+KCwIZTAkqCIQBJvd+9qjpVOoI38TfkNqa2sTdtt0k4troGuCg96TgWAdG7XIUfgL0GtwZJiFcLsIsKjx4MyY/tC/sQaIkzkK0EmQ1YP4WH8zyvgUy8S7oWO2E1XrkHNXq35TWDOFI1DrgatV64IjUtuc60QjqKNhQ6VrlmvFK7Sr8uPLE+mb7Du+CAATlIPtO5J7vIOpc31T2uNOKBHrcAguW9fIKdhBUEsgsrimyR8hEGlSYVNBWxlVkWhBLXlwAOkJXHCtsSBojSC/cHcwSBBIy/ZL/zPNe7gLy3OHM7nrZWuje1djiitV43GrTVtDM0SDFqtUuxSjXJszYzTTQ+MGizsS9jsGgwPSnwsRCmA7KDKEm0tC6ftto2p7m5Pa+94gMhhA8H+gqmi6WOxo6REEUROhFTE3sTchT9FKsUxZPDkvQRMw+JDr6N54zNjhANJA5SDqEOkA9Lj6oNrJAbigeOIoWnCNEB4oLYv1m+gLz8PAa5GrlYtIA0+q8HLuspUykwJQsmASQOJfgkqqbXJfEohyfRqpUqnyw/LbUsxjEjLju0sTEaOU21oz6ROWmDZrwGhsq/fIjGAxWKrIaJDG0KxA+0kASUfhTomC2YoBmsHHKZTp+ZGM6flhfrHAOWYxfPFK2UdpKKkX0P/I2Hi8wKDwZXhq+A2oNmvBAABzeyPGezdbi0L/01I6xasfgoua4oJZyqQaQppo8kIqNxJNOhHyX0oKqndaIKKe2kXix+JqcwLCn9NduurjylNN4ChTzYhwaE+ApnCqeNVg6YkCiRYhJ2EkyUGxJaFVkTDpaDlP6WyJZPlpMXuJYamPqWbBmplqgZ3xX+mUSTjhf9DxYUygm/EMMDxYvgvm0E4jkUvUC0crY2L5YwcascrBenoSl/JbSm/CUJpDYlmiHSJ0SiBam1JDaraic+rQ4qiC+TrggynbC6tV0xmTg3sjM7NrQ/Psq4MALRPN4HI4IMi4iIHA+5DeES6pM/lbQXWBifGyEa054vG44f/Bq3H+wYeB5YlQSbfBEPlsmNn5IpigYOCwbmireDWweLAEcEWL0OgGI50bvmtqa3frM9M48wHTDkrZ8uMauRK2KphCijJ5klmCZmIsamaKF6p6kh1iqnJFOuVagjMmgsNzZNMLY6vrWOPyY7rYMigVeHV4ZHi5CKSo88DT4RCI+RkmCRwpMeFEQT2RaBFLmYKpTkmQuU7xlNlEqZYJNQmMaRzpf3D7IV441+ku+KaI7RhpCKMYHLhM89Az9YuF65xTQxtOcwTLC7LZksyauIKdCpoad/qHwlmailJNWpdiTDapjl8CwMZ3+uAalIMNLrgLPwbjr2/HEjulu00L4AuUrCFv5DRjqDWgm4SDpMq4ysT3qQtNGQVDPTntaIFZUYqhbbWjdXClsL1nJbJRSMWqHSkVkm0G2Wh84Jk78LBlAwR5LMSIOXSFp/bkP9+1B/G7fO+ii0QnVU8X/woy6OLN2sV+nVKt4n1qo6ZkoqMeW5aqplhuwxpjWtsSdQL8ZpwjKPrQ31h/DQONi0V/xIN6//23rlA1R+3waZgwBJnEdRDBaLrw57j0RQmZKYkiNU0tMdFqXTRJfE0wPYE1Iwl2KQoJZ8jpdU+0xL0p8J8A9pxtgLxsPPSAIA8MR9feBBPntV/fQ5Hvpq9u324bSpM+Ayo7GVsT3v6PAzrq/v3626sAZsz7Dw7HLxq2zyMuTuF3SxL8829bIB+Yw01Xxe94e/PLq3AWI+IUOaQaIFlkTIh5CHhsleSa+KnEsJy4FMTAvwTTWLt03Iy7NOQ0t0DncKrk3TyeXM6oiFC4HHRworhYEIjEQsRtnCZ0U9QEvDAv6nwJM8qX4T+s272XlROfH4BfhqN1z3NHbG9kP29bWgNuj1TDd8dXq3/7XYeM621rnBt/K63PjsfCi6Mv1N+62+qnzWf/S+NUD9f0jCDwD8wtnCCQPCw25EckQoBOmE9UU5RWEFYwXzhV9GHQVoRgtFOsXExJbFoEPCxShDCYRjwnaDYwGXQq1A+0G9QCtA1n+yAAU/Ff+RfpG/Of4hvrn9xn5Qvf29wj3Mfcz9+r2p/cR9174f/dN+S/4Wvoj+Wz7Qvp9/HL7h/2b/HT+qv02/5b+xP9Q/xcAzf8qAAkA\";\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvTWV0cm9ub21lLnRzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vc3JjL01ldHJvbm9tZS50cz9iY2E4Il0sInNvdXJjZXNDb250ZW50IjpbInR5cGUgdGlja1dlaWdodCA9IFwibm9ybWFsXCIgfCBcInN0cm9uZ1wiO1xuZXhwb3J0IGNsYXNzIE1ldHJvbm9tZSB7XG4gICAgcHJpdmF0ZSBhdWRpb0NvbnRleHQ6IEF1ZGlvQ29udGV4dDtcbiAgICBwcml2YXRlIG5leHRUaW1lOiBudW1iZXI7XG4gICAgcHJpdmF0ZSBnYWluTm9kZTogR2Fpbk5vZGU7XG4gICAgcHJpdmF0ZSB0aWNrVGltZXI6IG51bWJlcjtcbiAgICBwcml2YXRlIGJwbTogbnVtYmVyID0gMTIwO1xuICAgIHByaXZhdGUgdGltZU9mZnNldCA9IDAuMDU7XG4gICAgcHJpdmF0ZSBzb3VuZDogQXVkaW9CdWZmZXI7XG4gICAgcHJpdmF0ZSBzb3VuZDI6IEF1ZGlvQnVmZmVyO1xuICAgIHByaXZhdGUgY3VycmVudFRpbWU6IG51bWJlciA9IDA7XG4gICAgcHJpdmF0ZSBzY2hlZHVsZU9zYzogQXVkaW9CdWZmZXJTb3VyY2VOb2RlW10gPSBbXTtcbiAgICBjb25zdHJ1Y3RvcihicG06IG51bWJlcil7XG4gICAgICAgIHRoaXMuYXVkaW9Db250ZXh0ID0gbmV3IEF1ZGlvQ29udGV4dCgpO1xuICAgICAgICBpZihicG0pdGhpcy5icG0gPSBicG07XG4gICAgICAgIHRoaXMuZ2Fpbk5vZGUgPSB0aGlzLmF1ZGlvQ29udGV4dC5jcmVhdGVHYWluKCk7XG4gICAgICAgIHRoaXMuZ2Fpbk5vZGUuZ2Fpbi52YWx1ZSA9IDAuNjtcbiAgICAgICAgdGhpcy5nYWluTm9kZS5jb25uZWN0KHRoaXMuYXVkaW9Db250ZXh0LmRlc3RpbmF0aW9uKTtcbiAgICAgICAgdGhpcy5iYXNlNjR0b0F1ZGlvQnVmZmVyKGJlZXApLnRoZW4oZGVjb2RlQnVmZmVyID0+IHRoaXMuc291bmQgPSBkZWNvZGVCdWZmZXIpO1xuICAgICAgICB0aGlzLmJhc2U2NHRvQXVkaW9CdWZmZXIoYmVlcDIpLnRoZW4oZGVjb2RlQnVmZmVyID0+IHRoaXMuc291bmQyID0gZGVjb2RlQnVmZmVyKTtcbiAgICB9XG4gICAgc3RhcnRUaWNrKCl7XG4gICAgICAgIGlmKCF0aGlzLnRpY2tUaW1lcil7XG4gICAgICAgICAgICBsZXQgY3ljbGVUaW1lID0gNjAgLyB0aGlzLmJwbTtcbiAgICAgICAgICAgIHRoaXMuYXVkaW9Db250ZXh0LnN1c3BlbmQoKTtcbiAgICAgICAgICAgIGxldCBhdCA9IHRoaXMuYXVkaW9Db250ZXh0LmN1cnJlbnRUaW1lO1xuICAgICAgICAgICAgdGhpcy5uZXh0VGltZSA9IGF0ICsgY3ljbGVUaW1lO1xuICAgICAgICAgICAgdGhpcy50aWNrVGltZXIgPSAtMSAqIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMudGljaygpO1xuICAgICAgICAgICAgICAgIHRoaXMudGlja1RpbWVyID0gc2V0SW50ZXJ2YWwoKCkgPT4gdGhpcy50aWNrKCksIGN5Y2xlVGltZSAqIDEwMDApO1xuICAgICAgICAgICAgfSwgY3ljbGVUaW1lICogMTAwMCAtIHRoaXMudGltZU9mZnNldCoxMDAwKTtcbiAgICAgICAgICAgIHRoaXMubWFrZVNvdW5kKGF0KTtcbiAgICAgICAgICAgIHRoaXMuYXVkaW9Db250ZXh0LnJlc3VtZSgpO1xuICAgICAgICB9ICAgIFxuICAgIH1cbiAgICBzdG9wVGljaygpe1xuICAgICAgICBpZih0aGlzLnRpY2tUaW1lciA8IDApe1xuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KC0xICogdGhpcy50aWNrVGltZXIpO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy50aWNrVGltZXIpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuYXVkaW9Db250ZXh0LnN1c3BlbmQoKTtcbiAgICAgICAgdGhpcy5jbGVhclNjaGVkdWxlT3NjKCk7XG4gICAgICAgIHRoaXMuY3VycmVudFRpbWUgPSB0aGlzLmF1ZGlvQ29udGV4dC5jdXJyZW50VGltZTtcbiAgICAgICAgdGhpcy50aWNrVGltZXIgPSBudWxsO1xuICAgIH1cbiAgICBzZXRCcG0oYnBtOiBudW1iZXIpe1xuICAgICAgICB0aGlzLmJwbSA9IGJwbTtcbiAgICB9XG4gICAgc2NoZWR1bGVUaWNrKHRpbWU6IG51bWJlciwgdHlwZTogdGlja1dlaWdodCA9IFwibm9ybWFsXCIpeyAvLyB0aW1lIGluIG1pbGxpIHNlY29uZFxuICAgICAgICBsZXQgc2NoZWR1bGVUaW1lID0gdGhpcy5jdXJyZW50VGltZSAqIDEwMDAgKyB0aW1lO1xuICAgICAgICBpZih0eXBlID09PSBcIm5vcm1hbFwiKXtcbiAgICAgICAgICAgIHRoaXMuc2NoZWR1bGVPc2MucHVzaCh0aGlzLm1ha2VTb3VuZChzY2hlZHVsZVRpbWUvMTAwMCkpO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIHRoaXMuc2NoZWR1bGVPc2MucHVzaCh0aGlzLm1ha2VTb3VuZChzY2hlZHVsZVRpbWUvMTAwMCwgdGhpcy5zb3VuZDIpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBwbGF5KCl7XG4gICAgICAgIHRoaXMuYXVkaW9Db250ZXh0LnJlc3VtZSgpO1xuICAgIH1cbiAgICBwcml2YXRlIGJhc2U2NHRvQXVkaW9CdWZmZXIoYjY0c3RyaW5nOiBzdHJpbmcpOiBQcm9taXNlPEF1ZGlvQnVmZmVyPntcbiAgICAgICAgcmV0dXJuIGZldGNoKGI2NHN0cmluZylcbiAgICAgICAgLnRoZW4ocmVzID0+IHJlcy5hcnJheUJ1ZmZlcigpKVxuICAgICAgICAudGhlbihidWZmZXIgPT4gdGhpcy5hdWRpb0NvbnRleHQuZGVjb2RlQXVkaW9EYXRhKGJ1ZmZlcikpXG4gICAgfVxuICAgIHByaXZhdGUgY2xlYXJTY2hlZHVsZU9zYygpe1xuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgdGhpcy5zY2hlZHVsZU9zYy5sZW5ndGg7IGkrKyl7XG4gICAgICAgICAgICB0aGlzLnNjaGVkdWxlT3NjW2ldLmRpc2Nvbm5lY3QoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNjaGVkdWxlT3NjID0gW107XG4gICAgfVxuICAgIHByaXZhdGUgdGljaygpe1xuICAgICAgICBsZXQgYXQgPSB0aGlzLmF1ZGlvQ29udGV4dC5jdXJyZW50VGltZTtcbiAgICAgICAgbGV0IGN5Y2xlVGltZSA9IDYwIC8gdGhpcy5icG07XG4gICAgICAgIGlmKGF0ID4gdGhpcy5uZXh0VGltZSl7XG4gICAgICAgICAgICB0aGlzLnRpbWVPZmZzZXQgKz0gMC4wNTtcbiAgICAgICAgICAgIHRoaXMubWFrZVNvdW5kKGF0ICsgdGhpcy50aW1lT2Zmc2V0KTtcbiAgICAgICAgICAgIHRoaXMubmV4dFRpbWUgPSBhdCArIHRoaXMudGltZU9mZnNldCArIGN5Y2xlVGltZTtcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICB0aGlzLm1ha2VTb3VuZCh0aGlzLm5leHRUaW1lKTtcbiAgICAgICAgICAgIHRoaXMubmV4dFRpbWUgKz0gY3ljbGVUaW1lO1xuICAgICAgICB9XG4gICAgfVxuICAgIHByaXZhdGUgbWFrZVNvdW5kKCBzdGFydFRpbWU6IG51bWJlciwgc291bmQ6IEF1ZGlvQnVmZmVyID0gdGhpcy5zb3VuZCk6IEF1ZGlvQnVmZmVyU291cmNlTm9kZXtcbiAgICAgICAgbGV0IG9zYyA9IHRoaXMuYXVkaW9Db250ZXh0LmNyZWF0ZUJ1ZmZlclNvdXJjZSgpO1xuICAgICAgICBvc2MuYnVmZmVyID0gc291bmQ7XG4gICAgICAgIG9zYy5jb25uZWN0KHRoaXMuZ2Fpbk5vZGUpO1xuICAgICAgICBvc2Muc3RhcnQoc3RhcnRUaW1lKTtcbiAgICAgICAgb3NjLnN0b3Aoc3RhcnRUaW1lICsgMC4wNSk7XG4gICAgICAgIHJldHVybiBvc2M7XG4gICAgfVxufVxuXG5sZXQgYmVlcCA9IFwiZGF0YTphdWRpby93YXY7YmFzZTY0LFVrbEdSaWdIQUFCWFFWWkZabTEwSUJBQUFBQUJBQUVBZ0xzQUFBQjNBUUFDQUJBQVpHRjBZUVFIQUFEdy93QUFHQUFnQU9EK0FQMEkvQmo3T1ByNCtVajVnUGh3K0JENGdQZVE5Nmo1cVB5by92ajlHUHdvKytqOHdQOW9BYkFDNkFPSUJCQURnQURJL2tqOTZQdEkrOUFCMEF0Z0VZQVp5Q0s0SmxBaW1Ca2dCbWp3QU9VSTNnRFpLTmNvM0xqbEVPMm8vQ0FRcUJyNEZxQU0yQVN3K25qdkNPcEErSkFQT0J6WURlanpVT1l3OFBBQ21BMUlFR0FRa0E4SUMyQUU4UDQ0K3JqMmlQblE3aURhUU5PUTNRanNjTzZnNTdEakNPbEE4cUR6UVBIWThRanpHUHN3Qm9BTlNCZkFJR2dvb0Q1MVYrVmUxVkRBT21nb0dDQW9IcWdncUNDWUc3Z1E0QUpvK2JqNXVQRVE0akRaMk5OUTBIalB3TVRidHRPeXk3a0l3ZURKQ05XSTRZRHdzUHdRQXdBUXFCN0lJNUFhaUF4d0F3Z0o0QlVnRjZBTThBUFlBZUFFaUFaQUJlajNvT2p3NGhqZkdONFE0ZWpvNFBOUSt4ajgwUHpnL2dnSG9CYm9JZWduV0RCQU5aZzJ5Q3lRSU5BZ2lDY0lLeEFvUUI5WUZmQVAyQWJJLzBEOXdQcUk5MGowVU9mUTJ4alZlTlVBM0xEZk1PWGc2dURvc09ZZzZHRHJtUElRK3hBQU1Bb1FGWUFaQ0JSb0Q5Z09NQStRRC9BUGNBcGdFS2diWUIzQUZpZ091QU9nNzdqZmdOd1k0VURwU08vdzcrRHZBUEU0OVdEKytBVjRBdmo0Y1BLUStxZ0ttQlhnSGlnaVdCK29GYWdNOEFqWUZaZ2hVQ0xnSG5nWDJCQzRDRWdDMkFEUS8zQUI4QU5nQThqN3VQTWc3MWpveU9OQTVPRG93TzZJOG5ENGFQNDRBYkFLd0JWZ0d2QVkrQk53RCtBYjZDeklNL2duWUJVSUN1Z0RzQUl3QkVnRUlBRXcvZEQyT1BFQThNRG40TjdRMStqVlVOb1E1MWowMlBwNC9EajlDUDZZQllBT2FCTG9FVEFUa0JSZ0Y3QVljQlpnRDBBRHdQbFErRGo4T0FGUS93RDVBUFVBL1BBSHdCQ0lFZEFKcVArdy9MZ0RtQTF3RllBWlVCZXdFSmdJNkFTQUJjZ0w4QlBRRm1nVHdBMG9DZkFFV1B4UTlkRHpXUFl3K2pEOWtQT1E1Z2ppYU9hZzdvRDJrUHlJL2lEOVVQUkE3TWpyR1BNWS9HQUJDQUFJKzJqM2lBQlFEc2dVWUJKSUN4Z0NZUHo0OWhEMjJQbncvaUFDTUFQWUJxQU1nQThZRFlBSUtBYVFBVGorWVA2NCs3RDI2UEo0OWJENzBBREFBMEFDR1A1WS9DZ0FpQVZZQ1dnSmdBV28veEQ5bVA4Z0E1Z0YwQVpnQ2tBTnlBeGdDdmdEU1AyWTlqanpzUFJnK0JqOFlQNUEvbUQ2NFBhbytUZ0ErQVRJQVlENmlQVkkrRWdDU0FzSUR3Z05vQWVZQXRnQTRQK1lBVkFFZ0FVZ0JDQUNhQUxBQUFqK29Qd2crVGoyV1BWWTl0ajVFUDZBLzFqNytQVUk5TWp5WVBLSTlPajBnUFBROG1qMTRQbXcvUkFCU0FNWUE1QURLQVdJQmdnSGNBYmdCRkFFbUFSWUJJZ0FPUHVnK0JqNTRQcjQvSWdBaUFSNEJtZ0dpQVZnQktnRGVBTVFBMEFDVUFGNEFEZ0JhQU1BQlZnRUlBSXdBTEQvY0FCb0FhZ0JLQUdBQU9qKzZQd28vUEQ5K0FBSUE0Z0U4QVZJQmpnRWdBQm8vU2o3YVBrQStXajVFUG9nKzBEN0FQcEErWEQ2bVB4SS9qRC80UDU0L1VqODZQc1EvSmo4SVAxNC9jajl5UDZJQUJnQ1FBUzRCcWdIR0FjZ0JyZ0UrQUhBL3VEOENQeUkrK2o3cVAzUS96Z0JLQUU0QUZqL3NQNVkvbUQrRUFCb0FuQURhQUdJL2RqNitQdkkvOGdDa0FUZ0JVZ0dzQVhvQkRBRTRBUFFBM0FEMEFKb0FqZ0NtQUlRQS9BQ2tBR3cvNGoraVA4UUF2QURHQU5vQUhEKzZQMFkvb2ord1A2dy9xaitRUDlRQURnQllBQW8vb2o4NlB2ZysxRDcwUHBJKzhqOHdQNW9BT0QvS1AyUStqRDVjUGdRK1BqMzZQY3crT0Q0Q1BtQStLajNNUGVnOXdENmdQM0kvOWdBd0FFWUFpQUNTQUpRQXFnQ29BT29CRGdHK0FkUUNRQUtDQXM0RElnTStBcWdDQ0FIaUFZd0JnQUdjQVdJQk9nRCtBSm9BUkFBUUFDb0FkZ0NlQUxvQUlqL1lQMVkramo0ZVBoZyttRDhXUDFZL2ZqOHlQeXcvSEQ4Y1B0SStpRDY0UHF3K3lqOGtQd1EvYkQ5b1AzSS9NRDc2UHM0L2VEK3VBQmdBc2dDQ0FJb0FYZ0FNQUJvQU9BQUtBSVFCR0FGa0FVUUJRQUV5QUlZQXRnQnVBRndBVmdCY0FHQUFaQUJxQUZBQVRnQUtBQVlBYkFCQ0FHNC8rRCsyUDVBLzZqL0NBQ0FBUGdBS0FIWUFHZ0FPQUJBQUVBQUdBRDQvOWovc1A5dy8rRC8rQURRQVJBQzhBR1lBV0FBY1A0QS9lRDh5UDNRL2xEL1VQOGcvNUQrbVAzSS9MRDhNUDNJL1ZqK21QNW8vdmo5d1Azby9mRDlDUDZBL2xELzBQK3cveWovUVA2SS9jRDhlUHo0L1BEOUVQOElBR2dBOEFDd0FRZ0N3QUZBQWFnQW9BQXdBWkFCS0FJWUE3QUQ4QU1JQktBRGtBSmdBZGdBNEFBUUFTQUJBQUVJQWJBQStQOVkvNEQvR0FCNEFBZ0FTUDg0L3hEL2NQNEEvaUQraVA3QS9yRCtvUDdRL3FEL2dBREFBT0QveVA0dy9saiswUDRnLzBEL2NQL1EvL0Qvb1A4by8wai8wUDhnQURnQVlBQlFBRmdBaUFDUUFCQUFjUDh3LzVEL01BQ1FBQ2dBY1A4US82aitLUDdvL2NqOXlQMG8va0QvYUFEd0FIZ0JDQUl3QXRBQlFBR2dBSWdBNEFENEFLQUFXQUI0QUZBQXNQOEkvNkQrd1A1SS85ai9FQUI0LzVEKytQMm8vVWo5T1AwNC9zRC84QURJQVVnQ2VBS1FBZz09XCI7XG5sZXQgYmVlcDI9IFwiZGF0YTphdWRpby93YXY7YmFzZTY0LFVrbEdSaEFIQUFCWFFWWkZabTEwSUJBQUFBQUJBQUlBUkt3QUFCQ3hBZ0FFQUJBQVpHRjBZZWdHQUFENi93UUErdjhBQURvQTZ2OGsvMVlBTWdCKy9rb0Q2Z0F1QUpRRUZQdTAvWXIrMHZrWUFWYi9WZ0I0QVFZQ2xnRnVCZklFUkFUc0J2ajlHQVBRK2ZUNm9Qb285eEw5NFBkKy9oNzdtdi9zLzVRQlZnUFdBODRESkFVY0JPQUZuZ1pvQmt3SUxnT1lCdFQramdCNi9GYjZldmhtK3dyekJ2N1k4eXo0MHZ4bTh6NEQ4dktJQTA3MWxnVDAvSWdIZUFsMENmSVVzZ3BRSE1ZSytoK0tDd0laVEFrcUNJUUJKdmQrOXFqcFZPb0kzOFRma05xYTJzVGR0dDBrNHRyb0d1Q2c5NlRnV0FkRzdYSVVmZ0wwR3R3WkppRmNMc0lzS2p4NE15WS90Qy9zUWFJa3prSzBFbVExWVA0V0g4enl2Z1V5OFM3b1dPMkUxWHJrSE5YcTM1VFdET0ZJMURyZ2F0VjY0SWpVdHVjNjBRanFLTmhRNlZybG12Rks3U3I4dVBMRSttYjdEdStDQUFUbElQdE81Sjd2SU9wYzMxVDJ1Tk9LQkhyY0FndVc5ZklLZGhCVUVzZ3NyaW15UjhoRUdsU1lWTkJXeGxWa1doQkxYbHdBT2tKWEhDdHNTQm9qU0MvY0hjd1NCQkl5L1pML3pQTmU3Z0x5M09ITTduclpXdWplMWRqaWl0VjQzR3JUVnRETTBTREZxdFV1eFNqWEpzell6VFRRK01HaXpzUzlqc0dnd1BTbndzUkNtQTdLREtFbTB0QzZmdHRvMnA3bTVQYSs5NGdNaGhBOEgrZ3FtaTZXT3hvNlJFRVVST2hGVEUzc1RjaFQ5RktzVXhaUERrdlFSTXcrSkRyNk41NHpOamhBTkpBNVNEcUVPa0E5TGo2b05ySkFiaWdlT0lvV25DTkVCNG9MWXYxbStnTHo4UEFhNUdybFl0SUEwK3E4SEx1c3BVeWt3SlFzbUFTUU9KZmdrcXFiWEpmRW9oeWZScXBVcW55dy9MYlVzeGpFakxqdTBzVEVhT1UyMW96NlJPV21EWnJ3R2hzcS9mSWpHQXhXS3JJYUpERzBLeEErMGtBU1VmaFRvbUMyWW9CbXNISEtaVHArWkdNNmZsaGZySEFPV1l4ZlBGSzJVZHBLS2tYMFAvSTJIaTh3S0R3WlhocStBMm9ObXZCQUFCemV5UEdlemRiaTBMLzAxSTZ4YXNmZ291YTRvSlp5cVFhUXBwbzhrSXFOeEpOT2hIeVgwb0txbmRhSUtLZTJrWGl4K0pxY3dMQ245TmR1dXJqeWxOTjRDaFR6WWh3YUUrQXBuQ3FlTlZnNllrQ2lSWWhKMkVreVVHeEphRlZrVERwYURsUDZXeUpaUGxwTVh1SllhbVBxV2JCbXBscWdaM3hYK21VU1RqaGY5RHhZVXlnbS9FTU1EeFl2Z3ZtMEU0amtVdlVDMGNyWTJMNVl3Y2FzY3JCZW5vU2wvSmJTbS9DVUpwRFlsbWlIU0owU2lCYW0xSkRhcmFpYytyUTRxaUMrVHJnZ3luYkM2dFYweG1UZzNzak03TnJRL1BzcTRNQUxSUE40SEk0SU1pNGlJSEErNURlRVM2cE0vbGJRWFdCaWZHeUVhMDU0dkc0NGYvQnEzSCt3WWVCNVlsUVNiZkJFUGxzbU5uNUlwaWdZT0N3Ym1pcmVEV3dlTEFFY0VXTDBPZ0dJNTBidm10cWEzZnJNOU00OHdIVERrclo4dU1hdVJLMktwaENpako1a2xtQ1ptSXNhbWFLRjZwNmtoMWlxbkpGT3VWYWdqTW1nc056Wk5NTFk2dnJXT1B5WTdyWU1pZ1ZlSFY0WkhpNUNLU284OERUNFJDSStSa21DUndwTWVGRVFUMlJhQkZMbVlLcFRrbVF1VTd4bE5sRXFaWUpOUW1NYVJ6cGYzRDdJVjQ0MStrdStLYUk3UmhwQ0tNWUhMaE04OUF6OVl1RjY1eFRReHRPY3dUTEM3TFprc3lhdUlLZENwb2FkL3FId2xtYWlsSk5XcGRpVERhcGpsOEN3TVozK3VBYWxJTU5McmdMUHdianIyL0hFanVsdTAwTDRBdVVyQ0Z2NURSanFEV2dtNFNEcE1xNHlzVDNxUXROR1FWRFBUbnRhSUZaVVlxaGJiV2pkWENsc0wxbkpiSlJTTVdxSFNrVmttMEcyV2g4NEprNzhMQmxBd1I1TE1TSU9YU0ZwL2JrUDkrMUIvRzdmTytpaTBRblZVOFgvd295Nk9MTjJzVituVkt0NG4xcW82WmtvcU1lVzVhcXBsaHV3eHBqV3RzU2RRTDhacHdqS1ByUTMxaC9EUU9OaTBWL3hJTjYvLzIzcmxBMVIrM3dhWmd3QkpuRWRSREJhTHJ3NTdqMFJRbVpLWWtpTlUwdE1kRnFYVFJKZkUwd1BZRTFJd2wyS1FvSlo4anBkVSsweEwwcDhKOEE5cHh0Z0x4c1BQU0FJQThNUjlmZUJCUG50Vi9mUTVIdnBxOXUzMjRiU3BNK0F5bzdHVnNUM3Y2UEF6cnEvdjM2MjZzQVpzejdEdzdITHhxMnp5TXVUdUYzU3hMODgyOWJJQitZdzAxWHhlOTRlL1BMcTNBV0krSVVPYVFhSUZsa1RJaDVDSGhzbGVTYStLbkVzSnk0Rk1UQXZ3VFRXTHQwM0l5N05PUTB0MERuY0tyazNUeWVYTTZvaUZDNEhIUndvcmhZRUlqRVFzUnRuQ1owVTlRRXZEQXY2bndKTThxWDRUK3MyNzJYbFJPZkg0QmZocU4xejNOSGJHOWtQMjliV2dOdWoxVERkOGRYcTMvN1hZZU02MjFybkJ0L0s2M1Bqc2ZDaTZNdjFOKzYyK3FueldmL1MrTlVEOWYwakNEd0Q4d3RuQ0NRUEN3MjVFY2tRb0JPbUU5VVU1UldFRll3WHpoVjlHSFFWb1JndEZPc1hFeEpiRm9FUEN4U2hEQ1lSanduYURZd0dYUXExQSswRzlRQ3RBMW4reUFBVS9GZitSZnBHL09mNGh2cm45eG41UXZmMjl3ajNNZmN6OStyMnAvY1I5MTc0Zi9kTitTLzRXdm9qK1d6N1F2cDkvSEw3aC8yYi9IVCtxdjAyLzViK3hQOVEveGNBemY4cUFBa0FcIjsiXSwibWFwcGluZ3MiOiJBQUNBO0FBQUE7QUFBQTtBQVdBO0FBTkE7QUFDQTtBQUdBO0FBQ0E7QUFFQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/Metronome.ts\n");

/***/ }),

/***/ "./src/SLPract.ts":
/*!************************!*\
  !*** ./src/SLPract.ts ***!
  \************************/
/*! exports provided: SLPract */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"SLPract\", function() { return SLPract; });\n/* harmony import */ var _Timer__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Timer */ \"./src/Timer.ts\");\n\r\nclass SLPract {\r\n    constructor(controlTab, editor, metronome) {\r\n        this.bpm = 120;\r\n        this.timeSignature = { upper: 4, lower: 4 };\r\n        this.isRepeat = false;\r\n        this.indicatorColor = \"rgba(255, 209, 81, 0.6)\";\r\n        this.indicatorShapes = [];\r\n        this.playSwitch = false;\r\n        this.timer = new _Timer__WEBPACK_IMPORTED_MODULE_0__[\"Timer\"]();\r\n        this.playLag = 50 / 1000;\r\n        this.selectedTimeSum = 0;\r\n        this.metronomeOn = false;\r\n        this.playIter = 0;\r\n        this.maxPracticeTimes = 2;\r\n        this.controlTab = controlTab;\r\n        this.editor = editor;\r\n        this.metronome = metronome;\r\n        this.setEvents();\r\n    }\r\n    play() {\r\n        if (this.playIter == this.maxPracticeTimes || (this.playIter > 0 && !this.isRepeat)) {\r\n            this.stop();\r\n            return;\r\n        }\r\n        let sectionNotes;\r\n        if (this.editor.SelectedNotes.length > 0) { //If selected more then one note swap to repeat playing mode\r\n            this.isRepeat = true;\r\n            sectionNotes = this.sortBySectionId(this.editor.SelectedNotes);\r\n        }\r\n        else {\r\n            this.isRepeat = false;\r\n            let selection = this.controlTab.headToEndSelect(this.controlTab.noteIndex(this.editor.selectedNote));\r\n            sectionNotes = this.sortBySectionId(selection);\r\n        }\r\n        let sectionLenSum = 0;\r\n        let preBeat = 0;\r\n        let sectionMetronomeBeats = [];\r\n        this.editor.undisplayIndicator();\r\n        sectionNotes.forEach((elem, index, self) => {\r\n            let sectionEnds = this.sectionTwoEnds(elem);\r\n            let sectionBeats = 0;\r\n            if (index == 0) {\r\n                if (this.nowPlaySectionIndicator == null) {\r\n                    this.nowPlaySectionIndicator = this.controlTab.tabCanvas.layers.ui.createRect(sectionEnds.x1, sectionEnds.y1, sectionEnds.x2 - sectionEnds.x1, sectionEnds.y2 - sectionEnds.y1, 2, this.indicatorColor);\r\n                }\r\n                else {\r\n                    this.nowPlaySectionIndicator.setPos(sectionEnds.x1, sectionEnds.y1);\r\n                    this.nowPlaySectionIndicator.setShape(sectionEnds.x2 - sectionEnds.x1, sectionEnds.y2 - sectionEnds.y1);\r\n                }\r\n                //If the first note selected is note on the beat, calc a prebeat note value.\r\n                if (elem[0].note != 0) {\r\n                    let preSum = 0;\r\n                    let firstSection = this.controlTab.getSectionData(elem[0].section);\r\n                    for (let i = 0; i < elem[0].note; i++) {\r\n                        preSum += this.timeSignature.lower / firstSection[i][0];\r\n                    }\r\n                    if (preSum % 1 != 0) {\r\n                        preBeat = this.timeSignature.lower / (1 - (preSum % 1));\r\n                    }\r\n                }\r\n            }\r\n            let sectionLen = 0;\r\n            elem.forEach((note, i, s) => {\r\n                let thisNote = this.controlTab.getNoteData(note.section, note.note);\r\n                sectionLen += this.noteValeu2Time(thisNote[0]);\r\n                sectionBeats += this.timeSignature.lower / thisNote[0];\r\n            });\r\n            sectionLenSum += sectionLen;\r\n            sectionMetronomeBeats.push(sectionBeats);\r\n            if (self.length == 1) {\r\n                this.timer.registerDelay(this.stopNowPlayIndicator.bind(this), sectionLen * 1000, 1);\r\n            }\r\n            else if (self.length > 1 && index < self.length - 1) {\r\n                let nextSectionEnds = this.sectionTwoEnds(self[index + 1]);\r\n                this.indicatorShapes.push({ x: nextSectionEnds.x1, y: nextSectionEnds.y1, width: nextSectionEnds.x2 - nextSectionEnds.x1, height: nextSectionEnds.y2 - nextSectionEnds.y1 });\r\n                this.timer.registerDelay(this.pushNowPlayIndicator.bind(this), sectionLenSum * 1000, 1);\r\n            }\r\n            if (index == self.length - 1) {\r\n                this.timer.registerDelay(this.play.bind(this), sectionLenSum * 1000, 1);\r\n            }\r\n        });\r\n        let sectionStartTime = 0;\r\n        if (this.playIter == 0) {\r\n            let repeatTime = 1;\r\n            if (this.isRepeat)\r\n                repeatTime = this.maxPracticeTimes;\r\n            for (let i = 0; i < repeatTime; i++) {\r\n                sectionMetronomeBeats.forEach((el, i, self) => {\r\n                    if (this.selectedTimeSum == 0 && sectionStartTime == 0)\r\n                        sectionStartTime += this.playLag;\r\n                    let sectionDuration = el * 60 / this.bpm;\r\n                    this.registerSectionMetronome(this.selectedTimeSum + sectionStartTime, el, sectionNotes[i][0].note == 0, preBeat);\r\n                    sectionStartTime += sectionDuration;\r\n                });\r\n            }\r\n        }\r\n        this.selectedTimeSum += sectionStartTime;\r\n        this.playIter += 1;\r\n        this.timer.start();\r\n        if (!this.metronomeOn) {\r\n            this.metronome.play();\r\n            this.metronomeOn = true;\r\n        }\r\n    }\r\n    stop() {\r\n        this.timer.stop();\r\n        this.stopNowPlayIndicator();\r\n        this.indicatorShapes = [];\r\n        this.metronome.stopTick();\r\n        this.metronomeOn = false;\r\n        this.selectedTimeSum = 0;\r\n        this.playIter = 0;\r\n        this.editor.displayIndicator();\r\n        this.playSwitch = false;\r\n    }\r\n    pushNowPlayIndicator() {\r\n        let nextShape = this.indicatorShapes.shift();\r\n        this.nowPlaySectionIndicator.setPos(nextShape.x, nextShape.y);\r\n        this.nowPlaySectionIndicator.setShape(nextShape.width, nextShape.height);\r\n    }\r\n    stopNowPlayIndicator() {\r\n        if (this.nowPlaySectionIndicator != null) {\r\n            this.nowPlaySectionIndicator.remove();\r\n            this.nowPlaySectionIndicator = null;\r\n        }\r\n    }\r\n    noteValeu2Time(noteValue) {\r\n        if (noteValue == 0)\r\n            return 0;\r\n        else\r\n            return (this.timeSignature.lower / noteValue) / (this.bpm / 60);\r\n    }\r\n    registerSectionMetronome(startTime, sectionBeats, firstClick, preBeat) {\r\n        if (preBeat == NaN) {\r\n            preBeat = 0;\r\n        }\r\n        let pre = this.timeSignature.lower / preBeat;\r\n        if (pre == Infinity)\r\n            pre = 0;\r\n        //Metronome click first beat on the section\r\n        if (firstClick) {\r\n            this.metronome.scheduleTick(startTime * 1000, 'strong');\r\n        }\r\n        else {\r\n            this.metronome.scheduleTick((startTime + this.noteValeu2Time(preBeat)) * 1000, 'normal');\r\n        }\r\n        for (let i = 1; i < Math.floor(sectionBeats - pre); i++) {\r\n            this.metronome.scheduleTick((startTime + i * this.noteValeu2Time(this.timeSignature.lower) + this.noteValeu2Time(preBeat)) * 1000, 'normal');\r\n        }\r\n    }\r\n    setEvents() {\r\n        this.controlTab.on(\"keydown\", (key) => {\r\n            if (key.toLowerCase() === \" \") {\r\n                this.playSwitch = !this.playSwitch;\r\n                if (this.playSwitch) {\r\n                    this.play();\r\n                }\r\n                else {\r\n                    this.stop();\r\n                }\r\n            }\r\n        });\r\n    }\r\n    sortBySectionId(notes) {\r\n        let selectedSections = [];\r\n        for (let i = 0; i < notes.length; i++) {\r\n            selectedSections.push(notes[i].section);\r\n        }\r\n        let uniqueSelectedSections = selectedSections.filter(function (elem, index, self) {\r\n            return index == self.indexOf(elem);\r\n        });\r\n        let ret = [];\r\n        for (let i = 0; i < uniqueSelectedSections.length; i++) {\r\n            let pushNotes = notes.filter(function (elem, index, self) {\r\n                return elem.section == uniqueSelectedSections[i];\r\n            });\r\n            ret.push(pushNotes);\r\n        }\r\n        return ret;\r\n    }\r\n    sectionTwoEnds(section) {\r\n        let strings = section[0].blockGroup.length;\r\n        let leftTopEnd = { x: section[0].blockGroup[0].x, y: section[0].blockGroup[0].y };\r\n        let rightBotEnd = { x: section[section.length - 1].blockGroup[strings - 1].x, y: section[section.length - 1].blockGroup[strings - 1].y };\r\n        if (section[0].note == 0) {\r\n            let thisSection = this.controlTab.tabCanvas.layers.ui.sectionIndicator[section[0].section];\r\n            leftTopEnd = { x: thisSection.x, y: thisSection.y };\r\n        }\r\n        if (section[section.length - 1].note == this.controlTab.notes[section[section.length - 1].section].length - 1) {\r\n            let thisSection = this.controlTab.tabCanvas.layers.ui.sectionIndicator[section[section.length - 1].section];\r\n            rightBotEnd = { x: thisSection.x + thisSection.width, y: thisSection.y + thisSection.height };\r\n        }\r\n        return { x1: leftTopEnd.x, y1: leftTopEnd.y, x2: rightBotEnd.x, y2: rightBotEnd.y };\r\n    }\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvU0xQcmFjdC50cy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovL1tuYW1lXS8uL3NyYy9TTFByYWN0LnRzPzdmZjYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgbm90ZSB9IGZyb20gXCIuL1NsaW1UYWJWMlR5cGVzXCJcbmltcG9ydCB7IFNMVGFiIH0gZnJvbSBcIi4vU2xpbVRhYlYyXCJcbmltcG9ydCB7IFJlY3QsIEVsbGlwc2UsIFRleHQsIExpbmUsIFNWR05vdGUsIE5vdGVCbG9ja30gZnJvbSBcIi4vU2xpbVRhYlYyQ2FudmFzXCJcbmltcG9ydCB7VGltZXJ9IGZyb20gXCIuL1RpbWVyXCJcbmltcG9ydCB7U0xFZGl0b3J9IGZyb20gXCIuL1NsaW1UYWJWMkVkaXRvclwiXG5pbXBvcnQge01ldHJvbm9tZX0gZnJvbSBcIi4vTWV0cm9ub21lXCJcblxuaW50ZXJmYWNlIFRpbWVTaWduYXR1cmV7XG4gICAgdXBwZXI6IG51bWJlcixcbiAgICBsb3dlcjogbnVtYmVyXG59XG5cbmludGVyZmFjZSBJbmRpY2F0b3JTaGFwZXtcbiAgICB4OiBudW1iZXIsXG4gICAgeTogbnVtYmVyLFxuICAgIHdpZHRoOiBudW1iZXIsXG4gICAgaGVpZ2h0OiBudW1iZXJcbn1cblxuZXhwb3J0IGNsYXNzIFNMUHJhY3Qge1xuICAgIHByaXZhdGUgY29udHJvbFRhYjogU0xUYWI7XG4gICAgcHJpdmF0ZSBlZGl0b3I6IFNMRWRpdG9yO1xuICAgIHByaXZhdGUgbm93UGxheVNlY3Rpb25JbmRpY2F0b3I6IFJlY3Q7XG4gICAgcHJpdmF0ZSBicG06IG51bWJlciA9IDEyMDtcbiAgICBwcml2YXRlIHRpbWVTaWduYXR1cmU6IFRpbWVTaWduYXR1cmUgPSB7dXBwZXI6IDQsIGxvd2VyOiA0fTtcbiAgICBwcml2YXRlIGlzUmVwZWF0OiBib29sZWFuID0gZmFsc2U7XG4gICAgcHJpdmF0ZSBpbmRpY2F0b3JDb2xvcjogc3RyaW5nID0gXCJyZ2JhKDI1NSwgMjA5LCA4MSwgMC42KVwiO1xuICAgIHByaXZhdGUgaW5kaWNhdG9yU2hhcGVzOiBJbmRpY2F0b3JTaGFwZVtdID0gW107XG4gICAgcHJpdmF0ZSBwbGF5U3dpdGNoOiBib29sZWFuID0gZmFsc2U7XG4gICAgcHJpdmF0ZSB0aW1lcjogVGltZXIgPSBuZXcgVGltZXIoKTtcbiAgICBwcml2YXRlIG1ldHJvbm9tZTogTWV0cm9ub21lO1xuICAgIHByaXZhdGUgcGxheUxhZzogbnVtYmVyID0gNTAvMTAwMDtcbiAgICBwcml2YXRlIHNlbGVjdGVkVGltZVN1bSA9IDA7XG4gICAgcHJpdmF0ZSBtZXRyb25vbWVPbjogYm9vbGVhbiA9IGZhbHNlO1xuICAgIHByaXZhdGUgcGxheUl0ZXI6IG51bWJlciA9IDA7XG4gICAgcHJpdmF0ZSBtYXhQcmFjdGljZVRpbWVzOiBudW1iZXIgPSAyO1xuXG4gICAgY29uc3RydWN0b3IoY29udHJvbFRhYjogU0xUYWIsIGVkaXRvcjogU0xFZGl0b3IsIG1ldHJvbm9tZTogTWV0cm9ub21lKXtcbiAgICAgICAgdGhpcy5jb250cm9sVGFiID0gY29udHJvbFRhYjtcbiAgICAgICAgdGhpcy5lZGl0b3IgPSBlZGl0b3I7XG4gICAgICAgIHRoaXMubWV0cm9ub21lID0gbWV0cm9ub21lO1xuICAgICAgICB0aGlzLnNldEV2ZW50cygpO1xuICAgIH1cblxuICAgIHBsYXkgKCl7XG4gICAgICAgIGlmKHRoaXMucGxheUl0ZXIgPT0gdGhpcy5tYXhQcmFjdGljZVRpbWVzIHx8ICh0aGlzLnBsYXlJdGVyPjAgJiYgIXRoaXMuaXNSZXBlYXQpKSB7XG4gICAgICAgICAgICB0aGlzLnN0b3AoKTtcbiAgICAgICAgICAgIHJldHVyblxuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHNlY3Rpb25Ob3RlczogU1ZHTm90ZVtdW107XG4gICAgICAgIGlmKHRoaXMuZWRpdG9yLlNlbGVjdGVkTm90ZXMubGVuZ3RoPjApey8vSWYgc2VsZWN0ZWQgbW9yZSB0aGVuIG9uZSBub3RlIHN3YXAgdG8gcmVwZWF0IHBsYXlpbmcgbW9kZVxuICAgICAgICAgICAgdGhpcy5pc1JlcGVhdCA9IHRydWU7XG4gICAgICAgICAgICBzZWN0aW9uTm90ZXMgPSB0aGlzLnNvcnRCeVNlY3Rpb25JZCh0aGlzLmVkaXRvci5TZWxlY3RlZE5vdGVzKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNle1xuICAgICAgICAgICAgdGhpcy5pc1JlcGVhdCA9IGZhbHNlO1xuICAgICAgICAgICAgbGV0IHNlbGVjdGlvbiA9IHRoaXMuY29udHJvbFRhYi5oZWFkVG9FbmRTZWxlY3QodGhpcy5jb250cm9sVGFiLm5vdGVJbmRleCh0aGlzLmVkaXRvci5zZWxlY3RlZE5vdGUpKTtcbiAgICAgICAgICAgIHNlY3Rpb25Ob3RlcyA9IHRoaXMuc29ydEJ5U2VjdGlvbklkKHNlbGVjdGlvbik7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHNlY3Rpb25MZW5TdW06IG51bWJlciA9IDA7XG4gICAgICAgIGxldCBwcmVCZWF0OiBudW1iZXIgPSAwO1xuICAgICAgICBcbiAgICAgICAgbGV0IHNlY3Rpb25NZXRyb25vbWVCZWF0czogbnVtYmVyW10gPSBbXTtcblxuICAgICAgICB0aGlzLmVkaXRvci51bmRpc3BsYXlJbmRpY2F0b3IoKTtcblxuICAgICAgICBzZWN0aW9uTm90ZXMuZm9yRWFjaCgoZWxlbSwgaW5kZXgsIHNlbGYpID0+e1xuICAgICAgICAgICAgbGV0IHNlY3Rpb25FbmRzID0gdGhpcy5zZWN0aW9uVHdvRW5kcyhlbGVtKTtcbiAgICAgICAgICAgIGxldCBzZWN0aW9uQmVhdHM6IG51bWJlciA9IDA7XG4gICAgICAgICAgICBpZihpbmRleCA9PSAwKXtcbiAgICAgICAgICAgICAgICBpZih0aGlzLm5vd1BsYXlTZWN0aW9uSW5kaWNhdG9yICA9PSBudWxsKXtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ub3dQbGF5U2VjdGlvbkluZGljYXRvciA9IHRoaXMuY29udHJvbFRhYi50YWJDYW52YXMubGF5ZXJzLnVpLmNyZWF0ZVJlY3Qoc2VjdGlvbkVuZHMueDEsIHNlY3Rpb25FbmRzLnkxLCBzZWN0aW9uRW5kcy54MiAtIHNlY3Rpb25FbmRzLngxLCBzZWN0aW9uRW5kcy55MiAtIHNlY3Rpb25FbmRzLnkxLCAyLCB0aGlzLmluZGljYXRvckNvbG9yKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ub3dQbGF5U2VjdGlvbkluZGljYXRvci5zZXRQb3Moc2VjdGlvbkVuZHMueDEsIHNlY3Rpb25FbmRzLnkxKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ub3dQbGF5U2VjdGlvbkluZGljYXRvci5zZXRTaGFwZShzZWN0aW9uRW5kcy54MiAtIHNlY3Rpb25FbmRzLngxLCBzZWN0aW9uRW5kcy55MiAtIHNlY3Rpb25FbmRzLnkxKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy9JZiB0aGUgZmlyc3Qgbm90ZSBzZWxlY3RlZCBpcyBub3RlIG9uIHRoZSBiZWF0LCBjYWxjIGEgcHJlYmVhdCBub3RlIHZhbHVlLlxuICAgICAgICAgICAgICAgIGlmKGVsZW1bMF0ubm90ZSAhPSAwKXtcbiAgICAgICAgICAgICAgICAgICAgbGV0IHByZVN1bTogbnVtYmVyID0gMDtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGZpcnN0U2VjdGlvbjogbm90ZVtdID0gdGhpcy5jb250cm9sVGFiLmdldFNlY3Rpb25EYXRhKGVsZW1bMF0uc2VjdGlvbik7XG4gICAgICAgICAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7aTwgZWxlbVswXS5ub3RlOyBpKyspe1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJlU3VtICs9IHRoaXMudGltZVNpZ25hdHVyZS5sb3dlci9maXJzdFNlY3Rpb25baV1bMF07XG4gICAgICAgICAgICAgICAgICAgIH0gXG4gICAgICAgICAgICAgICAgICAgIGlmKHByZVN1bSAlMSAhPSAwKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByZUJlYXQgPSB0aGlzLnRpbWVTaWduYXR1cmUubG93ZXIvKDEgLSAocHJlU3VtJTEpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbGV0IHNlY3Rpb25MZW46IG51bWJlciA9IDA7XG4gICAgICAgICAgICBlbGVtLmZvckVhY2goKG5vdGUsIGksIHMpID0+e1xuICAgICAgICAgICAgICAgIGxldCB0aGlzTm90ZTogbm90ZSA9IHRoaXMuY29udHJvbFRhYi5nZXROb3RlRGF0YShub3RlLnNlY3Rpb24sIG5vdGUubm90ZSk7XG4gICAgICAgICAgICAgICAgc2VjdGlvbkxlbiArPSB0aGlzLm5vdGVWYWxldTJUaW1lKHRoaXNOb3RlWzBdKTtcbiAgICAgICAgICAgICAgICBzZWN0aW9uQmVhdHMgKz0gdGhpcy50aW1lU2lnbmF0dXJlLmxvd2VyL3RoaXNOb3RlWzBdO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBzZWN0aW9uTGVuU3VtICs9IHNlY3Rpb25MZW47XG4gICAgICAgICAgICBzZWN0aW9uTWV0cm9ub21lQmVhdHMucHVzaChzZWN0aW9uQmVhdHMpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZihzZWxmLmxlbmd0aCA9PSAxKXtcbiAgICAgICAgICAgICAgICB0aGlzLnRpbWVyLnJlZ2lzdGVyRGVsYXkodGhpcy5zdG9wTm93UGxheUluZGljYXRvci5iaW5kKHRoaXMpLCBzZWN0aW9uTGVuKjEwMDAsIDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZihzZWxmLmxlbmd0aCA+IDEgJiYgaW5kZXggPCBzZWxmLmxlbmd0aCAtMSl7XG4gICAgICAgICAgICAgICAgbGV0IG5leHRTZWN0aW9uRW5kcyA9IHRoaXMuc2VjdGlvblR3b0VuZHMoc2VsZltpbmRleCsxXSk7XG4gICAgICAgICAgICAgICAgdGhpcy5pbmRpY2F0b3JTaGFwZXMucHVzaCh7eDogbmV4dFNlY3Rpb25FbmRzLngxLCB5OiBuZXh0U2VjdGlvbkVuZHMueTEsIHdpZHRoOiBuZXh0U2VjdGlvbkVuZHMueDIgLSBuZXh0U2VjdGlvbkVuZHMueDEsIGhlaWdodDogbmV4dFNlY3Rpb25FbmRzLnkyIC0gbmV4dFNlY3Rpb25FbmRzLnkxfSk7XG4gICAgICAgICAgICAgICAgdGhpcy50aW1lci5yZWdpc3RlckRlbGF5KHRoaXMucHVzaE5vd1BsYXlJbmRpY2F0b3IuYmluZCh0aGlzKSwgc2VjdGlvbkxlblN1bSoxMDAwLCAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKGluZGV4ID09IHNlbGYubGVuZ3RoIC0xKXtcbiAgICAgICAgICAgICAgICB0aGlzLnRpbWVyLnJlZ2lzdGVyRGVsYXkodGhpcy5wbGF5LmJpbmQodGhpcyksIHNlY3Rpb25MZW5TdW0qMTAwMCwgMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBsZXQgc2VjdGlvblN0YXJ0VGltZTogbnVtYmVyID0gMDtcblxuICAgICAgICBpZih0aGlzLnBsYXlJdGVyID09IDApe1xuICAgICAgICAgICAgbGV0IHJlcGVhdFRpbWUgPSAxO1xuICAgICAgICAgICAgaWYodGhpcy5pc1JlcGVhdCkgcmVwZWF0VGltZSA9dGhpcy5tYXhQcmFjdGljZVRpbWVzO1xuICAgICAgICAgICAgZm9yKGxldCBpID0gMCA7IGkgPCByZXBlYXRUaW1lOyBpKyspe1xuICAgICAgICAgICAgICAgIHNlY3Rpb25NZXRyb25vbWVCZWF0cy5mb3JFYWNoKChlbCwgaSwgc2VsZikgPT57XG4gICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuc2VsZWN0ZWRUaW1lU3VtID09IDAgJiYgc2VjdGlvblN0YXJ0VGltZSA9PSAwKSBzZWN0aW9uU3RhcnRUaW1lICs9IHRoaXMucGxheUxhZztcbiAgICAgICAgICAgICAgICAgICAgbGV0IHNlY3Rpb25EdXJhdGlvbiA9IGVsICogNjAgL3RoaXMuYnBtO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlZ2lzdGVyU2VjdGlvbk1ldHJvbm9tZSh0aGlzLnNlbGVjdGVkVGltZVN1bSArIHNlY3Rpb25TdGFydFRpbWUsIGVsLCBzZWN0aW9uTm90ZXNbaV1bMF0ubm90ZSA9PSAwLCBwcmVCZWF0KTtcbiAgICAgICAgICAgICAgICAgICAgc2VjdGlvblN0YXJ0VGltZSArPSBzZWN0aW9uRHVyYXRpb247XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNlbGVjdGVkVGltZVN1bSArPSBzZWN0aW9uU3RhcnRUaW1lO1xuICAgICAgICB0aGlzLnBsYXlJdGVyICs9IDE7XG4gICAgICAgIHRoaXMudGltZXIuc3RhcnQoKTtcbiAgICAgICAgaWYoIXRoaXMubWV0cm9ub21lT24pe1xuICAgICAgICAgICAgdGhpcy5tZXRyb25vbWUucGxheSgpO1xuICAgICAgICAgICAgdGhpcy5tZXRyb25vbWVPbiA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgc3RvcCgpe1xuICAgICAgICB0aGlzLnRpbWVyLnN0b3AoKTtcbiAgICAgICAgdGhpcy5zdG9wTm93UGxheUluZGljYXRvcigpO1xuICAgICAgICB0aGlzLmluZGljYXRvclNoYXBlcyA9IFtdO1xuICAgICAgICB0aGlzLm1ldHJvbm9tZS5zdG9wVGljaygpO1xuICAgICAgICB0aGlzLm1ldHJvbm9tZU9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRUaW1lU3VtID0gMDtcbiAgICAgICAgdGhpcy5wbGF5SXRlciA9IDA7XG4gICAgICAgIHRoaXMuZWRpdG9yLmRpc3BsYXlJbmRpY2F0b3IoKTtcbiAgICAgICAgdGhpcy5wbGF5U3dpdGNoID0gZmFsc2U7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBwdXNoTm93UGxheUluZGljYXRvcigpe1xuICAgICAgICBsZXQgbmV4dFNoYXBlID0gdGhpcy5pbmRpY2F0b3JTaGFwZXMuc2hpZnQoKTtcbiAgICAgICAgdGhpcy5ub3dQbGF5U2VjdGlvbkluZGljYXRvci5zZXRQb3MobmV4dFNoYXBlLngsIG5leHRTaGFwZS55KTtcbiAgICAgICAgdGhpcy5ub3dQbGF5U2VjdGlvbkluZGljYXRvci5zZXRTaGFwZShuZXh0U2hhcGUud2lkdGgsIG5leHRTaGFwZS5oZWlnaHQpO1xuICAgIH1cblxuICAgIHByaXZhdGUgc3RvcE5vd1BsYXlJbmRpY2F0b3IoKXtcbiAgICAgICAgaWYodGhpcy5ub3dQbGF5U2VjdGlvbkluZGljYXRvciAhPSBudWxsKXtcbiAgICAgICAgICAgIHRoaXMubm93UGxheVNlY3Rpb25JbmRpY2F0b3IucmVtb3ZlKCk7XG4gICAgICAgICAgICB0aGlzLm5vd1BsYXlTZWN0aW9uSW5kaWNhdG9yID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgbm90ZVZhbGV1MlRpbWUgKG5vdGVWYWx1ZTogbnVtYmVyKTogbnVtYmVye1xuICAgICAgICBpZihub3RlVmFsdWUgPT0gMCkgcmV0dXJuIDA7XG4gICAgICAgIGVsc2UgcmV0dXJuICh0aGlzLnRpbWVTaWduYXR1cmUubG93ZXIvbm90ZVZhbHVlKS8odGhpcy5icG0vNjApO1xuICAgIH1cblxuICAgIHByaXZhdGUgcmVnaXN0ZXJTZWN0aW9uTWV0cm9ub21lKHN0YXJ0VGltZTogbnVtYmVyLCBzZWN0aW9uQmVhdHM6IG51bWJlciwgZmlyc3RDbGljazogYm9vbGVhbiwgcHJlQmVhdD86IG51bWJlcil7XG4gICAgICAgIGlmKHByZUJlYXQgPT0gTmFOKXtcbiAgICAgICAgICAgIHByZUJlYXQgPSAwO1xuICAgICAgICB9XG4gICAgICAgIGxldCBwcmUgPSB0aGlzLnRpbWVTaWduYXR1cmUubG93ZXIvcHJlQmVhdFxuICAgICAgICBpZihwcmUgPT0gSW5maW5pdHkpIHByZSA9IDA7XG4gICAgICAgIC8vTWV0cm9ub21lIGNsaWNrIGZpcnN0IGJlYXQgb24gdGhlIHNlY3Rpb25cbiAgICAgICAgaWYoZmlyc3RDbGljaykge1xuICAgICAgICAgICAgdGhpcy5tZXRyb25vbWUuc2NoZWR1bGVUaWNrKHN0YXJ0VGltZSoxMDAwLCAnc3Ryb25nJyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLm1ldHJvbm9tZS5zY2hlZHVsZVRpY2soKHN0YXJ0VGltZSArIHRoaXMubm90ZVZhbGV1MlRpbWUocHJlQmVhdCkpKjEwMDAsICdub3JtYWwnKTtcbiAgICAgICAgfVxuICAgICAgICBmb3IobGV0IGkgPSAxOyBpIDwgTWF0aC5mbG9vcihzZWN0aW9uQmVhdHMgLSBwcmUpOyBpKyspe1xuICAgICAgICAgICAgdGhpcy5tZXRyb25vbWUuc2NoZWR1bGVUaWNrKChzdGFydFRpbWUgKyBpICogdGhpcy5ub3RlVmFsZXUyVGltZSh0aGlzLnRpbWVTaWduYXR1cmUubG93ZXIpICsgdGhpcy5ub3RlVmFsZXUyVGltZShwcmVCZWF0KSkqMTAwMCwgJ25vcm1hbCcpXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIHNldEV2ZW50cygpe1xuICAgICAgICB0aGlzLmNvbnRyb2xUYWIub24oXCJrZXlkb3duXCIsIChrZXkpID0+IHtcbiAgICAgICAgICAgIGlmKCg8c3RyaW5nPmtleSkudG9Mb3dlckNhc2UoKSA9PT0gXCIgXCIpe1xuICAgICAgICAgICAgICAgIHRoaXMucGxheVN3aXRjaCA9ICF0aGlzLnBsYXlTd2l0Y2g7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5wbGF5U3dpdGNoKXtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2V7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3RvcCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzb3J0QnlTZWN0aW9uSWQobm90ZXM6IFNWR05vdGVbXSk6IEFycmF5PFNWR05vdGVbXT57XG4gICAgICAgIGxldCBzZWxlY3RlZFNlY3Rpb25zOiBudW1iZXJbXSA9IFtdO1xuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgbm90ZXMubGVuZ3RoOyBpKyspe1xuICAgICAgICAgICAgc2VsZWN0ZWRTZWN0aW9ucy5wdXNoKG5vdGVzW2ldLnNlY3Rpb24pO1xuICAgICAgICB9XG4gICAgICAgIGxldCB1bmlxdWVTZWxlY3RlZFNlY3Rpb25zID0gc2VsZWN0ZWRTZWN0aW9ucy5maWx0ZXIoZnVuY3Rpb24oZWxlbSwgaW5kZXgsIHNlbGYpe1xuICAgICAgICAgICAgcmV0dXJuIGluZGV4ID09IHNlbGYuaW5kZXhPZihlbGVtKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGxldCByZXQ6IEFycmF5PFNWR05vdGVbXT4gPSBbXTtcbiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IHVuaXF1ZVNlbGVjdGVkU2VjdGlvbnMubGVuZ3RoOyBpKyspe1xuICAgICAgICAgICAgbGV0IHB1c2hOb3RlcyA9IG5vdGVzLmZpbHRlcihmdW5jdGlvbihlbGVtLCBpbmRleCwgc2VsZil7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGVsZW0uc2VjdGlvbiA9PSB1bmlxdWVTZWxlY3RlZFNlY3Rpb25zW2ldO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXQucHVzaChwdXNoTm90ZXMpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXQ7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzZWN0aW9uVHdvRW5kcyhzZWN0aW9uOiBTVkdOb3RlW10pOiB7eDE6IG51bWJlciwgeTE6IG51bWJlciwgeDI6IG51bWJlciwgeTI6IG51bWJlcn17XG4gICAgICAgIGxldCBzdHJpbmdzID0gc2VjdGlvblswXS5ibG9ja0dyb3VwLmxlbmd0aDtcbiAgICAgICAgbGV0IGxlZnRUb3BFbmQgPSB7eDogc2VjdGlvblswXS5ibG9ja0dyb3VwWzBdLngsIHk6IHNlY3Rpb25bMF0uYmxvY2tHcm91cFswXS55fTtcbiAgICAgICAgbGV0IHJpZ2h0Qm90RW5kID0ge3g6IHNlY3Rpb25bc2VjdGlvbi5sZW5ndGggLTFdLmJsb2NrR3JvdXBbc3RyaW5ncyAtMV0ueCwgeTogc2VjdGlvbltzZWN0aW9uLmxlbmd0aCAtMV0uYmxvY2tHcm91cFtzdHJpbmdzIC0xXS55fTtcbiAgICAgICAgaWYoc2VjdGlvblswXS5ub3RlID09IDApe1xuICAgICAgICAgICAgbGV0IHRoaXNTZWN0aW9uID0gdGhpcy5jb250cm9sVGFiLnRhYkNhbnZhcy5sYXllcnMudWkuc2VjdGlvbkluZGljYXRvcltzZWN0aW9uWzBdLnNlY3Rpb25dO1xuICAgICAgICAgICAgbGVmdFRvcEVuZCA9IHt4OiB0aGlzU2VjdGlvbi54LCB5OiB0aGlzU2VjdGlvbi55fTtcbiAgICAgICAgfVxuICAgICAgICBpZihzZWN0aW9uW3NlY3Rpb24ubGVuZ3RoIC0xXS5ub3RlID09IHRoaXMuY29udHJvbFRhYi5ub3Rlc1tzZWN0aW9uW3NlY3Rpb24ubGVuZ3RoIC0xXS5zZWN0aW9uXS5sZW5ndGggLTEpe1xuICAgICAgICAgICAgbGV0IHRoaXNTZWN0aW9uID0gdGhpcy5jb250cm9sVGFiLnRhYkNhbnZhcy5sYXllcnMudWkuc2VjdGlvbkluZGljYXRvcltzZWN0aW9uW3NlY3Rpb24ubGVuZ3RoIC0xXS5zZWN0aW9uXTtcbiAgICAgICAgICAgIHJpZ2h0Qm90RW5kID0ge3g6IHRoaXNTZWN0aW9uLnggKyB0aGlzU2VjdGlvbi53aWR0aCwgeTogdGhpc1NlY3Rpb24ueSArIHRoaXNTZWN0aW9uLmhlaWdodH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHt4MTogbGVmdFRvcEVuZC54LCB5MTogbGVmdFRvcEVuZC55LCB4MjogcmlnaHRCb3RFbmQueCwgeTI6IHJpZ2h0Qm90RW5kLnl9O1xuICAgIH1cbn0iXSwibWFwcGluZ3MiOiJBQUdBO0FBQUE7QUFBQTtBQUFBO0FBZ0JBO0FBa0JBO0FBZEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQUE7O0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/SLPract.ts\n");

/***/ }),

/***/ "./src/SlimTabV2.ts":
/*!**************************!*\
  !*** ./src/SlimTabV2.ts ***!
  \**************************/
/*! exports provided: SLTab */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"SLTab\", function() { return SLTab; });\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./utils */ \"./src/utils.ts\");\n/* harmony import */ var _SlimTabV2Canvas__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./SlimTabV2Canvas */ \"./src/SlimTabV2Canvas.ts\");\n\r\n\r\nclass SLTab {\r\n    constructor(data) {\r\n        this.lengthPerBeat = 4;\r\n        this.beatPerSection = 4;\r\n        this.lineWidth = 1200;\r\n        this.sectionPerLine = 4;\r\n        this.stringPadding = 16; // distance between each string\r\n        this.linePerPage = 20;\r\n        this.lineMargin = 42; // only for left and right\r\n        this.linePadding = [32, 14];\r\n        this.lineDistance = 90; // distance between each line\r\n        this.sectionAddNoteNumber = 16;\r\n        this.linkerElement = [];\r\n        this.startPosition = [this.lineMargin + this.linePadding[0] + 20, 120 + this.linePadding[1]]; // x, y\r\n        this.lineStartPosition = [this.lineMargin, 120]; // total line number, last line X, last line Y\r\n        this.rawData = [];\r\n        Object.assign(this, data);\r\n        this.tabCanvas = new _SlimTabV2Canvas__WEBPACK_IMPORTED_MODULE_1__[\"SLCanvas\"](_SlimTabV2Canvas__WEBPACK_IMPORTED_MODULE_1__[\"SLLayer\"]);\r\n        let width = this.lineWidth + this.linePadding[0] * 2 + 42 * 2;\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.tabCanvas.domElement, { width: `${width}` });\r\n        this.domElement = document.createElement(\"div\");\r\n        this.domElement.append(this.tabCanvas.domElement);\r\n        this.domElement.addEventListener(\"keydown\", (e) => {\r\n            let ka = [32, 37, 38, 39, 40]; //space: 32, left: 37, up: 38, right: 39, down: 40,\r\n            for (let i = 0; i < ka.length; i++) { // why is there no \"includes\" methods in typescript = =?\r\n                if (ka[i] === e.keyCode) {\r\n                    e.preventDefault();\r\n                    e.returnValue = false;\r\n                }\r\n            }\r\n        });\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setStyle(this.domElement, { \"width\": `${width + 20}px`, height: \"700px\", \"overflow-y\": \"auto\", \"overflow-x\": \"hidden\" });\r\n        //if add new event, you should describe the callback in eventCallBackInterface above\r\n        this.callbacks = new _utils__WEBPACK_IMPORTED_MODULE_0__[\"Callbacks\"]([\r\n            \"noteclick\",\r\n            \"noteshiftclick\",\r\n            \"notealtclick\",\r\n            \"notectrlclick\",\r\n            \"keydown\",\r\n            \"mouseovernote\",\r\n            \"mouseoutnote\",\r\n            \"mousedown\",\r\n            \"mousemove\",\r\n            \"mouseup\",\r\n            \"rightclick\"\r\n        ]);\r\n        this.tabCanvas.domElement.addEventListener(\"focus\", () => { });\r\n        this.tabCanvas.domElement.addEventListener(\"keydown\", this.onKeydown.bind(this));\r\n        this.tabCanvas.domElement.addEventListener(\"mousedown\", this.onMouseDown.bind(this));\r\n        this.tabCanvas.domElement.addEventListener(\"mousemove\", this.onMouseMove.bind(this));\r\n        this.tabCanvas.domElement.addEventListener(\"mouseup\", this.onMouseUp.bind(this));\r\n        this.tabCanvas.domElement.addEventListener(\"contextmenu\", this.onMouseRightClick.bind(this)); //Right click\r\n    }\r\n    //todo: do a stricter check for these function\r\n    setData(data) {\r\n        this.notes = data;\r\n    }\r\n    getNoteData(section, note) {\r\n        return this.notes[section][note];\r\n    }\r\n    setNoteData(section, note, data) {\r\n        this.notes[section][note] = data;\r\n    }\r\n    setStringDataOfNote(section, note, string, data) {\r\n        if (string >= 0 && string <= 5) {\r\n            this.notes[section][note][1][string] = data;\r\n        }\r\n    }\r\n    getSectionData(section) {\r\n        return this.notes[section];\r\n    }\r\n    deleteNote(section, note) {\r\n        this.notes[section].splice(note, 1);\r\n    }\r\n    addNote(section, note, data) {\r\n        if (section >= this.notes.length) {\r\n            section = this.notes.length;\r\n            this.notes.push([]);\r\n        }\r\n        this.notes[section].splice(note, 0, data);\r\n    }\r\n    isBlankNote(section, note) {\r\n        for (let i = 0; i < 6; i++) {\r\n            if (this.notes[section][note][1][i] != -1) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n    getSVGNote(section, note) {\r\n        let noteElements = this.tabCanvas.layers.notes.noteElements;\r\n        return noteElements.find((elem) => {\r\n            return elem.section == section && elem.note == note;\r\n        });\r\n    }\r\n    getNotePosition(section, note, string = 0) {\r\n        let sum = 0;\r\n        if (section == -1)\r\n            section = this.notes.length - 1;\r\n        if (note == -1)\r\n            note = this.notes[section].length - 1;\r\n        if (section >= this.notes.length || section < -1 || note >= this.notes[section].length || note < -1 || string > 5 || string < 0) {\r\n            return [-1, -1];\r\n        }\r\n        for (let i = 0; i < section; i++) {\r\n            sum += this.notes[i].length;\r\n        }\r\n        sum += note;\r\n        let sel = this.tabCanvas.layers.notes.noteElements[sum].blockGroup[string];\r\n        return [sel.x, sel.y];\r\n    }\r\n    getNoteNumberOfSection(section) {\r\n        if (section == -1)\r\n            section = this.notes.length - 1;\r\n        return this.notes[section].length;\r\n    }\r\n    getSectionNumber() {\r\n        return this.notes.length;\r\n    }\r\n    /**\r\n     * add a note\r\n     * @param { [number, number[], any] }   data, note length, [block number, index is string number,], user data\r\n     * @param { number }                    section, if give -1, note will be appended at last section. Index start from 0\r\n     * @param { number }                    note, if give -1, note will be appended at last note. Index start from 0\r\n     */\r\n    instrumentNoteInput(correction, data, section = -1, note = -1) {\r\n        if (section == -1)\r\n            section = this.notes.length - 1;\r\n        if (note == -1)\r\n            note = this.notes[section].length - 1;\r\n        correction(this, data, section, note);\r\n        this.render();\r\n    }\r\n    attach(anchor) {\r\n        anchor.append(this.domElement);\r\n    }\r\n    noteIndex(note) {\r\n        return this.tabCanvas.layers.notes.noteElements.indexOf(note);\r\n    }\r\n    /**\r\n * Drag and drog area select notes\r\n * Bad implement by now, the function search each note to find collision\r\n * Algorithm will be fixed in future.\r\n */\r\n    areaSelect(x1, y1, x2, y2) {\r\n        let noteElements = this.tabCanvas.layers.notes.noteElements;\r\n        var selectedNoteIds = [];\r\n        let leftSelectedNote;\r\n        let rightSelectedNote;\r\n        for (let i = 0; i < noteElements.length; i++) {\r\n            for (let j = 0; j < 6; j++) {\r\n                //Check if note is in the selected area\r\n                if (noteElements[i].blockGroup[j].x >= x1\r\n                    && noteElements[i].blockGroup[j].x <= x2\r\n                    && noteElements[i].blockGroup[j].y >= y1\r\n                    && noteElements[i].blockGroup[j].y <= y2) {\r\n                    selectedNoteIds.push(i);\r\n                }\r\n            }\r\n        }\r\n        leftSelectedNote = Math.min(...selectedNoteIds);\r\n        rightSelectedNote = Math.max(...selectedNoteIds);\r\n        return noteElements.slice(leftSelectedNote, rightSelectedNote + 1);\r\n    }\r\n    endsSelect(head, tail) {\r\n        if (head > tail) {\r\n            let temp = tail;\r\n            tail = head;\r\n            head = temp;\r\n        }\r\n        return this.tabCanvas.layers.notes.noteElements.slice(head, tail + 1);\r\n    }\r\n    headToEndSelect(head) {\r\n        return this.tabCanvas.layers.notes.noteElements.slice(head, this.tabCanvas.layers.notes.noteElements.length);\r\n    }\r\n    render() {\r\n        this.setAllLine();\r\n        let [rawDataLength, firstChange, linkerData, sectionPosition] = this.calNoteRawData();\r\n        this.setSectionIndicator(sectionPosition);\r\n        this.setAllNoteElementData(rawDataLength, firstChange);\r\n        this.setLinker(linkerData);\r\n        let ln = Math.ceil(this.notes.length / this.sectionPerLine);\r\n        if (this.height != (this.lineStartPosition[1] + (this.stringPadding * 5 + this.lineDistance) * ln + 70)) {\r\n            this.height = (this.lineStartPosition[1] + (this.stringPadding * 5 + this.lineDistance) * ln + 70);\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.tabCanvas.domElement, { height: `${this.height}` });\r\n        }\r\n    }\r\n    on(ename, cbk) {\r\n        if (ename in this.callbacks) {\r\n            this.callbacks[ename].push(cbk);\r\n        }\r\n    }\r\n    scrollTo(val) {\r\n        this.domElement.scrollTop = val;\r\n    }\r\n    getSectionLeftTopPos(section) {\r\n        if (section < this.notes.length) {\r\n            return [this.tabCanvas.layers.ui.sectionIndicator[section].x, this.tabCanvas.layers.ui.sectionIndicator[section].y];\r\n        }\r\n        return [-1, -1];\r\n    }\r\n    getSectionWidth(section) {\r\n        if (section < this.notes.length) {\r\n            this.tabCanvas.layers.ui.sectionIndicator[section].width;\r\n        }\r\n        return 0;\r\n    }\r\n    getSectionHeight(section) {\r\n        if (section < this.notes.length) {\r\n            this.tabCanvas.layers.ui.sectionIndicator[section].height;\r\n        }\r\n        return 0;\r\n    }\r\n    setAllLine() {\r\n        let ln = Math.ceil(this.notes.length / this.sectionPerLine); // number of row you need\r\n        let an = this.tabCanvas.layers.sheet.row.length; // number of row you have\r\n        for (let i = an; i < ln; i++) {\r\n            let x = this.lineStartPosition[0];\r\n            let y = this.lineStartPosition[1] + (this.stringPadding * 5 + this.lineDistance) * i;\r\n            this.tabCanvas.layers.sheet.createRow(x, y, this.lineWidth, this.linePadding, this.stringPadding, this.sectionPerLine);\r\n        }\r\n        for (let i = ln; i < an; i++) {\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setStyle(this.tabCanvas.layers.sheet.row[i], { display: \"none\" });\r\n        }\r\n        for (let i = 0; i < ln; i++) {\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setStyle(this.tabCanvas.layers.sheet.row[i], { display: \"unset\" });\r\n        }\r\n    }\r\n    setSectionIndicator(position) {\r\n        if (position.length > this.tabCanvas.layers.ui.sectionIndicator.length) {\r\n            let nsNumber = position.length - this.tabCanvas.layers.ui.sectionIndicator.length;\r\n            for (let i = 0; i < nsNumber; i++) {\r\n                this.tabCanvas.layers.ui.createSectionIndicator();\r\n            }\r\n        }\r\n        for (let i = 0; i < position.length; i++) {\r\n            let width = position[i][1][0] - position[i][0][0];\r\n            let height = this.stringPadding * 5;\r\n            this.tabCanvas.layers.ui.sectionIndicator[i].x = position[i][0][0];\r\n            this.tabCanvas.layers.ui.sectionIndicator[i].y = position[i][0][1];\r\n            this.tabCanvas.layers.ui.sectionIndicator[i].width = width;\r\n            this.tabCanvas.layers.ui.sectionIndicator[i].height = height;\r\n            //utils.setAttributes(this.tabCanvas.layers.ui.sectionIndicator[i], {x: `${position[i][0][0]}`, y: `${position[i][0][1]}`, width: `${width}`, height: `${height}`});\r\n        }\r\n    }\r\n    calNoteRawData() {\r\n        let [x, y] = this.startPosition;\r\n        let sectionLength = this.beatPerSection / this.lengthPerBeat;\r\n        let linker = [];\r\n        let sectionIndicator = [];\r\n        let seperaterLength = 1 / 4;\r\n        let accumulatedLength = 0;\r\n        this.rawData.splice(0, 0, { x: 0, y: 0, length: 0, blocks: null, tail: null, section: 0, note: 0 }); // give a initial data, remove it at the end of function\r\n        let ci = 1;\r\n        let first = -1;\r\n        for (let s = 0; s < this.notes.length; s++) { // section\r\n            let line = Math.floor(s / this.sectionPerLine);\r\n            let lineTotalNote = 0;\r\n            accumulatedLength = 0;\r\n            for (let i = 0; i < this.sectionPerLine; i++) {\r\n                if (this.notes[line * this.sectionPerLine + i]) {\r\n                    lineTotalNote += this.notes[line * this.sectionPerLine + i].length + this.sectionAddNoteNumber;\r\n                }\r\n                else {\r\n                    lineTotalNote += this.sectionAddNoteNumber;\r\n                }\r\n            }\r\n            let sectionWidth = this.lineWidth * (this.notes[s].length + this.sectionAddNoteNumber) / lineTotalNote;\r\n            let sectionTotalBeat = 0;\r\n            for (let i = 0; i < this.notes[s].length; i++) {\r\n                sectionTotalBeat += this.lengthPerBeat / this.notes[s][i][0];\r\n            }\r\n            let beatLength = (sectionWidth - 20) / sectionTotalBeat;\r\n            if (s % this.sectionPerLine == 0) { // change line\r\n                x = this.startPosition[0];\r\n                if (s != 0)\r\n                    y += this.stringPadding * 5 + this.lineDistance;\r\n            }\r\n            let sx = [[x - 20, y], [0, y]]; // section position\r\n            let nx = x + sectionWidth;\r\n            sx[1][0] = nx - 20;\r\n            this.tabCanvas.layers.sheet.bar[s].x1 = nx - 20;\r\n            this.tabCanvas.layers.sheet.bar[s].x2 = nx - 20;\r\n            sectionIndicator.push(sx);\r\n            for (let i = 0; i < this.notes[s].length; i++) { // note\r\n                let note = this.notes[s][i];\r\n                let noteLength = this.lengthPerBeat / note[0];\r\n                let tail;\r\n                if (accumulatedLength + noteLength / this.lengthPerBeat >= seperaterLength) { // the note is the end of a beat or the note's length equals to a beat\r\n                    tail = this.calculateTail(this.rawData[ci - 1].length, note[0], -1, beatLength);\r\n                    accumulatedLength = 0;\r\n                }\r\n                else {\r\n                    tail = this.calculateTail(this.rawData[ci - 1].length, note[0], accumulatedLength, beatLength);\r\n                    accumulatedLength += noteLength / this.lengthPerBeat;\r\n                }\r\n                let step = beatLength * this.lengthPerBeat / note[0];\r\n                let updateNote = this.updateRawData(ci, x, y, note[0], note[1], tail, s, i);\r\n                if (updateNote >= 0 && first < 0)\r\n                    first = updateNote - 1; // ci start from 1\r\n                ci++;\r\n                if (note[2] === \"linkStart\" || note[2] === \"linkEnd\") {\r\n                    linker.push([x, y]);\r\n                }\r\n                x += step;\r\n            }\r\n            x = nx;\r\n        }\r\n        this.rawData.shift();\r\n        ci--;\r\n        return [ci, first, linker, sectionIndicator]; // ci = totoal section number, first = frist note that data has changed\r\n    }\r\n    updateRawData(arryIndex, x, y, noteLength, noteData, tail, section, note) {\r\n        if (arryIndex > this.rawData.length) {\r\n            console.error(\"array index erro, should not be greater than rawData.length\");\r\n            return -1;\r\n        }\r\n        if (arryIndex === this.rawData.length) {\r\n            this.rawData.push({ x: x, y: y, length: noteLength, blocks: noteData.slice(0, 6), tail: tail.slice(0, tail.length), section: section, note: note });\r\n            return arryIndex;\r\n        }\r\n        let data = this.rawData[arryIndex];\r\n        if (data.x != x || data.y != y || data.length != noteLength || data.section != section || data.note != note || !this.compareArray(data.blocks, noteData) || !this.compareArray(data.tail, tail)) {\r\n            this.rawData[arryIndex].x = x;\r\n            this.rawData[arryIndex].y = y;\r\n            this.rawData[arryIndex].length = noteLength;\r\n            this.rawData[arryIndex].blocks = noteData.slice(0, 6);\r\n            this.rawData[arryIndex].tail = tail.slice(0, tail.length);\r\n            this.rawData[arryIndex].section = section;\r\n            this.rawData[arryIndex].note = note;\r\n            return arryIndex;\r\n        }\r\n        return -1;\r\n    }\r\n    compareArray(a, b) {\r\n        if (a.length != b.length)\r\n            return false;\r\n        for (let i = 0; i < a.length; i++) {\r\n            if (a[i] != b[i])\r\n                return false;\r\n        }\r\n        return true;\r\n    }\r\n    calculateTail(lastNoteLength, noteLength, accumulatedLength, beatLength) {\r\n        let step = beatLength * this.lengthPerBeat / lastNoteLength * -1;\r\n        let basicLength = 8;\r\n        if (accumulatedLength == -1)\r\n            basicLength = -8;\r\n        if (accumulatedLength == 0) { // start of a seperate note\r\n            if (noteLength == 8) {\r\n                return [basicLength, 0, 0];\r\n            }\r\n            else if (noteLength == 16) {\r\n                return [basicLength, basicLength, 0];\r\n            }\r\n            else if (noteLength == 32) {\r\n                return [basicLength, basicLength, basicLength];\r\n            }\r\n        }\r\n        else {\r\n            if (noteLength == 8) {\r\n                if (lastNoteLength == 8 || lastNoteLength == 16 || lastNoteLength == 32) {\r\n                    return [step, 0, 0];\r\n                }\r\n            }\r\n            else if (noteLength == 16) {\r\n                if (lastNoteLength == 8) {\r\n                    return [step, basicLength, 0];\r\n                }\r\n                else if (lastNoteLength == 16 || lastNoteLength == 32) {\r\n                    return [step, step, 0];\r\n                }\r\n            }\r\n            else if (noteLength == 32) {\r\n                if (lastNoteLength == 8) {\r\n                    return [step, basicLength, basicLength];\r\n                }\r\n                else if (lastNoteLength == 16) {\r\n                    return [step, step, basicLength];\r\n                }\r\n                else if (lastNoteLength == 32) {\r\n                    return [step, step, step];\r\n                }\r\n            }\r\n        }\r\n        return [0, 0, 0];\r\n    }\r\n    /**\r\n     * receive data from calNoteRawData and set elements\r\n     * @param { [number, number, number, number[]][] } data\r\n     */\r\n    setAllNoteElementData(dataLength, firstChange) {\r\n        let data = this.rawData;\r\n        let noteElement = this.tabCanvas.layers.notes.noteElements;\r\n        let ne = dataLength - noteElement.length;\r\n        let nullData = { x: 0, y: 0, length: 0, blocks: [-1, -1, -1, -1, -1, -1], tail: [0, 0, 0], section: 0, note: 0 }; //[0, 0, 0, [-1, -1, -1, -1, -1, -1], [0, 0, 0], 0, 0];\r\n        for (let i = 0; i < ne; i++) {\r\n            this.tabCanvas.layers.notes.createNote();\r\n            noteElement[noteElement.length - 1].blockGroup.forEach((wg, i) => {\r\n                wg.domelement.addEventListener(\"click\", this.onNoteClicked.bind(this));\r\n                wg.domelement.addEventListener(\"mouseover\", this.onMouseOverNote.bind(this));\r\n                wg.domelement.addEventListener(\"mouseout\", this.onMouseOutNote.bind(this));\r\n                wg.string = i;\r\n                _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(wg.domelement, { \"data-string\": `${i}` });\r\n            });\r\n        }\r\n        if (firstChange > 0)\r\n            firstChange -= 1;\r\n        if (firstChange >= 0) {\r\n            for (let i = firstChange; i < dataLength; i++) {\r\n                _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setStyle(noteElement[i].domelement, { display: \"unset\" });\r\n                if (i != data.length - 1) {\r\n                    if (data[i + 1].x > data[i].x) {\r\n                        this.setNoteElementData(noteElement[i], data[i], data[i + 1], (data[i + 1].x - data[i].x) * 0.7);\r\n                    }\r\n                    else {\r\n                        this.setNoteElementData(noteElement[i], data[i], data[i + 1], 30);\r\n                    }\r\n                }\r\n                else {\r\n                    this.setNoteElementData(noteElement[i], data[i], nullData, 30);\r\n                }\r\n            }\r\n        }\r\n        for (let i = dataLength; i < noteElement.length; i++) {\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setStyle(noteElement[i].domelement, { display: \"none\" });\r\n        }\r\n    }\r\n    setNoteElementData(el, data, nexData, xlength) {\r\n        this.setElementPosition(el, data.x, data.y, data.tail, data.section, data.note, xlength);\r\n        this.setChordVisiable(el, data.x, data.y, data.length, data.blocks, data.tail, nexData.tail);\r\n    }\r\n    setElementPosition(e, x, y, tail, sectionIndex, noteIndex, xlength) {\r\n        let ln = Math.floor(sectionIndex / this.sectionPerLine);\r\n        // set note bar's position and bar tail's length\r\n        e.lineGroup[0].x1 = x;\r\n        e.lineGroup[0].y1 = 26 + y + this.stringPadding * 5;\r\n        e.lineGroup[0].x2 = x;\r\n        e.lineGroup[0].y2 = y;\r\n        e.lineGroup[1].x1 = x;\r\n        e.lineGroup[1].y1 = 25 + y + this.stringPadding * 5;\r\n        e.lineGroup[1].x2 = x + tail[0];\r\n        e.lineGroup[1].y2 = 25 + y + this.stringPadding * 5;\r\n        e.lineGroup[2].x1 = x;\r\n        e.lineGroup[2].y1 = 21 + y + this.stringPadding * 5;\r\n        e.lineGroup[2].x2 = x + tail[1];\r\n        e.lineGroup[2].y2 = 21 + y + this.stringPadding * 5;\r\n        e.lineGroup[3].x1 = x;\r\n        e.lineGroup[3].y1 = 17 + y + this.stringPadding * 5;\r\n        e.lineGroup[3].x2 = x + tail[2];\r\n        e.lineGroup[3].y2 = 17 + y + this.stringPadding * 5;\r\n        // set note word position\r\n        for (let i = 0; i < 6; i++) {\r\n            e.blockGroup[i].x = x;\r\n            e.blockGroup[i].y = y + this.stringPadding * i;\r\n            e.blockGroup[i].extendRect.y = y + this.stringPadding * (i - 0.5);\r\n            e.blockGroup[i].extendRect.height = this.stringPadding;\r\n            e.blockGroup[i].extendRect.width = xlength;\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(e.blockGroup[i].domelement, { \"data-x\": `${x}`, \"data-y\": `${y + this.stringPadding * i}`, \"data-line\": `${ln}` });\r\n        }\r\n        e.tail8.setPosition(x, y + this.stringPadding * 5 + 15);\r\n        e.tail16.setPosition(x, y + this.stringPadding * 5 + 10);\r\n        e.tail32.setPosition(x, y + this.stringPadding * 5 + 5);\r\n        e.section = sectionIndex;\r\n        e.note = noteIndex;\r\n        e.line = ln;\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(e.domelement, { \"data-section\": `${sectionIndex}`, \"data-note\": `${noteIndex}` });\r\n        e.blockGroup.forEach((wg, i) => {\r\n            wg.section = sectionIndex;\r\n            wg.note = noteIndex;\r\n            wg.line = ln;\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(wg.domelement, { \"data-section\": `${sectionIndex}`, \"data-note\": `${noteIndex}`, \"data-line\": `${ln}` });\r\n        });\r\n    }\r\n    setChordVisiable(e, x, y, noteLength, data, tail, nextTail) {\r\n        let ap = true;\r\n        e.tail8.hide();\r\n        e.tail16.hide();\r\n        e.tail32.hide();\r\n        for (let i = 0; i < 3; i++) {\r\n            if (tail[i] < 0 || nextTail[i] < 0) {\r\n                ap = false;\r\n                break;\r\n            }\r\n        }\r\n        if (ap) {\r\n            if (noteLength == 8) {\r\n                e.tail8.show();\r\n            }\r\n            else if (noteLength == 16) {\r\n                e.tail16.show();\r\n            }\r\n            else if (noteLength == 32) {\r\n                e.tail32.show();\r\n            }\r\n            e.lineGroup[1].x2 = x;\r\n            e.lineGroup[2].x2 = x;\r\n            e.lineGroup[3].x2 = x;\r\n        }\r\n        for (let i = 0; i < 6; i++) {\r\n            e.blockGroup[i].word.text = `${data[i]}`;\r\n            e.blockGroup[i].wordBack.text = `${data[i]}`;\r\n            if (data[i] == -1) {\r\n                _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setStyle(e.blockGroup[i].domelement, { display: \"none\" });\r\n            }\r\n            else {\r\n                _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setStyle(e.blockGroup[i].domelement, { display: \"block\" });\r\n            }\r\n        }\r\n        if (noteLength == 2) {\r\n            e.lineGroup[0].y2 = 10 + y + this.stringPadding * 5;\r\n            return;\r\n        }\r\n        else if (noteLength == 1) {\r\n            e.lineGroup[0].y2 = 26 + y + this.stringPadding * 5;\r\n            return;\r\n        }\r\n        let hc = 6.5;\r\n        // note bar should reach the top word\r\n        for (let i = 1; i <= 6; i++) {\r\n            if (data[i - 1] != -1) {\r\n                hc = i;\r\n                break;\r\n            }\r\n        }\r\n        e.lineGroup[0].y2 = y + this.stringPadding * (hc - 1);\r\n    }\r\n    setLinker(linkerData) {\r\n        let lenumber = Math.floor(linkerData.length / 2);\r\n        let existNumber = this.tabCanvas.layers.background.linker.length;\r\n        for (let i = 0; i < lenumber - existNumber; i++) {\r\n            this.tabCanvas.layers.background.createLinker();\r\n        }\r\n        for (let i = 0; i < lenumber; i++) {\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setStyle(this.tabCanvas.layers.background.linker[i], { display: \"unset\" });\r\n            this.setLinkerData(this.tabCanvas.layers.background.linker[i], linkerData[i * 2], linkerData[i * 2 + 1]);\r\n        }\r\n        for (let i = lenumber; i < this.tabCanvas.layers.background.linker.length; i++) {\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setStyle(this.tabCanvas.layers.background.linker[i], { display: \"none\" });\r\n        }\r\n    }\r\n    setLinkerData(linkElement, start, end) {\r\n        let ly = start[1] + 31 + this.stringPadding * 5;\r\n        if (start[1] !== end[1]) {\r\n            let ex = start[0] + 30;\r\n            let sx = start[0];\r\n            let path = `M ${sx} ${ly} C ${sx + 4} ${ly + 15}, ${ex - 4} ${ly + 15}, ${ex} ${ly} C ${ex - 4} ${ly + 12}, ${sx + 4} ${ly + 12}, ${sx} ${ly} `;\r\n            ly = end[1] + 31 + this.stringPadding * 5;\r\n            sx = end[0] - 30;\r\n            ex = end[0];\r\n            path += `M ${sx} ${ly} C ${sx + 4} ${ly + 15}, ${ex - 4} ${ly + 15}, ${ex} ${ly} C ${ex - 4} ${ly + 12}, ${sx + 4} ${ly + 12}, ${sx} ${ly}`;\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(linkElement, { d: path });\r\n        }\r\n        else {\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(linkElement, { d: `M ${start[0]} ${ly} C ${start[0] + 4} ${ly + 15}, ${end[0] - 4} ${ly + 15}, ${end[0]} ${ly} C ${end[0] - 4} ${ly + 12}, ${start[0] + 4} ${ly + 12}, ${start[0]} ${ly}` });\r\n        }\r\n    }\r\n    onNoteClicked(ev) {\r\n        let section = Number(ev.currentTarget.dataset.section);\r\n        let note = Number(ev.currentTarget.dataset.note);\r\n        let string = Number(ev.currentTarget.dataset.string);\r\n        let position = [Number(ev.currentTarget.dataset.x), Number(ev.currentTarget.dataset.y)];\r\n        if (ev.shiftKey) {\r\n            this.callbacks[\"noteshiftclick\"].callAll(section, note, string, position, ev.currentTarget);\r\n        }\r\n        else if (ev.altKey) {\r\n            this.callbacks[\"notealtclick\"].callAll(section, note, string, position, ev.currentTarget);\r\n        }\r\n        else if (ev.ctrlKey) {\r\n            this.callbacks[\"notectrlclick\"].callAll(section, note, string, position, ev.currentTarget);\r\n        }\r\n        else {\r\n            this.callbacks[\"noteclick\"].callAll(section, note, string, position, ev.currentTarget);\r\n        }\r\n    }\r\n    onKeydown(ev) {\r\n        this.callbacks[\"keydown\"].callAll(ev.key);\r\n    }\r\n    onMouseOverNote(ev) {\r\n        let section = Number(ev.currentTarget.dataset.section);\r\n        let note = Number(ev.currentTarget.dataset.note);\r\n        let string = Number(ev.currentTarget.dataset.string);\r\n        let position = [Number(ev.currentTarget.dataset.x), Number(ev.currentTarget.dataset.y)];\r\n        this.callbacks[\"mouseovernote\"].callAll(section, note, string, position, ev.currentTarget);\r\n    }\r\n    onMouseOutNote(ev) {\r\n        let section = Number(ev.currentTarget.dataset.section);\r\n        let note = Number(ev.currentTarget.dataset.note);\r\n        let string = Number(ev.currentTarget.dataset.string);\r\n        let position = [Number(ev.currentTarget.dataset.x), Number(ev.currentTarget.dataset.y)];\r\n        this.callbacks[\"mouseoutnote\"].callAll(section, note, string, position, ev.currentTarget);\r\n    }\r\n    onMouseDown(ev) {\r\n        this.callbacks[\"mousedown\"].callAll(Number(ev.x), Number(ev.y));\r\n    }\r\n    onMouseMove(ev) {\r\n        this.callbacks[\"mousemove\"].callAll(Number(ev.x), Number(ev.y));\r\n    }\r\n    onMouseUp(ev) {\r\n        this.callbacks[\"mouseup\"].callAll(Number(ev.x), Number(ev.y));\r\n    }\r\n    onMouseRightClick(ev) {\r\n        this.callbacks[\"rightclick\"].callAll(Number(ev.x), Number(ev.y));\r\n    }\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvU2xpbVRhYlYyLnRzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vc3JjL1NsaW1UYWJWMi50cz85NzBlIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7dXRpbHMsIENhbGxiYWNrc30gZnJvbSBcIi4vdXRpbHNcIlxuaW1wb3J0IHsgc2VjdGlvbiwgbm90ZSB9IGZyb20gXCIuL1NsaW1UYWJWMlR5cGVzXCJcbmltcG9ydCB7IENvcnJlY3Rpb24gfSBmcm9tIFwiLi9TbGltVGFiVjJJbnRlcmZhY2VcIlxuaW1wb3J0IHsgU0xDYW52YXMsIFNMTGF5ZXIsIFNWR05vdGUgfSBmcm9tIFwiLi9TbGltVGFiVjJDYW52YXNcIlxuaW50ZXJmYWNlIGNhY3VsYXRlZE5vdGVEYXRhe1xuICAgIHg6IG51bWJlcjtcbiAgICB5OiBudW1iZXI7XG4gICAgbGVuZ3RoOiBudW1iZXI7XG4gICAgYmxvY2tzOiBudW1iZXJbXTtcbiAgICB0YWlsOiBudW1iZXJbXTtcbiAgICBzZWN0aW9uOiBudW1iZXI7XG4gICAgbm90ZTogbnVtYmVyO1xufVxuLy90eXBlIGNhY3VsYXRlZE5vdGVEYXRhID0gW251bWJlciwgbnVtYmVyLCBudW1iZXIsIG51bWJlcltdLCBudW1iZXJbXSwgbnVtYmVyLCBudW1iZXJdOyAvL1t4LCB5ICwgbGVuZ3RoLCBibG9jayBvZiBldmVyeSBjaG9yZCwgdGFpbCBsZW5ndGgsIHNlY3Rpb24gaW5kZXgsIG5vdGUgaW5kZXhdXG5pbnRlcmZhY2UgZXZlbnRDYWxsQmFja0ludGVyZmFjZSB7XG4gICAgbm90ZWNsaWNrOiAoc2VjdGlvbjogbnVtYmVyICwgbm90ZTogbnVtYmVyICwgc3RyaW5nOiBudW1iZXIsIHBvc2l0aW9uOiBudW1iZXJbXSwgY3VycmVudFRhcmdldDogSFRNTEVsZW1lbnQpID0+IGFueTtcbiAgICBrZXlkb3duOiAoa2V5OiBzdHJpbmcpID0+IGFueTtcbiAgICBtb3VzZW92ZXJub3RlOiAoc2VjdGlvbjogbnVtYmVyICwgbm90ZTogbnVtYmVyICwgc3RyaW5nOiBudW1iZXIsIHBvc2l0aW9uOiBudW1iZXJbXSwgY3VycmVudFRhcmdldDogSFRNTEVsZW1lbnQpID0+IGFueTtcbiAgICBtb3VzZW91dG5vdGU6IChzZWN0aW9uOiBudW1iZXIgLCBub3RlOiBudW1iZXIgLCBzdHJpbmc6IG51bWJlciwgcG9zaXRpb246IG51bWJlcltdLCBjdXJyZW50VGFyZ2V0OiBIVE1MRWxlbWVudCkgPT4gYW55O1xuICAgIG5vdGVzaGlmdGNsaWNrOiAoc2VjdGlvbjogbnVtYmVyLCBub3RlOiBudW1iZXIsIHN0cmluZzogbnVtYmVyLCBwb3NpdGlvbjogbnVtYmVyW10sIGN1cnJlbnRUYXJnZXQ6IEhUTUxFbGVtZW50KSA9PiBhbnk7XG4gICAgbm90ZWFsdGNsaWNrOiAoc2VjdGlvbjogbnVtYmVyLCBub3RlOiBudW1iZXIsIHN0cmluZzogbnVtYmVyLCBwb3NpdGlvbjogbnVtYmVyW10sIGN1cnJlbnRUYXJnZXQ6IEhUTUxFbGVtZW50KSA9PiBhbnk7XG4gICAgbm90ZWN0cmxjbGNpazogKHNlY3Rpb246IG51bWJlciwgbm90ZTogbnVtYmVyLCBzdHJpbmc6IG51bWJlciwgcG9zaXRpb246IG51bWJlcltdLCBjdXJyZW50VGFyZ2V0OiBIVE1MRWxlbWVudCkgPT4gYW55O1xuICAgIG1vdXNlZG93bjogKHg6IG51bWJlciwgeTogbnVtYmVyKSA9PiBhbnk7XG4gICAgbW91c2Vtb3ZlOiAoeDogbnVtYmVyLCB5OiBudW1iZXIpID0+IGFueTtcbiAgICBtb3VzZXVwOiAoeDogbnVtYmVyLCB5OiBudW1iZXIpID0+IGFueTtcbn1cbmV4cG9ydCBjbGFzcyBTTFRhYiB7XG4gICAgdGFiQ2FudmFzOiBTTENhbnZhczxTTExheWVyPjtcbiAgICBub3Rlczogc2VjdGlvbltdO1xuICAgIGRvbUVsZW1lbnQ6IEhUTUxFbGVtZW50O1xuICAgIHJlYWRvbmx5IGxlbmd0aFBlckJlYXQ6IG51bWJlciA9IDQ7XG4gICAgcmVhZG9ubHkgYmVhdFBlclNlY3Rpb246IG51bWJlciA9IDQ7XG4gICAgcHJpdmF0ZSBsaW5lV2lkdGg6IG51bWJlciA9IDEyMDA7XG4gICAgcHJpdmF0ZSBzZWN0aW9uUGVyTGluZTogbnVtYmVyID0gNDtcbiAgICBwcml2YXRlIHN0cmluZ1BhZGRpbmc6IG51bWJlciA9IDE2OyAvLyBkaXN0YW5jZSBiZXR3ZWVuIGVhY2ggc3RyaW5nXG4gICAgcHJpdmF0ZSBsaW5lUGVyUGFnZTogbnVtYmVyID0gMjA7XG4gICAgcHJpdmF0ZSBsaW5lTWFyZ2luOiBudW1iZXIgPSA0MjsgLy8gb25seSBmb3IgbGVmdCBhbmQgcmlnaHRcbiAgICBwcml2YXRlIGxpbmVQYWRkaW5nOiBbbnVtYmVyLCBudW1iZXJdID0gWzMyLCAxNF07XG4gICAgcHJpdmF0ZSBsaW5lRGlzdGFuY2U6IG51bWJlciA9IDkwOyAvLyBkaXN0YW5jZSBiZXR3ZWVuIGVhY2ggbGluZVxuICAgIHByaXZhdGUgc2VjdGlvbkFkZE5vdGVOdW1iZXIgPSAxNjtcbiAgICBwcml2YXRlIGxpbmtlckVsZW1lbnQ6IFNWR0VsZW1lbnRbXSA9IFtdO1xuICAgIHByaXZhdGUgc3RhcnRQb3NpdGlvbjogbnVtYmVyW10gPSBbdGhpcy5saW5lTWFyZ2luICsgdGhpcy5saW5lUGFkZGluZ1swXSArIDIwLCAxMjAgKyB0aGlzLmxpbmVQYWRkaW5nWzFdXTsgLy8geCwgeVxuICAgIHByaXZhdGUgbGluZVN0YXJ0UG9zaXRpb246IFtudW1iZXIsIG51bWJlcl0gPSBbdGhpcy5saW5lTWFyZ2luLCAxMjBdOyAvLyB0b3RhbCBsaW5lIG51bWJlciwgbGFzdCBsaW5lIFgsIGxhc3QgbGluZSBZXG4gICAgcHJpdmF0ZSBoZWlnaHQ6IG51bWJlcjtcbiAgICBwcml2YXRlIHJhd0RhdGE6IGNhY3VsYXRlZE5vdGVEYXRhW10gPSBbXTtcbiAgICBcbiAgICAvKipcbiAgICAgKiBDYWxsYmFja3NcbiAgICAgKiBBdmFpbGFibGUgY2FsbGJhY2tzXG4gICAgICogbm90ZWNsaWNrOiB0cmlnZ2VyZWQgd2hlbiBhIG5vdGUgZWxlbWVudCBpcyBjbGlja2VkXG4gICAgICovXG4gICAgcHJpdmF0ZSBjYWxsYmFja3M6IENhbGxiYWNrcztcblxuICAgIGNvbnN0cnVjdG9yKGRhdGE/OiB7bGVuZ3RoUGVyQmVhdD86IG51bWJlciwgYmVhdFBlclNlY3Rpb24/OiBudW1iZXIsIGxpbmVXaWR0aD86IG51bWJlciwgc2VjdGlvblBlckxpbmU/OiBudW1iZXIsIGxpbmVQZXJQYWdlPzogbnVtYmVyfSkge1xuICAgICAgICBPYmplY3QuYXNzaWduKHRoaXMsIGRhdGEpO1xuICAgICAgICB0aGlzLnRhYkNhbnZhcyA9IG5ldyBTTENhbnZhczxTTExheWVyPihTTExheWVyKTtcbiAgICAgICAgbGV0IHdpZHRoID0gdGhpcy5saW5lV2lkdGggKyB0aGlzLmxpbmVQYWRkaW5nWzBdKjIgKyA0MioyO1xuICAgICAgICB1dGlscy5zZXRBdHRyaWJ1dGVzKHRoaXMudGFiQ2FudmFzLmRvbUVsZW1lbnQse3dpZHRoOiBgJHt3aWR0aH1gfSk7XG4gICAgICAgIHRoaXMuZG9tRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIHRoaXMuZG9tRWxlbWVudC5hcHBlbmQodGhpcy50YWJDYW52YXMuZG9tRWxlbWVudCk7XG4gICAgICAgIHRoaXMuZG9tRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLChlKSA9PiB7XG4gICAgICAgICAgICBsZXQga2EgPSBbMzIsIDM3LCAzOCwgMzksIDQwXTsgLy9zcGFjZTogMzIsIGxlZnQ6IDM3LCB1cDogMzgsIHJpZ2h0OiAzOSwgZG93bjogNDAsXG4gICAgICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwga2EubGVuZ3RoOyBpKyspey8vIHdoeSBpcyB0aGVyZSBubyBcImluY2x1ZGVzXCIgbWV0aG9kcyBpbiB0eXBlc2NyaXB0ID0gPT9cbiAgICAgICAgICAgICAgICBpZihrYVtpXSA9PT0gZS5rZXlDb2RlKXtcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICBlLnJldHVyblZhbHVlID0gZmFsc2U7ICBcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB1dGlscy5zZXRTdHlsZSh0aGlzLmRvbUVsZW1lbnQsIHtcIndpZHRoXCI6IGAke3dpZHRoICsgMjB9cHhgLCBoZWlnaHQ6IFwiNzAwcHhcIiwgXCJvdmVyZmxvdy15XCI6IFwiYXV0b1wiLCBcIm92ZXJmbG93LXhcIjogXCJoaWRkZW5cIn0pO1xuICAgICAgICAvL2lmIGFkZCBuZXcgZXZlbnQsIHlvdSBzaG91bGQgZGVzY3JpYmUgdGhlIGNhbGxiYWNrIGluIGV2ZW50Q2FsbEJhY2tJbnRlcmZhY2UgYWJvdmVcbiAgICAgICAgdGhpcy5jYWxsYmFja3MgPSBuZXcgQ2FsbGJhY2tzKFtcbiAgICAgICAgICAgIFwibm90ZWNsaWNrXCIsIFxuICAgICAgICAgICAgXCJub3Rlc2hpZnRjbGlja1wiLCBcbiAgICAgICAgICAgIFwibm90ZWFsdGNsaWNrXCIsIFxuICAgICAgICAgICAgXCJub3RlY3RybGNsaWNrXCIsXG4gICAgICAgICAgICBcImtleWRvd25cIiwgXG4gICAgICAgICAgICBcIm1vdXNlb3Zlcm5vdGVcIiwgXG4gICAgICAgICAgICBcIm1vdXNlb3V0bm90ZVwiLCBcbiAgICAgICAgICAgIFwibW91c2Vkb3duXCIsIFxuICAgICAgICAgICAgXCJtb3VzZW1vdmVcIiwgXG4gICAgICAgICAgICBcIm1vdXNldXBcIixcbiAgICAgICAgICAgIFwicmlnaHRjbGlja1wiXG4gICAgICAgIF0pO1xuICAgICAgICB0aGlzLnRhYkNhbnZhcy5kb21FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJmb2N1c1wiLCAoKT0+e30pO1xuICAgICAgICB0aGlzLnRhYkNhbnZhcy5kb21FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMub25LZXlkb3duLmJpbmQodGhpcykpO1xuICAgICAgICB0aGlzLnRhYkNhbnZhcy5kb21FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgdGhpcy5vbk1vdXNlRG93bi5iaW5kKHRoaXMpKTtcbiAgICAgICAgdGhpcy50YWJDYW52YXMuZG9tRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vtb3ZlXCIsIHRoaXMub25Nb3VzZU1vdmUuYmluZCh0aGlzKSk7XG4gICAgICAgIHRoaXMudGFiQ2FudmFzLmRvbUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgdGhpcy5vbk1vdXNlVXAuYmluZCh0aGlzKSk7XG4gICAgICAgIHRoaXMudGFiQ2FudmFzLmRvbUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNvbnRleHRtZW51XCIsIHRoaXMub25Nb3VzZVJpZ2h0Q2xpY2suYmluZCh0aGlzKSk7Ly9SaWdodCBjbGlja1xuICAgIH1cblxuICAgIC8vdG9kbzogZG8gYSBzdHJpY3RlciBjaGVjayBmb3IgdGhlc2UgZnVuY3Rpb25cbiAgICBzZXREYXRhKGRhdGE6IFtudW1iZXIsIG51bWJlcltdLCBhbnldW11bXSkge1xuICAgICAgICB0aGlzLm5vdGVzID0gZGF0YTtcbiAgICB9XG5cbiAgICBnZXROb3RlRGF0YShzZWN0aW9uOiBudW1iZXIsIG5vdGU6IG51bWJlcik6IG5vdGV7XG4gICAgICAgIHJldHVybiB0aGlzLm5vdGVzW3NlY3Rpb25dW25vdGVdO1xuICAgIH1cbiAgICBcbiAgICBzZXROb3RlRGF0YShzZWN0aW9uOiBudW1iZXIsIG5vdGU6IG51bWJlciwgZGF0YTogbm90ZSl7XG4gICAgICAgIHRoaXMubm90ZXNbc2VjdGlvbl1bbm90ZV0gPSBkYXRhO1xuICAgIH1cblxuICAgIHNldFN0cmluZ0RhdGFPZk5vdGUoc2VjdGlvbjogbnVtYmVyLCBub3RlOiBudW1iZXIsIHN0cmluZzogbnVtYmVyLCBkYXRhOiBudW1iZXIpe1xuICAgICAgICBpZihzdHJpbmcgPj0wICYmIHN0cmluZyA8PSA1KXtcbiAgICAgICAgICAgIHRoaXMubm90ZXNbc2VjdGlvbl1bbm90ZV1bMV1bc3RyaW5nXSA9IGRhdGE7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXRTZWN0aW9uRGF0YShzZWN0aW9uOiBudW1iZXIpOiBub3RlW117XG4gICAgICAgIHJldHVybiB0aGlzLm5vdGVzW3NlY3Rpb25dO1xuICAgIH1cblxuICAgIGRlbGV0ZU5vdGUoc2VjdGlvbjogbnVtYmVyLCBub3RlOiBudW1iZXIpe1xuICAgICAgICB0aGlzLm5vdGVzW3NlY3Rpb25dLnNwbGljZShub3RlLCAxKTtcbiAgICB9XG5cbiAgICBhZGROb3RlKHNlY3Rpb246IG51bWJlciwgbm90ZTogbnVtYmVyLCBkYXRhOiBub3RlKXtcbiAgICAgICAgaWYoc2VjdGlvbiA+PSB0aGlzLm5vdGVzLmxlbmd0aCl7XG4gICAgICAgICAgICBzZWN0aW9uID0gdGhpcy5ub3Rlcy5sZW5ndGg7XG4gICAgICAgICAgICB0aGlzLm5vdGVzLnB1c2goW10pO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubm90ZXNbc2VjdGlvbl0uc3BsaWNlKG5vdGUsIDAsIGRhdGEpO1xuICAgIH1cblxuICAgIFxuICAgIGlzQmxhbmtOb3RlKHNlY3Rpb246IG51bWJlciwgbm90ZTogbnVtYmVyKXtcbiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IDY7IGkrKyl7XG4gICAgICAgICAgICBpZih0aGlzLm5vdGVzW3NlY3Rpb25dW25vdGVdWzFdW2ldICE9IC0xKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgZ2V0U1ZHTm90ZShzZWN0aW9uOiBudW1iZXIsIG5vdGU6IG51bWJlcik6IFNWR05vdGV7XG4gICAgICAgIGxldCBub3RlRWxlbWVudHMgPSB0aGlzLnRhYkNhbnZhcy5sYXllcnMubm90ZXMubm90ZUVsZW1lbnRzO1xuICAgICAgICByZXR1cm4gbm90ZUVsZW1lbnRzLmZpbmQoKGVsZW0pID0+IHtcbiAgICAgICAgICAgIHJldHVybiBlbGVtLnNlY3Rpb24gPT0gc2VjdGlvbiAmJiBlbGVtLm5vdGUgPT0gbm90ZVxuICAgICAgICB9KVxuICAgIH1cblxuICAgIGdldE5vdGVQb3NpdGlvbihzZWN0aW9uOiBudW1iZXIsIG5vdGU6IG51bWJlciwgc3RyaW5nOiBudW1iZXIgPSAwKTogW251bWJlciwgbnVtYmVyXXtcbiAgICAgICAgbGV0IHN1bSA9IDA7XG4gICAgICAgIGlmKHNlY3Rpb24gPT0gLTEpIHNlY3Rpb24gPSB0aGlzLm5vdGVzLmxlbmd0aCAtMTtcbiAgICAgICAgaWYobm90ZSA9PSAtMSkgbm90ZSA9IHRoaXMubm90ZXNbc2VjdGlvbl0ubGVuZ3RoIC0xO1xuICAgICAgICBpZihzZWN0aW9uID49IHRoaXMubm90ZXMubGVuZ3RoIHx8IHNlY3Rpb24gPCAtMSB8fCBub3RlID49IHRoaXMubm90ZXNbc2VjdGlvbl0ubGVuZ3RoIHx8IG5vdGUgPCAtMSB8fCBzdHJpbmcgPiA1IHx8IHN0cmluZyA8IDApe1xuICAgICAgICAgICAgcmV0dXJuIFstMSwgLTFdO1xuICAgICAgICB9XG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBzZWN0aW9uOyBpKyspe1xuICAgICAgICAgICAgc3VtICs9IHRoaXMubm90ZXNbaV0ubGVuZ3RoO1xuICAgICAgICB9XG4gICAgICAgIHN1bSArPSBub3RlO1xuICAgICAgICBsZXQgc2VsID0gdGhpcy50YWJDYW52YXMubGF5ZXJzLm5vdGVzLm5vdGVFbGVtZW50c1tzdW1dLmJsb2NrR3JvdXBbc3RyaW5nXTtcbiAgICAgICAgcmV0dXJuIFtzZWwueCwgc2VsLnldO1xuICAgIH1cblxuICAgIGdldE5vdGVOdW1iZXJPZlNlY3Rpb24oc2VjdGlvbjogbnVtYmVyKXtcbiAgICAgICAgaWYoc2VjdGlvbiA9PSAtMSkgc2VjdGlvbiA9IHRoaXMubm90ZXMubGVuZ3RoIC0gMTtcbiAgICAgICAgcmV0dXJuIHRoaXMubm90ZXNbc2VjdGlvbl0ubGVuZ3RoO1xuICAgIH1cblxuICAgIGdldFNlY3Rpb25OdW1iZXIoKXtcbiAgICAgICAgcmV0dXJuIHRoaXMubm90ZXMubGVuZ3RoO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBhZGQgYSBub3RlXG4gICAgICogQHBhcmFtIHsgW251bWJlciwgbnVtYmVyW10sIGFueV0gfSAgIGRhdGEsIG5vdGUgbGVuZ3RoLCBbYmxvY2sgbnVtYmVyLCBpbmRleCBpcyBzdHJpbmcgbnVtYmVyLF0sIHVzZXIgZGF0YVxuICAgICAqIEBwYXJhbSB7IG51bWJlciB9ICAgICAgICAgICAgICAgICAgICBzZWN0aW9uLCBpZiBnaXZlIC0xLCBub3RlIHdpbGwgYmUgYXBwZW5kZWQgYXQgbGFzdCBzZWN0aW9uLiBJbmRleCBzdGFydCBmcm9tIDBcbiAgICAgKiBAcGFyYW0geyBudW1iZXIgfSAgICAgICAgICAgICAgICAgICAgbm90ZSwgaWYgZ2l2ZSAtMSwgbm90ZSB3aWxsIGJlIGFwcGVuZGVkIGF0IGxhc3Qgbm90ZS4gSW5kZXggc3RhcnQgZnJvbSAwXG4gICAgICovXG4gICAgaW5zdHJ1bWVudE5vdGVJbnB1dChjb3JyZWN0aW9uOiBDb3JyZWN0aW9uLCBkYXRhOiBub3RlLCBzZWN0aW9uOiBudW1iZXIgPSAtMSwgbm90ZTogbnVtYmVyID0gLTEpIHtcbiAgICAgICAgaWYoc2VjdGlvbiA9PSAtMSlzZWN0aW9uID0gdGhpcy5ub3Rlcy5sZW5ndGggLSAxO1xuICAgICAgICBpZihub3RlID09IC0xKW5vdGUgPSB0aGlzLm5vdGVzW3NlY3Rpb25dLmxlbmd0aCAtIDE7XG4gICAgICAgIGNvcnJlY3Rpb24odGhpcywgZGF0YSwgc2VjdGlvbiwgbm90ZSk7XG4gICAgICAgIHRoaXMucmVuZGVyKCk7XG4gICAgfVxuICAgIFxuICAgIGF0dGFjaChhbmNob3I6IEhUTUxFbGVtZW50KXtcbiAgICAgICAgYW5jaG9yLmFwcGVuZCh0aGlzLmRvbUVsZW1lbnQpO1xuICAgIH1cblxuICAgIG5vdGVJbmRleChub3RlOiBTVkdOb3RlKXtcbiAgICAgICAgcmV0dXJuIHRoaXMudGFiQ2FudmFzLmxheWVycy5ub3Rlcy5ub3RlRWxlbWVudHMuaW5kZXhPZihub3RlKTtcbiAgICB9XG4gICAgICAgIC8qKlxuICAgICAqIERyYWcgYW5kIGRyb2cgYXJlYSBzZWxlY3Qgbm90ZXNcbiAgICAgKiBCYWQgaW1wbGVtZW50IGJ5IG5vdywgdGhlIGZ1bmN0aW9uIHNlYXJjaCBlYWNoIG5vdGUgdG8gZmluZCBjb2xsaXNpb25cbiAgICAgKiBBbGdvcml0aG0gd2lsbCBiZSBmaXhlZCBpbiBmdXR1cmUuXG4gICAgICovXG4gICAgYXJlYVNlbGVjdCh4MTogbnVtYmVyLCB5MTogbnVtYmVyLCB4MjogbnVtYmVyLCB5MjogbnVtYmVyKXtcbiAgICAgICAgbGV0IG5vdGVFbGVtZW50cyA9IHRoaXMudGFiQ2FudmFzLmxheWVycy5ub3Rlcy5ub3RlRWxlbWVudHM7XG4gICAgICAgIHZhciBzZWxlY3RlZE5vdGVJZHM6IG51bWJlcltdID0gW107XG4gICAgICAgIGxldCBsZWZ0U2VsZWN0ZWROb3RlOiBudW1iZXI7XG4gICAgICAgIGxldCByaWdodFNlbGVjdGVkTm90ZTogbnVtYmVyO1xuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgbm90ZUVsZW1lbnRzLmxlbmd0aDsgaSsrKXtcbiAgICAgICAgICAgIGZvcihsZXQgaiA9IDA7IGogPCA2OyBqKyspe1xuICAgICAgICAgICAgICAgIC8vQ2hlY2sgaWYgbm90ZSBpcyBpbiB0aGUgc2VsZWN0ZWQgYXJlYVxuICAgICAgICAgICAgICAgIGlmKG5vdGVFbGVtZW50c1tpXS5ibG9ja0dyb3VwW2pdLnggPj0geDEgXG4gICAgICAgICAgICAgICAgICAgICYmIG5vdGVFbGVtZW50c1tpXS5ibG9ja0dyb3VwW2pdLnggPD0geDIgXG4gICAgICAgICAgICAgICAgICAgICYmIG5vdGVFbGVtZW50c1tpXS5ibG9ja0dyb3VwW2pdLnkgPj15MSBcbiAgICAgICAgICAgICAgICAgICAgJiYgbm90ZUVsZW1lbnRzW2ldLmJsb2NrR3JvdXBbal0ueSA8PXkyKXtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWROb3RlSWRzLnB1c2goaSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGxlZnRTZWxlY3RlZE5vdGUgPSBNYXRoLm1pbiguLi5zZWxlY3RlZE5vdGVJZHMpO1xuICAgICAgICByaWdodFNlbGVjdGVkTm90ZSA9IE1hdGgubWF4KC4uLnNlbGVjdGVkTm90ZUlkcyk7XG4gICAgICAgIHJldHVybiBub3RlRWxlbWVudHMuc2xpY2UobGVmdFNlbGVjdGVkTm90ZSwgcmlnaHRTZWxlY3RlZE5vdGUrMSk7XG4gICAgfVxuICAgIGVuZHNTZWxlY3QoaGVhZDogbnVtYmVyLCB0YWlsOiBudW1iZXIpOiBTVkdOb3RlW117XG4gICAgICAgIGlmKGhlYWQgPiB0YWlsKXtcbiAgICAgICAgICAgIGxldCB0ZW1wID0gdGFpbDtcbiAgICAgICAgICAgIHRhaWwgPSBoZWFkO1xuICAgICAgICAgICAgaGVhZCA9IHRlbXA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMudGFiQ2FudmFzLmxheWVycy5ub3Rlcy5ub3RlRWxlbWVudHMuc2xpY2UoaGVhZCwgdGFpbCsxKTtcbiAgICB9XG4gICAgaGVhZFRvRW5kU2VsZWN0KGhlYWQ6IG51bWJlcik6IFNWR05vdGVbXXtcbiAgICAgICAgcmV0dXJuIHRoaXMudGFiQ2FudmFzLmxheWVycy5ub3Rlcy5ub3RlRWxlbWVudHMuc2xpY2UoaGVhZCwgdGhpcy50YWJDYW52YXMubGF5ZXJzLm5vdGVzLm5vdGVFbGVtZW50cy5sZW5ndGgpO1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHRoaXMuc2V0QWxsTGluZSgpO1xuICAgICAgICBsZXQgW3Jhd0RhdGFMZW5ndGgsIGZpcnN0Q2hhbmdlLCBsaW5rZXJEYXRhLCBzZWN0aW9uUG9zaXRpb25dID0gdGhpcy5jYWxOb3RlUmF3RGF0YSgpO1xuICAgICAgICB0aGlzLnNldFNlY3Rpb25JbmRpY2F0b3Ioc2VjdGlvblBvc2l0aW9uKTtcbiAgICAgICAgdGhpcy5zZXRBbGxOb3RlRWxlbWVudERhdGEocmF3RGF0YUxlbmd0aCwgZmlyc3RDaGFuZ2UpO1xuICAgICAgICB0aGlzLnNldExpbmtlcihsaW5rZXJEYXRhKTtcbiAgICAgICAgbGV0IGxuID0gTWF0aC5jZWlsKHRoaXMubm90ZXMubGVuZ3RoIC8gdGhpcy5zZWN0aW9uUGVyTGluZSk7XG4gICAgICAgIGlmKHRoaXMuaGVpZ2h0ICE9ICh0aGlzLmxpbmVTdGFydFBvc2l0aW9uWzFdICsgKHRoaXMuc3RyaW5nUGFkZGluZyAqIDUgKyB0aGlzLmxpbmVEaXN0YW5jZSkgKiBsbiArIDcwKSl7XG4gICAgICAgICAgICB0aGlzLmhlaWdodCA9ICh0aGlzLmxpbmVTdGFydFBvc2l0aW9uWzFdICsgKHRoaXMuc3RyaW5nUGFkZGluZyAqIDUgKyB0aGlzLmxpbmVEaXN0YW5jZSkgKiBsbiArIDcwKTtcbiAgICAgICAgICAgIHV0aWxzLnNldEF0dHJpYnV0ZXModGhpcy50YWJDYW52YXMuZG9tRWxlbWVudCx7IGhlaWdodDogYCR7dGhpcy5oZWlnaHR9YH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgb248ayBleHRlbmRzIGtleW9mIGV2ZW50Q2FsbEJhY2tJbnRlcmZhY2U+KGVuYW1lOiBrLCBjYms6IGV2ZW50Q2FsbEJhY2tJbnRlcmZhY2Vba10pIHtcbiAgICAgICAgaWYoZW5hbWUgaW4gdGhpcy5jYWxsYmFja3MpIHtcbiAgICAgICAgICAgIHRoaXMuY2FsbGJhY2tzW2VuYW1lXS5wdXNoKGNiayk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzY3JvbGxUbyh2YWw6IG51bWJlcil7XG4gICAgICAgIHRoaXMuZG9tRWxlbWVudC5zY3JvbGxUb3AgPSB2YWw7XG4gICAgfVxuICAgIGdldFNlY3Rpb25MZWZ0VG9wUG9zKHNlY3Rpb246IG51bWJlcik6IFtudW1iZXIsIG51bWJlcl17XG4gICAgICAgIGlmKHNlY3Rpb24gPCB0aGlzLm5vdGVzLmxlbmd0aCl7XG4gICAgICAgICAgICByZXR1cm4gW3RoaXMudGFiQ2FudmFzLmxheWVycy51aS5zZWN0aW9uSW5kaWNhdG9yW3NlY3Rpb25dLngsIHRoaXMudGFiQ2FudmFzLmxheWVycy51aS5zZWN0aW9uSW5kaWNhdG9yW3NlY3Rpb25dLnldO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBbLTEsIC0xXVxuICAgIH1cbiAgICBnZXRTZWN0aW9uV2lkdGgoc2VjdGlvbjogbnVtYmVyKTogbnVtYmVye1xuICAgICAgICBpZihzZWN0aW9uIDwgdGhpcy5ub3Rlcy5sZW5ndGgpe1xuICAgICAgICAgICAgdGhpcy50YWJDYW52YXMubGF5ZXJzLnVpLnNlY3Rpb25JbmRpY2F0b3Jbc2VjdGlvbl0ud2lkdGg7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICAgIGdldFNlY3Rpb25IZWlnaHQoc2VjdGlvbjogbnVtYmVyKTogbnVtYmVye1xuICAgICAgICBpZihzZWN0aW9uIDwgdGhpcy5ub3Rlcy5sZW5ndGgpe1xuICAgICAgICAgICAgdGhpcy50YWJDYW52YXMubGF5ZXJzLnVpLnNlY3Rpb25JbmRpY2F0b3Jbc2VjdGlvbl0uaGVpZ2h0O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgICBwcml2YXRlIHNldEFsbExpbmUoKSB7XG4gICAgICAgIGxldCBsbiA9IE1hdGguY2VpbCh0aGlzLm5vdGVzLmxlbmd0aCAvIHRoaXMuc2VjdGlvblBlckxpbmUpOyAvLyBudW1iZXIgb2Ygcm93IHlvdSBuZWVkXG4gICAgICAgIGxldCBhbiA9IHRoaXMudGFiQ2FudmFzLmxheWVycy5zaGVldC5yb3cubGVuZ3RoOyAvLyBudW1iZXIgb2Ygcm93IHlvdSBoYXZlXG4gICAgICAgIGZvcihsZXQgaSA9IGFuOyBpIDwgbG4gOyBpKyspe1xuICAgICAgICAgICAgbGV0IHggPSB0aGlzLmxpbmVTdGFydFBvc2l0aW9uWzBdO1xuICAgICAgICAgICAgbGV0IHkgPSB0aGlzLmxpbmVTdGFydFBvc2l0aW9uWzFdICsgKHRoaXMuc3RyaW5nUGFkZGluZyAqIDUgKyB0aGlzLmxpbmVEaXN0YW5jZSkgKiBpO1xuICAgICAgICAgICAgdGhpcy50YWJDYW52YXMubGF5ZXJzLnNoZWV0LmNyZWF0ZVJvdyh4LCB5LCB0aGlzLmxpbmVXaWR0aCwgdGhpcy5saW5lUGFkZGluZywgdGhpcy5zdHJpbmdQYWRkaW5nLCB0aGlzLnNlY3Rpb25QZXJMaW5lKTtcbiAgICAgICAgfVxuICAgICAgICBmb3IobGV0IGkgPSBsbjsgaSA8IGFuOyBpKyspe1xuICAgICAgICAgICAgdXRpbHMuc2V0U3R5bGUodGhpcy50YWJDYW52YXMubGF5ZXJzLnNoZWV0LnJvd1tpXSwge2Rpc3BsYXk6IFwibm9uZVwifSk7XG4gICAgICAgIH1cbiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IGxuOyBpKyspe1xuICAgICAgICAgICAgdXRpbHMuc2V0U3R5bGUodGhpcy50YWJDYW52YXMubGF5ZXJzLnNoZWV0LnJvd1tpXSwge2Rpc3BsYXk6IFwidW5zZXRcIn0pXG4gICAgICAgIH1cbiAgICB9XG4gICAgcHJpdmF0ZSBzZXRTZWN0aW9uSW5kaWNhdG9yKHBvc2l0aW9uOiBbbnVtYmVyW10sIG51bWJlcltdXVtdKXtcbiAgICAgICAgaWYocG9zaXRpb24ubGVuZ3RoID4gdGhpcy50YWJDYW52YXMubGF5ZXJzLnVpLnNlY3Rpb25JbmRpY2F0b3IubGVuZ3RoKXtcbiAgICAgICAgICAgIGxldCBuc051bWJlciA9IHBvc2l0aW9uLmxlbmd0aCAtIHRoaXMudGFiQ2FudmFzLmxheWVycy51aS5zZWN0aW9uSW5kaWNhdG9yLmxlbmd0aDtcbiAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBuc051bWJlcjsgaSsrKXtcbiAgICAgICAgICAgICAgICB0aGlzLnRhYkNhbnZhcy5sYXllcnMudWkuY3JlYXRlU2VjdGlvbkluZGljYXRvcigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBwb3NpdGlvbi5sZW5ndGg7IGkrKyl7XG4gICAgICAgICAgICBsZXQgd2lkdGggPSBwb3NpdGlvbltpXVsxXVswXSAtIHBvc2l0aW9uW2ldWzBdWzBdO1xuICAgICAgICAgICAgbGV0IGhlaWdodCA9IHRoaXMuc3RyaW5nUGFkZGluZyAqIDU7XG4gICAgICAgICAgICB0aGlzLnRhYkNhbnZhcy5sYXllcnMudWkuc2VjdGlvbkluZGljYXRvcltpXS54ID0gcG9zaXRpb25baV1bMF1bMF1cbiAgICAgICAgICAgIHRoaXMudGFiQ2FudmFzLmxheWVycy51aS5zZWN0aW9uSW5kaWNhdG9yW2ldLnkgPSBwb3NpdGlvbltpXVswXVsxXVxuICAgICAgICAgICAgdGhpcy50YWJDYW52YXMubGF5ZXJzLnVpLnNlY3Rpb25JbmRpY2F0b3JbaV0ud2lkdGggPSB3aWR0aFxuICAgICAgICAgICAgdGhpcy50YWJDYW52YXMubGF5ZXJzLnVpLnNlY3Rpb25JbmRpY2F0b3JbaV0uaGVpZ2h0ID0gaGVpZ2h0XG4gICAgICAgICAgICAvL3V0aWxzLnNldEF0dHJpYnV0ZXModGhpcy50YWJDYW52YXMubGF5ZXJzLnVpLnNlY3Rpb25JbmRpY2F0b3JbaV0sIHt4OiBgJHtwb3NpdGlvbltpXVswXVswXX1gLCB5OiBgJHtwb3NpdGlvbltpXVswXVsxXX1gLCB3aWR0aDogYCR7d2lkdGh9YCwgaGVpZ2h0OiBgJHtoZWlnaHR9YH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjYWxOb3RlUmF3RGF0YSgpOltudW1iZXIsIG51bWJlciwgbnVtYmVyW11bXSwgW251bWJlcltdLCBudW1iZXJbXV1bXSBde1xuICAgICAgICBsZXQgW3gsIHldID0gdGhpcy5zdGFydFBvc2l0aW9uO1xuICAgICAgICBsZXQgc2VjdGlvbkxlbmd0aCA9IHRoaXMuYmVhdFBlclNlY3Rpb24gLyB0aGlzLmxlbmd0aFBlckJlYXQ7XG4gICAgICAgIGxldCBsaW5rZXIgPSBbXTtcbiAgICAgICAgbGV0IHNlY3Rpb25JbmRpY2F0b3I6IFtudW1iZXJbXSwgbnVtYmVyW11dW10gPSBbXTtcbiAgICAgICAgbGV0IHNlcGVyYXRlckxlbmd0aCA9IDEgLyA0O1xuICAgICAgICBsZXQgYWNjdW11bGF0ZWRMZW5ndGggPSAwO1xuICAgICAgICB0aGlzLnJhd0RhdGEuc3BsaWNlKDAsIDAsIHt4OiAwLCB5OiAwLCBsZW5ndGg6IDAsIGJsb2NrczogbnVsbCwgdGFpbDogbnVsbCwgc2VjdGlvbjogMCwgbm90ZTogMH0pOy8vIGdpdmUgYSBpbml0aWFsIGRhdGEsIHJlbW92ZSBpdCBhdCB0aGUgZW5kIG9mIGZ1bmN0aW9uXG4gICAgICAgIGxldCBjaSA9IDE7XG4gICAgICAgIGxldCBmaXJzdCA9IC0xO1xuXG4gICAgICAgIGZvcihsZXQgcyA9IDA7IHMgPCB0aGlzLm5vdGVzLmxlbmd0aDsgcysrKXsgLy8gc2VjdGlvblxuICAgICAgICAgICAgbGV0IGxpbmUgPSBNYXRoLmZsb29yKHMgLyB0aGlzLnNlY3Rpb25QZXJMaW5lKTtcbiAgICAgICAgICAgIGxldCBsaW5lVG90YWxOb3RlID0gMDtcbiAgICAgICAgICAgIGFjY3VtdWxhdGVkTGVuZ3RoID0gMDtcbiAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCB0aGlzLnNlY3Rpb25QZXJMaW5lOyBpKyspe1xuICAgICAgICAgICAgICAgIGlmKHRoaXMubm90ZXNbbGluZSAqIHRoaXMuc2VjdGlvblBlckxpbmUgKyBpXSl7XG4gICAgICAgICAgICAgICAgICAgIGxpbmVUb3RhbE5vdGUgKz0gdGhpcy5ub3Rlc1tsaW5lICogdGhpcy5zZWN0aW9uUGVyTGluZSArIGldLmxlbmd0aCArIHRoaXMuc2VjdGlvbkFkZE5vdGVOdW1iZXI7XG4gICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgICAgIGxpbmVUb3RhbE5vdGUgKz0gdGhpcy5zZWN0aW9uQWRkTm90ZU51bWJlcjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgc2VjdGlvbldpZHRoID0gdGhpcy5saW5lV2lkdGggKiAodGhpcy5ub3Rlc1tzXS5sZW5ndGggKyB0aGlzLnNlY3Rpb25BZGROb3RlTnVtYmVyKSAvIGxpbmVUb3RhbE5vdGU7XG4gICAgICAgICAgICBsZXQgc2VjdGlvblRvdGFsQmVhdCA9IDA7XG4gICAgICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgdGhpcy5ub3Rlc1tzXS5sZW5ndGg7IGkrKyl7XG4gICAgICAgICAgICAgICAgc2VjdGlvblRvdGFsQmVhdCArPSB0aGlzLmxlbmd0aFBlckJlYXQgL3RoaXMubm90ZXNbc11baV1bMF07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgYmVhdExlbmd0aCA9IChzZWN0aW9uV2lkdGggLSAyMCkgLyBzZWN0aW9uVG90YWxCZWF0O1xuXG4gICAgICAgICAgICBpZihzICUgdGhpcy5zZWN0aW9uUGVyTGluZSA9PSAwKXsgLy8gY2hhbmdlIGxpbmVcbiAgICAgICAgICAgICAgICB4ID0gdGhpcy5zdGFydFBvc2l0aW9uWzBdO1xuICAgICAgICAgICAgICAgIGlmKHMgIT0gMCl5ICs9IHRoaXMuc3RyaW5nUGFkZGluZyAqIDUgKyB0aGlzLmxpbmVEaXN0YW5jZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCBzeDogW251bWJlcltdLCBudW1iZXJbXV0gPSBbW3ggLSAyMCwgeV0sIFswLCB5XV07IC8vIHNlY3Rpb24gcG9zaXRpb25cbiAgICAgICAgICAgIGxldCBueCA9IHggKyBzZWN0aW9uV2lkdGg7XG4gICAgICAgICAgICBzeFsxXVswXSA9IG54IC0gMjA7XG4gICAgICAgICAgICB0aGlzLnRhYkNhbnZhcy5sYXllcnMuc2hlZXQuYmFyW3NdLngxID0gbnggLSAyMDtcbiAgICAgICAgICAgIHRoaXMudGFiQ2FudmFzLmxheWVycy5zaGVldC5iYXJbc10ueDIgPSBueCAtIDIwO1xuICAgICAgICAgICAgc2VjdGlvbkluZGljYXRvci5wdXNoKHN4KTtcbiAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCB0aGlzLm5vdGVzW3NdLmxlbmd0aDsgaSsrKXsgLy8gbm90ZVxuICAgICAgICAgICAgICAgIGxldCBub3RlID0gdGhpcy5ub3Rlc1tzXVtpXTtcbiAgICAgICAgICAgICAgICBsZXQgbm90ZUxlbmd0aCA9IHRoaXMubGVuZ3RoUGVyQmVhdCAvIG5vdGVbMF07XG4gICAgICAgICAgICAgICAgbGV0IHRhaWw6IG51bWJlcltdO1xuICAgICAgICAgICAgICAgIGlmKGFjY3VtdWxhdGVkTGVuZ3RoICsgbm90ZUxlbmd0aCAvIHRoaXMubGVuZ3RoUGVyQmVhdCA+PSBzZXBlcmF0ZXJMZW5ndGgpeyAvLyB0aGUgbm90ZSBpcyB0aGUgZW5kIG9mIGEgYmVhdCBvciB0aGUgbm90ZSdzIGxlbmd0aCBlcXVhbHMgdG8gYSBiZWF0XG4gICAgICAgICAgICAgICAgICAgIHRhaWwgPSB0aGlzLmNhbGN1bGF0ZVRhaWwodGhpcy5yYXdEYXRhW2NpIC0gMV0ubGVuZ3RoLCBub3RlWzBdLCAtMSwgYmVhdExlbmd0aCk7XG4gICAgICAgICAgICAgICAgICAgIGFjY3VtdWxhdGVkTGVuZ3RoID0gMDtcbiAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgdGFpbCA9IHRoaXMuY2FsY3VsYXRlVGFpbCh0aGlzLnJhd0RhdGFbY2kgLSAxXS5sZW5ndGgsIG5vdGVbMF0sIGFjY3VtdWxhdGVkTGVuZ3RoLCBiZWF0TGVuZ3RoKTtcbiAgICAgICAgICAgICAgICAgICAgYWNjdW11bGF0ZWRMZW5ndGggKz0gbm90ZUxlbmd0aCAvIHRoaXMubGVuZ3RoUGVyQmVhdDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbGV0IHN0ZXAgPSBiZWF0TGVuZ3RoICogdGhpcy5sZW5ndGhQZXJCZWF0IC8gbm90ZVswXTtcbiAgICAgICAgICAgICAgICBsZXQgdXBkYXRlTm90ZSA9IHRoaXMudXBkYXRlUmF3RGF0YShjaSwgeCwgeSwgbm90ZVswXSwgbm90ZVsxXSwgdGFpbCwgcywgaSk7XG4gICAgICAgICAgICAgICAgaWYodXBkYXRlTm90ZT49MCAmJiBmaXJzdCA8IDApZmlyc3QgPSB1cGRhdGVOb3RlIC0gMTsvLyBjaSBzdGFydCBmcm9tIDFcbiAgICAgICAgICAgICAgICBjaSsrO1xuICAgICAgICAgICAgICAgIGlmKG5vdGVbMl0gPT09IFwibGlua1N0YXJ0XCIgfHwgbm90ZVsyXSA9PT0gXCJsaW5rRW5kXCIpe1xuICAgICAgICAgICAgICAgICAgICBsaW5rZXIucHVzaChbeCx5XSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHggKz0gc3RlcDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHggPSBueDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnJhd0RhdGEuc2hpZnQoKTtcbiAgICAgICAgY2ktLTtcbiAgICAgICAgcmV0dXJuIFtjaSwgZmlyc3QsIGxpbmtlciwgc2VjdGlvbkluZGljYXRvcl07Ly8gY2kgPSB0b3RvYWwgc2VjdGlvbiBudW1iZXIsIGZpcnN0ID0gZnJpc3Qgbm90ZSB0aGF0IGRhdGEgaGFzIGNoYW5nZWRcbiAgICB9XG5cbiAgICBwcml2YXRlIHVwZGF0ZVJhd0RhdGEoYXJyeUluZGV4OiBudW1iZXIsIHg6IG51bWJlciwgeTogbnVtYmVyLCBub3RlTGVuZ3RoOiBudW1iZXIsIG5vdGVEYXRhOiBudW1iZXJbXSwgdGFpbDogbnVtYmVyW10sIHNlY3Rpb246IG51bWJlciwgbm90ZTogbnVtYmVyKTogbnVtYmVye1xuICAgICAgICBpZihhcnJ5SW5kZXggPiB0aGlzLnJhd0RhdGEubGVuZ3RoKXtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJhcnJheSBpbmRleCBlcnJvLCBzaG91bGQgbm90IGJlIGdyZWF0ZXIgdGhhbiByYXdEYXRhLmxlbmd0aFwiKTtcbiAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgfVxuICAgICAgICBpZihhcnJ5SW5kZXggPT09IHRoaXMucmF3RGF0YS5sZW5ndGgpe1xuICAgICAgICAgICAgdGhpcy5yYXdEYXRhLnB1c2goe3g6IHgsIHk6IHksIGxlbmd0aDogbm90ZUxlbmd0aCwgYmxvY2tzOiBub3RlRGF0YS5zbGljZSgwLCA2KSwgdGFpbDogdGFpbC5zbGljZSgwLCB0YWlsLmxlbmd0aCksIHNlY3Rpb246IHNlY3Rpb24sIG5vdGU6IG5vdGV9KTtcbiAgICAgICAgICAgIHJldHVybiBhcnJ5SW5kZXg7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGRhdGEgPSB0aGlzLnJhd0RhdGFbYXJyeUluZGV4XTtcbiAgICAgICAgaWYoZGF0YS54ICE9IHggfHwgZGF0YS55ICE9IHkgfHwgZGF0YS5sZW5ndGggIT0gbm90ZUxlbmd0aCB8fCBkYXRhLnNlY3Rpb24gIT0gc2VjdGlvbiB8fCBkYXRhLm5vdGUgIT0gbm90ZSB8fCAhdGhpcy5jb21wYXJlQXJyYXkoZGF0YS5ibG9ja3MsIG5vdGVEYXRhKSB8fCAhdGhpcy5jb21wYXJlQXJyYXkoZGF0YS50YWlsLCB0YWlsKSl7IFxuICAgICAgICAgICAgdGhpcy5yYXdEYXRhW2FycnlJbmRleF0ueCA9IHg7XG4gICAgICAgICAgICB0aGlzLnJhd0RhdGFbYXJyeUluZGV4XS55ID0geTtcbiAgICAgICAgICAgIHRoaXMucmF3RGF0YVthcnJ5SW5kZXhdLmxlbmd0aCA9IG5vdGVMZW5ndGg7XG4gICAgICAgICAgICB0aGlzLnJhd0RhdGFbYXJyeUluZGV4XS5ibG9ja3MgPSBub3RlRGF0YS5zbGljZSgwLCA2KTtcbiAgICAgICAgICAgIHRoaXMucmF3RGF0YVthcnJ5SW5kZXhdLnRhaWwgPSB0YWlsLnNsaWNlKDAsIHRhaWwubGVuZ3RoKTtcbiAgICAgICAgICAgIHRoaXMucmF3RGF0YVthcnJ5SW5kZXhdLnNlY3Rpb24gPSBzZWN0aW9uO1xuICAgICAgICAgICAgdGhpcy5yYXdEYXRhW2FycnlJbmRleF0ubm90ZSA9IG5vdGU7XG4gICAgICAgICAgICByZXR1cm4gYXJyeUluZGV4O1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gLTE7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjb21wYXJlQXJyYXkoYTogbnVtYmVyW10sIGI6IG51bWJlcltdKXtcbiAgICAgICAgaWYoYS5sZW5ndGggIT0gYi5sZW5ndGgpIHJldHVybiBmYWxzZTtcbiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IGEubGVuZ3RoOyBpKyspe1xuICAgICAgICAgICAgaWYoYVtpXSAhPSBiW2ldKSByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjYWxjdWxhdGVUYWlsKGxhc3ROb3RlTGVuZ3RoOiBudW1iZXIsIG5vdGVMZW5ndGg6IG51bWJlciwgYWNjdW11bGF0ZWRMZW5ndGg6IG51bWJlciwgYmVhdExlbmd0aDogbnVtYmVyKTogbnVtYmVyW117XG4gICAgICAgIGxldCBzdGVwID0gYmVhdExlbmd0aCAqIHRoaXMubGVuZ3RoUGVyQmVhdCAvIGxhc3ROb3RlTGVuZ3RoICogLTE7XG4gICAgICAgIGxldCBiYXNpY0xlbmd0aCA9IDg7XG4gICAgICAgIGlmKGFjY3VtdWxhdGVkTGVuZ3RoID09IC0xKWJhc2ljTGVuZ3RoID0gLTg7XG4gICAgICAgIGlmKGFjY3VtdWxhdGVkTGVuZ3RoID09IDApeyAvLyBzdGFydCBvZiBhIHNlcGVyYXRlIG5vdGVcbiAgICAgICAgICAgIGlmKG5vdGVMZW5ndGggPT0gOCl7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFtiYXNpY0xlbmd0aCwgMCwgMF07XG4gICAgICAgICAgICB9ZWxzZSBpZihub3RlTGVuZ3RoID09IDE2KXtcbiAgICAgICAgICAgICAgICByZXR1cm4gW2Jhc2ljTGVuZ3RoLCBiYXNpY0xlbmd0aCwgMF07XG4gICAgICAgICAgICB9ZWxzZSBpZihub3RlTGVuZ3RoID09IDMyKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gW2Jhc2ljTGVuZ3RoLCBiYXNpY0xlbmd0aCwgYmFzaWNMZW5ndGhdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIGlmKG5vdGVMZW5ndGggPT0gOCl7XG4gICAgICAgICAgICAgICAgaWYobGFzdE5vdGVMZW5ndGggPT0gOCB8fCBsYXN0Tm90ZUxlbmd0aCA9PSAxNiB8fCBsYXN0Tm90ZUxlbmd0aCA9PSAzMil7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbc3RlcCwgMCwgMF07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfWVsc2UgaWYobm90ZUxlbmd0aCA9PSAxNil7XG4gICAgICAgICAgICAgICAgaWYobGFzdE5vdGVMZW5ndGggPT0gOCApe1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gW3N0ZXAsIGJhc2ljTGVuZ3RoLCAwXTtcbiAgICAgICAgICAgICAgICB9ZWxzZSBpZihsYXN0Tm90ZUxlbmd0aCA9PSAxNiB8fCBsYXN0Tm90ZUxlbmd0aCA9PSAzMil7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbc3RlcCwgc3RlcCwgMF07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfWVsc2UgaWYobm90ZUxlbmd0aCA9PSAzMil7XG4gICAgICAgICAgICAgICAgaWYobGFzdE5vdGVMZW5ndGggPT0gOCl7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbc3RlcCwgYmFzaWNMZW5ndGgsIGJhc2ljTGVuZ3RoXTtcbiAgICAgICAgICAgICAgICB9ZWxzZSBpZihsYXN0Tm90ZUxlbmd0aCA9PSAxNil7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbc3RlcCwgc3RlcCwgYmFzaWNMZW5ndGhdO1xuICAgICAgICAgICAgICAgIH1lbHNlIGlmKGxhc3ROb3RlTGVuZ3RoID09IDMyKXtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFtzdGVwLCBzdGVwLCBzdGVwXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFswLCAwLCAwXTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogcmVjZWl2ZSBkYXRhIGZyb20gY2FsTm90ZVJhd0RhdGEgYW5kIHNldCBlbGVtZW50c1xuICAgICAqIEBwYXJhbSB7IFtudW1iZXIsIG51bWJlciwgbnVtYmVyLCBudW1iZXJbXV1bXSB9IGRhdGEgXG4gICAgICovXG4gICAgcHJpdmF0ZSBzZXRBbGxOb3RlRWxlbWVudERhdGEoZGF0YUxlbmd0aDogbnVtYmVyLCBmaXJzdENoYW5nZTogbnVtYmVyKXtcbiAgICAgICAgbGV0IGRhdGEgPSB0aGlzLnJhd0RhdGE7XG4gICAgICAgIGxldCBub3RlRWxlbWVudCA9IHRoaXMudGFiQ2FudmFzLmxheWVycy5ub3Rlcy5ub3RlRWxlbWVudHNcbiAgICAgICAgbGV0IG5lID0gZGF0YUxlbmd0aCAtIG5vdGVFbGVtZW50Lmxlbmd0aDtcbiAgICAgICAgbGV0IG51bGxEYXRhOiBjYWN1bGF0ZWROb3RlRGF0YSA9IHt4OiAwLCB5OiAwLCBsZW5ndGg6IDAsIGJsb2NrczogWy0xLCAtMSwgLTEsIC0xLCAtMSwgLTFdLCB0YWlsOiBbMCwgMCwgMF0sIHNlY3Rpb246IDAsIG5vdGU6IDB9Ly9bMCwgMCwgMCwgWy0xLCAtMSwgLTEsIC0xLCAtMSwgLTFdLCBbMCwgMCwgMF0sIDAsIDBdO1xuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgbmU7IGkrKyl7XG4gICAgICAgICAgICB0aGlzLnRhYkNhbnZhcy5sYXllcnMubm90ZXMuY3JlYXRlTm90ZSgpO1xuICAgICAgICAgICAgbm90ZUVsZW1lbnRbbm90ZUVsZW1lbnQubGVuZ3RoIC0gMV0uYmxvY2tHcm91cC5mb3JFYWNoKCh3ZywgaSkgPT4ge1xuICAgICAgICAgICAgICAgIHdnLmRvbWVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMub25Ob3RlQ2xpY2tlZC5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgICAgICB3Zy5kb21lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW92ZXJcIiwgdGhpcy5vbk1vdXNlT3Zlck5vdGUuYmluZCh0aGlzKSk7XG4gICAgICAgICAgICAgICAgd2cuZG9tZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2VvdXRcIiwgdGhpcy5vbk1vdXNlT3V0Tm90ZS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgICAgICB3Zy5zdHJpbmcgPSBpO1xuICAgICAgICAgICAgICAgIHV0aWxzLnNldEF0dHJpYnV0ZXMod2cuZG9tZWxlbWVudCwge1wiZGF0YS1zdHJpbmdcIjogYCR7aX1gfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZihmaXJzdENoYW5nZSA+IDApZmlyc3RDaGFuZ2UgLT0xO1xuICAgICAgICBpZihmaXJzdENoYW5nZSA+PSAwKXtcbiAgICAgICAgICAgIGZvcihsZXQgaSA9IGZpcnN0Q2hhbmdlOyBpIDwgZGF0YUxlbmd0aDsgaSsrKXtcbiAgICAgICAgICAgICAgICB1dGlscy5zZXRTdHlsZShub3RlRWxlbWVudFtpXS5kb21lbGVtZW50LHsgZGlzcGxheTogXCJ1bnNldFwifSk7XG4gICAgICAgICAgICAgICAgaWYoaSAhPSBkYXRhLmxlbmd0aCAtIDEpe1xuICAgICAgICAgICAgICAgICAgICBpZihkYXRhW2krMV0ueCA+IGRhdGFbaV0ueCl7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldE5vdGVFbGVtZW50RGF0YShub3RlRWxlbWVudFtpXSwgZGF0YVtpXSwgZGF0YVtpICsgMV0sIChkYXRhW2krMV0ueCAtIGRhdGFbaV0ueCkgKiAwLjcpO1xuICAgICAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0Tm90ZUVsZW1lbnREYXRhKG5vdGVFbGVtZW50W2ldLCBkYXRhW2ldLCBkYXRhW2kgKyAxXSwgMzApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0Tm90ZUVsZW1lbnREYXRhKG5vdGVFbGVtZW50W2ldLCBkYXRhW2ldLCBudWxsRGF0YSwgMzApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBmb3IobGV0IGkgPSBkYXRhTGVuZ3RoOyBpIDwgbm90ZUVsZW1lbnQubGVuZ3RoOyBpKyspe1xuICAgICAgICAgICAgdXRpbHMuc2V0U3R5bGUobm90ZUVsZW1lbnRbaV0uZG9tZWxlbWVudCx7IGRpc3BsYXk6IFwibm9uZVwifSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcHJpdmF0ZSBzZXROb3RlRWxlbWVudERhdGEoZWw6IFNWR05vdGUsIGRhdGE6IGNhY3VsYXRlZE5vdGVEYXRhLCBuZXhEYXRhOmNhY3VsYXRlZE5vdGVEYXRhICx4bGVuZ3RoOiBudW1iZXIpe1xuICAgICAgICB0aGlzLnNldEVsZW1lbnRQb3NpdGlvbihlbCwgZGF0YS54LCBkYXRhLnksIGRhdGEudGFpbCwgZGF0YS5zZWN0aW9uLCBkYXRhLm5vdGUsIHhsZW5ndGgpO1xuICAgICAgICB0aGlzLnNldENob3JkVmlzaWFibGUoZWwsIGRhdGEueCwgZGF0YS55LCBkYXRhLmxlbmd0aCwgZGF0YS5ibG9ja3MsIGRhdGEudGFpbCwgbmV4RGF0YS50YWlsKTtcbiAgICB9XG4gICAgXG4gICAgcHJpdmF0ZSBzZXRFbGVtZW50UG9zaXRpb24oZTogU1ZHTm90ZSwgeDpudW1iZXIsIHk6bnVtYmVyLCB0YWlsOiBudW1iZXJbXSwgc2VjdGlvbkluZGV4OiBudW1iZXIsIG5vdGVJbmRleDogbnVtYmVyLCB4bGVuZ3RoOiBudW1iZXIpe1xuICAgICAgICBsZXQgbG4gPSBNYXRoLmZsb29yKHNlY3Rpb25JbmRleCAvIHRoaXMuc2VjdGlvblBlckxpbmUpO1xuICAgICAgICAvLyBzZXQgbm90ZSBiYXIncyBwb3NpdGlvbiBhbmQgYmFyIHRhaWwncyBsZW5ndGhcbiAgICAgICAgZS5saW5lR3JvdXBbMF0ueDEgPSB4OyBlLmxpbmVHcm91cFswXS55MSA9IDI2ICsgeSArIHRoaXMuc3RyaW5nUGFkZGluZyAqIDU7IGUubGluZUdyb3VwWzBdLngyID0geDsgZS5saW5lR3JvdXBbMF0ueTIgPSB5O1xuICAgICAgICBlLmxpbmVHcm91cFsxXS54MSA9IHg7IGUubGluZUdyb3VwWzFdLnkxID0gMjUgKyB5ICsgdGhpcy5zdHJpbmdQYWRkaW5nICogNTsgZS5saW5lR3JvdXBbMV0ueDIgPSB4ICsgdGFpbFswXTsgZS5saW5lR3JvdXBbMV0ueTIgPSAyNSArIHkgKyB0aGlzLnN0cmluZ1BhZGRpbmcgKiA1O1xuICAgICAgICBlLmxpbmVHcm91cFsyXS54MSA9IHg7IGUubGluZUdyb3VwWzJdLnkxID0gMjEgKyB5ICsgdGhpcy5zdHJpbmdQYWRkaW5nICogNTsgZS5saW5lR3JvdXBbMl0ueDIgPSB4ICsgdGFpbFsxXTsgZS5saW5lR3JvdXBbMl0ueTIgPSAyMSArIHkgKyB0aGlzLnN0cmluZ1BhZGRpbmcgKiA1O1xuICAgICAgICBlLmxpbmVHcm91cFszXS54MSA9IHg7IGUubGluZUdyb3VwWzNdLnkxID0gMTcgKyB5ICsgdGhpcy5zdHJpbmdQYWRkaW5nICogNTsgZS5saW5lR3JvdXBbM10ueDIgPSB4ICsgdGFpbFsyXTsgZS5saW5lR3JvdXBbM10ueTIgPSAxNyArIHkgKyB0aGlzLnN0cmluZ1BhZGRpbmcgKiA1O1xuICAgICAgICAvLyBzZXQgbm90ZSB3b3JkIHBvc2l0aW9uXG4gICAgICAgIGZvcihsZXQgaSA9IDAgOyBpIDwgNjsgaSsrKXtcbiAgICAgICAgICAgIGUuYmxvY2tHcm91cFtpXS54ID0geDtcbiAgICAgICAgICAgIGUuYmxvY2tHcm91cFtpXS55ID0geSArIHRoaXMuc3RyaW5nUGFkZGluZyAqIGk7XG4gICAgICAgICAgICBlLmJsb2NrR3JvdXBbaV0uZXh0ZW5kUmVjdC55ID0gIHkgKyB0aGlzLnN0cmluZ1BhZGRpbmcgKiAoaSAtIDAuNSk7XG4gICAgICAgICAgICBlLmJsb2NrR3JvdXBbaV0uZXh0ZW5kUmVjdC5oZWlnaHQgPSB0aGlzLnN0cmluZ1BhZGRpbmc7XG4gICAgICAgICAgICBlLmJsb2NrR3JvdXBbaV0uZXh0ZW5kUmVjdC53aWR0aCA9IHhsZW5ndGg7XG4gICAgICAgICAgICB1dGlscy5zZXRBdHRyaWJ1dGVzKGUuYmxvY2tHcm91cFtpXS5kb21lbGVtZW50LHtcImRhdGEteFwiOiBgJHt4fWAsIFwiZGF0YS15XCI6IGAke3kgKyB0aGlzLnN0cmluZ1BhZGRpbmcgKiBpfWAsIFwiZGF0YS1saW5lXCI6IGAke2xufWB9KTtcbiAgICAgICAgfVxuICAgICAgICBlLnRhaWw4LnNldFBvc2l0aW9uKHgseSArIHRoaXMuc3RyaW5nUGFkZGluZyAqIDUgKyAxNSk7XG4gICAgICAgIGUudGFpbDE2LnNldFBvc2l0aW9uKHgseSArIHRoaXMuc3RyaW5nUGFkZGluZyAqIDUgKyAxMCk7XG4gICAgICAgIGUudGFpbDMyLnNldFBvc2l0aW9uKHgseSArIHRoaXMuc3RyaW5nUGFkZGluZyAqIDUgKyA1KTtcbiAgICAgICAgZS5zZWN0aW9uID0gc2VjdGlvbkluZGV4O1xuICAgICAgICBlLm5vdGUgPSBub3RlSW5kZXg7XG4gICAgICAgIGUubGluZSA9IGxuO1xuICAgICAgICB1dGlscy5zZXRBdHRyaWJ1dGVzKGUuZG9tZWxlbWVudCwge1wiZGF0YS1zZWN0aW9uXCI6IGAke3NlY3Rpb25JbmRleH1gLCBcImRhdGEtbm90ZVwiOiBgJHtub3RlSW5kZXh9YH0pO1xuICAgICAgICBlLmJsb2NrR3JvdXAuZm9yRWFjaCgod2csIGkpID0+IHtcbiAgICAgICAgICAgIHdnLnNlY3Rpb24gPSBzZWN0aW9uSW5kZXg7XG4gICAgICAgICAgICB3Zy5ub3RlID0gbm90ZUluZGV4O1xuICAgICAgICAgICAgd2cubGluZSA9IGxuO1xuICAgICAgICAgICAgdXRpbHMuc2V0QXR0cmlidXRlcyh3Zy5kb21lbGVtZW50LCB7XCJkYXRhLXNlY3Rpb25cIjogYCR7c2VjdGlvbkluZGV4fWAsIFwiZGF0YS1ub3RlXCI6IGAke25vdGVJbmRleH1gLCBcImRhdGEtbGluZVwiOiBgJHtsbn1gfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBwcml2YXRlIHNldENob3JkVmlzaWFibGUoZTpTVkdOb3RlLCB4OiBudW1iZXIsIHk6IG51bWJlciwgbm90ZUxlbmd0aDogbnVtYmVyLCBkYXRhOiBudW1iZXJbXSwgdGFpbDogbnVtYmVyW10sIG5leHRUYWlsOiBudW1iZXJbXSl7XG4gICAgICAgIGxldCBhcCA9IHRydWU7XG4gICAgICAgIGUudGFpbDguaGlkZSgpO1xuICAgICAgICBlLnRhaWwxNi5oaWRlKCk7XG4gICAgICAgIGUudGFpbDMyLmhpZGUoKTtcbiAgICAgICAgZm9yKGxldCBpID0gMCA7IGkgPCAzOyBpKyspe1xuICAgICAgICAgICAgaWYodGFpbFtpXSA8IDAgfHwgbmV4dFRhaWxbaV0gPCAwKXtcbiAgICAgICAgICAgICAgICBhcCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmKGFwKXtcbiAgICAgICAgICAgIGlmKG5vdGVMZW5ndGggPT0gOCl7XG4gICAgICAgICAgICAgICAgZS50YWlsOC5zaG93KCk7XG4gICAgICAgICAgICB9ZWxzZSBpZihub3RlTGVuZ3RoID09IDE2KXtcbiAgICAgICAgICAgICAgICBlLnRhaWwxNi5zaG93KCk7XG4gICAgICAgICAgICB9ZWxzZSBpZihub3RlTGVuZ3RoID09IDMyKXtcbiAgICAgICAgICAgICAgICBlLnRhaWwzMi5zaG93KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlLmxpbmVHcm91cFsxXS54MiA9IHg7XG4gICAgICAgICAgICBlLmxpbmVHcm91cFsyXS54MiA9IHg7XG4gICAgICAgICAgICBlLmxpbmVHcm91cFszXS54MiA9IHg7XG4gICAgICAgIH1cbiAgICAgICAgZm9yKGxldCBpID0gMCA7IGkgPCA2OyBpKyspe1xuICAgICAgICAgICAgZS5ibG9ja0dyb3VwW2ldLndvcmQudGV4dCA9IGAke2RhdGFbaV19YDtcbiAgICAgICAgICAgIGUuYmxvY2tHcm91cFtpXS53b3JkQmFjay50ZXh0ID0gYCR7ZGF0YVtpXX1gO1xuICAgICAgICAgICAgaWYoZGF0YVtpXSA9PSAtMSl7XG4gICAgICAgICAgICAgICAgdXRpbHMuc2V0U3R5bGUoZS5ibG9ja0dyb3VwW2ldLmRvbWVsZW1lbnQsIHtkaXNwbGF5OiBcIm5vbmVcIn0pO1xuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgdXRpbHMuc2V0U3R5bGUoZS5ibG9ja0dyb3VwW2ldLmRvbWVsZW1lbnQsIHtkaXNwbGF5OiBcImJsb2NrXCJ9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZihub3RlTGVuZ3RoID09IDIpe1xuICAgICAgICAgICAgZS5saW5lR3JvdXBbMF0ueTIgPSAxMCArIHkgKyB0aGlzLnN0cmluZ1BhZGRpbmcgKiA1O1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9ZWxzZSBpZihub3RlTGVuZ3RoID09IDEpe1xuICAgICAgICAgICAgZS5saW5lR3JvdXBbMF0ueTIgPSAyNiArIHkgKyB0aGlzLnN0cmluZ1BhZGRpbmcgKiA1O1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGxldCBoYzogbnVtYmVyID0gNi41O1xuICAgICAgICAvLyBub3RlIGJhciBzaG91bGQgcmVhY2ggdGhlIHRvcCB3b3JkXG4gICAgICAgIGZvcihsZXQgaSA9IDEgOyBpIDw9IDY7IGkrKyl7XG4gICAgICAgICAgICBpZihkYXRhW2ktMV0gIT0gLTEpe1xuICAgICAgICAgICAgICAgIGhjID0gaTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH0gICAgXG4gICAgICAgIH1cbiAgICAgICAgZS5saW5lR3JvdXBbMF0ueTIgPSB5ICsgdGhpcy5zdHJpbmdQYWRkaW5nICogKGhjIC0gMSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzZXRMaW5rZXIobGlua2VyRGF0YTogbnVtYmVyW11bXSl7XG4gICAgICAgIGxldCBsZW51bWJlciA9IE1hdGguZmxvb3IobGlua2VyRGF0YS5sZW5ndGggLyAyKTtcbiAgICAgICAgbGV0IGV4aXN0TnVtYmVyID0gdGhpcy50YWJDYW52YXMubGF5ZXJzLmJhY2tncm91bmQubGlua2VyLmxlbmd0aDtcbiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IGxlbnVtYmVyIC0gZXhpc3ROdW1iZXI7IGkrKyl7XG4gICAgICAgICAgICB0aGlzLnRhYkNhbnZhcy5sYXllcnMuYmFja2dyb3VuZC5jcmVhdGVMaW5rZXIoKTtcbiAgICAgICAgfVxuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgbGVudW1iZXI7IGkrKyl7XG4gICAgICAgICAgICB1dGlscy5zZXRTdHlsZSg8SFRNTEVsZW1lbnQ+PHVua25vd24+dGhpcy50YWJDYW52YXMubGF5ZXJzLmJhY2tncm91bmQubGlua2VyW2ldLCB7ZGlzcGxheTogXCJ1bnNldFwifSk7XG4gICAgICAgICAgICB0aGlzLnNldExpbmtlckRhdGEodGhpcy50YWJDYW52YXMubGF5ZXJzLmJhY2tncm91bmQubGlua2VyW2ldLCBsaW5rZXJEYXRhW2kqMl0sIGxpbmtlckRhdGFbaSoyKzFdKTtcbiAgICAgICAgfVxuICAgICAgICBmb3IobGV0IGkgPSBsZW51bWJlcjsgaSA8IHRoaXMudGFiQ2FudmFzLmxheWVycy5iYWNrZ3JvdW5kLmxpbmtlci5sZW5ndGg7IGkrKyl7XG4gICAgICAgICAgICB1dGlscy5zZXRTdHlsZSg8SFRNTEVsZW1lbnQ+PHVua25vd24+dGhpcy50YWJDYW52YXMubGF5ZXJzLmJhY2tncm91bmQubGlua2VyW2ldLCB7ZGlzcGxheTogXCJub25lXCJ9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBwcml2YXRlIHNldExpbmtlckRhdGEobGlua0VsZW1lbnQ6U1ZHRWxlbWVudCwgc3RhcnQ6IG51bWJlcltdLCBlbmQ6IG51bWJlcltdKXtcbiAgICAgICAgbGV0IGx5ID0gc3RhcnRbMV0gKyAzMSArIHRoaXMuc3RyaW5nUGFkZGluZyAqIDU7XG4gICAgICAgIGlmKHN0YXJ0WzFdICE9PSBlbmRbMV0pe1xuICAgICAgICAgICAgbGV0IGV4ID0gc3RhcnRbMF0gKyAzMDtcbiAgICAgICAgICAgIGxldCBzeCA9IHN0YXJ0WzBdO1xuICAgICAgICAgICAgbGV0IHBhdGggPSBgTSAke3N4fSAke2x5fSBDICR7c3grNH0gJHtseSsxNX0sICR7ZXgtNH0gJHtseSsxNX0sICR7ZXh9ICR7bHl9IEMgJHtleC00fSAke2x5KzEyfSwgJHtzeCs0fSAke2x5KzEyfSwgJHtzeH0gJHtseX0gYDtcbiAgICAgICAgICAgIGx5ID0gZW5kWzFdICsgMzEgKyB0aGlzLnN0cmluZ1BhZGRpbmcgKiA1O1xuICAgICAgICAgICAgc3ggPSBlbmRbMF0gLSAzMDtcbiAgICAgICAgICAgIGV4ID0gZW5kWzBdO1xuICAgICAgICAgICAgcGF0aCArPSBgTSAke3N4fSAke2x5fSBDICR7c3grNH0gJHtseSsxNX0sICR7ZXgtNH0gJHtseSsxNX0sICR7ZXh9ICR7bHl9IEMgJHtleC00fSAke2x5KzEyfSwgJHtzeCs0fSAke2x5KzEyfSwgJHtzeH0gJHtseX1gO1xuICAgICAgICAgICAgdXRpbHMuc2V0QXR0cmlidXRlcyhsaW5rRWxlbWVudCwge2Q6IHBhdGh9KTtcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICB1dGlscy5zZXRBdHRyaWJ1dGVzKGxpbmtFbGVtZW50LCB7ZDogYE0gJHtzdGFydFswXX0gJHtseX0gQyAke3N0YXJ0WzBdKzR9ICR7bHkrMTV9LCAke2VuZFswXS00fSAke2x5KzE1fSwgJHtlbmRbMF19ICR7bHl9IEMgJHtlbmRbMF0tNH0gJHtseSsxMn0sICR7c3RhcnRbMF0rNH0gJHtseSsxMn0sICR7c3RhcnRbMF19ICR7bHl9YH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvbk5vdGVDbGlja2VkKGV2OiBNb3VzZUV2ZW50KSB7XG4gICAgICAgIGxldCBzZWN0aW9uID0gTnVtYmVyKChldi5jdXJyZW50VGFyZ2V0IGFzIFNWR0dFbGVtZW50KS5kYXRhc2V0LnNlY3Rpb24pO1xuICAgICAgICBsZXQgbm90ZSA9IE51bWJlcigoZXYuY3VycmVudFRhcmdldCBhcyBTVkdHRWxlbWVudCkuZGF0YXNldC5ub3RlKTtcbiAgICAgICAgbGV0IHN0cmluZyA9IE51bWJlcigoZXYuY3VycmVudFRhcmdldCBhcyBTVkdFbGVtZW50KS5kYXRhc2V0LnN0cmluZyk7XG4gICAgICAgIGxldCBwb3NpdGlvbiA9IFtOdW1iZXIoKGV2LmN1cnJlbnRUYXJnZXQgYXMgU1ZHRWxlbWVudCkuZGF0YXNldC54KSwgTnVtYmVyKChldi5jdXJyZW50VGFyZ2V0IGFzIFNWR0VsZW1lbnQpLmRhdGFzZXQueSldXG4gICAgICAgIGlmKGV2LnNoaWZ0S2V5KXtcbiAgICAgICAgICAgIHRoaXMuY2FsbGJhY2tzW1wibm90ZXNoaWZ0Y2xpY2tcIl0uY2FsbEFsbChzZWN0aW9uLCBub3RlLCBzdHJpbmcsIHBvc2l0aW9uLCBldi5jdXJyZW50VGFyZ2V0KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmKGV2LmFsdEtleSl7XG4gICAgICAgICAgICB0aGlzLmNhbGxiYWNrc1tcIm5vdGVhbHRjbGlja1wiXS5jYWxsQWxsKHNlY3Rpb24sIG5vdGUsIHN0cmluZywgcG9zaXRpb24sIGV2LmN1cnJlbnRUYXJnZXQpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYoZXYuY3RybEtleSl7XG4gICAgICAgICAgICB0aGlzLmNhbGxiYWNrc1tcIm5vdGVjdHJsY2xpY2tcIl0uY2FsbEFsbChzZWN0aW9uLCBub3RlLCBzdHJpbmcsIHBvc2l0aW9uLCBldi5jdXJyZW50VGFyZ2V0KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNle1xuICAgICAgICAgICAgdGhpcy5jYWxsYmFja3NbXCJub3RlY2xpY2tcIl0uY2FsbEFsbChzZWN0aW9uLCBub3RlLCBzdHJpbmcsIHBvc2l0aW9uLCBldi5jdXJyZW50VGFyZ2V0KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBwcml2YXRlIG9uS2V5ZG93bihldjogS2V5Ym9hcmRFdmVudCl7XG4gICAgICAgIHRoaXMuY2FsbGJhY2tzW1wia2V5ZG93blwiXS5jYWxsQWxsKGV2LmtleSk7XG4gICAgfVxuICAgIHByaXZhdGUgb25Nb3VzZU92ZXJOb3RlKGV2OiBNb3VzZUV2ZW50KXtcbiAgICAgICAgbGV0IHNlY3Rpb24gPSBOdW1iZXIoKGV2LmN1cnJlbnRUYXJnZXQgYXMgU1ZHR0VsZW1lbnQpLmRhdGFzZXQuc2VjdGlvbik7XG4gICAgICAgIGxldCBub3RlID0gTnVtYmVyKChldi5jdXJyZW50VGFyZ2V0IGFzIFNWR0dFbGVtZW50KS5kYXRhc2V0Lm5vdGUpO1xuICAgICAgICBsZXQgc3RyaW5nID0gTnVtYmVyKChldi5jdXJyZW50VGFyZ2V0IGFzIFNWR0VsZW1lbnQpLmRhdGFzZXQuc3RyaW5nKTtcbiAgICAgICAgbGV0IHBvc2l0aW9uID0gW051bWJlcigoZXYuY3VycmVudFRhcmdldCBhcyBTVkdFbGVtZW50KS5kYXRhc2V0LngpLCBOdW1iZXIoKGV2LmN1cnJlbnRUYXJnZXQgYXMgU1ZHRWxlbWVudCkuZGF0YXNldC55KV1cbiAgICAgICAgdGhpcy5jYWxsYmFja3NbXCJtb3VzZW92ZXJub3RlXCJdLmNhbGxBbGwoc2VjdGlvbiwgbm90ZSwgc3RyaW5nLCBwb3NpdGlvbiwgZXYuY3VycmVudFRhcmdldCk7XG4gICAgfVxuICAgIHByaXZhdGUgb25Nb3VzZU91dE5vdGUoZXY6IE1vdXNlRXZlbnQpe1xuICAgICAgICBsZXQgc2VjdGlvbiA9IE51bWJlcigoZXYuY3VycmVudFRhcmdldCBhcyBTVkdHRWxlbWVudCkuZGF0YXNldC5zZWN0aW9uKTtcbiAgICAgICAgbGV0IG5vdGUgPSBOdW1iZXIoKGV2LmN1cnJlbnRUYXJnZXQgYXMgU1ZHR0VsZW1lbnQpLmRhdGFzZXQubm90ZSk7XG4gICAgICAgIGxldCBzdHJpbmcgPSBOdW1iZXIoKGV2LmN1cnJlbnRUYXJnZXQgYXMgU1ZHRWxlbWVudCkuZGF0YXNldC5zdHJpbmcpO1xuICAgICAgICBsZXQgcG9zaXRpb24gPSBbTnVtYmVyKChldi5jdXJyZW50VGFyZ2V0IGFzIFNWR0VsZW1lbnQpLmRhdGFzZXQueCksIE51bWJlcigoZXYuY3VycmVudFRhcmdldCBhcyBTVkdFbGVtZW50KS5kYXRhc2V0LnkpXVxuICAgICAgICB0aGlzLmNhbGxiYWNrc1tcIm1vdXNlb3V0bm90ZVwiXS5jYWxsQWxsKHNlY3Rpb24sIG5vdGUsIHN0cmluZywgcG9zaXRpb24sIGV2LmN1cnJlbnRUYXJnZXQpO1xuICAgIH1cbiAgICBwcml2YXRlIG9uTW91c2VEb3duKGV2OiBNb3VzZUV2ZW50KXtcbiAgICAgICAgdGhpcy5jYWxsYmFja3NbXCJtb3VzZWRvd25cIl0uY2FsbEFsbChOdW1iZXIoZXYueCksIE51bWJlcihldi55KSk7XG4gICAgfVxuICAgIHByaXZhdGUgb25Nb3VzZU1vdmUoZXY6IE1vdXNlRXZlbnQpe1xuICAgICAgICB0aGlzLmNhbGxiYWNrc1tcIm1vdXNlbW92ZVwiXS5jYWxsQWxsKE51bWJlcihldi54KSwgTnVtYmVyKGV2LnkpKTtcbiAgICB9XG4gICAgcHJpdmF0ZSBvbk1vdXNlVXAoZXY6IE1vdXNlRXZlbnQpe1xuICAgICAgICB0aGlzLmNhbGxiYWNrc1tcIm1vdXNldXBcIl0uY2FsbEFsbChOdW1iZXIoZXYueCksIE51bWJlcihldi55KSk7XG4gICAgfVxuICAgIHByaXZhdGUgb25Nb3VzZVJpZ2h0Q2xpY2soZXY6IE1vdXNlRXZlbnQpe1xuICAgICAgICB0aGlzLmNhbGxiYWNrc1tcInJpZ2h0Y2xpY2tcIl0uY2FsbEFsbChOdW1iZXIoZXYueCksIE51bWJlcihldi55KSk7XG4gICAgfVxufSJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBdUJBO0FBMkJBO0FBdkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFVQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQUtBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/SlimTabV2.ts\n");

/***/ }),

/***/ "./src/SlimTabV2Canvas.ts":
/*!********************************!*\
  !*** ./src/SlimTabV2Canvas.ts ***!
  \********************************/
/*! exports provided: NoteBlock, SVGNote, Layer, Rect, Ellipse, Line, Text, Layers, SLLayer, SLCanvas */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"NoteBlock\", function() { return NoteBlock; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"SVGNote\", function() { return SVGNote; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Layer\", function() { return Layer; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Rect\", function() { return Rect; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Ellipse\", function() { return Ellipse; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Line\", function() { return Line; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Text\", function() { return Text; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Layers\", function() { return Layers; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"SLLayer\", function() { return SLLayer; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"SLCanvas\", function() { return SLCanvas; });\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./utils */ \"./src/utils.ts\");\n\r\nclass NoteBlock {\r\n    constructor(domelement, word, wordBack, extendRect) {\r\n        this.domelement = domelement;\r\n        this.word = word;\r\n        this.wordBack = wordBack;\r\n        this.extendRect = extendRect;\r\n    }\r\n    set x(val) {\r\n        if (this._x !== val) {\r\n            this._x = val;\r\n            this.word.x = val;\r\n            this.wordBack.x = val;\r\n            this.extendRect.x = val;\r\n        }\r\n    }\r\n    get x() {\r\n        return this._x;\r\n    }\r\n    set y(val) {\r\n        if (this._y !== val) {\r\n            this._y = val;\r\n            this.word.y = val + 4;\r\n            this.wordBack.y = val + 4;\r\n        }\r\n    }\r\n    get y() {\r\n        return this._y;\r\n    }\r\n    set section(val) {\r\n        this._section = val;\r\n    }\r\n    get section() {\r\n        return this._section;\r\n    }\r\n    set note(val) {\r\n        this._note = val;\r\n    }\r\n    get note() {\r\n        return this._note;\r\n    }\r\n    set string(val) {\r\n        this._string = val;\r\n    }\r\n    get string() {\r\n        return this._string;\r\n    }\r\n    set line(val) {\r\n        this._line = val;\r\n    }\r\n    get line() {\r\n        return this._line;\r\n    }\r\n}\r\nclass SVGNote {\r\n    constructor(domelement, blockGroup, lineGroup) {\r\n        this.blockGroup = [];\r\n        this.lineGroup = [];\r\n        this.domelement = domelement;\r\n        this.blockGroup = blockGroup;\r\n        this.lineGroup = lineGroup;\r\n        this.tail8 = new Base8Tail();\r\n        this.tail16 = new Base16Tail();\r\n        this.tail32 = new Base32Tail();\r\n        this.domelement.append(this.tail32.domElement, this.tail16.domElement, this.tail8.domElement);\r\n    }\r\n    set section(val) {\r\n        this._section = val;\r\n    }\r\n    get section() {\r\n        return this._section;\r\n    }\r\n    set note(val) {\r\n        this._note = val;\r\n    }\r\n    get note() {\r\n        return this._note;\r\n    }\r\n    set line(val) {\r\n        this._line = val;\r\n    }\r\n    get line() {\r\n        return this._line;\r\n    }\r\n}\r\nclass Tail {\r\n    constructor() {\r\n        this._isShow = true;\r\n        this.domElement = document.createElementNS('http://www.w3.org/2000/svg', \"g\");\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, { style: \"fill: white;\" });\r\n        //this.hide();\r\n    }\r\n    setPosition(x, y) {\r\n        if (this._x !== x || this._y !== y) {\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setStyle(this.domElement, { \"transform\": `scale(0.08) translate(${x / 0.08}px,${y / 0.08}px)` });\r\n            this._x = x;\r\n            this._y = y;\r\n        }\r\n    }\r\n    show() {\r\n        if (!this._isShow) {\r\n            this._isShow = true;\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setStyle(this.domElement, { display: \"unset\" });\r\n        }\r\n    }\r\n    hide() {\r\n        if (this._isShow) {\r\n            this._isShow = false;\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setStyle(this.domElement, { display: \"none\" });\r\n        }\r\n    }\r\n}\r\nclass Base8Tail extends Tail {\r\n    constructor() {\r\n        super();\r\n        this.domElement.innerHTML = `<use xlink:href=\"#stail8\"></use>`;\r\n    }\r\n}\r\nclass Base16Tail extends Tail {\r\n    constructor() {\r\n        super();\r\n        this.domElement.innerHTML = `<use xlink:href=\"#stail16\"></use>`;\r\n    }\r\n}\r\nclass Base32Tail extends Tail {\r\n    constructor() {\r\n        super();\r\n        this.domElement.innerHTML = `<use xlink:href=\"#stail32\"></use>`;\r\n    }\r\n}\r\nclass Layer {\r\n    constructor() {\r\n        this.linker = [];\r\n        this.domElement = document.createElementNS('http://www.w3.org/2000/svg', \"g\");\r\n    }\r\n    clear() {\r\n        this.domElement.innerHTML = \"\";\r\n    }\r\n    createRect(x, y, width, height, strokeWidth, fill, target) {\r\n        const inst = document.createElementNS('http://www.w3.org/2000/svg', \"rect\");\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(inst, {\r\n            x: `${x}`, y: `${y}`,\r\n            width: `${width}`, height: `${height}`,\r\n            \"stroke-width\": `${strokeWidth}`,\r\n            fill: fill,\r\n        });\r\n        if (!target)\r\n            this.domElement.appendChild(inst);\r\n        else\r\n            target.appendChild(inst);\r\n        return new Rect(inst);\r\n    }\r\n    createEllipse(cx, cy, rx, ry, target) {\r\n        const inst = document.createElementNS('http://www.w3.org/2000/svg', \"ellipse\");\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(inst, {\r\n            cx: `${cx}`, cy: `${cy}`,\r\n            rx: `${rx}`, ry: `${ry}`\r\n        });\r\n        if (!target)\r\n            this.domElement.appendChild(inst);\r\n        else\r\n            target.appendChild(inst);\r\n        return new Ellipse(inst);\r\n    }\r\n    createText(x, y, str, anchor, target) {\r\n        const inst = document.createElementNS('http://www.w3.org/2000/svg', \"text\");\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(inst, {\r\n            x: `${x}`, y: `${y}`,\r\n            'text-anchor': `${anchor}`\r\n        });\r\n        inst.innerHTML = `${str}`;\r\n        if (!target)\r\n            this.domElement.appendChild(inst);\r\n        else\r\n            target.appendChild(inst);\r\n        return new Text(inst);\r\n    }\r\n    createLine(x1, y1, x2, y2, width, color, target) {\r\n        const inst = document.createElementNS('http://www.w3.org/2000/svg', \"line\");\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(inst, {\r\n            x1: `${x1}`, y1: `${y1}`,\r\n            x2: `${x2}`, y2: `${y2}`,\r\n            stroke: `${color}`,\r\n            \"stroke-width\": `${width}`\r\n        });\r\n        if (!target)\r\n            this.domElement.appendChild(inst);\r\n        else\r\n            target.appendChild(inst);\r\n        return new Line(inst);\r\n    }\r\n    ;\r\n    createLinker(target) {\r\n        let linker = document.createElementNS('http://www.w3.org/2000/svg', \"path\");\r\n        if (!target)\r\n            this.domElement.appendChild(linker);\r\n        else\r\n            target.appendChild(linker);\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(linker, { fill: `white` });\r\n        this.linker.push(linker);\r\n        return linker;\r\n    }\r\n}\r\nclass SVGShape {\r\n    constructor(domElement) {\r\n        this._domElement = domElement;\r\n    }\r\n    remove() {\r\n        this._domElement.remove();\r\n    }\r\n    get domElement() {\r\n        return this._domElement;\r\n    }\r\n    set style(val) {\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setStyle(this.domElement, val);\r\n    }\r\n}\r\n;\r\nclass Rect extends SVGShape {\r\n    constructor(domElement) {\r\n        super(domElement);\r\n    }\r\n    setPos(x, y) {\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n            \"x\": `${x}`, \"y\": `${y}`\r\n        });\r\n    }\r\n    setShape(width, height) {\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n            \"width\": `${width}`, \"height\": `${height}`\r\n        });\r\n    }\r\n    set x(val) {\r\n        if (this._x !== val) {\r\n            this._x = val;\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n                x: `${val}`\r\n            });\r\n        }\r\n    }\r\n    get x() {\r\n        return this._x;\r\n    }\r\n    set y(val) {\r\n        if (this._y !== val) {\r\n            this._y = val;\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n                y: `${val}`\r\n            });\r\n        }\r\n    }\r\n    get y() {\r\n        return this._y;\r\n    }\r\n    set width(val) {\r\n        if (this._width !== val) {\r\n            this._width = val;\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n                width: `${val}`\r\n            });\r\n        }\r\n    }\r\n    get width() {\r\n        return this._width;\r\n    }\r\n    set height(val) {\r\n        if (this._height !== val) {\r\n            this._height = val;\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n                height: `${val}`\r\n            });\r\n        }\r\n    }\r\n    get height() {\r\n        return this._height;\r\n    }\r\n    set strokeWidth(val) {\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n            \"stroke-width\": `${val}`\r\n        });\r\n    }\r\n    get strokeWidth() {\r\n        return Number(this.domElement.getAttribute(\"stroke-width\"));\r\n    }\r\n    set fill(val) {\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n            fill: `${val}`\r\n        });\r\n    }\r\n    get fill() {\r\n        return this.domElement.getAttribute(\"fill\");\r\n    }\r\n}\r\nclass Ellipse extends SVGShape {\r\n    constructor(domElement) {\r\n        super(domElement);\r\n    }\r\n    setPos(cx, cy) {\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n            \"cx\": `${cx}`, \"cy\": `${cy}`\r\n        });\r\n    }\r\n    setShape(cx, cy, rx, ry) {\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n            \"rx\": `${rx}`, \"ry\": `${ry}`\r\n        });\r\n    }\r\n    set cx(val) {\r\n        if (this._cx != val) {\r\n            this._cx = val;\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n                cx: `${val}`\r\n            });\r\n        }\r\n    }\r\n    get cx() {\r\n        return this._cx;\r\n    }\r\n    set cy(val) {\r\n        if (this._cy != val) {\r\n            this._cy = val;\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n                cy: `${val}`\r\n            });\r\n        }\r\n    }\r\n    get cy() {\r\n        return this._cy;\r\n    }\r\n    set rx(val) {\r\n        if (this._rx != val) {\r\n            this._rx = val;\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n                rx: `${val}`\r\n            });\r\n        }\r\n    }\r\n    get rx() {\r\n        return this._rx;\r\n    }\r\n    set ry(val) {\r\n        if (this._ry != val) {\r\n            this._ry = val;\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n                ry: `${val}`\r\n            });\r\n        }\r\n    }\r\n    get ry() {\r\n        return this._ry;\r\n    }\r\n    set fill(val) {\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n            fill: `${val}`\r\n        });\r\n    }\r\n    get fill() {\r\n        return this.domElement.getAttribute(\"fill\");\r\n    }\r\n}\r\nclass Line extends SVGShape {\r\n    constructor(domElement) {\r\n        super(domElement);\r\n    }\r\n    setEndPoints(x1, y1, x2, y2) {\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n            \"x1\": `${x1}`, \"y1\": `${y1}`,\r\n            \"x2\": `${x2}`, \"y2\": `${y2}`\r\n        });\r\n    }\r\n    set x1(val) {\r\n        if (this._x1 != val) {\r\n            this._x1 = val;\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n                x1: `${val}`\r\n            });\r\n        }\r\n    }\r\n    get x1() {\r\n        return Number(this.domElement.getAttribute(\"x1\"));\r\n    }\r\n    set y1(val) {\r\n        if (this._y1 != val) {\r\n            this._y1 = val;\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n                y1: `${val}`\r\n            });\r\n        }\r\n    }\r\n    get y1() {\r\n        return Number(this.domElement.getAttribute(\"y1\"));\r\n    }\r\n    set x2(val) {\r\n        if (this._x2 != val) {\r\n            this._x2 = val;\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n                x2: `${val}`\r\n            });\r\n        }\r\n    }\r\n    get x2() {\r\n        return Number(this.domElement.getAttribute(\"x2\"));\r\n    }\r\n    set y2(val) {\r\n        if (this._y2 != val) {\r\n            this._y2 = val;\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n                y2: `${val}`\r\n            });\r\n        }\r\n    }\r\n    get y2() {\r\n        return Number(this.domElement.getAttribute(\"y2\"));\r\n    }\r\n    set stroke(val) {\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n            stroke: `${val}`\r\n        });\r\n    }\r\n    get stroke() {\r\n        return this.domElement.getAttribute(\"stroke\");\r\n    }\r\n    set strokeWidth(val) {\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n            \"stroke-width\": `${val}`\r\n        });\r\n    }\r\n    get strokeWidth() {\r\n        return Number(this.domElement.getAttribute(\"stroke-width\"));\r\n    }\r\n}\r\nclass Text extends SVGShape {\r\n    constructor(domElement) {\r\n        super(domElement);\r\n    }\r\n    setPos(x, y) {\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n            \"x\": `${x}`, \"y\": `${y}`,\r\n        });\r\n    }\r\n    set x(val) {\r\n        if (this._x != val) {\r\n            this._x = val;\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n                x: `${val}`\r\n            });\r\n        }\r\n    }\r\n    get x() {\r\n        return Number(this.domElement.getAttribute(\"x\"));\r\n    }\r\n    set y(val) {\r\n        if (this._y != val) {\r\n            this._y = val;\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n                y: `${val}`\r\n            });\r\n        }\r\n    }\r\n    get y() {\r\n        return Number(this.domElement.getAttribute(\"y\"));\r\n    }\r\n    set anchor(val) {\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n            \"text-anchor\": `${val}`\r\n        });\r\n    }\r\n    get anchor() {\r\n        return this.domElement.getAttribute(\"text-anchor\");\r\n    }\r\n    set text(val) {\r\n        if (this.domElement.innerHTML !== val) {\r\n            this.domElement.innerHTML = `${val}`;\r\n        }\r\n    }\r\n    get text() {\r\n        return this.domElement.innerHTML;\r\n    }\r\n    set strokeWidth(val) {\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, {\r\n            \"stroke-width\": `${val}`\r\n        });\r\n    }\r\n    get strokeWidth() {\r\n        return Number(this.domElement.getAttribute(\"stroke-width\"));\r\n    }\r\n}\r\nclass NoteLayer extends Layer {\r\n    constructor() {\r\n        super();\r\n        this.noteElements = [];\r\n        this.domElement.innerHTML = `\n        <defs>\n            <path id=\"SVGTAIL8_1\" d=\"M-4.728,151.313l10.303,2.061l39.153-33.854c0,0,20.543-24.318,23.338-67.708L70.34,0H43.846L22.061,78.012\n                l-33.854,20.901L-4.728,151.313z\"/>\n        \t<clipPath id=\"SVGTAIL8_2\">\n                <use xlink:href=\"#SVGTAIL8_1\"  style=\"overflow:visible;\"/>\n            </clipPath>\n\n            <path id=\"stail16\"d=\"M67.37,59.776c2.698-19.84-2.806-39.01-7.124-58.173C60.138,1.127,59.523,0.765,58.825,0c0,3.411-0.317,6.266,0.054,9.029\n            c1.69,12.576,0.707,25.062-2.478,37.175c-5.494,20.897-15.163,39.32-35.394,49.69c-6.397,3.279-13.599,4.99-20.612,7.443\n            l-0.168,42.842c0.429-1.459,1.031-2.899,1.881-4.318c5.712-9.535,13.379-17.275,23.422-21.731\n            c11.728-5.203,21.372-12.634,29.432-22.407c0.486-0.59,1.154-1.029,2.017-1.782c-6.693,34.412-26.894,55.961-56.794,60.555\n            L0,203.874c1.634-4.092,2.518-8.621,4.922-12.148c5.906-8.664,14.092-14.797,23.71-19.308c16.597-7.786,30.016-19.532,35.085-37.498\n            c3.198-11.333,4.22-23.682,3.872-35.506C67.2,86.185,65.551,73.148,67.37,59.776z\"/>\n        \n            <path id=\"stail8\" style=\"clip-path:url(#SVGTAIL8_2);\" d=\"M67.352,64.184c2.698-19.84-2.806-39.01-7.124-58.173\n            c-0.107-0.476-0.722-0.837-1.42-1.603c0,3.411-0.317,6.266,0.054,9.029c1.69,12.576,0.707,25.062-2.478,37.175\n            c-5.494,20.897-15.163,39.32-35.394,49.69c-6.397,3.279-13.599,4.99-20.612,7.443l-0.168,42.842\n            c0.429-1.459,1.031-2.899,1.881-4.318c5.712-9.535,13.379-17.275,23.422-21.731c11.728-5.203,21.372-12.634,29.432-22.407\n            c0.486-0.59,1.154-1.029,2.017-1.782c-6.693,34.412-26.894,55.961-56.794,60.555l-0.186,47.379\n            c1.634-4.092,2.518-8.621,4.922-12.148c5.906-8.664,14.092-14.797,23.71-19.308c16.597-7.786,30.016-19.532,35.085-37.498\n            c3.198-11.333,4.22-23.682,3.872-35.506C67.182,90.594,65.534,77.557,67.352,64.184z\"/>\n\n            <path id=\"SVGID_1_\" d=\"M-4.17,255.543l10.303,2.061l39.153-33.854c0,0,20.543-24.318,23.338-67.708l2.274-51.812H44.404\n                l-21.784,78.012l-33.854,20.901L-4.17,255.543z\"/>\n            <clipPath id=\"SVGID_2_\">\n                <use xlink:href=\"#SVGID_1_\"  style=\"overflow:visible;\"/>\n            </clipPath>\n            <g id=\"stail32\">\n            <path d=\"M67.183,59.776c2.698-19.84-2.806-39.01-7.124-58.173C59.952,1.127,59.337,0.765,58.639,0c0,3.411-0.317,6.266,0.054,9.029\n\t\tc1.69,12.576,0.707,25.062-2.478,37.175c-5.494,20.897-15.163,39.32-35.394,49.69c-6.397,3.279-13.599,4.99-20.612,7.443\n\t\tl-0.168,42.842c0.429-1.459,1.031-2.899,1.881-4.318c5.712-9.535,13.379-17.275,23.422-21.731\n\t\tc11.728-5.203,21.372-12.634,29.432-22.407c0.486-0.59,1.154-1.029,2.017-1.782C50.101,130.352,29.9,151.901,0,156.495\n\t\tl-0.186,47.379c1.634-4.092,2.518-8.621,4.922-12.148c5.906-8.664,14.092-14.797,23.71-19.308\n\t\tc16.597-7.786,30.016-19.532,35.085-37.498c3.198-11.333,4.22-23.682,3.872-35.506C67.013,86.185,65.365,73.148,67.183,59.776z\"/>\n            <path style=\"clip-path:url(#SVGID_2_);\" d=\"M67.91,168.414c2.698-19.84-2.806-39.01-7.124-58.173\n\t\t\tc-0.107-0.476-0.722-0.837-1.42-1.603c0,3.411-0.317,6.266,0.054,9.029c1.69,12.576,0.707,25.062-2.478,37.175\n\t\t\tc-5.494,20.897-15.163,39.32-35.394,49.69c-6.397,3.279-13.599,4.99-20.612,7.443l-0.168,42.842\n\t\t\tc0.429-1.459,1.031-2.899,1.881-4.318c5.712-9.535,13.379-17.275,23.422-21.731c11.728-5.203,21.372-12.634,29.432-22.407\n\t\t\tc0.486-0.59,1.154-1.029,2.017-1.782c-6.693,34.412-26.894,55.96-56.794,60.555L0.54,312.512\n\t\t\tc1.634-4.092,2.518-8.621,4.922-12.148c5.906-8.664,14.092-14.797,23.71-19.308c16.597-7.786,30.016-19.532,35.085-37.498\n            c3.198-11.333,4.22-23.682,3.872-35.506C67.74,194.823,66.092,181.786,67.91,168.414z\"/>\n            </g>\n        </defs>\n        `;\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, { \"data-layer\": \"NoteLayer\" });\r\n    }\r\n    createNote() {\r\n        const note = document.createElementNS('http://www.w3.org/2000/svg', \"g\");\r\n        const blockGroup = document.createElementNS('http://www.w3.org/2000/svg', \"g\");\r\n        const blockArray = [];\r\n        const lineGroup = document.createElementNS('http://www.w3.org/2000/svg', \"g\");\r\n        const lg = [];\r\n        lg.push(this.createLine(0, 0, 0, 0, 1, \"white\", lineGroup));\r\n        for (let i = 0; i < 3; i++) {\r\n            lg.push(this.createLine(0, 0, 0, 0, 2, \"white\", lineGroup));\r\n        }\r\n        note.append(lineGroup);\r\n        for (let i = 0; i < 6; i++) {\r\n            const wordGroup = document.createElementNS('http://www.w3.org/2000/svg', \"g\");\r\n            const extendRect = this.createRect(0, 0, 0, 0, 0, \"rgba(0, 0, 0, 0)\", wordGroup);\r\n            const wordBack = this.createText(0, 0, \"\", \"middle\", wordGroup);\r\n            const word = this.createText(0, 0, \"\", \"middle\", wordGroup);\r\n            _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(wordGroup, { \"stroke-width\": '0', \"stroke\": \"black\", style: \"cursor:pointer;\" });\r\n            wordBack.strokeWidth = 3;\r\n            wordBack.style = { font: \"12px Sans-serf\" };\r\n            word.style = { \"font\": \"12px Sans-serif\", \"fill\": \"#fff\" };\r\n            blockGroup.append(wordGroup);\r\n            blockArray.push(new NoteBlock(wordGroup, word, wordBack, extendRect));\r\n        }\r\n        note.append(blockGroup);\r\n        this.noteElements.push(new SVGNote(note, blockArray, lg));\r\n        this.domElement.append(note);\r\n        return note;\r\n    }\r\n}\r\nclass SheetLayer extends Layer {\r\n    constructor() {\r\n        super();\r\n        this.row = [];\r\n        this.bar = [];\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, { \"data-layer\": \"SheetLayer\" });\r\n    }\r\n    createRow(x, y, lineWidth, linePadding, stringPadding, sectionPerLine) {\r\n        let ng = document.createElementNS('http://www.w3.org/2000/svg', \"g\");\r\n        let lineBack = document.createElementNS('http://www.w3.org/2000/svg', \"rect\");\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(lineBack, { x: `${x}`, y: `${y}`, style: \"fill: rgba(255, 255, 255, 0.09)\", width: `${linePadding[0] * 2 + lineWidth}`, height: `${linePadding[1] * 2 + stringPadding * 5}` });\r\n        ng.appendChild(lineBack);\r\n        x += linePadding[0];\r\n        y += linePadding[1];\r\n        for (let i = 0; i < 6; i++) {\r\n            let l = lineWidth;\r\n            this.createLine(x, y + i * stringPadding, x + l, y + i * stringPadding, 2, \"rgba(255, 255, 255, 0.24)\", ng);\r\n        }\r\n        this.drawRowTitle(x - 30, y, ng);\r\n        this.createLine(x, y, x, y + stringPadding * 5, 2, \"rgba(255, 255, 255, 0.24)\", this.domElement);\r\n        for (let i = 0; i < sectionPerLine; i++) {\r\n            let nb = this.createLine(0, y, 0, y + stringPadding * 5, 2, \"rgba(255, 255, 255, 0.24)\", this.domElement);\r\n            this.bar.push(nb);\r\n        }\r\n        this.domElement.append(ng);\r\n        this.row.push(ng);\r\n        return ng;\r\n    }\r\n    drawRowTitle(x, y, target) {\r\n        let title = document.createElementNS('http://www.w3.org/2000/svg', \"g\");\r\n        title.innerHTML = `\n        <text style=\"fill:#959595;font:17px arial;\">\n            <tspan x='${x + 10}' y='${y + 26}'>T</tspan>\n            <tspan x='${x + 10}' y='${y + 22 + 26}'>A</tspan>\n            <tspan x='${x + 10}' y='${y + 44 + 26}'>B</tspan>\n        </text>\n        `;\r\n        if (target)\r\n            target.append(title);\r\n        return title;\r\n    }\r\n}\r\nclass UILayer extends Layer {\r\n    constructor() {\r\n        super();\r\n        this.sectionIndicator = [];\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setAttributes(this.domElement, { \"data-layer\": \"UILayer\" });\r\n    }\r\n    createSectionIndicator() {\r\n        let newSquare = this.createRect(0, 0, 0, 0, 0, \"rgba(0, 255, 255, 0.13)\");\r\n        newSquare.style = { display: \"none\" };\r\n        //utils.setAttributes(newSquare, {style: \"display: none\"});\r\n        this.sectionIndicator.push(newSquare);\r\n        return newSquare;\r\n    }\r\n}\r\nclass Layers {\r\n    constructor() {\r\n        this.background = new Layer();\r\n        this.sheet = new SheetLayer();\r\n        this.notes = new NoteLayer();\r\n        this.foreground = new Layer();\r\n    }\r\n    get flattened() {\r\n        return [this.background, this.sheet, this.notes, this.foreground];\r\n    }\r\n}\r\nclass SLLayer extends Layers {\r\n    constructor() {\r\n        super();\r\n        this.ui = new UILayer();\r\n    }\r\n    get flattened() {\r\n        return [this.background, this.ui, this.sheet, this.notes, this.foreground];\r\n    }\r\n}\r\nclass SLCanvas {\r\n    constructor(layerType) {\r\n        this.layerType = layerType;\r\n        this.layers = new layerType();\r\n        this.domElement = document.createElementNS('http://www.w3.org/2000/svg', \"svg\");\r\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"utils\"].setStyle(this.domElement, { \"user-select\": \"none\", \"outline\": \"none\" });\r\n        this.layers.flattened.forEach(layer => this.domElement.appendChild(layer.domElement));\r\n    }\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvU2xpbVRhYlYyQ2FudmFzLnRzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vc3JjL1NsaW1UYWJWMkNhbnZhcy50cz8zYWM5Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7dXRpbHN9IGZyb20gJy4vdXRpbHMnO1xuXG5pbnRlcmZhY2UgU1ZHUHJpbWl0aXZlUmVuZGVyZXIge1xuICAgIGNsZWFyKCk6IHZvaWQ7XG4gICAgY3JlYXRlUmVjdCh4OiBudW1iZXIsIHk6IG51bWJlciwgd2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIsIHN0cm9rZVdpZHRoOiBudW1iZXIsIGNvbG9yOiBzdHJpbmcpOiBSZWN0O1xuICAgIGNyZWF0ZUVsbGlwc2UoY3g6IG51bWJlciwgY3k6IG51bWJlciwgcng6IG51bWJlciwgcnk6IG51bWJlcik6IEVsbGlwc2U7XG4gICAgY3JlYXRlVGV4dCh4OiBudW1iZXIsIHk6IG51bWJlciwgc3RyOiBzdHJpbmcsIGFuY2hvcjogc3RyaW5nKTogVGV4dDtcbiAgICBjcmVhdGVMaW5lKHgxOiBudW1iZXIsIHkxOiBudW1iZXIsIHgyOiBudW1iZXIsIHkyOiBudW1iZXIsIHdpZHRoOiBudW1iZXIsIGNvbG9yPzogc3RyaW5nKTogTGluZTtcbn1cbmV4cG9ydCBjbGFzcyBOb3RlQmxvY2t7XG4gICAgcmVhZG9ubHkgZG9tZWxlbWVudDogSFRNTEVsZW1lbnQ7XG4gICAgcmVhZG9ubHkgd29yZDogVGV4dDtcbiAgICByZWFkb25seSB3b3JkQmFjazogVGV4dDtcbiAgICByZWFkb25seSBleHRlbmRSZWN0OiBSZWN0O1xuICAgIHByaXZhdGUgX3g6IG51bWJlcjtcbiAgICBwcml2YXRlIF95OiBudW1iZXI7XG4gICAgcHJpdmF0ZSBfc2VjdGlvbjogbnVtYmVyO1xuICAgIHByaXZhdGUgX25vdGU6IG51bWJlcjtcbiAgICBwcml2YXRlIF9zdHJpbmc6IG51bWJlcjtcbiAgICBwcml2YXRlIF9saW5lOiBudW1iZXI7XG5cbiAgICBjb25zdHJ1Y3Rvcihkb21lbGVtZW50OiBIVE1MRWxlbWVudCwgd29yZDogVGV4dCwgd29yZEJhY2s6IFRleHQsIGV4dGVuZFJlY3Q6IFJlY3Qpe1xuICAgICAgICB0aGlzLmRvbWVsZW1lbnQgPSBkb21lbGVtZW50O1xuICAgICAgICB0aGlzLndvcmQgPSB3b3JkO1xuICAgICAgICB0aGlzLndvcmRCYWNrID0gd29yZEJhY2s7XG4gICAgICAgIHRoaXMuZXh0ZW5kUmVjdCA9IGV4dGVuZFJlY3Q7XG4gICAgfVxuICAgIHNldCB4KHZhbDogbnVtYmVyKXtcbiAgICAgICAgaWYodGhpcy5feCAhPT0gdmFsKXtcbiAgICAgICAgICAgIHRoaXMuX3ggPSB2YWw7XG4gICAgICAgICAgICB0aGlzLndvcmQueCA9IHZhbDtcbiAgICAgICAgICAgIHRoaXMud29yZEJhY2sueCA9IHZhbDtcbiAgICAgICAgICAgIHRoaXMuZXh0ZW5kUmVjdC54ID0gdmFsO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCB4KCl7XG4gICAgICAgIHJldHVybiB0aGlzLl94O1xuICAgIH1cbiAgICBzZXQgeSh2YWw6IG51bWJlcil7XG4gICAgICAgIGlmKHRoaXMuX3kgIT09IHZhbCl7XG4gICAgICAgICAgICB0aGlzLl95ID0gdmFsO1xuICAgICAgICAgICAgdGhpcy53b3JkLnkgPSB2YWwgKyA0O1xuICAgICAgICAgICAgdGhpcy53b3JkQmFjay55ID0gdmFsICsgNDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgeSgpe1xuICAgICAgICByZXR1cm4gdGhpcy5feTtcbiAgICB9XG4gICAgc2V0IHNlY3Rpb24odmFsOiBudW1iZXIpe1xuICAgICAgICB0aGlzLl9zZWN0aW9uID0gdmFsO1xuICAgIH1cbiAgICBnZXQgc2VjdGlvbigpOiBudW1iZXJ7XG4gICAgICAgIHJldHVybiB0aGlzLl9zZWN0aW9uO1xuICAgIH1cbiAgICBzZXQgbm90ZSh2YWw6IG51bWJlcil7XG4gICAgICAgIHRoaXMuX25vdGUgPSB2YWw7XG4gICAgfVxuICAgIGdldCBub3RlKCk6IG51bWJlcntcbiAgICAgICAgcmV0dXJuIHRoaXMuX25vdGU7XG4gICAgfVxuICAgIHNldCBzdHJpbmcodmFsOiBudW1iZXIpe1xuICAgICAgICB0aGlzLl9zdHJpbmcgPSB2YWw7XG4gICAgfVxuICAgIGdldCBzdHJpbmcoKTogbnVtYmVye1xuICAgICAgICByZXR1cm4gdGhpcy5fc3RyaW5nO1xuICAgIH1cbiAgICBzZXQgbGluZSh2YWw6IG51bWJlcil7XG4gICAgICAgIHRoaXMuX2xpbmUgPSB2YWw7XG4gICAgfVxuICAgIGdldCBsaW5lKCk6IG51bWJlcntcbiAgICAgICAgcmV0dXJuIHRoaXMuX2xpbmU7XG4gICAgfVxufVxuZXhwb3J0IGNsYXNzIFNWR05vdGV7XG4gICAgcmVhZG9ubHkgZG9tZWxlbWVudDogSFRNTEVsZW1lbnQ7XG4gICAgcmVhZG9ubHkgYmxvY2tHcm91cDogTm90ZUJsb2NrW10gPSBbXTtcbiAgICByZWFkb25seSBsaW5lR3JvdXA6IExpbmVbXSA9IFtdO1xuICAgIHJlYWRvbmx5IHRhaWw4OiBCYXNlOFRhaWw7XG4gICAgcmVhZG9ubHkgdGFpbDE2OiBCYXNlMTZUYWlsO1xuICAgIHJlYWRvbmx5IHRhaWwzMjogQmFzZTMyVGFpbDtcbiAgICBwcml2YXRlIF9zZWN0aW9uOiBudW1iZXI7XG4gICAgcHJpdmF0ZSBfbm90ZTogbnVtYmVyO1xuICAgIHByaXZhdGUgX2xpbmU6IG51bWJlcjtcbiAgICBjb25zdHJ1Y3Rvcihkb21lbGVtZW50OiBIVE1MRWxlbWVudCwgYmxvY2tHcm91cDogTm90ZUJsb2NrW10sIGxpbmVHcm91cDogTGluZVtdKXtcbiAgICAgICAgdGhpcy5kb21lbGVtZW50ID0gZG9tZWxlbWVudDtcbiAgICAgICAgdGhpcy5ibG9ja0dyb3VwID0gYmxvY2tHcm91cDtcbiAgICAgICAgdGhpcy5saW5lR3JvdXAgPSBsaW5lR3JvdXA7XG4gICAgICAgIHRoaXMudGFpbDggPSBuZXcgQmFzZThUYWlsKCk7XG4gICAgICAgIHRoaXMudGFpbDE2ID0gbmV3IEJhc2UxNlRhaWwoKTtcbiAgICAgICAgdGhpcy50YWlsMzIgPSBuZXcgQmFzZTMyVGFpbCgpO1xuICAgICAgICB0aGlzLmRvbWVsZW1lbnQuYXBwZW5kKHRoaXMudGFpbDMyLmRvbUVsZW1lbnQsIHRoaXMudGFpbDE2LmRvbUVsZW1lbnQsIHRoaXMudGFpbDguZG9tRWxlbWVudCk7XG4gICAgfVxuICAgIHNldCBzZWN0aW9uKHZhbDogbnVtYmVyKXtcbiAgICAgICAgdGhpcy5fc2VjdGlvbiA9IHZhbDtcbiAgICB9XG4gICAgZ2V0IHNlY3Rpb24oKTogbnVtYmVye1xuICAgICAgICByZXR1cm4gdGhpcy5fc2VjdGlvbjtcbiAgICB9XG4gICAgc2V0IG5vdGUodmFsOiBudW1iZXIpe1xuICAgICAgICB0aGlzLl9ub3RlID0gdmFsO1xuICAgIH1cbiAgICBnZXQgbm90ZSgpOiBudW1iZXJ7XG4gICAgICAgIHJldHVybiB0aGlzLl9ub3RlO1xuICAgIH1cbiAgICBzZXQgbGluZSh2YWw6IG51bWJlcil7XG4gICAgICAgIHRoaXMuX2xpbmUgPSB2YWw7XG4gICAgfVxuICAgIGdldCBsaW5lKCk6IG51bWJlcntcbiAgICAgICAgcmV0dXJuIHRoaXMuX2xpbmU7XG4gICAgfVxufVxuY2xhc3MgVGFpbHtcbiAgICByZWFkb25seSBkb21FbGVtZW50OiBTVkdFbGVtZW50O1xuICAgIHByaXZhdGUgX3g6IG51bWJlcjtcbiAgICBwcml2YXRlIF95OiBudW1iZXI7XG4gICAgcHJpdmF0ZSBfaXNTaG93OiBib29sZWFuID0gdHJ1ZTtcbiAgICBjb25zdHJ1Y3Rvcigpe1xuICAgICAgICB0aGlzLmRvbUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyxcImdcIik7XG4gICAgICAgIHV0aWxzLnNldEF0dHJpYnV0ZXModGhpcy5kb21FbGVtZW50LCB7c3R5bGU6IFwiZmlsbDogd2hpdGU7XCJ9KTtcbiAgICAgICAgLy90aGlzLmhpZGUoKTtcbiAgICB9XG4gICAgc2V0UG9zaXRpb24oeDogbnVtYmVyLCB5OiBudW1iZXIpe1xuICAgICAgICBpZih0aGlzLl94ICE9PSB4IHx8IHRoaXMuX3kgIT09IHkpe1xuICAgICAgICAgICAgdXRpbHMuc2V0U3R5bGUoPEhUTUxFbGVtZW50Pjx1bmtub3duPnRoaXMuZG9tRWxlbWVudCx7XCJ0cmFuc2Zvcm1cIjogYHNjYWxlKDAuMDgpIHRyYW5zbGF0ZSgke3ggLyAwLjA4fXB4LCR7eSAvIDAuMDh9cHgpYH0pO1xuICAgICAgICAgICAgdGhpcy5feCA9IHg7XG4gICAgICAgICAgICB0aGlzLl95ID0geTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBzaG93KCl7XG4gICAgICAgIGlmKCF0aGlzLl9pc1Nob3cpe1xuICAgICAgICAgICAgdGhpcy5faXNTaG93ID0gdHJ1ZTtcbiAgICAgICAgICAgIHV0aWxzLnNldFN0eWxlKDxIVE1MRWxlbWVudD48dW5rbm93bj50aGlzLmRvbUVsZW1lbnQse2Rpc3BsYXk6IFwidW5zZXRcIn0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGhpZGUoKXtcbiAgICAgICAgaWYodGhpcy5faXNTaG93KXtcbiAgICAgICAgICAgIHRoaXMuX2lzU2hvdyA9IGZhbHNlO1xuICAgICAgICAgICAgdXRpbHMuc2V0U3R5bGUoPEhUTUxFbGVtZW50Pjx1bmtub3duPnRoaXMuZG9tRWxlbWVudCx7ZGlzcGxheTogXCJub25lXCJ9KTtcbiAgICAgICAgfVxuICAgIH1cbn1cbmNsYXNzIEJhc2U4VGFpbCBleHRlbmRzIFRhaWx7XG4gICAgY29uc3RydWN0b3IoKXtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5kb21FbGVtZW50LmlubmVySFRNTCA9IGA8dXNlIHhsaW5rOmhyZWY9XCIjc3RhaWw4XCI+PC91c2U+YDtcbiAgICB9XG59XG5cbmNsYXNzIEJhc2UxNlRhaWwgZXh0ZW5kcyBUYWlse1xuICAgIGNvbnN0cnVjdG9yKCl7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMuZG9tRWxlbWVudC5pbm5lckhUTUwgPSBgPHVzZSB4bGluazpocmVmPVwiI3N0YWlsMTZcIj48L3VzZT5gXG4gICAgfVxufVxuXG5jbGFzcyBCYXNlMzJUYWlsIGV4dGVuZHMgVGFpbHtcbiAgICBjb25zdHJ1Y3Rvcigpe1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLmRvbUVsZW1lbnQuaW5uZXJIVE1MID0gYDx1c2UgeGxpbms6aHJlZj1cIiNzdGFpbDMyXCI+PC91c2U+YDtcbiAgICB9XG59XG5leHBvcnQgY2xhc3MgTGF5ZXIgaW1wbGVtZW50cyBTVkdQcmltaXRpdmVSZW5kZXJlciB7XG4gICAgcmVhZG9ubHkgZG9tRWxlbWVudDogU1ZHRWxlbWVudDtcbiAgICByZWFkb25seSBsaW5rZXI6IFNWR0VsZW1lbnRbXSA9IFtdO1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLmRvbUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyxcImdcIik7XG4gICAgfVxuXG4gICAgY2xlYXIoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuZG9tRWxlbWVudC5pbm5lckhUTUwgPSBcIlwiO1xuICAgIH1cblxuICAgIGNyZWF0ZVJlY3QoeDogbnVtYmVyLCB5OiBudW1iZXIsIHdpZHRoOiBudW1iZXIsIGhlaWdodDogbnVtYmVyLCBzdHJva2VXaWR0aDogbnVtYmVyLCBmaWxsOiBzdHJpbmcsIHRhcmdldD86IFNWR0VsZW1lbnQpOiBSZWN0IHtcbiAgICAgICAgY29uc3QgaW5zdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLFwicmVjdFwiKTtcbiAgICAgICAgdXRpbHMuc2V0QXR0cmlidXRlcyhpbnN0LCB7XG4gICAgICAgICAgICB4OiBgJHt4fWAsIHk6YCR7eX1gLFxuICAgICAgICAgICAgd2lkdGg6YCR7d2lkdGh9YCwgaGVpZ2h0OiBgJHtoZWlnaHR9YCxcbiAgICAgICAgICAgIFwic3Ryb2tlLXdpZHRoXCI6IGAke3N0cm9rZVdpZHRofWAsXG4gICAgICAgICAgICBmaWxsOiBmaWxsLFxuICAgICAgICB9KTtcbiAgICAgICAgaWYoIXRhcmdldClcbiAgICAgICAgICAgIHRoaXMuZG9tRWxlbWVudC5hcHBlbmRDaGlsZChpbnN0KTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGFyZ2V0LmFwcGVuZENoaWxkKGluc3QpO1xuICAgICAgICByZXR1cm4gbmV3IFJlY3QoaW5zdCk7XG4gICAgfVxuXG4gICAgY3JlYXRlRWxsaXBzZShjeDogbnVtYmVyLCBjeTogbnVtYmVyLCByeDogbnVtYmVyLCByeTogbnVtYmVyLCB0YXJnZXQ/OiBTVkdFbGVtZW50KTogRWxsaXBzZSB7XG4gICAgICAgIGNvbnN0IGluc3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyxcImVsbGlwc2VcIik7XG4gICAgICAgIHV0aWxzLnNldEF0dHJpYnV0ZXMoaW5zdCwge1xuICAgICAgICAgICAgY3g6IGAke2N4fWAsIGN5OiBgJHtjeX1gLFxuICAgICAgICAgICAgcng6IGAke3J4fWAsIHJ5OiBgJHtyeX1gXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmKCF0YXJnZXQpXG4gICAgICAgICAgICB0aGlzLmRvbUVsZW1lbnQuYXBwZW5kQ2hpbGQoaW5zdCk7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHRhcmdldC5hcHBlbmRDaGlsZChpbnN0KTtcbiAgICAgICAgcmV0dXJuIG5ldyBFbGxpcHNlKGluc3QpO1xuICAgIH1cblxuICAgIGNyZWF0ZVRleHQoeDogbnVtYmVyLCB5OiBudW1iZXIsIHN0cjogc3RyaW5nLCBhbmNob3I6IHN0cmluZywgdGFyZ2V0PzogU1ZHRWxlbWVudCk6IFRleHQge1xuICAgICAgICBjb25zdCBpbnN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsXCJ0ZXh0XCIpO1xuICAgICAgICB1dGlscy5zZXRBdHRyaWJ1dGVzKGluc3QsIHtcbiAgICAgICAgICAgIHg6IGAke3h9YCwgeTogYCR7eX1gLFxuICAgICAgICAgICAgJ3RleHQtYW5jaG9yJzogYCR7YW5jaG9yfWBcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICBpbnN0LmlubmVySFRNTCA9IGAke3N0cn1gO1xuXG4gICAgICAgIGlmKCF0YXJnZXQpXG4gICAgICAgICAgICB0aGlzLmRvbUVsZW1lbnQuYXBwZW5kQ2hpbGQoaW5zdCk7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHRhcmdldC5hcHBlbmRDaGlsZChpbnN0KTtcbiAgICAgICAgcmV0dXJuIG5ldyBUZXh0KGluc3QpO1xuICAgIH1cbiAgICBjcmVhdGVMaW5lKHgxOiBudW1iZXIsIHkxOiBudW1iZXIsIHgyOiBudW1iZXIsIHkyOiBudW1iZXIsIHdpZHRoOiBudW1iZXIsIGNvbG9yOiBzdHJpbmcsIHRhcmdldD86IFNWR0VsZW1lbnQpOiBMaW5lIHtcbiAgICAgICAgY29uc3QgaW5zdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLFwibGluZVwiKTtcbiAgICAgICAgdXRpbHMuc2V0QXR0cmlidXRlcyhpbnN0LCB7XG4gICAgICAgICAgICB4MTogYCR7eDF9YCwgeTE6IGAke3kxfWAsXG4gICAgICAgICAgICB4MjogYCR7eDJ9YCwgeTI6IGAke3kyfWAsXG4gICAgICAgICAgICBzdHJva2U6IGAke2NvbG9yfWAsXG4gICAgICAgICAgICBcInN0cm9rZS13aWR0aFwiOiBgJHt3aWR0aH1gXG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgaWYoIXRhcmdldClcbiAgICAgICAgICAgIHRoaXMuZG9tRWxlbWVudC5hcHBlbmRDaGlsZChpbnN0KTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGFyZ2V0LmFwcGVuZENoaWxkKGluc3QpO1xuICAgICAgICByZXR1cm4gbmV3IExpbmUoaW5zdCk7XG4gICAgfTtcbiAgICBjcmVhdGVMaW5rZXIodGFyZ2V0PzogU1ZHRWxlbWVudCl7XG4gICAgICAgIGxldCBsaW5rZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyxcInBhdGhcIik7XG4gICAgICAgIGlmKCF0YXJnZXQpXG4gICAgICAgICAgICB0aGlzLmRvbUVsZW1lbnQuYXBwZW5kQ2hpbGQobGlua2VyKTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGFyZ2V0LmFwcGVuZENoaWxkKGxpbmtlcik7XG4gICAgICAgIFxuICAgICAgICB1dGlscy5zZXRBdHRyaWJ1dGVzKGxpbmtlciwge2ZpbGw6IGB3aGl0ZWB9KTtcbiAgICAgICAgdGhpcy5saW5rZXIucHVzaChsaW5rZXIpO1xuICAgICAgICByZXR1cm4gbGlua2VyO1xuICAgIH1cbn1cblxuXG5jbGFzcyBTVkdTaGFwZSB7XG4gICAgcHJvdGVjdGVkIF9kb21FbGVtZW50OiBTVkdFbGVtZW50O1xuICAgIGNvbnN0cnVjdG9yKGRvbUVsZW1lbnQ6IFNWR0VsZW1lbnQpIHtcbiAgICAgICAgdGhpcy5fZG9tRWxlbWVudCA9IGRvbUVsZW1lbnQ7XG4gICAgfVxuICAgIHJlbW92ZSgpIHtcbiAgICAgICAgdGhpcy5fZG9tRWxlbWVudC5yZW1vdmUoKTtcbiAgICB9XG4gICAgZ2V0IGRvbUVsZW1lbnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9kb21FbGVtZW50O1xuICAgIH1cbiAgICBzZXQgc3R5bGUodmFsOiB7W2tleTogc3RyaW5nXTogc3RyaW5nfSl7XG4gICAgICAgIHV0aWxzLnNldFN0eWxlKDxIVE1MRWxlbWVudD48dW5rbm93bj50aGlzLmRvbUVsZW1lbnQsIHZhbCk7XG4gICAgfVxufTtcblxuZXhwb3J0IGNsYXNzIFJlY3QgZXh0ZW5kcyBTVkdTaGFwZXtcbiAgICBjb25zdHJ1Y3Rvcihkb21FbGVtZW50OiBTVkdSZWN0RWxlbWVudCkge1xuICAgICAgICBzdXBlcihkb21FbGVtZW50KTtcbiAgICB9XG4gICAgcHJpdmF0ZSBfeDogbnVtYmVyO1xuICAgIHByaXZhdGUgX3k6IG51bWJlcjtcbiAgICBwcml2YXRlIF93aWR0aDogbnVtYmVyO1xuICAgIHByaXZhdGUgX2hlaWdodDogbnVtYmVyO1xuICAgIHNldFBvcyh4OiBudW1iZXIsIHk6IG51bWJlcikge1xuICAgICAgICB1dGlscy5zZXRBdHRyaWJ1dGVzKHRoaXMuZG9tRWxlbWVudCwge1xuICAgICAgICAgICAgXCJ4XCI6IGAke3h9YCwgXCJ5XCI6IGAke3l9YFxuICAgICAgICB9KTtcbiAgICB9XG4gICAgc2V0U2hhcGUod2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIpIHtcbiAgICAgICAgdXRpbHMuc2V0QXR0cmlidXRlcyh0aGlzLmRvbUVsZW1lbnQsIHtcbiAgICAgICAgICAgIFwid2lkdGhcIjogYCR7d2lkdGh9YCwgXCJoZWlnaHRcIjogYCR7aGVpZ2h0fWBcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgc2V0IHgodmFsOiBudW1iZXIpIHtcbiAgICAgICAgaWYodGhpcy5feCAhPT0gdmFsKXtcbiAgICAgICAgICAgIHRoaXMuX3ggPSB2YWw7XG4gICAgICAgICAgICB1dGlscy5zZXRBdHRyaWJ1dGVzKHRoaXMuZG9tRWxlbWVudCwge1xuICAgICAgICAgICAgICAgIHg6IGAke3ZhbH1gXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldCB4KCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLl94O1xuICAgIH1cblxuICAgIHNldCB5KHZhbDogbnVtYmVyKXtcbiAgICAgICAgaWYodGhpcy5feSAhPT0gdmFsKXtcbiAgICAgICAgICAgIHRoaXMuX3kgPSB2YWw7XG4gICAgICAgICAgICB1dGlscy5zZXRBdHRyaWJ1dGVzKHRoaXMuZG9tRWxlbWVudCwge1xuICAgICAgICAgICAgICAgIHk6IGAke3ZhbH1gXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldCB5KCk6IG51bWJlcntcbiAgICAgICAgcmV0dXJuIHRoaXMuX3k7XG4gICAgfVxuXG4gICAgc2V0IHdpZHRoKHZhbDogbnVtYmVyKXtcbiAgICAgICAgaWYodGhpcy5fd2lkdGggIT09IHZhbCl7XG4gICAgICAgICAgICB0aGlzLl93aWR0aCA9IHZhbDtcbiAgICAgICAgICAgIHV0aWxzLnNldEF0dHJpYnV0ZXModGhpcy5kb21FbGVtZW50LCB7XG4gICAgICAgICAgICAgICAgd2lkdGg6IGAke3ZhbH1gXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldCB3aWR0aCgpOiBudW1iZXJ7XG4gICAgICAgIHJldHVybiB0aGlzLl93aWR0aDtcbiAgICB9XG4gICAgXG4gICAgc2V0IGhlaWdodCh2YWw6IG51bWJlcil7XG4gICAgICAgIGlmKHRoaXMuX2hlaWdodCAhPT0gdmFsKXtcbiAgICAgICAgICAgIHRoaXMuX2hlaWdodCA9IHZhbDtcbiAgICAgICAgICAgIHV0aWxzLnNldEF0dHJpYnV0ZXModGhpcy5kb21FbGVtZW50LCB7XG4gICAgICAgICAgICAgICAgaGVpZ2h0OiBgJHt2YWx9YFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXQgaGVpZ2h0KCk6IG51bWJlcntcbiAgICAgICAgcmV0dXJuIHRoaXMuX2hlaWdodDtcbiAgICB9XG5cbiAgICBzZXQgc3Ryb2tlV2lkdGgodmFsOiBudW1iZXIpe1xuICAgICAgICB1dGlscy5zZXRBdHRyaWJ1dGVzKHRoaXMuZG9tRWxlbWVudCwge1xuICAgICAgICAgICAgXCJzdHJva2Utd2lkdGhcIjogYCR7dmFsfWBcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZ2V0IHN0cm9rZVdpZHRoKCk6IG51bWJlcntcbiAgICAgICAgcmV0dXJuIE51bWJlcih0aGlzLmRvbUVsZW1lbnQuZ2V0QXR0cmlidXRlKFwic3Ryb2tlLXdpZHRoXCIpKTtcbiAgICB9XG5cbiAgICBzZXQgZmlsbCh2YWw6IHN0cmluZyl7XG4gICAgICAgIHV0aWxzLnNldEF0dHJpYnV0ZXModGhpcy5kb21FbGVtZW50LCB7XG4gICAgICAgICAgICBmaWxsOiBgJHt2YWx9YFxuICAgICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgZ2V0IGZpbGwoKTogc3RyaW5ne1xuICAgICAgICByZXR1cm4gdGhpcy5kb21FbGVtZW50LmdldEF0dHJpYnV0ZShcImZpbGxcIik7XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgRWxsaXBzZSBleHRlbmRzIFNWR1NoYXBle1xuICAgIHByaXZhdGUgX2N4OiBudW1iZXI7XG4gICAgcHJpdmF0ZSBfY3k6IG51bWJlcjtcbiAgICBwcml2YXRlIF9yeDogbnVtYmVyO1xuICAgIHByaXZhdGUgX3J5OiBudW1iZXI7XG4gICAgY29uc3RydWN0b3IoZG9tRWxlbWVudDogU1ZHRWxsaXBzZUVsZW1lbnQpIHtcbiAgICAgICAgc3VwZXIoZG9tRWxlbWVudCk7XG4gICAgfVxuXG4gICAgc2V0UG9zKGN4OiBudW1iZXIsIGN5OiBudW1iZXIpIHtcbiAgICAgICAgdXRpbHMuc2V0QXR0cmlidXRlcyh0aGlzLmRvbUVsZW1lbnQsIHtcbiAgICAgICAgICAgIFwiY3hcIjogYCR7Y3h9YCwgXCJjeVwiOiBgJHtjeX1gXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBzZXRTaGFwZShjeDogbnVtYmVyLCBjeTogbnVtYmVyLCByeDogbnVtYmVyLCByeTogbnVtYmVyKSB7XG4gICAgICAgIHV0aWxzLnNldEF0dHJpYnV0ZXModGhpcy5kb21FbGVtZW50LCB7XG4gICAgICAgICAgICBcInJ4XCI6IGAke3J4fWAsIFwicnlcIjogYCR7cnl9YFxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBzZXQgY3godmFsOiBudW1iZXIpe1xuICAgICAgICBpZih0aGlzLl9jeCAhPSB2YWwpe1xuICAgICAgICAgICAgdGhpcy5fY3ggPSB2YWw7XG4gICAgICAgICAgICB1dGlscy5zZXRBdHRyaWJ1dGVzKHRoaXMuZG9tRWxlbWVudCwge1xuICAgICAgICAgICAgICAgIGN4OiBgJHt2YWx9YFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgZ2V0IGN4KCk6bnVtYmVye1xuICAgICAgICByZXR1cm4gdGhpcy5fY3g7XG4gICAgfVxuXG4gICAgc2V0IGN5KHZhbDogbnVtYmVyKXtcbiAgICAgICAgaWYodGhpcy5fY3kgIT0gdmFsKXtcbiAgICAgICAgICAgIHRoaXMuX2N5ID0gdmFsO1xuICAgICAgICAgICAgdXRpbHMuc2V0QXR0cmlidXRlcyh0aGlzLmRvbUVsZW1lbnQsIHtcbiAgICAgICAgICAgICAgICBjeTogYCR7dmFsfWBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0IGN5KCk6IG51bWJlcntcbiAgICAgICAgcmV0dXJuIHRoaXMuX2N5O1xuICAgIH1cblxuICAgIHNldCByeCh2YWw6IG51bWJlcil7XG4gICAgICAgIGlmKHRoaXMuX3J4ICE9IHZhbCl7XG4gICAgICAgICAgICB0aGlzLl9yeCA9IHZhbDtcbiAgICAgICAgICAgIHV0aWxzLnNldEF0dHJpYnV0ZXModGhpcy5kb21FbGVtZW50LCB7XG4gICAgICAgICAgICAgICAgcng6IGAke3ZhbH1gXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldCByeCgpOiBudW1iZXJ7XG4gICAgICAgIHJldHVybiB0aGlzLl9yeDtcbiAgICB9XG5cbiAgICBzZXQgcnkodmFsOiBudW1iZXIpe1xuICAgICAgICBpZih0aGlzLl9yeSAhPSB2YWwpe1xuICAgICAgICAgICAgdGhpcy5fcnkgPSB2YWw7XG4gICAgICAgICAgICB1dGlscy5zZXRBdHRyaWJ1dGVzKHRoaXMuZG9tRWxlbWVudCwge1xuICAgICAgICAgICAgICAgIHJ5OiBgJHt2YWx9YFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXQgcnkoKTogbnVtYmVye1xuICAgICAgICByZXR1cm4gdGhpcy5fcnk7XG4gICAgfVxuXG4gICAgc2V0IGZpbGwodmFsOiBzdHJpbmcpe1xuICAgICAgICB1dGlscy5zZXRBdHRyaWJ1dGVzKHRoaXMuZG9tRWxlbWVudCwge1xuICAgICAgICAgICAgZmlsbDogYCR7dmFsfWBcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZ2V0IGZpbGwoKTogc3RyaW5ne1xuICAgICAgICByZXR1cm4gdGhpcy5kb21FbGVtZW50LmdldEF0dHJpYnV0ZShcImZpbGxcIik7XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgTGluZSBleHRlbmRzIFNWR1NoYXBle1xuICAgIHByaXZhdGUgX3gxOiBudW1iZXI7XG4gICAgcHJpdmF0ZSBfeDI6IG51bWJlcjtcbiAgICBwcml2YXRlIF95MTogbnVtYmVyO1xuICAgIHByaXZhdGUgX3kyOiBudW1iZXI7XG4gICAgY29uc3RydWN0b3IoZG9tRWxlbWVudDogU1ZHRWxlbWVudCkge1xuICAgICAgICBzdXBlcihkb21FbGVtZW50KTtcbiAgICB9XG5cbiAgICBzZXRFbmRQb2ludHMoeDE6IG51bWJlciwgeTE6IG51bWJlciwgeDI6IG51bWJlciwgeTI6IG51bWJlcikge1xuICAgICAgICB1dGlscy5zZXRBdHRyaWJ1dGVzKHRoaXMuZG9tRWxlbWVudCwge1xuICAgICAgICAgICAgXCJ4MVwiOiBgJHt4MX1gLCBcInkxXCI6IGAke3kxfWAsXG4gICAgICAgICAgICBcIngyXCI6IGAke3gyfWAsIFwieTJcIjogYCR7eTJ9YFxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBzZXQgeDEodmFsOiBudW1iZXIpe1xuICAgICAgICBpZih0aGlzLl94MSAhPSB2YWwpe1xuICAgICAgICAgICAgdGhpcy5feDEgPSB2YWw7XG4gICAgICAgICAgICB1dGlscy5zZXRBdHRyaWJ1dGVzKHRoaXMuZG9tRWxlbWVudCwge1xuICAgICAgICAgICAgICAgIHgxOiBgJHt2YWx9YFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IHgxKCk6IG51bWJlcntcbiAgICAgICAgcmV0dXJuIE51bWJlcih0aGlzLmRvbUVsZW1lbnQuZ2V0QXR0cmlidXRlKFwieDFcIikpO1xuICAgIH1cbiAgICBzZXQgeTEodmFsOiBudW1iZXIpe1xuICAgICAgICBpZih0aGlzLl95MSAhPSB2YWwpe1xuICAgICAgICAgICAgdGhpcy5feTEgPSB2YWw7XG4gICAgICAgIHV0aWxzLnNldEF0dHJpYnV0ZXModGhpcy5kb21FbGVtZW50LCB7XG4gICAgICAgICAgICB5MTogYCR7dmFsfWBcbiAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IHkxKCk6IG51bWJlcntcbiAgICAgICAgcmV0dXJuIE51bWJlcih0aGlzLmRvbUVsZW1lbnQuZ2V0QXR0cmlidXRlKFwieTFcIikpO1xuICAgIH1cbiAgICBzZXQgeDIodmFsOiBudW1iZXIpe1xuICAgICAgICBpZih0aGlzLl94MiAhPSB2YWwpe1xuICAgICAgICAgICAgdGhpcy5feDIgPSB2YWw7XG4gICAgICAgIHV0aWxzLnNldEF0dHJpYnV0ZXModGhpcy5kb21FbGVtZW50LCB7XG4gICAgICAgICAgICB4MjogYCR7dmFsfWBcbiAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IHgyKCk6IG51bWJlcntcbiAgICAgICAgcmV0dXJuIE51bWJlcih0aGlzLmRvbUVsZW1lbnQuZ2V0QXR0cmlidXRlKFwieDJcIikpO1xuICAgIH1cbiAgICBzZXQgeTIodmFsOiBudW1iZXIpe1xuICAgICAgICBpZih0aGlzLl95MiAhPSB2YWwpe1xuICAgICAgICAgICAgdGhpcy5feTIgPSB2YWw7XG4gICAgICAgIHV0aWxzLnNldEF0dHJpYnV0ZXModGhpcy5kb21FbGVtZW50LCB7XG4gICAgICAgICAgICB5MjogYCR7dmFsfWBcbiAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IHkyKCk6IG51bWJlcntcbiAgICAgICAgcmV0dXJuIE51bWJlcih0aGlzLmRvbUVsZW1lbnQuZ2V0QXR0cmlidXRlKFwieTJcIikpO1xuICAgIH1cbiAgICBzZXQgc3Ryb2tlKHZhbDogc3RyaW5nKXtcbiAgICAgICAgdXRpbHMuc2V0QXR0cmlidXRlcyh0aGlzLmRvbUVsZW1lbnQsIHtcbiAgICAgICAgICAgIHN0cm9rZTogYCR7dmFsfWBcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGdldCBzdHJva2UoKTogc3RyaW5ne1xuICAgICAgICByZXR1cm4gdGhpcy5kb21FbGVtZW50LmdldEF0dHJpYnV0ZShcInN0cm9rZVwiKVxuICAgIH1cbiAgICBzZXQgc3Ryb2tlV2lkdGgodmFsOiBudW1iZXIpe1xuICAgICAgICB1dGlscy5zZXRBdHRyaWJ1dGVzKHRoaXMuZG9tRWxlbWVudCwge1xuICAgICAgICAgICAgXCJzdHJva2Utd2lkdGhcIjogYCR7dmFsfWBcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGdldCBzdHJva2VXaWR0aCgpOiBudW1iZXJ7XG4gICAgICAgIHJldHVybiBOdW1iZXIodGhpcy5kb21FbGVtZW50LmdldEF0dHJpYnV0ZShcInN0cm9rZS13aWR0aFwiKSlcbiAgICB9XG59XG50eXBlIGFuY2hvciA9ICBcImNlbnRlclwiIHwgXCJsZWZ0XCI7XG5leHBvcnQgY2xhc3MgVGV4dCBleHRlbmRzIFNWR1NoYXBle1xuICAgIHByaXZhdGUgX3g6IG51bWJlcjtcbiAgICBwcml2YXRlIF95OiBudW1iZXI7XG4gICAgY29uc3RydWN0b3IoZG9tRWxlbWVudDogU1ZHVGV4dEVsZW1lbnQpIHtcbiAgICAgICAgc3VwZXIoZG9tRWxlbWVudCk7XG4gICAgfVxuICAgIHNldFBvcyh4OiBudW1iZXIsIHk6IG51bWJlcikge1xuICAgICAgICB1dGlscy5zZXRBdHRyaWJ1dGVzKHRoaXMuZG9tRWxlbWVudCwge1xuICAgICAgICAgICAgXCJ4XCI6IGAke3h9YCwgXCJ5XCI6IGAke3l9YCxcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHNldCB4KHZhbDogbnVtYmVyKXtcbiAgICAgICAgaWYodGhpcy5feCAhPSB2YWwpe1xuICAgICAgICAgICAgdGhpcy5feCA9IHZhbDtcbiAgICAgICAgICAgIHV0aWxzLnNldEF0dHJpYnV0ZXModGhpcy5kb21FbGVtZW50LCB7XG4gICAgICAgICAgICAgICAgeDogYCR7dmFsfWBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCB4KCk6IG51bWJlcntcbiAgICAgICAgcmV0dXJuIE51bWJlcih0aGlzLmRvbUVsZW1lbnQuZ2V0QXR0cmlidXRlKFwieFwiKSk7XG4gICAgfVxuICAgIHNldCB5KHZhbDogbnVtYmVyKXtcbiAgICAgICAgaWYodGhpcy5feSAhPSB2YWwpe1xuICAgICAgICAgICAgdGhpcy5feSA9IHZhbDtcbiAgICAgICAgICAgIHV0aWxzLnNldEF0dHJpYnV0ZXModGhpcy5kb21FbGVtZW50LCB7XG4gICAgICAgICAgICAgICAgeTogYCR7dmFsfWBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCB5KCk6IG51bWJlcntcbiAgICAgICAgcmV0dXJuIE51bWJlcih0aGlzLmRvbUVsZW1lbnQuZ2V0QXR0cmlidXRlKFwieVwiKSk7XG4gICAgfVxuICAgIHNldCBhbmNob3IodmFsOiBhbmNob3Ipe1xuICAgICAgICB1dGlscy5zZXRBdHRyaWJ1dGVzKHRoaXMuZG9tRWxlbWVudCwge1xuICAgICAgICAgICAgXCJ0ZXh0LWFuY2hvclwiOiBgJHt2YWx9YFxuICAgICAgICB9KTtcbiAgICB9XG4gICAgZ2V0IGFuY2hvcigpOiBhbmNob3J7XG4gICAgICAgIHJldHVybiA8YW5jaG9yPnRoaXMuZG9tRWxlbWVudC5nZXRBdHRyaWJ1dGUoXCJ0ZXh0LWFuY2hvclwiKTtcbiAgICB9XG5cbiAgICBzZXQgdGV4dCh2YWw6IHN0cmluZyl7XG4gICAgICAgIGlmKHRoaXMuZG9tRWxlbWVudC5pbm5lckhUTUwgIT09IHZhbCl7XG4gICAgICAgICAgICB0aGlzLmRvbUVsZW1lbnQuaW5uZXJIVE1MID0gYCR7dmFsfWA7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXQgdGV4dCgpOiBzdHJpbmd7XG4gICAgICAgIHJldHVybiB0aGlzLmRvbUVsZW1lbnQuaW5uZXJIVE1MO1xuICAgIH1cblxuICAgIHNldCBzdHJva2VXaWR0aCh2YWw6IG51bWJlcil7XG4gICAgICAgIHV0aWxzLnNldEF0dHJpYnV0ZXModGhpcy5kb21FbGVtZW50LCB7XG4gICAgICAgICAgICBcInN0cm9rZS13aWR0aFwiOiBgJHt2YWx9YFxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBnZXQgc3Ryb2tlV2lkdGgoKTogbnVtYmVye1xuICAgICAgICByZXR1cm4gTnVtYmVyKHRoaXMuZG9tRWxlbWVudC5nZXRBdHRyaWJ1dGUoXCJzdHJva2Utd2lkdGhcIikpO1xuICAgIH1cbn1cblxuY2xhc3MgTm90ZUxheWVyIGV4dGVuZHMgTGF5ZXIge1xuICAgIG5vdGVFbGVtZW50czogU1ZHTm90ZVtdID0gW107XG4gICAgY29uc3RydWN0b3IoKXtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5kb21FbGVtZW50LmlubmVySFRNTCA9IGBcbiAgICAgICAgPGRlZnM+XG4gICAgICAgICAgICA8cGF0aCBpZD1cIlNWR1RBSUw4XzFcIiBkPVwiTS00LjcyOCwxNTEuMzEzbDEwLjMwMywyLjA2MWwzOS4xNTMtMzMuODU0YzAsMCwyMC41NDMtMjQuMzE4LDIzLjMzOC02Ny43MDhMNzAuMzQsMEg0My44NDZMMjIuMDYxLDc4LjAxMlxuICAgICAgICAgICAgICAgIGwtMzMuODU0LDIwLjkwMUwtNC43MjgsMTUxLjMxM3pcIi8+XG4gICAgICAgIFx0PGNsaXBQYXRoIGlkPVwiU1ZHVEFJTDhfMlwiPlxuICAgICAgICAgICAgICAgIDx1c2UgeGxpbms6aHJlZj1cIiNTVkdUQUlMOF8xXCIgIHN0eWxlPVwib3ZlcmZsb3c6dmlzaWJsZTtcIi8+XG4gICAgICAgICAgICA8L2NsaXBQYXRoPlxuXG4gICAgICAgICAgICA8cGF0aCBpZD1cInN0YWlsMTZcImQ9XCJNNjcuMzcsNTkuNzc2YzIuNjk4LTE5Ljg0LTIuODA2LTM5LjAxLTcuMTI0LTU4LjE3M0M2MC4xMzgsMS4xMjcsNTkuNTIzLDAuNzY1LDU4LjgyNSwwYzAsMy40MTEtMC4zMTcsNi4yNjYsMC4wNTQsOS4wMjlcbiAgICAgICAgICAgIGMxLjY5LDEyLjU3NiwwLjcwNywyNS4wNjItMi40NzgsMzcuMTc1Yy01LjQ5NCwyMC44OTctMTUuMTYzLDM5LjMyLTM1LjM5NCw0OS42OWMtNi4zOTcsMy4yNzktMTMuNTk5LDQuOTktMjAuNjEyLDcuNDQzXG4gICAgICAgICAgICBsLTAuMTY4LDQyLjg0MmMwLjQyOS0xLjQ1OSwxLjAzMS0yLjg5OSwxLjg4MS00LjMxOGM1LjcxMi05LjUzNSwxMy4zNzktMTcuMjc1LDIzLjQyMi0yMS43MzFcbiAgICAgICAgICAgIGMxMS43MjgtNS4yMDMsMjEuMzcyLTEyLjYzNCwyOS40MzItMjIuNDA3YzAuNDg2LTAuNTksMS4xNTQtMS4wMjksMi4wMTctMS43ODJjLTYuNjkzLDM0LjQxMi0yNi44OTQsNTUuOTYxLTU2Ljc5NCw2MC41NTVcbiAgICAgICAgICAgIEwwLDIwMy44NzRjMS42MzQtNC4wOTIsMi41MTgtOC42MjEsNC45MjItMTIuMTQ4YzUuOTA2LTguNjY0LDE0LjA5Mi0xNC43OTcsMjMuNzEtMTkuMzA4YzE2LjU5Ny03Ljc4NiwzMC4wMTYtMTkuNTMyLDM1LjA4NS0zNy40OThcbiAgICAgICAgICAgIGMzLjE5OC0xMS4zMzMsNC4yMi0yMy42ODIsMy44NzItMzUuNTA2QzY3LjIsODYuMTg1LDY1LjU1MSw3My4xNDgsNjcuMzcsNTkuNzc2elwiLz5cbiAgICAgICAgXG4gICAgICAgICAgICA8cGF0aCBpZD1cInN0YWlsOFwiIHN0eWxlPVwiY2xpcC1wYXRoOnVybCgjU1ZHVEFJTDhfMik7XCIgZD1cIk02Ny4zNTIsNjQuMTg0YzIuNjk4LTE5Ljg0LTIuODA2LTM5LjAxLTcuMTI0LTU4LjE3M1xuICAgICAgICAgICAgYy0wLjEwNy0wLjQ3Ni0wLjcyMi0wLjgzNy0xLjQyLTEuNjAzYzAsMy40MTEtMC4zMTcsNi4yNjYsMC4wNTQsOS4wMjljMS42OSwxMi41NzYsMC43MDcsMjUuMDYyLTIuNDc4LDM3LjE3NVxuICAgICAgICAgICAgYy01LjQ5NCwyMC44OTctMTUuMTYzLDM5LjMyLTM1LjM5NCw0OS42OWMtNi4zOTcsMy4yNzktMTMuNTk5LDQuOTktMjAuNjEyLDcuNDQzbC0wLjE2OCw0Mi44NDJcbiAgICAgICAgICAgIGMwLjQyOS0xLjQ1OSwxLjAzMS0yLjg5OSwxLjg4MS00LjMxOGM1LjcxMi05LjUzNSwxMy4zNzktMTcuMjc1LDIzLjQyMi0yMS43MzFjMTEuNzI4LTUuMjAzLDIxLjM3Mi0xMi42MzQsMjkuNDMyLTIyLjQwN1xuICAgICAgICAgICAgYzAuNDg2LTAuNTksMS4xNTQtMS4wMjksMi4wMTctMS43ODJjLTYuNjkzLDM0LjQxMi0yNi44OTQsNTUuOTYxLTU2Ljc5NCw2MC41NTVsLTAuMTg2LDQ3LjM3OVxuICAgICAgICAgICAgYzEuNjM0LTQuMDkyLDIuNTE4LTguNjIxLDQuOTIyLTEyLjE0OGM1LjkwNi04LjY2NCwxNC4wOTItMTQuNzk3LDIzLjcxLTE5LjMwOGMxNi41OTctNy43ODYsMzAuMDE2LTE5LjUzMiwzNS4wODUtMzcuNDk4XG4gICAgICAgICAgICBjMy4xOTgtMTEuMzMzLDQuMjItMjMuNjgyLDMuODcyLTM1LjUwNkM2Ny4xODIsOTAuNTk0LDY1LjUzNCw3Ny41NTcsNjcuMzUyLDY0LjE4NHpcIi8+XG5cbiAgICAgICAgICAgIDxwYXRoIGlkPVwiU1ZHSURfMV9cIiBkPVwiTS00LjE3LDI1NS41NDNsMTAuMzAzLDIuMDYxbDM5LjE1My0zMy44NTRjMCwwLDIwLjU0My0yNC4zMTgsMjMuMzM4LTY3LjcwOGwyLjI3NC01MS44MTJINDQuNDA0XG4gICAgICAgICAgICAgICAgbC0yMS43ODQsNzguMDEybC0zMy44NTQsMjAuOTAxTC00LjE3LDI1NS41NDN6XCIvPlxuICAgICAgICAgICAgPGNsaXBQYXRoIGlkPVwiU1ZHSURfMl9cIj5cbiAgICAgICAgICAgICAgICA8dXNlIHhsaW5rOmhyZWY9XCIjU1ZHSURfMV9cIiAgc3R5bGU9XCJvdmVyZmxvdzp2aXNpYmxlO1wiLz5cbiAgICAgICAgICAgIDwvY2xpcFBhdGg+XG4gICAgICAgICAgICA8ZyBpZD1cInN0YWlsMzJcIj5cbiAgICAgICAgICAgIDxwYXRoIGQ9XCJNNjcuMTgzLDU5Ljc3NmMyLjY5OC0xOS44NC0yLjgwNi0zOS4wMS03LjEyNC01OC4xNzNDNTkuOTUyLDEuMTI3LDU5LjMzNywwLjc2NSw1OC42MzksMGMwLDMuNDExLTAuMzE3LDYuMjY2LDAuMDU0LDkuMDI5XG5cdFx0YzEuNjksMTIuNTc2LDAuNzA3LDI1LjA2Mi0yLjQ3OCwzNy4xNzVjLTUuNDk0LDIwLjg5Ny0xNS4xNjMsMzkuMzItMzUuMzk0LDQ5LjY5Yy02LjM5NywzLjI3OS0xMy41OTksNC45OS0yMC42MTIsNy40NDNcblx0XHRsLTAuMTY4LDQyLjg0MmMwLjQyOS0xLjQ1OSwxLjAzMS0yLjg5OSwxLjg4MS00LjMxOGM1LjcxMi05LjUzNSwxMy4zNzktMTcuMjc1LDIzLjQyMi0yMS43MzFcblx0XHRjMTEuNzI4LTUuMjAzLDIxLjM3Mi0xMi42MzQsMjkuNDMyLTIyLjQwN2MwLjQ4Ni0wLjU5LDEuMTU0LTEuMDI5LDIuMDE3LTEuNzgyQzUwLjEwMSwxMzAuMzUyLDI5LjksMTUxLjkwMSwwLDE1Ni40OTVcblx0XHRsLTAuMTg2LDQ3LjM3OWMxLjYzNC00LjA5MiwyLjUxOC04LjYyMSw0LjkyMi0xMi4xNDhjNS45MDYtOC42NjQsMTQuMDkyLTE0Ljc5NywyMy43MS0xOS4zMDhcblx0XHRjMTYuNTk3LTcuNzg2LDMwLjAxNi0xOS41MzIsMzUuMDg1LTM3LjQ5OGMzLjE5OC0xMS4zMzMsNC4yMi0yMy42ODIsMy44NzItMzUuNTA2QzY3LjAxMyw4Ni4xODUsNjUuMzY1LDczLjE0OCw2Ny4xODMsNTkuNzc2elwiLz5cbiAgICAgICAgICAgIDxwYXRoIHN0eWxlPVwiY2xpcC1wYXRoOnVybCgjU1ZHSURfMl8pO1wiIGQ9XCJNNjcuOTEsMTY4LjQxNGMyLjY5OC0xOS44NC0yLjgwNi0zOS4wMS03LjEyNC01OC4xNzNcblx0XHRcdGMtMC4xMDctMC40NzYtMC43MjItMC44MzctMS40Mi0xLjYwM2MwLDMuNDExLTAuMzE3LDYuMjY2LDAuMDU0LDkuMDI5YzEuNjksMTIuNTc2LDAuNzA3LDI1LjA2Mi0yLjQ3OCwzNy4xNzVcblx0XHRcdGMtNS40OTQsMjAuODk3LTE1LjE2MywzOS4zMi0zNS4zOTQsNDkuNjljLTYuMzk3LDMuMjc5LTEzLjU5OSw0Ljk5LTIwLjYxMiw3LjQ0M2wtMC4xNjgsNDIuODQyXG5cdFx0XHRjMC40MjktMS40NTksMS4wMzEtMi44OTksMS44ODEtNC4zMThjNS43MTItOS41MzUsMTMuMzc5LTE3LjI3NSwyMy40MjItMjEuNzMxYzExLjcyOC01LjIwMywyMS4zNzItMTIuNjM0LDI5LjQzMi0yMi40MDdcblx0XHRcdGMwLjQ4Ni0wLjU5LDEuMTU0LTEuMDI5LDIuMDE3LTEuNzgyYy02LjY5MywzNC40MTItMjYuODk0LDU1Ljk2LTU2Ljc5NCw2MC41NTVMMC41NCwzMTIuNTEyXG5cdFx0XHRjMS42MzQtNC4wOTIsMi41MTgtOC42MjEsNC45MjItMTIuMTQ4YzUuOTA2LTguNjY0LDE0LjA5Mi0xNC43OTcsMjMuNzEtMTkuMzA4YzE2LjU5Ny03Ljc4NiwzMC4wMTYtMTkuNTMyLDM1LjA4NS0zNy40OThcbiAgICAgICAgICAgIGMzLjE5OC0xMS4zMzMsNC4yMi0yMy42ODIsMy44NzItMzUuNTA2QzY3Ljc0LDE5NC44MjMsNjYuMDkyLDE4MS43ODYsNjcuOTEsMTY4LjQxNHpcIi8+XG4gICAgICAgICAgICA8L2c+XG4gICAgICAgIDwvZGVmcz5cbiAgICAgICAgYDtcbiAgICAgICAgdXRpbHMuc2V0QXR0cmlidXRlcyh0aGlzLmRvbUVsZW1lbnQse1wiZGF0YS1sYXllclwiOiBcIk5vdGVMYXllclwifSlcbiAgICB9XG4gICAgY3JlYXRlTm90ZSgpOiBTVkdFbGVtZW50IHtcbiAgICAgICAgY29uc3Qgbm90ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLFwiZ1wiKTtcbiAgICAgICAgY29uc3QgYmxvY2tHcm91cCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLFwiZ1wiKTtcbiAgICAgICAgY29uc3QgYmxvY2tBcnJheTogTm90ZUJsb2NrW10gPSBbXTtcbiAgICAgICAgY29uc3QgbGluZUdyb3VwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsXCJnXCIpO1xuICAgICAgICBjb25zdCBsZzogTGluZVtdID0gW107XG4gICAgICAgIGxnLnB1c2godGhpcy5jcmVhdGVMaW5lKDAsIDAsIDAsIDAsIDEsIFwid2hpdGVcIiwgbGluZUdyb3VwKSk7XG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCAzIDsgaSsrKXtcbiAgICAgICAgICAgIGxnLnB1c2godGhpcy5jcmVhdGVMaW5lKDAsIDAsIDAsIDAsIDIsIFwid2hpdGVcIiwgbGluZUdyb3VwKSk7XG4gICAgICAgIH1cbiAgICAgICAgbm90ZS5hcHBlbmQobGluZUdyb3VwKTtcbiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IDYgOyBpKyspe1xuICAgICAgICAgICAgY29uc3Qgd29yZEdyb3VwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsXCJnXCIpO1xuICAgICAgICAgICAgY29uc3QgZXh0ZW5kUmVjdCA9IHRoaXMuY3JlYXRlUmVjdCgwLCAwLCAwLCAwLCAwLCBcInJnYmEoMCwgMCwgMCwgMClcIix3b3JkR3JvdXApO1xuICAgICAgICAgICAgY29uc3Qgd29yZEJhY2sgPSB0aGlzLmNyZWF0ZVRleHQoMCwgMCwgXCJcIiwgXCJtaWRkbGVcIiwgd29yZEdyb3VwKTtcbiAgICAgICAgICAgIGNvbnN0IHdvcmQgPSB0aGlzLmNyZWF0ZVRleHQoMCwgMCwgXCJcIiwgXCJtaWRkbGVcIiwgd29yZEdyb3VwKTtcbiAgICAgICAgICAgIHV0aWxzLnNldEF0dHJpYnV0ZXMod29yZEdyb3VwLCB7XCJzdHJva2Utd2lkdGhcIjogJzAnLCBcInN0cm9rZVwiOiBcImJsYWNrXCIsIHN0eWxlOiBcImN1cnNvcjpwb2ludGVyO1wifSk7XG4gICAgICAgICAgICB3b3JkQmFjay5zdHJva2VXaWR0aCA9IDM7IFxuICAgICAgICAgICAgd29yZEJhY2suc3R5bGUgPSB7Zm9udDogXCIxMnB4IFNhbnMtc2VyZlwifVxuICAgICAgICAgICAgd29yZC5zdHlsZSA9IHtcImZvbnRcIjogXCIxMnB4IFNhbnMtc2VyaWZcIiwgXCJmaWxsXCI6IFwiI2ZmZlwifTtcbiAgICAgICAgICAgIGJsb2NrR3JvdXAuYXBwZW5kKHdvcmRHcm91cCk7XG4gICAgICAgICAgICBibG9ja0FycmF5LnB1c2gobmV3IE5vdGVCbG9jayg8SFRNTEVsZW1lbnQ+PHVua25vd24+d29yZEdyb3VwLCB3b3JkLCB3b3JkQmFjaywgZXh0ZW5kUmVjdCkpO1xuICAgICAgICB9XG4gICAgICAgIG5vdGUuYXBwZW5kKGJsb2NrR3JvdXApO1xuICAgICAgICB0aGlzLm5vdGVFbGVtZW50cy5wdXNoKG5ldyBTVkdOb3RlKDxIVE1MRWxlbWVudD48dW5rbm93bj5ub3RlLCBibG9ja0FycmF5LCBsZykpO1xuICAgICAgICB0aGlzLmRvbUVsZW1lbnQuYXBwZW5kKG5vdGUpO1xuICAgICAgICByZXR1cm4gbm90ZTtcbiAgICB9XG59XG5cbmNsYXNzIFNoZWV0TGF5ZXIgZXh0ZW5kcyBMYXllciB7XG4gICAgcmVhZG9ubHkgcm93OiBIVE1MRWxlbWVudFtdID0gW107XG4gICAgcmVhZG9ubHkgYmFyOiBMaW5lW10gPSBbXTtcbiAgICBjb25zdHJ1Y3Rvcigpe1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB1dGlscy5zZXRBdHRyaWJ1dGVzKHRoaXMuZG9tRWxlbWVudCx7XCJkYXRhLWxheWVyXCI6IFwiU2hlZXRMYXllclwifSlcbiAgICB9XG4gICAgY3JlYXRlUm93KHg6IG51bWJlciwgeTogbnVtYmVyLCBsaW5lV2lkdGg6bnVtYmVyLCBsaW5lUGFkZGluZzogW251bWJlciwgbnVtYmVyXSwgc3RyaW5nUGFkZGluZzogbnVtYmVyLCBzZWN0aW9uUGVyTGluZTogbnVtYmVyKTogU1ZHRWxlbWVudCB7XG4gICAgICAgIGxldCBuZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLFwiZ1wiKTtcbiAgICAgICAgbGV0IGxpbmVCYWNrID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsXCJyZWN0XCIpO1xuICAgICAgICB1dGlscy5zZXRBdHRyaWJ1dGVzKGxpbmVCYWNrLHt4OiBgJHt4fWAsIHk6YCR7eX1gLHN0eWxlOiBcImZpbGw6IHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4wOSlcIiwgd2lkdGg6YCR7bGluZVBhZGRpbmdbMF0qMiArIGxpbmVXaWR0aH1gLCBoZWlnaHQ6IGAke2xpbmVQYWRkaW5nWzFdKjIgKyBzdHJpbmdQYWRkaW5nICogNX1gfSk7XG4gICAgICAgIG5nLmFwcGVuZENoaWxkKGxpbmVCYWNrKTtcbiAgICAgICAgeCArPSBsaW5lUGFkZGluZ1swXTtcbiAgICAgICAgeSArPSBsaW5lUGFkZGluZ1sxXTtcbiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IDY7IGkrKyl7XG4gICAgICAgICAgICBsZXQgbCA9IGxpbmVXaWR0aDtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlTGluZSh4LCB5ICsgaSpzdHJpbmdQYWRkaW5nLCB4ICsgbCwgeSArIGkgKiBzdHJpbmdQYWRkaW5nLCAyLCBcInJnYmEoMjU1LCAyNTUsIDI1NSwgMC4yNClcIiwgbmcpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZHJhd1Jvd1RpdGxlKHggLSAzMCwgeSwgbmcpO1xuICAgICAgICB0aGlzLmNyZWF0ZUxpbmUoeCwgeSwgeCwgeSArIHN0cmluZ1BhZGRpbmcgKiA1LCAyLCBcInJnYmEoMjU1LCAyNTUsIDI1NSwgMC4yNClcIiwgdGhpcy5kb21FbGVtZW50KTtcbiAgICAgICAgZm9yKGxldCBpPSAwOyBpIDwgc2VjdGlvblBlckxpbmU7IGkrKyl7XG4gICAgICAgICAgICBsZXQgbmIgPSB0aGlzLmNyZWF0ZUxpbmUoMCwgeSwgMCwgeSArIHN0cmluZ1BhZGRpbmcgKiA1LCAyLCBcInJnYmEoMjU1LCAyNTUsIDI1NSwgMC4yNClcIiwgdGhpcy5kb21FbGVtZW50KTtcbiAgICAgICAgICAgIHRoaXMuYmFyLnB1c2gobmIpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZG9tRWxlbWVudC5hcHBlbmQobmcpO1xuICAgICAgICB0aGlzLnJvdy5wdXNoKDxIVE1MRWxlbWVudD48dW5rbm93bj5uZyk7XG4gICAgICAgIHJldHVybiBuZztcbiAgICB9XG5cbiAgICBwcml2YXRlIGRyYXdSb3dUaXRsZSh4OiBudW1iZXIsIHk6IG51bWJlciwgdGFyZ2V0PzogU1ZHRWxlbWVudCk6IFNWR0VsZW1lbnQge1xuICAgICAgICBsZXQgdGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyxcImdcIik7XG4gICAgICAgIHRpdGxlLmlubmVySFRNTCA9IGBcbiAgICAgICAgPHRleHQgc3R5bGU9XCJmaWxsOiM5NTk1OTU7Zm9udDoxN3B4IGFyaWFsO1wiPlxuICAgICAgICAgICAgPHRzcGFuIHg9JyR7eCArIDEwfScgeT0nJHt5ICsgMjZ9Jz5UPC90c3Bhbj5cbiAgICAgICAgICAgIDx0c3BhbiB4PScke3ggKyAxMH0nIHk9JyR7eSArIDIyICsgMjZ9Jz5BPC90c3Bhbj5cbiAgICAgICAgICAgIDx0c3BhbiB4PScke3ggKyAxMH0nIHk9JyR7eSArIDQ0ICsgMjZ9Jz5CPC90c3Bhbj5cbiAgICAgICAgPC90ZXh0PlxuICAgICAgICBgO1xuICAgICAgICBpZih0YXJnZXQpdGFyZ2V0LmFwcGVuZCh0aXRsZSk7XG4gICAgICAgIHJldHVybiB0aXRsZTtcbiAgICB9XG59XG5cbmNsYXNzIFVJTGF5ZXIgZXh0ZW5kcyBMYXllciB7XG4gICAgcmVhZG9ubHkgc2VjdGlvbkluZGljYXRvcjogUmVjdFtdID0gW107XG4gICAgY29uc3RydWN0b3IoKXtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdXRpbHMuc2V0QXR0cmlidXRlcyh0aGlzLmRvbUVsZW1lbnQse1wiZGF0YS1sYXllclwiOiBcIlVJTGF5ZXJcIn0pXG4gICAgfVxuICAgIGNyZWF0ZVNlY3Rpb25JbmRpY2F0b3IoKXtcbiAgICAgICAgbGV0IG5ld1NxdWFyZSA9IHRoaXMuY3JlYXRlUmVjdCgwLCAwLCAwLCAwLCAwLFwicmdiYSgwLCAyNTUsIDI1NSwgMC4xMylcIik7XG4gICAgICAgIG5ld1NxdWFyZS5zdHlsZSA9IHtkaXNwbGF5OiBcIm5vbmVcIn07XG4gICAgICAgIC8vdXRpbHMuc2V0QXR0cmlidXRlcyhuZXdTcXVhcmUsIHtzdHlsZTogXCJkaXNwbGF5OiBub25lXCJ9KTtcbiAgICAgICAgdGhpcy5zZWN0aW9uSW5kaWNhdG9yLnB1c2gobmV3U3F1YXJlKTtcbiAgICAgICAgcmV0dXJuIG5ld1NxdWFyZTtcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBMYXllcnMge1xuICAgIHJlYWRvbmx5IGJhY2tncm91bmQ6IExheWVyO1xuICAgIHJlYWRvbmx5IHNoZWV0OiBTaGVldExheWVyO1xuICAgIHJlYWRvbmx5IG5vdGVzOiBOb3RlTGF5ZXI7XG4gICAgcmVhZG9ubHkgZm9yZWdyb3VuZDogTGF5ZXI7XG4gICAgY29uc3RydWN0b3IoKXtcbiAgICAgICAgdGhpcy5iYWNrZ3JvdW5kID0gbmV3IExheWVyKCk7XG4gICAgICAgIHRoaXMuc2hlZXQgPSBuZXcgU2hlZXRMYXllcigpO1xuICAgICAgICB0aGlzLm5vdGVzID0gbmV3IE5vdGVMYXllcigpO1xuICAgICAgICB0aGlzLmZvcmVncm91bmQgPSBuZXcgTGF5ZXIoKTtcbiAgICB9XG4gICAgZ2V0IGZsYXR0ZW5lZCgpOiBMYXllcltdIHtcbiAgICAgICAgcmV0dXJuIFt0aGlzLmJhY2tncm91bmQsIHRoaXMuc2hlZXQsIHRoaXMubm90ZXMsIHRoaXMuZm9yZWdyb3VuZF07XG4gICAgfVxuXG59XG5cbmV4cG9ydCBjbGFzcyBTTExheWVyIGV4dGVuZHMgTGF5ZXJze1xuICAgIHJlYWRvbmx5IHVpOiBVSUxheWVyO1xuICAgIGNvbnN0cnVjdG9yKCl7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMudWkgPSBuZXcgVUlMYXllcigpO1xuICAgIH1cbiAgICBnZXQgZmxhdHRlbmVkKCk6IExheWVyW10ge1xuICAgICAgICByZXR1cm4gW3RoaXMuYmFja2dyb3VuZCwgdGhpcy51aSwgdGhpcy5zaGVldCwgdGhpcy5ub3RlcywgdGhpcy5mb3JlZ3JvdW5kXTtcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBTTENhbnZhczxUIGV4dGVuZHMgTGF5ZXJzPiB7XG4gICAgcmVhZG9ubHkgZG9tRWxlbWVudDogU1ZHRWxlbWVudDtcbiAgICByZWFkb25seSBsYXllcnM6IFQ7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGxheWVyVHlwZTogbmV3ICgpID0+IFQpIHtcbiAgICAgICAgdGhpcy5sYXllcnMgPSBuZXcgbGF5ZXJUeXBlKCk7XG5cbiAgICAgICAgdGhpcy5kb21FbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsXCJzdmdcIik7XG4gICAgICAgIHV0aWxzLnNldFN0eWxlKDxIVE1MRWxlbWVudD48dW5rbm93bj50aGlzLmRvbUVsZW1lbnQsIHtcInVzZXItc2VsZWN0XCI6IFwibm9uZVwiLCBcIm91dGxpbmVcIjogXCJub25lXCJ9KTtcblxuICAgICAgICB0aGlzLmxheWVycy5mbGF0dGVuZWQuZm9yRWFjaChsYXllciA9PiB0aGlzLmRvbUVsZW1lbnQuYXBwZW5kQ2hpbGQobGF5ZXIuZG9tRWxlbWVudCkpO1xuICAgIH1cbn0iXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBU0E7QUFZQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBVUE7QUFSQTtBQUNBO0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFLQTtBQURBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQURBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFLQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUtBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUZBO0FBR0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBNENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUdBO0FBQ0E7QUFIQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBRkE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUlBO0FBQUE7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/SlimTabV2Canvas.ts\n");

/***/ }),

/***/ "./src/SlimTabV2Editor.ts":
/*!********************************!*\
  !*** ./src/SlimTabV2Editor.ts ***!
  \********************************/
/*! exports provided: SLEditor */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"SLEditor\", function() { return SLEditor; });\nclass SLEditor {\r\n    constructor(controlTab) {\r\n        this.inputBlock = 0;\r\n        this.mouseDown = false;\r\n        this.mouseMove = false;\r\n        this.selectNotesIndicator = [];\r\n        this.selectNotesIndicatorPadding = 8;\r\n        this.controlTab = controlTab;\r\n        this.indicator = this.controlTab.tabCanvas.layers.ui.createEllipse(0, 0, 8, 8);\r\n        this.shadowIndicator = this.controlTab.tabCanvas.layers.ui.createEllipse(0, 0, 8, 8);\r\n        this.indicator.cx = -20;\r\n        this.indicator.cy = -20;\r\n        this.indicator.fill = \"rgb(255, 50, 0)\";\r\n        this.shadowIndicator.cx = -20;\r\n        this.shadowIndicator.cy = -20;\r\n        this.shadowIndicator.fill = \"rgba(255, 50, 0, 0.6)\";\r\n        this.dragNDropSection = this.controlTab.tabCanvas.layers.ui.createRect(0, 0, 0, 0, 0, \"rgba(255, 50, 0, 0.6)\");\r\n        this.setEvents();\r\n    }\r\n    get selectedNote() {\r\n        return this.selectedSVGNote;\r\n    }\r\n    get SelectedNotes() {\r\n        return this.selectedSVGNotes;\r\n    }\r\n    undisplayIndicator() {\r\n        this.indicator.style = { display: \"none\" };\r\n        this.shadowIndicator.style = { display: \"none\" };\r\n        this.selectNotesIndicator.forEach((elem, index, self) => {\r\n            elem.style = { display: \"none\" };\r\n        });\r\n    }\r\n    displayIndicator() {\r\n        this.indicator.style = { display: \"unset\" };\r\n        this.shadowIndicator.style = { display: \"unset\" };\r\n        this.selectNotesIndicator.forEach((elem, index, self) => {\r\n            elem.style = { display: \"unset\" };\r\n        });\r\n    }\r\n    setEvents() {\r\n        this.controlTab.on(\"noteclick\", (section, note, string, position) => {\r\n            this.setNoteClickEvent(section, note, string, position);\r\n            this.selectedSVGNote = this.controlTab.getSVGNote(section, note);\r\n            this.unselectSVGNotes();\r\n        });\r\n        this.controlTab.on(\"noteshiftclick\", (section, note, string, position) => {\r\n            this.unselectSVGNotes();\r\n            this.controlTab.getSVGNote(section, note);\r\n            this.selectedSVGNotes = this.controlTab.endsSelect(this.controlTab.noteIndex(this.selectedSVGNote), this.controlTab.noteIndex(this.controlTab.getSVGNote(section, note)));\r\n            this.drawMultiSelectRect(this.selectedSVGNotes);\r\n        });\r\n        this.controlTab.on(\"keydown\", (key) => {\r\n            if (key.toLowerCase() !== \" \" && !isNaN(Number(key))) {\r\n                if (this.selectedBlock) {\r\n                    let tb = this.inputBlock * 10 + Number(key);\r\n                    if (tb < 40) {\r\n                        this.inputBlock = tb;\r\n                    }\r\n                    else {\r\n                        this.inputBlock = Number(key);\r\n                    }\r\n                    this.controlTab.setStringDataOfNote(this.selectedBlock.section, this.selectedBlock.note, this.selectedBlock.string, this.inputBlock);\r\n                    this.controlTab.render();\r\n                }\r\n            }\r\n            else {\r\n                this.inputBlock = 0;\r\n            }\r\n            if (key.toLowerCase() === \"d\" || key.toLowerCase() === \"arrowright\") {\r\n                if (this.selectedSVGNotes.length > 0) {\r\n                    let rightSideBlock = this.selectedSVGNotes[this.selectedSVGNotes.length - 1].blockGroup[0];\r\n                    this.selectedBlock = { section: rightSideBlock.section, note: rightSideBlock.note, string: rightSideBlock.string };\r\n                    this.unselectSVGNotes();\r\n                }\r\n                if (this.selectedBlock) {\r\n                    this.selectRight(this.selectedBlock, this.controlTab);\r\n                }\r\n            }\r\n            if (key.toLowerCase() === \"a\" || key.toLowerCase() === \"arrowleft\") {\r\n                if (this.selectedSVGNotes.length > 0) {\r\n                    let leftSideBlock = this.selectedSVGNotes[0].blockGroup[0];\r\n                    this.selectedBlock = { section: leftSideBlock.section, note: leftSideBlock.note, string: leftSideBlock.string };\r\n                    this.unselectSVGNotes();\r\n                }\r\n                if (this.selectedBlock) {\r\n                    this.selectLeft(this.selectedBlock, this.controlTab);\r\n                }\r\n            }\r\n            if (key.toLowerCase() === \"w\" || key.toLowerCase() === \"arrowup\") {\r\n                if (this.selectedSVGNotes.length > 0) {\r\n                    let rightSideBlock = this.selectedSVGNotes[this.selectedSVGNotes.length - 1].blockGroup[0];\r\n                    this.selectedBlock = { section: rightSideBlock.section, note: rightSideBlock.note, string: rightSideBlock.string };\r\n                    this.unselectSVGNotes();\r\n                }\r\n                if (this.selectedBlock) {\r\n                    this.selectUp(this.selectedBlock, this.controlTab);\r\n                }\r\n            }\r\n            if (key.toLowerCase() === \"s\" || key.toLowerCase() === \"arrowdown\") {\r\n                if (this.selectedSVGNotes.length > 0) {\r\n                    let rightSideBlock = this.selectedSVGNotes[this.selectedSVGNotes.length - 1].blockGroup[0];\r\n                    this.selectedBlock = { section: rightSideBlock.section, note: rightSideBlock.note, string: rightSideBlock.string };\r\n                    this.unselectSVGNotes();\r\n                }\r\n                if (this.selectedBlock) {\r\n                    this.selectDown(this.selectedBlock, this.controlTab);\r\n                }\r\n            }\r\n            if (key.toLowerCase() === \"i\") {\r\n                if (this.selectedSVGNotes.length > 0) {\r\n                    this.selectedBlock = { section: this.selectedSVGNotes[0].section, note: this.selectedSVGNotes[0].note, string: 0 };\r\n                    this.unselectSVGNotes();\r\n                }\r\n                if (this.selectedBlock) {\r\n                    let emptyNote = this.insertEmptyNote(this.selectedBlock);\r\n                    this.controlTab.render();\r\n                    this.selectNoteAndMoveIndicator(emptyNote.section, emptyNote.note, emptyNote.string);\r\n                }\r\n                this.controlTab.render();\r\n            }\r\n            if (key.toLowerCase() === \"delete\" || key.toLowerCase() === \"backspace\") {\r\n                if (this.selectedSVGNotes.length > 0) {\r\n                    for (let i = this.selectedSVGNotes.length - 1; i >= 0; i--) {\r\n                        this.controlTab.deleteNote(this.selectedSVGNotes[i].section, this.selectedSVGNotes[i].note);\r\n                        this.controlTab.render();\r\n                    }\r\n                    this.unselectSVGNotes();\r\n                }\r\n                else if (this.selectedBlock) {\r\n                    this.deleteNoteBlock(this.selectedBlock, this.controlTab);\r\n                }\r\n            }\r\n            if (key.toLowerCase() === \"+\") {\r\n                this.changeNoteLength(\"+\");\r\n            }\r\n            if (key.toLowerCase() === \"-\") {\r\n                this.changeNoteLength(\"-\");\r\n            }\r\n        });\r\n        this.controlTab.on(\"mouseovernote\", (section, note, string, position) => {\r\n            this.shadowIndicator.cx = position[0];\r\n            this.shadowIndicator.cy = position[1];\r\n        });\r\n        this.controlTab.on(\"mouseoutnote\", (section, note, string, position) => {\r\n            this.shadowIndicator.cx = -20;\r\n            this.shadowIndicator.cy = -20;\r\n        });\r\n        this.controlTab.on(\"mousedown\", (x, y) => {\r\n            y += this.controlTab.domElement.scrollTop;\r\n            if (this.dragNDropSection != null) {\r\n                this.dragNDropSection.remove();\r\n            }\r\n            this.dragNDropSection = this.controlTab.tabCanvas.layers.ui.createRect(0, 0, 0, 0, 5, \"rgba(255, 50, 0, 0.6)\");\r\n            this.dragStartPos = [x, y];\r\n            this.dragNDropSection.style = { display: \"none\" };\r\n            this.mouseDown = true;\r\n            this.mouseMove = false;\r\n            this.unselectSVGNotes();\r\n        });\r\n        //Mouse move event, handle with all quadrant of direction.\r\n        this.controlTab.on(\"mousemove\", (x, y) => {\r\n            y += this.controlTab.domElement.scrollTop;\r\n            if (this.mouseDown) {\r\n                if (Math.sqrt(Math.pow(x - this.dragStartPos[0], 2) + Math.pow(y - this.dragStartPos[1], 2)) > 1) {\r\n                    this.mouseMove = true;\r\n                    //Clear the empty note when clicking \r\n                    if (this.selectedBlock && this.controlTab.isBlankNote(this.selectedBlock.section, this.selectedBlock.note)) {\r\n                        this.controlTab.deleteNote(this.selectedBlock.section, this.selectedBlock.note);\r\n                        this.unselectNoteBlock();\r\n                        this.controlTab.render();\r\n                    }\r\n                }\r\n                if (this.mouseMove) {\r\n                    if (x - this.dragStartPos[0] >= 0) {\r\n                        this.dragNDropSection.x = this.dragStartPos[0];\r\n                    }\r\n                    else {\r\n                        this.dragNDropSection.x = x;\r\n                    }\r\n                    if (y - this.dragStartPos[1] >= 0) {\r\n                        this.dragNDropSection.y = this.dragStartPos[1];\r\n                    }\r\n                    else {\r\n                        this.dragNDropSection.y = y;\r\n                    }\r\n                    this.dragNDropSection.setShape(Math.abs(x - this.dragStartPos[0]), Math.abs(y - this.dragStartPos[1]));\r\n                    this.dragNDropSection.style = { display: \"unset\" };\r\n                }\r\n            }\r\n        });\r\n        this.controlTab.on(\"mouseup\", (x, y) => {\r\n            y += this.controlTab.domElement.scrollTop;\r\n            this.mouseDown = false;\r\n            if (this.mouseMove) {\r\n                let x1;\r\n                let y1;\r\n                let x2;\r\n                let y2;\r\n                this.dragNDropSection.remove();\r\n                if (x >= this.dragStartPos[0]) {\r\n                    x1 = this.dragStartPos[0];\r\n                    x2 = x;\r\n                }\r\n                else {\r\n                    x1 = x;\r\n                    x2 = this.dragStartPos[0];\r\n                }\r\n                if (y >= this.dragStartPos[1]) {\r\n                    y1 = this.dragStartPos[1];\r\n                    y2 = y;\r\n                }\r\n                else {\r\n                    y1 = y;\r\n                    y2 = this.dragStartPos[1];\r\n                }\r\n                this.selectedSVGNotes = this.controlTab.areaSelect(x1, y1, x2, y2);\r\n                this.drawMultiSelectRect(this.selectedSVGNotes);\r\n            }\r\n        });\r\n    }\r\n    selectNoteAndMoveIndicator(section, note, string) {\r\n        let np = this.controlTab.getNotePosition(section, note, string);\r\n        if (np[0] === -1)\r\n            return false;\r\n        this.setSelectNote(section, note, string);\r\n        this.setIndicator(np);\r\n        return true;\r\n    }\r\n    setNoteClickEvent(section, note, string, position) {\r\n        this.setSelectNote(section, note, string);\r\n        this.setIndicator(position);\r\n    }\r\n    setSelectNote(section, note, string) {\r\n        this.selectedBlock = { section: section, note: note, string: string };\r\n    }\r\n    setIndicator(position) {\r\n        this.indicator.cx = position[0];\r\n        this.indicator.cy = position[1];\r\n        //if(position[0] > 0)this.controlTab.scrollTo(position[1] - 166);\r\n    }\r\n    changeNoteLength(operater) {\r\n        let factor;\r\n        if (operater === \"+\") {\r\n            factor = 1;\r\n        }\r\n        else if (operater === \"-\") {\r\n            factor = 0;\r\n        }\r\n        else {\r\n            return;\r\n        }\r\n        if (this.selectedBlock) {\r\n            let lengthArray = [1, 2, 4, 8, 16, 32];\r\n            let selectData = this.controlTab.getNoteData(this.selectedBlock.section, this.selectedBlock.note);\r\n            for (let i = 1 - factor; i < lengthArray.length - factor; i++) {\r\n                if (lengthArray[i] === selectData[0]) {\r\n                    selectData[0] = lengthArray[i - 1 + factor * 2];\r\n                    this.controlTab.setNoteData(this.selectedBlock.section, this.selectedBlock.note, selectData);\r\n                    this.controlTab.render();\r\n                    this.selectNoteAndMoveIndicator(this.selectedBlock.section, this.selectedBlock.note, this.selectedBlock.string);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    selectRight(selectNote, controlTab) {\r\n        let s = this.selectNoteAndMoveIndicator(selectNote.section, selectNote.note + 1, selectNote.string);\r\n        if (!s) { // the current selection is the last note of the section\r\n            if (controlTab.isBlankNote(selectNote.section, selectNote.note)) {\r\n                // delete the blank note and move to next section in the second time pressing \"right\" key\r\n                let pl = controlTab.getNoteNumberOfSection(selectNote.section);\r\n                if (pl != 1) {\r\n                    controlTab.deleteNote(selectNote.section, selectNote.note);\r\n                    controlTab.render();\r\n                }\r\n                s = this.selectNoteAndMoveIndicator(selectNote.section + 1, 0, selectNote.string);\r\n                if (!s) { // the current selection is the last section and the last note\r\n                    controlTab.addNote(selectNote.section + 1, 0, [4, [-1, -1, -1, -1, -1, -1], null]);\r\n                    controlTab.render();\r\n                    this.selectNoteAndMoveIndicator(selectNote.section + 1, 0, selectNote.string);\r\n                }\r\n            }\r\n            else {\r\n                controlTab.addNote(selectNote.section, selectNote.note + 1, [4, [-1, -1, -1, -1, -1, -1], null]);\r\n                controlTab.render();\r\n                this.selectNoteAndMoveIndicator(selectNote.section, selectNote.note + 1, selectNote.string);\r\n            }\r\n        }\r\n        else {\r\n            //Minor modified, for insert function debugging. HaK.\r\n            // if(selectNote.note - 1 >= 0){\r\n            //     if(controlTab.isBlankNote(selectNote.section, selectNote.note - 1)){\r\n            //         controlTab.deleteNote(selectNote.section, selectNote.note - 1);\r\n            //         controlTab.render();\r\n            //         this.selectNoteAndMoveIndicator(selectNote.section , selectNote.note - 1, selectNote.string);\r\n            //     }\r\n            // }\r\n            if (controlTab.isBlankNote(selectNote.section, selectNote.note)) {\r\n                controlTab.deleteNote(selectNote.section, selectNote.note);\r\n                controlTab.render();\r\n                this.selectNoteAndMoveIndicator(selectNote.section, selectNote.note, selectNote.string);\r\n            }\r\n        }\r\n    }\r\n    selectLeft(selectNoteBlock, controlTab) {\r\n        if (selectNoteBlock.note === 0) {\r\n            if (selectNoteBlock.section > 0) {\r\n                let n = controlTab.getNoteNumberOfSection(selectNoteBlock.section - 1) - 1;\r\n                this.selectNoteAndMoveIndicator(selectNoteBlock.section - 1, n, selectNoteBlock.string);\r\n            }\r\n        }\r\n        else {\r\n            if (controlTab.isBlankNote(selectNoteBlock.section, selectNoteBlock.note)) {\r\n                controlTab.deleteNote(selectNoteBlock.section, selectNoteBlock.note);\r\n                controlTab.render();\r\n                this.selectNoteAndMoveIndicator(selectNoteBlock.section, selectNoteBlock.note - 1, selectNoteBlock.string);\r\n            }\r\n            else {\r\n                this.selectNoteAndMoveIndicator(selectNoteBlock.section, selectNoteBlock.note - 1, selectNoteBlock.string);\r\n            }\r\n        }\r\n    }\r\n    selectUp(selectNoteBlock, controlTab) {\r\n        if (selectNoteBlock.string > 0) {\r\n            this.selectNoteAndMoveIndicator(selectNoteBlock.section, selectNoteBlock.note, selectNoteBlock.string - 1);\r\n        }\r\n    }\r\n    selectDown(selectNoteBlock, controlTab) {\r\n        if (selectNoteBlock.string < 5) {\r\n            this.selectNoteAndMoveIndicator(selectNoteBlock.section, selectNoteBlock.note, selectNoteBlock.string + 1);\r\n        }\r\n    }\r\n    insertEmptyNote(selectedBlock) {\r\n        if (!this.controlTab.isBlankNote(this.selectedBlock.section, this.selectedBlock.note)) {\r\n            this.controlTab.addNote(this.selectedBlock.section, this.selectedBlock.note, [4, [-1, -1, -1, -1, -1, -1], null]);\r\n            this.selectedBlock = { section: this.selectedBlock.section, note: this.selectedBlock.note, string: this.selectedBlock.string };\r\n        }\r\n        return this.selectedBlock;\r\n    }\r\n    deleteNoteBlock(selectNoteBlock, controlTab) {\r\n        this.controlTab.setStringDataOfNote(selectNoteBlock.section, selectNoteBlock.note, selectNoteBlock.string, -1);\r\n        controlTab.render();\r\n    }\r\n    drawMultiSelectRect(selectedSVGNotes) {\r\n        //Sort out the selected lines.\r\n        let selectedLines = [];\r\n        for (let i = 0; i < selectedSVGNotes.length; i++) {\r\n            selectedLines.push(selectedSVGNotes[i].line);\r\n        }\r\n        let uniqueSelectedLines = selectedLines.filter(function (elem, index, self) {\r\n            return index == self.indexOf(elem);\r\n        });\r\n        if (selectedSVGNotes.length > 0) {\r\n            this.unselectNoteBlock();\r\n            let lineNotes = [];\r\n            for (let i = 0; i < uniqueSelectedLines.length; i++) {\r\n                let pushNotes = selectedSVGNotes.filter(function (elem, index, self) {\r\n                    return elem.line == uniqueSelectedLines[i];\r\n                });\r\n                lineNotes.push({ lineIndex: uniqueSelectedLines[i], notes: pushNotes });\r\n            }\r\n            for (let i = 0; i < lineNotes.length; i++) {\r\n                //let rectIndicatorLT = this.selectedNotes[0].blockGroup[0];\r\n                let rectIndicatorLT = lineNotes[i].notes[0].blockGroup[0];\r\n                //Indicator's right bottom note, which provideds position.\r\n                //let rectIndicatorRB = this.selectedNotes[this.selectedNotes.length-1].blockGroup[this.selectedNotes[this.selectedNotes.length-1].blockGroup.length-1];\r\n                let rectIndicatorRB = lineNotes[i].notes[lineNotes[i].notes.length - 1].blockGroup[lineNotes[i].notes[lineNotes[i].notes.length - 1].blockGroup.length - 1];\r\n                this.selectNotesIndicator.push(this.controlTab.tabCanvas.layers.ui.createRect(rectIndicatorLT.x - this.selectNotesIndicatorPadding, rectIndicatorLT.y - this.selectNotesIndicatorPadding, rectIndicatorRB.x - rectIndicatorLT.x + 2 * this.selectNotesIndicatorPadding, rectIndicatorRB.y - rectIndicatorLT.y + 2 * this.selectNotesIndicatorPadding, 5, \"rgba(255, 182, 45, 0.6)\"));\r\n            }\r\n        }\r\n    }\r\n    unselectSVGNotes() {\r\n        this.selectedSVGNotes = [];\r\n        if (this.selectNotesIndicator.length > 0) {\r\n            this.selectNotesIndicator.forEach((elem, index, self) => {\r\n                elem.remove();\r\n            });\r\n        }\r\n    }\r\n    unselectNoteBlock() {\r\n        this.selectedBlock = null;\r\n        this.setIndicator([-20, -20]);\r\n    }\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvU2xpbVRhYlYyRWRpdG9yLnRzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vc3JjL1NsaW1UYWJWMkVkaXRvci50cz9jNGUyIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IG5vdGUgfSBmcm9tIFwiLi9TbGltVGFiVjJUeXBlc1wiXG5pbXBvcnQgeyBTTFRhYiB9IGZyb20gXCIuL1NsaW1UYWJWMlwiXG5pbXBvcnQgeyB1dGlscyB9IGZyb20gXCIuL3V0aWxzXCI7XG5pbXBvcnQgeyBSZWN0LCBFbGxpcHNlLCBUZXh0LCBMaW5lLCBTVkdOb3RlLCBOb3RlQmxvY2t9IGZyb20gXCIuL1NsaW1UYWJWMkNhbnZhc1wiXG5cbmludGVyZmFjZSBOb3RlQmxvY2tJbmRleHtcbiAgICBzZWN0aW9uOiBudW1iZXI7XG4gICAgbm90ZTogbnVtYmVyO1xuICAgIHN0cmluZzogbnVtYmVyO1xufVxuXG5leHBvcnQgY2xhc3MgU0xFZGl0b3Ige1xuICAgIHByaXZhdGUgc2VsZWN0ZWRCbG9jazogTm90ZUJsb2NrSW5kZXg7XG4gICAgcHJpdmF0ZSBzZWxlY3RlZFNWR05vdGU6IFNWR05vdGU7XG4gICAgcHJpdmF0ZSBjb250cm9sVGFiOiBTTFRhYjtcbiAgICBwcml2YXRlIGluZGljYXRvcjogRWxsaXBzZTtcbiAgICBwcml2YXRlIHNoYWRvd0luZGljYXRvcjogRWxsaXBzZTtcbiAgICBwcml2YXRlIGlucHV0QmxvY2s6IG51bWJlciA9IDA7XG4gICAgcHJpdmF0ZSBkcmFnTkRyb3BTZWN0aW9uOiBSZWN0O1xuICAgIHByaXZhdGUgZHJhZ1N0YXJ0UG9zOiBudW1iZXJbXTtcbiAgICBwcml2YXRlIHNlbGVjdGVkU1ZHTm90ZXM6IFNWR05vdGVbXTtcbiAgICBwcml2YXRlIG1vdXNlRG93bjogYm9vbGVhbiA9IGZhbHNlO1xuICAgIHByaXZhdGUgbW91c2VNb3ZlOiBib29sZWFuID0gZmFsc2U7XG4gICAgcHJpdmF0ZSBzZWxlY3ROb3Rlc0luZGljYXRvcjogUmVjdFtdID0gW107XG4gICAgcHJpdmF0ZSBzZWxlY3ROb3Rlc0luZGljYXRvclBhZGRpbmc6IG51bWJlciA9IDg7XG5cbiAgICBjb25zdHJ1Y3Rvcihjb250cm9sVGFiOiBTTFRhYil7XG4gICAgICAgIHRoaXMuY29udHJvbFRhYiA9IGNvbnRyb2xUYWI7XG4gICAgICAgIHRoaXMuaW5kaWNhdG9yID0gdGhpcy5jb250cm9sVGFiLnRhYkNhbnZhcy5sYXllcnMudWkuY3JlYXRlRWxsaXBzZSgwLCAwICwgOCwgOCk7XG4gICAgICAgIHRoaXMuc2hhZG93SW5kaWNhdG9yID0gdGhpcy5jb250cm9sVGFiLnRhYkNhbnZhcy5sYXllcnMudWkuY3JlYXRlRWxsaXBzZSgwLCAwICwgOCwgOCk7XG4gICAgICAgIHRoaXMuaW5kaWNhdG9yLmN4ID0gLTIwO1xuICAgICAgICB0aGlzLmluZGljYXRvci5jeSA9IC0yMDtcbiAgICAgICAgdGhpcy5pbmRpY2F0b3IuZmlsbCA9IFwicmdiKDI1NSwgNTAsIDApXCJcbiAgICAgICAgdGhpcy5zaGFkb3dJbmRpY2F0b3IuY3ggPSAtMjA7XG4gICAgICAgIHRoaXMuc2hhZG93SW5kaWNhdG9yLmN5ID0gLTIwO1xuICAgICAgICB0aGlzLnNoYWRvd0luZGljYXRvci5maWxsID0gXCJyZ2JhKDI1NSwgNTAsIDAsIDAuNilcIjtcbiAgICAgICAgdGhpcy5kcmFnTkRyb3BTZWN0aW9uID0gdGhpcy5jb250cm9sVGFiLnRhYkNhbnZhcy5sYXllcnMudWkuY3JlYXRlUmVjdCgwLCAwLCAwLCAwLCAwLCBcInJnYmEoMjU1LCA1MCwgMCwgMC42KVwiKTtcbiAgICAgICAgdGhpcy5zZXRFdmVudHMoKTtcbiAgICB9XG4gICAgZ2V0IHNlbGVjdGVkTm90ZSgpOiBTVkdOb3Rle1xuICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3RlZFNWR05vdGU7XG4gICAgfVxuXG4gICAgZ2V0IFNlbGVjdGVkTm90ZXMoKTpTVkdOb3RlW117XG4gICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGVkU1ZHTm90ZXM7XG4gICAgfVxuXG4gICAgdW5kaXNwbGF5SW5kaWNhdG9yKCl7XG4gICAgICAgIHRoaXMuaW5kaWNhdG9yLnN0eWxlID0ge2Rpc3BsYXk6IFwibm9uZVwifTtcbiAgICAgICAgdGhpcy5zaGFkb3dJbmRpY2F0b3Iuc3R5bGUgPSB7ZGlzcGxheTogXCJub25lXCJ9O1xuICAgICAgICB0aGlzLnNlbGVjdE5vdGVzSW5kaWNhdG9yLmZvckVhY2goKGVsZW0sIGluZGV4LCBzZWxmKSA9PntcbiAgICAgICAgICAgIGVsZW0uc3R5bGUgPSB7ZGlzcGxheTogXCJub25lXCJ9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGRpc3BsYXlJbmRpY2F0b3IoKXtcbiAgICAgICAgdGhpcy5pbmRpY2F0b3Iuc3R5bGUgPSB7ZGlzcGxheTogXCJ1bnNldFwifTtcbiAgICAgICAgdGhpcy5zaGFkb3dJbmRpY2F0b3Iuc3R5bGUgPSB7ZGlzcGxheTogXCJ1bnNldFwifTtcbiAgICAgICAgdGhpcy5zZWxlY3ROb3Rlc0luZGljYXRvci5mb3JFYWNoKChlbGVtLCBpbmRleCwgc2VsZikgPT57XG4gICAgICAgICAgICBlbGVtLnN0eWxlID0ge2Rpc3BsYXk6IFwidW5zZXRcIn1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHByaXZhdGUgc2V0RXZlbnRzKCl7XG4gICAgICAgIHRoaXMuY29udHJvbFRhYi5vbihcIm5vdGVjbGlja1wiLCAoc2VjdGlvbiwgbm90ZSwgc3RyaW5nLCBwb3NpdGlvbikgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZXROb3RlQ2xpY2tFdmVudChzZWN0aW9uLCBub3RlLCBzdHJpbmcsIHBvc2l0aW9uKTtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRTVkdOb3RlID0gdGhpcy5jb250cm9sVGFiLmdldFNWR05vdGUoc2VjdGlvbiwgbm90ZSk7XG4gICAgICAgICAgICB0aGlzLnVuc2VsZWN0U1ZHTm90ZXMoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuY29udHJvbFRhYi5vbihcIm5vdGVzaGlmdGNsaWNrXCIsIChzZWN0aW9uLCBub3RlLCBzdHJpbmcsIHBvc2l0aW9uKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnVuc2VsZWN0U1ZHTm90ZXMoKTtcbiAgICAgICAgICAgIHRoaXMuY29udHJvbFRhYi5nZXRTVkdOb3RlKHNlY3Rpb24sIG5vdGUpXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkU1ZHTm90ZXMgPSB0aGlzLmNvbnRyb2xUYWIuZW5kc1NlbGVjdCh0aGlzLmNvbnRyb2xUYWIubm90ZUluZGV4KHRoaXMuc2VsZWN0ZWRTVkdOb3RlKSwgdGhpcy5jb250cm9sVGFiLm5vdGVJbmRleCh0aGlzLmNvbnRyb2xUYWIuZ2V0U1ZHTm90ZShzZWN0aW9uLCBub3RlKSkpXG4gICAgICAgICAgICB0aGlzLmRyYXdNdWx0aVNlbGVjdFJlY3QodGhpcy5zZWxlY3RlZFNWR05vdGVzKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuY29udHJvbFRhYi5vbihcImtleWRvd25cIiwgKGtleSkgPT4ge1xuICAgICAgICAgICAgaWYoKDxzdHJpbmc+a2V5KS50b0xvd2VyQ2FzZSgpICE9PSBcIiBcIiAmJiAhaXNOYU4oTnVtYmVyKGtleSkpKXtcbiAgICAgICAgICAgICAgICBpZih0aGlzLnNlbGVjdGVkQmxvY2spe1xuICAgICAgICAgICAgICAgICAgICBsZXQgdGIgPSB0aGlzLmlucHV0QmxvY2sgKiAxMCArIE51bWJlcihrZXkpXG4gICAgICAgICAgICAgICAgICAgIGlmKHRiIDwgNDApe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnB1dEJsb2NrID0gdGI7XG4gICAgICAgICAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnB1dEJsb2NrID0gTnVtYmVyKGtleSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250cm9sVGFiLnNldFN0cmluZ0RhdGFPZk5vdGUodGhpcy5zZWxlY3RlZEJsb2NrLnNlY3Rpb24sIHRoaXMuc2VsZWN0ZWRCbG9jay5ub3RlLCB0aGlzLnNlbGVjdGVkQmxvY2suc3RyaW5nLCB0aGlzLmlucHV0QmxvY2spO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xUYWIucmVuZGVyKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgdGhpcy5pbnB1dEJsb2NrID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKCg8c3RyaW5nPmtleSkudG9Mb3dlckNhc2UoKSA9PT0gXCJkXCIgfHwgKDxzdHJpbmc+a2V5KS50b0xvd2VyQ2FzZSgpID09PSBcImFycm93cmlnaHRcIil7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5zZWxlY3RlZFNWR05vdGVzLmxlbmd0aCA+IDApe1xuICAgICAgICAgICAgICAgICAgICBsZXQgcmlnaHRTaWRlQmxvY2sgPSB0aGlzLnNlbGVjdGVkU1ZHTm90ZXNbdGhpcy5zZWxlY3RlZFNWR05vdGVzLmxlbmd0aC0xXS5ibG9ja0dyb3VwWzBdXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRCbG9jayA9IHtzZWN0aW9uOiByaWdodFNpZGVCbG9jay5zZWN0aW9uLCBub3RlOnJpZ2h0U2lkZUJsb2NrLm5vdGUsIHN0cmluZzogcmlnaHRTaWRlQmxvY2suc3RyaW5nfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLnVuc2VsZWN0U1ZHTm90ZXMoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYodGhpcy5zZWxlY3RlZEJsb2NrKXtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RSaWdodCh0aGlzLnNlbGVjdGVkQmxvY2ssIHRoaXMuY29udHJvbFRhYik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoKDxzdHJpbmc+a2V5KS50b0xvd2VyQ2FzZSgpID09PSBcImFcIiB8fCAoPHN0cmluZz5rZXkpLnRvTG93ZXJDYXNlKCkgPT09IFwiYXJyb3dsZWZ0XCIpe1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2VsZWN0ZWRTVkdOb3Rlcy5sZW5ndGggPiAwKXtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGxlZnRTaWRlQmxvY2sgPSB0aGlzLnNlbGVjdGVkU1ZHTm90ZXNbMF0uYmxvY2tHcm91cFswXVxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkQmxvY2sgPSB7c2VjdGlvbjogbGVmdFNpZGVCbG9jay5zZWN0aW9uLCBub3RlOmxlZnRTaWRlQmxvY2subm90ZSwgc3RyaW5nOiBsZWZ0U2lkZUJsb2NrLnN0cmluZ31cbiAgICAgICAgICAgICAgICAgICAgdGhpcy51bnNlbGVjdFNWR05vdGVzKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2VsZWN0ZWRCbG9jayl7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0TGVmdCh0aGlzLnNlbGVjdGVkQmxvY2ssIHRoaXMuY29udHJvbFRhYik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoKDxzdHJpbmc+a2V5KS50b0xvd2VyQ2FzZSgpID09PSBcIndcIiB8fCAoPHN0cmluZz5rZXkpLnRvTG93ZXJDYXNlKCkgPT09IFwiYXJyb3d1cFwiKXtcbiAgICAgICAgICAgICAgICBpZih0aGlzLnNlbGVjdGVkU1ZHTm90ZXMubGVuZ3RoID4gMCl7XG4gICAgICAgICAgICAgICAgICAgIGxldCByaWdodFNpZGVCbG9jayA9IHRoaXMuc2VsZWN0ZWRTVkdOb3Rlc1t0aGlzLnNlbGVjdGVkU1ZHTm90ZXMubGVuZ3RoLTFdLmJsb2NrR3JvdXBbMF1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEJsb2NrID0ge3NlY3Rpb246IHJpZ2h0U2lkZUJsb2NrLnNlY3Rpb24sIG5vdGU6cmlnaHRTaWRlQmxvY2subm90ZSwgc3RyaW5nOiByaWdodFNpZGVCbG9jay5zdHJpbmd9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudW5zZWxlY3RTVkdOb3RlcygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZih0aGlzLnNlbGVjdGVkQmxvY2spe1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdFVwKHRoaXMuc2VsZWN0ZWRCbG9jaywgdGhpcy5jb250cm9sVGFiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZigoPHN0cmluZz5rZXkpLnRvTG93ZXJDYXNlKCkgPT09IFwic1wiIHx8ICg8c3RyaW5nPmtleSkudG9Mb3dlckNhc2UoKSA9PT0gXCJhcnJvd2Rvd25cIil7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5zZWxlY3RlZFNWR05vdGVzLmxlbmd0aCA+IDApe1xuICAgICAgICAgICAgICAgICAgICBsZXQgcmlnaHRTaWRlQmxvY2sgPSB0aGlzLnNlbGVjdGVkU1ZHTm90ZXNbdGhpcy5zZWxlY3RlZFNWR05vdGVzLmxlbmd0aC0xXS5ibG9ja0dyb3VwWzBdXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRCbG9jayA9IHtzZWN0aW9uOiByaWdodFNpZGVCbG9jay5zZWN0aW9uLCBub3RlOnJpZ2h0U2lkZUJsb2NrLm5vdGUsIHN0cmluZzogcmlnaHRTaWRlQmxvY2suc3RyaW5nfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLnVuc2VsZWN0U1ZHTm90ZXMoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYodGhpcy5zZWxlY3RlZEJsb2NrKXtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3REb3duKHRoaXMuc2VsZWN0ZWRCbG9jaywgdGhpcy5jb250cm9sVGFiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZigoPHN0cmluZz5rZXkpLnRvTG93ZXJDYXNlKCkgPT09IFwiaVwiICl7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5zZWxlY3RlZFNWR05vdGVzLmxlbmd0aCA+IDApe1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkQmxvY2sgPSB7c2VjdGlvbjogdGhpcy5zZWxlY3RlZFNWR05vdGVzWzBdLnNlY3Rpb24sIG5vdGU6IHRoaXMuc2VsZWN0ZWRTVkdOb3Rlc1swXS5ub3RlLCBzdHJpbmc6IDB9O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVuc2VsZWN0U1ZHTm90ZXMoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYodGhpcy5zZWxlY3RlZEJsb2NrKXtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGVtcHR5Tm90ZSA9IHRoaXMuaW5zZXJ0RW1wdHlOb3RlKHRoaXMuc2VsZWN0ZWRCbG9jayk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29udHJvbFRhYi5yZW5kZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3ROb3RlQW5kTW92ZUluZGljYXRvcihlbXB0eU5vdGUuc2VjdGlvbiwgZW1wdHlOb3RlLm5vdGUgLGVtcHR5Tm90ZS5zdHJpbmcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xUYWIucmVuZGVyKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZigoPHN0cmluZz5rZXkpLnRvTG93ZXJDYXNlKCkgPT09IFwiZGVsZXRlXCIgfHwgKDxzdHJpbmc+a2V5KS50b0xvd2VyQ2FzZSgpID09PSBcImJhY2tzcGFjZVwiKXtcbiAgICAgICAgICAgICAgICBpZih0aGlzLnNlbGVjdGVkU1ZHTm90ZXMubGVuZ3RoID4gMCl7XG4gICAgICAgICAgICAgICAgICAgIGZvcihsZXQgaSA9IHRoaXMuc2VsZWN0ZWRTVkdOb3Rlcy5sZW5ndGggLTE7IGkgPj0gMDsgaS0tKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29udHJvbFRhYi5kZWxldGVOb3RlKHRoaXMuc2VsZWN0ZWRTVkdOb3Rlc1tpXS5zZWN0aW9uLCB0aGlzLnNlbGVjdGVkU1ZHTm90ZXNbaV0ubm90ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xUYWIucmVuZGVyKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy51bnNlbGVjdFNWR05vdGVzKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYodGhpcy5zZWxlY3RlZEJsb2NrKXtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZWxldGVOb3RlQmxvY2sodGhpcy5zZWxlY3RlZEJsb2NrLCB0aGlzLmNvbnRyb2xUYWIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKCg8c3RyaW5nPmtleSkudG9Mb3dlckNhc2UoKSA9PT0gXCIrXCIpe1xuICAgICAgICAgICAgICAgIHRoaXMuY2hhbmdlTm90ZUxlbmd0aChcIitcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZigoPHN0cmluZz5rZXkpLnRvTG93ZXJDYXNlKCkgPT09IFwiLVwiKXtcbiAgICAgICAgICAgICAgICB0aGlzLmNoYW5nZU5vdGVMZW5ndGgoXCItXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5jb250cm9sVGFiLm9uKFwibW91c2VvdmVybm90ZVwiLCAoc2VjdGlvbiwgbm90ZSwgc3RyaW5nLCBwb3NpdGlvbikgPT4ge1xuICAgICAgICAgICAgdGhpcy5zaGFkb3dJbmRpY2F0b3IuY3ggPSBwb3NpdGlvblswXTtcbiAgICAgICAgICAgIHRoaXMuc2hhZG93SW5kaWNhdG9yLmN5ID0gcG9zaXRpb25bMV07XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmNvbnRyb2xUYWIub24oXCJtb3VzZW91dG5vdGVcIiwgKHNlY3Rpb24sIG5vdGUsIHN0cmluZywgcG9zaXRpb24pID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2hhZG93SW5kaWNhdG9yLmN4ID0gLTIwO1xuICAgICAgICAgICAgdGhpcy5zaGFkb3dJbmRpY2F0b3IuY3kgPSAtMjA7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmNvbnRyb2xUYWIub24oXCJtb3VzZWRvd25cIiwgKHgsIHkpID0+IHtcbiAgICAgICAgICAgIHkgKz0gdGhpcy5jb250cm9sVGFiLmRvbUVsZW1lbnQuc2Nyb2xsVG9wO1xuICAgICAgICAgICAgaWYodGhpcy5kcmFnTkRyb3BTZWN0aW9uICE9IG51bGwpe1xuICAgICAgICAgICAgICAgIHRoaXMuZHJhZ05Ecm9wU2VjdGlvbi5yZW1vdmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuZHJhZ05Ecm9wU2VjdGlvbiA9IHRoaXMuY29udHJvbFRhYi50YWJDYW52YXMubGF5ZXJzLnVpLmNyZWF0ZVJlY3QoMCwgMCwgMCwgMCwgNSwgXCJyZ2JhKDI1NSwgNTAsIDAsIDAuNilcIik7XG4gICAgICAgICAgICB0aGlzLmRyYWdTdGFydFBvcyA9IFt4LCB5XTtcbiAgICAgICAgICAgIHRoaXMuZHJhZ05Ecm9wU2VjdGlvbi5zdHlsZSA9IHtkaXNwbGF5OiBcIm5vbmVcIn07XG4gICAgICAgICAgICB0aGlzLm1vdXNlRG93biA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLm1vdXNlTW92ZSA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy51bnNlbGVjdFNWR05vdGVzKCk7XG4gICAgICAgIH0pO1xuICAgICAgICAvL01vdXNlIG1vdmUgZXZlbnQsIGhhbmRsZSB3aXRoIGFsbCBxdWFkcmFudCBvZiBkaXJlY3Rpb24uXG4gICAgICAgIHRoaXMuY29udHJvbFRhYi5vbihcIm1vdXNlbW92ZVwiLCAoeCwgeSkgPT4ge1xuICAgICAgICAgICAgeSArPSB0aGlzLmNvbnRyb2xUYWIuZG9tRWxlbWVudC5zY3JvbGxUb3A7XG4gICAgICAgICAgICBpZiAodGhpcy5tb3VzZURvd24pIHtcbiAgICAgICAgICAgICAgICBpZihNYXRoLnNxcnQoTWF0aC5wb3coeCAtIHRoaXMuZHJhZ1N0YXJ0UG9zWzBdLCAyKSArIE1hdGgucG93KHkgLSB0aGlzLmRyYWdTdGFydFBvc1sxXSwgMikpID4gMSl7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubW91c2VNb3ZlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgLy9DbGVhciB0aGUgZW1wdHkgbm90ZSB3aGVuIGNsaWNraW5nIFxuICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnNlbGVjdGVkQmxvY2sgJiYgdGhpcy5jb250cm9sVGFiLmlzQmxhbmtOb3RlKHRoaXMuc2VsZWN0ZWRCbG9jay5zZWN0aW9uLCB0aGlzLnNlbGVjdGVkQmxvY2subm90ZSkpe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250cm9sVGFiLmRlbGV0ZU5vdGUodGhpcy5zZWxlY3RlZEJsb2NrLnNlY3Rpb24gLCB0aGlzLnNlbGVjdGVkQmxvY2subm90ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVuc2VsZWN0Tm90ZUJsb2NrKClcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29udHJvbFRhYi5yZW5kZXIoKVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBcblxuICAgICAgICAgICAgICAgIGlmKHRoaXMubW91c2VNb3ZlKXtcbiAgICAgICAgICAgICAgICAgICAgaWYoeCAtIHRoaXMuZHJhZ1N0YXJ0UG9zWzBdID49IDApe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kcmFnTkRyb3BTZWN0aW9uLnggPSB0aGlzLmRyYWdTdGFydFBvc1swXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNle1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kcmFnTkRyb3BTZWN0aW9uLnggPSB4O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmKHkgLSB0aGlzLmRyYWdTdGFydFBvc1sxXSA+PSAwKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZHJhZ05Ecm9wU2VjdGlvbi55ID0gdGhpcy5kcmFnU3RhcnRQb3NbMV07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZHJhZ05Ecm9wU2VjdGlvbi55ID0geTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRyYWdORHJvcFNlY3Rpb24uc2V0U2hhcGUoTWF0aC5hYnMoeCAtIHRoaXMuZHJhZ1N0YXJ0UG9zWzBdKSwgTWF0aC5hYnMoeSAtIHRoaXMuZHJhZ1N0YXJ0UG9zWzFdKSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZHJhZ05Ecm9wU2VjdGlvbi5zdHlsZSA9IHtkaXNwbGF5OiBcInVuc2V0XCJ9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuY29udHJvbFRhYi5vbihcIm1vdXNldXBcIiwgKHgsIHkpID0+e1xuICAgICAgICAgICAgeSArPSB0aGlzLmNvbnRyb2xUYWIuZG9tRWxlbWVudC5zY3JvbGxUb3A7XG4gICAgICAgICAgICB0aGlzLm1vdXNlRG93biA9IGZhbHNlO1xuICAgICAgICAgICAgaWYodGhpcy5tb3VzZU1vdmUpe1xuICAgICAgICAgICAgICAgIGxldCB4MTogbnVtYmVyO1xuICAgICAgICAgICAgICAgIGxldCB5MTogbnVtYmVyO1xuICAgICAgICAgICAgICAgIGxldCB4MjogbnVtYmVyO1xuICAgICAgICAgICAgICAgIGxldCB5MjogbnVtYmVyO1xuICAgICAgICAgICAgICAgIHRoaXMuZHJhZ05Ecm9wU2VjdGlvbi5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICBpZiAoeCA+PSB0aGlzLmRyYWdTdGFydFBvc1swXSl7XG4gICAgICAgICAgICAgICAgICAgIHgxID0gdGhpcy5kcmFnU3RhcnRQb3NbMF07XG4gICAgICAgICAgICAgICAgICAgIHgyID0geDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgeDEgPSB4O1xuICAgICAgICAgICAgICAgICAgICB4MiA9IHRoaXMuZHJhZ1N0YXJ0UG9zWzBdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZih5ID49IHRoaXMuZHJhZ1N0YXJ0UG9zWzFdKXtcbiAgICAgICAgICAgICAgICAgICAgeTEgPSB0aGlzLmRyYWdTdGFydFBvc1sxXTtcbiAgICAgICAgICAgICAgICAgICAgeTIgPSB5O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNle1xuICAgICAgICAgICAgICAgICAgICB5MSA9IHk7XG4gICAgICAgICAgICAgICAgICAgIHkyID0gdGhpcy5kcmFnU3RhcnRQb3NbMV07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRTVkdOb3RlcyA9IHRoaXMuY29udHJvbFRhYi5hcmVhU2VsZWN0KHgxLCB5MSwgeDIsIHkyKTtcbiAgICAgICAgICAgICAgICB0aGlzLmRyYXdNdWx0aVNlbGVjdFJlY3QodGhpcy5zZWxlY3RlZFNWR05vdGVzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHByaXZhdGUgc2VsZWN0Tm90ZUFuZE1vdmVJbmRpY2F0b3Ioc2VjdGlvbjogbnVtYmVyLCBub3RlOiBudW1iZXIsIHN0cmluZzogbnVtYmVyKTogYm9vbGVhbntcbiAgICAgICAgbGV0IG5wID0gdGhpcy5jb250cm9sVGFiLmdldE5vdGVQb3NpdGlvbihzZWN0aW9uLCBub3RlLCBzdHJpbmcpO1xuICAgICAgICBpZihucFswXSA9PT0gLTEpcmV0dXJuIGZhbHNlO1xuICAgICAgICB0aGlzLnNldFNlbGVjdE5vdGUoc2VjdGlvbiwgbm90ZSwgc3RyaW5nKTtcbiAgICAgICAgdGhpcy5zZXRJbmRpY2F0b3IobnApO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcHJpdmF0ZSBzZXROb3RlQ2xpY2tFdmVudChzZWN0aW9uOiBudW1iZXIsIG5vdGU6IG51bWJlciwgc3RyaW5nOiBudW1iZXIsIHBvc2l0aW9uOiBudW1iZXJbXSl7XG4gICAgICAgIHRoaXMuc2V0U2VsZWN0Tm90ZShzZWN0aW9uLCBub3RlLCBzdHJpbmcpO1xuICAgICAgICB0aGlzLnNldEluZGljYXRvcihwb3NpdGlvbik7XG4gICAgfVxuICAgIHByaXZhdGUgc2V0U2VsZWN0Tm90ZShzZWN0aW9uOiBudW1iZXIsIG5vdGU6IG51bWJlciwgc3RyaW5nOiBudW1iZXIpe1xuICAgICAgICB0aGlzLnNlbGVjdGVkQmxvY2sgPSB7c2VjdGlvbjogc2VjdGlvbiwgbm90ZTogbm90ZSwgc3RyaW5nOiBzdHJpbmd9O1xuICAgIH1cbiAgICBwcml2YXRlIHNldEluZGljYXRvcihwb3NpdGlvbjogbnVtYmVyW10pe1xuICAgICAgICB0aGlzLmluZGljYXRvci5jeCA9IHBvc2l0aW9uWzBdO1xuICAgICAgICB0aGlzLmluZGljYXRvci5jeSA9IHBvc2l0aW9uWzFdO1xuICAgICAgICAvL2lmKHBvc2l0aW9uWzBdID4gMCl0aGlzLmNvbnRyb2xUYWIuc2Nyb2xsVG8ocG9zaXRpb25bMV0gLSAxNjYpO1xuICAgIH1cbiAgICBwcml2YXRlIGNoYW5nZU5vdGVMZW5ndGgob3BlcmF0ZXI6IHN0cmluZyl7XG4gICAgICAgIGxldCBmYWN0b3I6IG51bWJlcjtcbiAgICAgICAgaWYob3BlcmF0ZXIgPT09IFwiK1wiKXtcbiAgICAgICAgICAgIGZhY3RvciA9IDE7XG4gICAgICAgIH1lbHNlIGlmKG9wZXJhdGVyID09PSBcIi1cIil7XG4gICAgICAgICAgICBmYWN0b3IgPSAwO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZih0aGlzLnNlbGVjdGVkQmxvY2spe1xuICAgICAgICAgICAgbGV0IGxlbmd0aEFycmF5ID0gWzEsIDIsIDQsIDgsIDE2LCAzMl07XG4gICAgICAgICAgICBsZXQgc2VsZWN0RGF0YSA9IHRoaXMuY29udHJvbFRhYi5nZXROb3RlRGF0YSh0aGlzLnNlbGVjdGVkQmxvY2suc2VjdGlvbiwgdGhpcy5zZWxlY3RlZEJsb2NrLm5vdGUpO1xuICAgICAgICAgICAgZm9yKGxldCBpID0gMSAtIGZhY3RvciA7IGkgPCBsZW5ndGhBcnJheS5sZW5ndGggLSBmYWN0b3I7IGkrKyl7XG4gICAgICAgICAgICAgICAgaWYobGVuZ3RoQXJyYXlbaV0gPT09IHNlbGVjdERhdGFbMF0pe1xuICAgICAgICAgICAgICAgICAgICBzZWxlY3REYXRhWzBdID0gbGVuZ3RoQXJyYXlbaSAtIDEgKyBmYWN0b3IgKiAyXTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250cm9sVGFiLnNldE5vdGVEYXRhKHRoaXMuc2VsZWN0ZWRCbG9jay5zZWN0aW9uLCB0aGlzLnNlbGVjdGVkQmxvY2subm90ZSwgc2VsZWN0RGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29udHJvbFRhYi5yZW5kZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3ROb3RlQW5kTW92ZUluZGljYXRvcih0aGlzLnNlbGVjdGVkQmxvY2suc2VjdGlvbiwgdGhpcy5zZWxlY3RlZEJsb2NrLm5vdGUsIHRoaXMuc2VsZWN0ZWRCbG9jay5zdHJpbmcpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgcHJpdmF0ZSBzZWxlY3RSaWdodChzZWxlY3ROb3RlOiBOb3RlQmxvY2tJbmRleCwgY29udHJvbFRhYjogU0xUYWIpe1xuICAgICAgICBsZXQgcyA9IHRoaXMuc2VsZWN0Tm90ZUFuZE1vdmVJbmRpY2F0b3Ioc2VsZWN0Tm90ZS5zZWN0aW9uLCBzZWxlY3ROb3RlLm5vdGUgKyAxLCBzZWxlY3ROb3RlLnN0cmluZyk7XG4gICAgICAgIGlmKCFzKXsgLy8gdGhlIGN1cnJlbnQgc2VsZWN0aW9uIGlzIHRoZSBsYXN0IG5vdGUgb2YgdGhlIHNlY3Rpb25cbiAgICAgICAgICAgIGlmKGNvbnRyb2xUYWIuaXNCbGFua05vdGUoc2VsZWN0Tm90ZS5zZWN0aW9uLCBzZWxlY3ROb3RlLm5vdGUpKXtcbiAgICAgICAgICAgICAgICAvLyBkZWxldGUgdGhlIGJsYW5rIG5vdGUgYW5kIG1vdmUgdG8gbmV4dCBzZWN0aW9uIGluIHRoZSBzZWNvbmQgdGltZSBwcmVzc2luZyBcInJpZ2h0XCIga2V5XG4gICAgICAgICAgICAgICAgbGV0IHBsID0gY29udHJvbFRhYi5nZXROb3RlTnVtYmVyT2ZTZWN0aW9uKHNlbGVjdE5vdGUuc2VjdGlvbik7XG4gICAgICAgICAgICAgICAgaWYocGwgIT0gMSl7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xUYWIuZGVsZXRlTm90ZShzZWxlY3ROb3RlLnNlY3Rpb24gLCBzZWxlY3ROb3RlLm5vdGUpO1xuICAgICAgICAgICAgICAgICAgICBjb250cm9sVGFiLnJlbmRlcigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzID0gdGhpcy5zZWxlY3ROb3RlQW5kTW92ZUluZGljYXRvcihzZWxlY3ROb3RlLnNlY3Rpb24gKyAxLCAwLCBzZWxlY3ROb3RlLnN0cmluZyk7XG4gICAgICAgICAgICAgICAgaWYoIXMpeyAvLyB0aGUgY3VycmVudCBzZWxlY3Rpb24gaXMgdGhlIGxhc3Qgc2VjdGlvbiBhbmQgdGhlIGxhc3Qgbm90ZVxuICAgICAgICAgICAgICAgICAgICBjb250cm9sVGFiLmFkZE5vdGUoc2VsZWN0Tm90ZS5zZWN0aW9uICsgMSwgMCwgWzQsIFstMSwgLTEsIC0xLCAtMSwgLTEsLTFdLCBudWxsXSk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xUYWIucmVuZGVyKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0Tm90ZUFuZE1vdmVJbmRpY2F0b3Ioc2VsZWN0Tm90ZS5zZWN0aW9uICsgMSwgMCwgc2VsZWN0Tm90ZS5zdHJpbmcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgIGNvbnRyb2xUYWIuYWRkTm90ZShzZWxlY3ROb3RlLnNlY3Rpb24sIHNlbGVjdE5vdGUubm90ZSArIDEsIFs0LCBbLTEsIC0xLCAtMSwgLTEsIC0xLC0xXSwgbnVsbF0pO1xuICAgICAgICAgICAgICAgIGNvbnRyb2xUYWIucmVuZGVyKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3ROb3RlQW5kTW92ZUluZGljYXRvcihzZWxlY3ROb3RlLnNlY3Rpb24sIHNlbGVjdE5vdGUubm90ZSArIDEsIHNlbGVjdE5vdGUuc3RyaW5nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAvL01pbm9yIG1vZGlmaWVkLCBmb3IgaW5zZXJ0IGZ1bmN0aW9uIGRlYnVnZ2luZy4gSGFLLlxuICAgICAgICAgICAgLy8gaWYoc2VsZWN0Tm90ZS5ub3RlIC0gMSA+PSAwKXtcbiAgICAgICAgICAgIC8vICAgICBpZihjb250cm9sVGFiLmlzQmxhbmtOb3RlKHNlbGVjdE5vdGUuc2VjdGlvbiwgc2VsZWN0Tm90ZS5ub3RlIC0gMSkpe1xuICAgICAgICAgICAgLy8gICAgICAgICBjb250cm9sVGFiLmRlbGV0ZU5vdGUoc2VsZWN0Tm90ZS5zZWN0aW9uLCBzZWxlY3ROb3RlLm5vdGUgLSAxKTtcbiAgICAgICAgICAgIC8vICAgICAgICAgY29udHJvbFRhYi5yZW5kZXIoKTtcbiAgICAgICAgICAgIC8vICAgICAgICAgdGhpcy5zZWxlY3ROb3RlQW5kTW92ZUluZGljYXRvcihzZWxlY3ROb3RlLnNlY3Rpb24gLCBzZWxlY3ROb3RlLm5vdGUgLSAxLCBzZWxlY3ROb3RlLnN0cmluZyk7XG4gICAgICAgICAgICAvLyAgICAgfVxuICAgICAgICAgICAgLy8gfVxuICAgICAgICAgICAgaWYoY29udHJvbFRhYi5pc0JsYW5rTm90ZShzZWxlY3ROb3RlLnNlY3Rpb24sIHNlbGVjdE5vdGUubm90ZSkpe1xuICAgICAgICAgICAgICAgIGNvbnRyb2xUYWIuZGVsZXRlTm90ZShzZWxlY3ROb3RlLnNlY3Rpb24sIHNlbGVjdE5vdGUubm90ZSk7XG4gICAgICAgICAgICAgICAgY29udHJvbFRhYi5yZW5kZXIoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdE5vdGVBbmRNb3ZlSW5kaWNhdG9yKHNlbGVjdE5vdGUuc2VjdGlvbiAsIHNlbGVjdE5vdGUubm90ZSwgc2VsZWN0Tm90ZS5zdHJpbmcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHByaXZhdGUgc2VsZWN0TGVmdChzZWxlY3ROb3RlQmxvY2s6IE5vdGVCbG9ja0luZGV4LCBjb250cm9sVGFiOiBTTFRhYil7XG4gICAgICAgIGlmKHNlbGVjdE5vdGVCbG9jay5ub3RlID09PSAwKXtcbiAgICAgICAgICAgIGlmKHNlbGVjdE5vdGVCbG9jay5zZWN0aW9uID4gMCl7XG4gICAgICAgICAgICAgICAgbGV0IG4gPSBjb250cm9sVGFiLmdldE5vdGVOdW1iZXJPZlNlY3Rpb24oc2VsZWN0Tm90ZUJsb2NrLnNlY3Rpb24gLSAxKSAtIDE7XG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3ROb3RlQW5kTW92ZUluZGljYXRvcihzZWxlY3ROb3RlQmxvY2suc2VjdGlvbiAtIDEsIG4gLHNlbGVjdE5vdGVCbG9jay5zdHJpbmcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIGlmKGNvbnRyb2xUYWIuaXNCbGFua05vdGUoc2VsZWN0Tm90ZUJsb2NrLnNlY3Rpb24sIHNlbGVjdE5vdGVCbG9jay5ub3RlKSl7XG4gICAgICAgICAgICAgICAgY29udHJvbFRhYi5kZWxldGVOb3RlKHNlbGVjdE5vdGVCbG9jay5zZWN0aW9uLCBzZWxlY3ROb3RlQmxvY2subm90ZSk7XG4gICAgICAgICAgICAgICAgY29udHJvbFRhYi5yZW5kZXIoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdE5vdGVBbmRNb3ZlSW5kaWNhdG9yKHNlbGVjdE5vdGVCbG9jay5zZWN0aW9uICwgc2VsZWN0Tm90ZUJsb2NrLm5vdGUgLSAxLCBzZWxlY3ROb3RlQmxvY2suc3RyaW5nKTtcbiAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0Tm90ZUFuZE1vdmVJbmRpY2F0b3Ioc2VsZWN0Tm90ZUJsb2NrLnNlY3Rpb24sIHNlbGVjdE5vdGVCbG9jay5ub3RlIC0gMSAsc2VsZWN0Tm90ZUJsb2NrLnN0cmluZyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgcHJpdmF0ZSBzZWxlY3RVcChzZWxlY3ROb3RlQmxvY2s6IE5vdGVCbG9ja0luZGV4LCBjb250cm9sVGFiOiBTTFRhYil7XG4gICAgICAgIGlmKHNlbGVjdE5vdGVCbG9jay5zdHJpbmcgPiAwKXtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0Tm90ZUFuZE1vdmVJbmRpY2F0b3Ioc2VsZWN0Tm90ZUJsb2NrLnNlY3Rpb24sIHNlbGVjdE5vdGVCbG9jay5ub3RlICxzZWxlY3ROb3RlQmxvY2suc3RyaW5nIC0gMSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcHJpdmF0ZSBzZWxlY3REb3duKHNlbGVjdE5vdGVCbG9jazogTm90ZUJsb2NrSW5kZXgsIGNvbnRyb2xUYWI6IFNMVGFiKXtcbiAgICAgICAgaWYoc2VsZWN0Tm90ZUJsb2NrLnN0cmluZyA8IDUpe1xuICAgICAgICAgICAgdGhpcy5zZWxlY3ROb3RlQW5kTW92ZUluZGljYXRvcihzZWxlY3ROb3RlQmxvY2suc2VjdGlvbiwgc2VsZWN0Tm90ZUJsb2NrLm5vdGUgLHNlbGVjdE5vdGVCbG9jay5zdHJpbmcgKyAxKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBwcml2YXRlIGluc2VydEVtcHR5Tm90ZShzZWxlY3RlZEJsb2NrOiBOb3RlQmxvY2tJbmRleCk6IE5vdGVCbG9ja0luZGV4e1xuICAgICAgICBpZighdGhpcy5jb250cm9sVGFiLmlzQmxhbmtOb3RlKHRoaXMuc2VsZWN0ZWRCbG9jay5zZWN0aW9uLCB0aGlzLnNlbGVjdGVkQmxvY2subm90ZSkpe1xuICAgICAgICAgICAgdGhpcy5jb250cm9sVGFiLmFkZE5vdGUodGhpcy5zZWxlY3RlZEJsb2NrLnNlY3Rpb24sIHRoaXMuc2VsZWN0ZWRCbG9jay5ub3RlLCBbNCwgWy0xLCAtMSwgLTEsIC0xLCAtMSwtMV0sIG51bGxdKTtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRCbG9jayA9IHtzZWN0aW9uOiB0aGlzLnNlbGVjdGVkQmxvY2suc2VjdGlvbiwgbm90ZTogdGhpcy5zZWxlY3RlZEJsb2NrLm5vdGUsIHN0cmluZzogdGhpcy5zZWxlY3RlZEJsb2NrLnN0cmluZ307XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0ZWRCbG9ja1xuICAgIH1cbiAgICBwcml2YXRlIGRlbGV0ZU5vdGVCbG9jayhzZWxlY3ROb3RlQmxvY2s6IE5vdGVCbG9ja0luZGV4LCBjb250cm9sVGFiOiBTTFRhYil7XG4gICAgICAgIHRoaXMuY29udHJvbFRhYi5zZXRTdHJpbmdEYXRhT2ZOb3RlKHNlbGVjdE5vdGVCbG9jay5zZWN0aW9uLCBzZWxlY3ROb3RlQmxvY2subm90ZSwgc2VsZWN0Tm90ZUJsb2NrLnN0cmluZywgLTEpO1xuICAgICAgICBjb250cm9sVGFiLnJlbmRlcigpO1xuICAgIH1cbiAgICBwcml2YXRlIGRyYXdNdWx0aVNlbGVjdFJlY3Qoc2VsZWN0ZWRTVkdOb3RlczogU1ZHTm90ZVtdKXtcbiAgICAgICAgLy9Tb3J0IG91dCB0aGUgc2VsZWN0ZWQgbGluZXMuXG4gICAgICAgIGxldCBzZWxlY3RlZExpbmVzOiBudW1iZXJbXSA9IFtdO1xuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgc2VsZWN0ZWRTVkdOb3Rlcy5sZW5ndGg7IGkrKyl7XG4gICAgICAgICAgICBzZWxlY3RlZExpbmVzLnB1c2goc2VsZWN0ZWRTVkdOb3Rlc1tpXS5saW5lKTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgdW5pcXVlU2VsZWN0ZWRMaW5lcyA9IHNlbGVjdGVkTGluZXMuZmlsdGVyKGZ1bmN0aW9uKGVsZW0sIGluZGV4LCBzZWxmKXtcbiAgICAgICAgICAgIHJldHVybiBpbmRleCA9PSBzZWxmLmluZGV4T2YoZWxlbSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChzZWxlY3RlZFNWR05vdGVzLmxlbmd0aCA+IDApe1xuICAgICAgICAgICAgdGhpcy51bnNlbGVjdE5vdGVCbG9jaygpO1xuICAgICAgICAgICAgdHlwZSBsaW5lT2JqID0ge1xuICAgICAgICAgICAgICAgIGxpbmVJbmRleDogbnVtYmVyO1xuICAgICAgICAgICAgICAgIG5vdGVzOiBTVkdOb3RlW107XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgbGV0IGxpbmVOb3RlczogbGluZU9ialtdID0gW107XG4gICAgICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgdW5pcXVlU2VsZWN0ZWRMaW5lcy5sZW5ndGg7IGkrKyl7XG4gICAgICAgICAgICAgICAgbGV0IHB1c2hOb3RlcyA9IHNlbGVjdGVkU1ZHTm90ZXMuZmlsdGVyKGZ1bmN0aW9uKGVsZW0sIGluZGV4LCBzZWxmKXtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW0ubGluZSA9PSB1bmlxdWVTZWxlY3RlZExpbmVzW2ldXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgbGluZU5vdGVzLnB1c2goe2xpbmVJbmRleDogdW5pcXVlU2VsZWN0ZWRMaW5lc1tpXSwgbm90ZXM6IHB1c2hOb3Rlc30pXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgbGluZU5vdGVzLmxlbmd0aDsgaSsrKXtcbiAgICAgICAgICAgICAgICAvL2xldCByZWN0SW5kaWNhdG9yTFQgPSB0aGlzLnNlbGVjdGVkTm90ZXNbMF0uYmxvY2tHcm91cFswXTtcbiAgICAgICAgICAgICAgICBsZXQgcmVjdEluZGljYXRvckxUID0gbGluZU5vdGVzW2ldLm5vdGVzWzBdLmJsb2NrR3JvdXBbMF07XG4gICAgICAgICAgICAgICAgLy9JbmRpY2F0b3IncyByaWdodCBib3R0b20gbm90ZSwgd2hpY2ggcHJvdmlkZWRzIHBvc2l0aW9uLlxuICAgICAgICAgICAgICAgIC8vbGV0IHJlY3RJbmRpY2F0b3JSQiA9IHRoaXMuc2VsZWN0ZWROb3Rlc1t0aGlzLnNlbGVjdGVkTm90ZXMubGVuZ3RoLTFdLmJsb2NrR3JvdXBbdGhpcy5zZWxlY3RlZE5vdGVzW3RoaXMuc2VsZWN0ZWROb3Rlcy5sZW5ndGgtMV0uYmxvY2tHcm91cC5sZW5ndGgtMV07XG4gICAgICAgICAgICAgICAgbGV0IHJlY3RJbmRpY2F0b3JSQiA9IGxpbmVOb3Rlc1tpXS5ub3Rlc1tsaW5lTm90ZXNbaV0ubm90ZXMubGVuZ3RoIC0gMV0uYmxvY2tHcm91cFtsaW5lTm90ZXNbaV0ubm90ZXNbbGluZU5vdGVzW2ldLm5vdGVzLmxlbmd0aCAtIDFdLmJsb2NrR3JvdXAubGVuZ3RoIC0gMV07XG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3ROb3Rlc0luZGljYXRvci5wdXNoKHRoaXMuY29udHJvbFRhYi50YWJDYW52YXMubGF5ZXJzLnVpLmNyZWF0ZVJlY3QoXG4gICAgICAgICAgICAgICAgICAgIHJlY3RJbmRpY2F0b3JMVC54IC0gdGhpcy5zZWxlY3ROb3Rlc0luZGljYXRvclBhZGRpbmcsIFxuICAgICAgICAgICAgICAgICAgICByZWN0SW5kaWNhdG9yTFQueSAtIHRoaXMuc2VsZWN0Tm90ZXNJbmRpY2F0b3JQYWRkaW5nLCBcbiAgICAgICAgICAgICAgICAgICAgcmVjdEluZGljYXRvclJCLnggLSByZWN0SW5kaWNhdG9yTFQueCArIDIgKiB0aGlzLnNlbGVjdE5vdGVzSW5kaWNhdG9yUGFkZGluZywgXG4gICAgICAgICAgICAgICAgICAgIHJlY3RJbmRpY2F0b3JSQi55IC0gcmVjdEluZGljYXRvckxULnkgKyAyICogdGhpcy5zZWxlY3ROb3Rlc0luZGljYXRvclBhZGRpbmcsIFxuICAgICAgICAgICAgICAgICAgICA1LCBcbiAgICAgICAgICAgICAgICAgICAgXCJyZ2JhKDI1NSwgMTgyLCA0NSwgMC42KVwiXG4gICAgICAgICAgICAgICAgKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgcHJpdmF0ZSB1bnNlbGVjdFNWR05vdGVzKCl7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRTVkdOb3RlcyA9IFtdXG4gICAgICAgIGlmKHRoaXMuc2VsZWN0Tm90ZXNJbmRpY2F0b3IubGVuZ3RoID4gMCl7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdE5vdGVzSW5kaWNhdG9yLmZvckVhY2goKGVsZW0sIGluZGV4LCBzZWxmKSA9PntcbiAgICAgICAgICAgICAgICBlbGVtLnJlbW92ZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcHJpdmF0ZSB1bnNlbGVjdE5vdGVCbG9jaygpe1xuICAgICAgICB0aGlzLnNlbGVjdGVkQmxvY2sgPSBudWxsO1xuICAgICAgICB0aGlzLnNldEluZGljYXRvcihbLTIwLCAtMjBdKTtcbiAgICB9XG59Il0sIm1hcHBpbmdzIjoiQUFXQTtBQUFBO0FBQUE7QUFlQTtBQVRBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/SlimTabV2Editor.ts\n");

/***/ }),

/***/ "./src/Timer.ts":
/*!**********************!*\
  !*** ./src/Timer.ts ***!
  \**********************/
/*! exports provided: Timer */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Timer\", function() { return Timer; });\nclass Timer {\r\n    constructor() {\r\n        this._running = false;\r\n        this._systemTime = 0;\r\n        this.lastTime = 0;\r\n        this.delay = 33;\r\n        this.funcs = [];\r\n        this.timerId = null;\r\n        this.executeFuncs = [];\r\n    }\r\n    searchIndex(time) {\r\n        let funcs = this.executeFuncs;\r\n        let low = 0;\r\n        let high = funcs.length;\r\n        let mid = 0;\r\n        while (low < high) {\r\n            mid = Math.floor(low + (high - low) / 2);\r\n            if (time >= funcs[mid].time) {\r\n                low = mid + 1;\r\n            }\r\n            else {\r\n                high = mid - 1;\r\n            }\r\n        }\r\n        return low;\r\n    }\r\n    register(func) {\r\n        if (this.funcs.indexOf(func)) {\r\n            return;\r\n        }\r\n        this.funcs.push(func);\r\n    }\r\n    registerDelay(func, delay, loop = 1) {\r\n        let time = this._systemTime + delay;\r\n        this.registerDelayP(func, delay, time, loop);\r\n    }\r\n    unregister(func) {\r\n        this.funcs.map((value, index) => {\r\n            if (func === value) {\r\n                this.funcs.splice(index, 1);\r\n            }\r\n        });\r\n    }\r\n    start(systemTime = 0) {\r\n        if (this._running) {\r\n            return;\r\n        }\r\n        this._running = true;\r\n        this._systemTime = systemTime;\r\n        this.lastTime = new Date().getTime();\r\n        this.update();\r\n    }\r\n    stop() {\r\n        if (this.timerId) {\r\n            clearTimeout(this.timerId - 1);\r\n            clearTimeout(this.timerId);\r\n            clearTimeout(this.timerId + 1);\r\n            this.timerId = null;\r\n        }\r\n        this._running = false;\r\n        this._systemTime = 0;\r\n        this.lastTime = 0;\r\n        this.clearFuncs();\r\n        this.clearDelayFuncs();\r\n    }\r\n    update() {\r\n        let currentTime = new Date().getTime();\r\n        let delay = currentTime - this.lastTime;\r\n        this._systemTime += delay;\r\n        this.funcs.forEach((value) => {\r\n            value(delay);\r\n        });\r\n        this.executeFunc();\r\n        this.lastTime = currentTime;\r\n        if (this._running)\r\n            this.timerId = setTimeout(this.update.bind(this), this.delay);\r\n    }\r\n    executeFunc() {\r\n        if (this.executeFuncs[0] && this.executeFuncs[0].time < this._systemTime) {\r\n            let value = this.executeFuncs.shift();\r\n            value.func();\r\n            this.executeFunc();\r\n            // loop <= 0 will be infinite loop\r\n            if (value.loop > 0 && --value.loop === 0) {\r\n                return;\r\n            }\r\n            let nextTime = value.time + value.delay;\r\n            this.registerDelayP(value.func, value.delay, nextTime, value.loop);\r\n        }\r\n    }\r\n    clearFuncs() {\r\n        this.funcs = [];\r\n    }\r\n    clearDelayFuncs() {\r\n        this.executeFuncs = [];\r\n    }\r\n    registerDelayP(func, delay, time, loop) {\r\n        let index = this.searchIndex(time);\r\n        let value = { func: func, delay: delay, time: time, loop: loop };\r\n        this.executeFuncs.splice(index, 0, value);\r\n    }\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvVGltZXIudHMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvVGltZXIudHM/NTBkOCJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY2xhc3MgVGltZXJ7XG4gICAgX3J1bm5pbmc6IGJvb2xlYW4gPSBmYWxzZTtcbiAgICBfc3lzdGVtVGltZTogbnVtYmVyID0gMDtcbiAgICBsYXN0VGltZTogbnVtYmVyID0gMDtcbiAgICBkZWxheTogbnVtYmVyID0gMzM7XG4gICAgZnVuY3M6IEFycmF5PEZ1bmN0aW9uPiA9IFtdO1xuICAgIHRpbWVySWQ6IG51bWJlciA9IG51bGw7XG4gICAgZXhlY3V0ZUZ1bmNzOiBBcnJheTxFeGVjdXRlVmFsdWU+ID0gW107XG5cblxuICAgIGNvbnN0cnVjdG9yKCl7fVxuXG4gICAgc2VhcmNoSW5kZXgodGltZTogbnVtYmVyKXtcbiAgICAgICAgbGV0IGZ1bmNzOiBBcnJheTxFeGVjdXRlVmFsdWU+ID0gdGhpcy5leGVjdXRlRnVuY3M7XG4gICAgICAgIGxldCBsb3c6IG51bWJlciA9IDA7XG4gICAgICAgIGxldCBoaWdoOiBudW1iZXIgPSBmdW5jcy5sZW5ndGg7XG4gICAgICAgIGxldCBtaWQ6IG51bWJlciA9IDA7XG4gICAgICAgIHdoaWxlIChsb3cgPCBoaWdoKXtcbiAgICAgICAgICAgIG1pZCA9IE1hdGguZmxvb3IobG93ICsgKGhpZ2ggLSBsb3cpLzIpO1xuICAgICAgICAgICAgaWYodGltZSA+PSBmdW5jc1ttaWRdLnRpbWUpe1xuICAgICAgICAgICAgICAgIGxvdyA9IG1pZCArMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2V7XG4gICAgICAgICAgICAgICAgaGlnaCA9IG1pZCAtMTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBsb3c7XG4gICAgfVxuXG4gICAgcmVnaXN0ZXIoZnVuYzogRnVuY3Rpb24pe1xuICAgICAgICBpZiAodGhpcy5mdW5jcy5pbmRleE9mKGZ1bmMpKXtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmZ1bmNzLnB1c2goZnVuYyk7XG4gICAgfVxuXG4gICAgcmVnaXN0ZXJEZWxheShmdW5jOiBGdW5jdGlvbiwgZGVsYXk6bnVtYmVyLCBsb29wOiBudW1iZXIgPSAxKXtcbiAgICAgICAgbGV0IHRpbWU6IG51bWJlciA9IHRoaXMuX3N5c3RlbVRpbWUgKyBkZWxheTtcbiAgICAgICAgdGhpcy5yZWdpc3RlckRlbGF5UChmdW5jLCBkZWxheSwgdGltZSwgbG9vcCk7XG4gICAgfVxuICAgIFxuICAgIHVucmVnaXN0ZXIgKGZ1bmM6IEZ1bmN0aW9uKSB7XG4gICAgICAgIHRoaXMuZnVuY3MubWFwKCh2YWx1ZTogRnVuY3Rpb24sIGluZGV4OiBudW1iZXIpID0+IHtcbiAgICAgICAgICAgIGlmIChmdW5jID09PSB2YWx1ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZnVuY3Muc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgc3RhcnQoc3lzdGVtVGltZTogbnVtYmVyID0gMCl7XG4gICAgICAgIGlmKHRoaXMuX3J1bm5pbmcpe1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3J1bm5pbmcgPSB0cnVlO1xuICAgICAgICB0aGlzLl9zeXN0ZW1UaW1lID0gc3lzdGVtVGltZTtcbiAgICAgICAgdGhpcy5sYXN0VGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgICAgICB0aGlzLnVwZGF0ZSgpO1xuICAgIH1cblxuICAgIHN0b3AoKXtcbiAgICAgICAgaWYodGhpcy50aW1lcklkKXtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnRpbWVySWQgLSAxKTtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnRpbWVySWQpO1xuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMudGltZXJJZCArIDEpO1xuICAgICAgICAgICAgdGhpcy50aW1lcklkID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9ydW5uaW5nID0gZmFsc2U7XG4gICAgICAgIHRoaXMuX3N5c3RlbVRpbWUgPSAwO1xuICAgICAgICB0aGlzLmxhc3RUaW1lID0gMDtcbiAgICAgICAgdGhpcy5jbGVhckZ1bmNzKCk7XG4gICAgICAgIHRoaXMuY2xlYXJEZWxheUZ1bmNzKCk7XG4gICAgfVxuXG4gICAgdXBkYXRlKCl7XG4gICAgICAgIGxldCBjdXJyZW50VGltZTogbnVtYmVyID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7IFxuICAgICAgICBsZXQgZGVsYXk6IG51bWJlciA9IGN1cnJlbnRUaW1lIC0gdGhpcy5sYXN0VGltZTtcbiAgICAgICAgdGhpcy5fc3lzdGVtVGltZSArPSBkZWxheTtcbiAgICAgICAgdGhpcy5mdW5jcy5mb3JFYWNoKCh2YWx1ZTogRnVuY3Rpb24pID0+e1xuICAgICAgICAgICAgdmFsdWUoZGVsYXkpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5leGVjdXRlRnVuYygpO1xuICAgICAgICB0aGlzLmxhc3RUaW1lID1jdXJyZW50VGltZTtcbiAgICAgICAgaWYodGhpcy5fcnVubmluZylcbiAgICAgICAgICAgIHRoaXMudGltZXJJZCA9IHNldFRpbWVvdXQodGhpcy51cGRhdGUuYmluZCh0aGlzKSwgdGhpcy5kZWxheSk7XG4gICAgfVxuXG4gICAgZXhlY3V0ZUZ1bmMoKXtcbiAgICAgICAgaWYodGhpcy5leGVjdXRlRnVuY3NbMF0gJiYgdGhpcy5leGVjdXRlRnVuY3NbMF0udGltZSA8IHRoaXMuX3N5c3RlbVRpbWUpe1xuICAgICAgICAgICAgbGV0IHZhbHVlOiBFeGVjdXRlVmFsdWUgPSB0aGlzLmV4ZWN1dGVGdW5jcy5zaGlmdCgpO1xuICAgICAgICAgICAgdmFsdWUuZnVuYygpO1xuXG4gICAgICAgICAgICB0aGlzLmV4ZWN1dGVGdW5jKCk7XG5cbiAgICAgICAgICAgIC8vIGxvb3AgPD0gMCB3aWxsIGJlIGluZmluaXRlIGxvb3BcbiAgICAgICAgICAgIGlmICh2YWx1ZS5sb29wID4gMCAmJiAtLXZhbHVlLmxvb3AgPT09MCl7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IG5leHRUaW1lOiBudW1iZXIgPSB2YWx1ZS50aW1lICsgdmFsdWUuZGVsYXk7XG4gICAgICAgICAgICB0aGlzLnJlZ2lzdGVyRGVsYXlQKHZhbHVlLmZ1bmMsIHZhbHVlLmRlbGF5LCBuZXh0VGltZSwgdmFsdWUubG9vcClcbiAgICAgICAgfVxuICAgIH1cbiAgICBjbGVhckZ1bmNzKCl7XG4gICAgICAgIHRoaXMuZnVuY3M9IFtdO1xuICAgIH1cbiAgICBjbGVhckRlbGF5RnVuY3MoKXtcbiAgICAgICAgdGhpcy5leGVjdXRlRnVuY3MgPSBbXTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHJlZ2lzdGVyRGVsYXlQKGZ1bmM6IEZ1bmN0aW9uLCBkZWxheTogbnVtYmVyLCB0aW1lOiBudW1iZXIsIGxvb3A6IG51bWJlcil7XG4gICAgICAgIGxldCBpbmRleDogbnVtYmVyID0gdGhpcy5zZWFyY2hJbmRleCh0aW1lKTtcbiAgICAgICAgbGV0IHZhbHVlOiBFeGVjdXRlVmFsdWUgPSB7ZnVuYzogZnVuYywgZGVsYXk6IGRlbGF5LCB0aW1lOiB0aW1lLCBsb29wOiBsb29wfTtcbiAgICAgICAgdGhpcy5leGVjdXRlRnVuY3Muc3BsaWNlKGluZGV4LCAwLCB2YWx1ZSk7XG4gICAgfVxufVxuXG5pbnRlcmZhY2UgRXhlY3V0ZVZhbHVlIHtcbiAgICBmdW5jOiBGdW5jdGlvbjtcbiAgICB0aW1lOiBudW1iZXI7XG4gICAgZGVsYXk6IG51bWJlcjtcbiAgICBsb29wOiBudW1iZXI7XG59Il0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFVQTtBQVRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/Timer.ts\n");

/***/ }),

/***/ "./src/demo.ts":
/*!*********************!*\
  !*** ./src/demo.ts ***!
  \*********************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _SlimTabV2__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./SlimTabV2 */ \"./src/SlimTabV2.ts\");\n/* harmony import */ var _DataAdapter__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./DataAdapter */ \"./src/DataAdapter.ts\");\n/* harmony import */ var _LiCAP__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./LiCAP */ \"./src/LiCAP.ts\");\n/* harmony import */ var _Metronome__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./Metronome */ \"./src/Metronome.ts\");\n/* harmony import */ var _instrumentCorrection__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./instrumentCorrection */ \"./src/instrumentCorrection.ts\");\n/* harmony import */ var _SlimTabV2Editor__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./SlimTabV2Editor */ \"./src/SlimTabV2Editor.ts\");\n/* harmony import */ var _LiCAPStream__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./LiCAPStream */ \"./src/LiCAPStream.ts\");\n/* harmony import */ var _SLPract__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./SLPract */ \"./src/SLPract.ts\");\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nlet nt = new _SlimTabV2__WEBPACK_IMPORTED_MODULE_0__[\"SLTab\"]();\r\nlet data = [\r\n    [ // section\r\n    // [4, [3, -1, -1, 4, -1, -1], null],// note length, [block number, index is string number,], user data\r\n    ],\r\n];\r\nnt.setData(data);\r\nlet tabEditor = new _SlimTabV2Editor__WEBPACK_IMPORTED_MODULE_5__[\"SLEditor\"](nt);\r\nnt.attach(document.getElementById(\"slimtab\"));\r\ndocument.addEventListener(\"keydown\", (e) => {\r\n    let ka = [32, 37, 38, 39, 40]; //space: 32, left: 37, up: 38, right: 39, down: 40,\r\n    for (let i = 0; i < ka.length; i++) { // why is there no \"includes\" methods in typescript = =?\r\n        if (ka[i] === e.keyCode) {\r\n            e.preventDefault();\r\n            e.returnValue = false;\r\n        }\r\n    }\r\n});\r\nnt.render();\r\nlet da = new _DataAdapter__WEBPACK_IMPORTED_MODULE_1__[\"DataAdapter\"]();\r\n_LiCAP__WEBPACK_IMPORTED_MODULE_2__[\"LiCAP\"].enumerate().then((devs) => {\r\n    if (devs.length > 0) {\r\n        devs[0].on(\"pick\", da.receiveData.bind(da));\r\n    }\r\n});\r\nda.addDataListener((data) => { nt.instrumentNoteInput(_instrumentCorrection__WEBPACK_IMPORTED_MODULE_4__[\"instrumentCorrection\"], data); });\r\nlet beep = new _Metronome__WEBPACK_IMPORTED_MODULE_3__[\"Metronome\"](120);\r\nlet bs = 0;\r\nlet beepEle = document.getElementById(\"metronome\");\r\nbeepEle.onclick = function (event) {\r\n    if (bs == 0) {\r\n        beep.startTick();\r\n        beepEle.style.background = \"#e99415\";\r\n        bs = 1;\r\n    }\r\n    else {\r\n        beep.stopTick();\r\n        beepEle.style.background = \"\";\r\n        bs = 0;\r\n    }\r\n};\r\nlet win = window;\r\nlet s;\r\nwindow.gg = () => { s = setInterval(function () { nt.instrumentNoteInput(_instrumentCorrection__WEBPACK_IMPORTED_MODULE_4__[\"instrumentCorrection\"], [8, [-1, -1, -1, 4, -1, 6], null]); }, 100); };\r\nwindow.gx = () => { clearInterval(s); };\r\n//s= setInterval(function(){nt.instrumentNoteInput(instrumentCorrection,[8, [-1, -1, -1, 4, -1, 6], null])}, 100);\r\n//nt.instrumentNoteInput(instrumentCorrection,[4, [-1, -1, -1, 4, -1, 6], null]);\r\n//nt.instrumentNoteInput(instrumentCorrection,[4, [-1, -1, -1, 4, -1, 6], null], 0, 2);\r\nfunction pad(num, size) { return ('000000000' + num).substr(-size); }\r\nnt.on(\"noteclick\", (sectionIdx, noteIdx, stringIdx) => {\r\n    document.getElementById(\"section-idx\").innerText = pad(String(sectionIdx + 1), 3) + \".\";\r\n});\r\nlet stream = new _LiCAPStream__WEBPACK_IMPORTED_MODULE_6__[\"LiCAPStream\"]();\r\ndocument.getElementById('playstream').addEventListener('click', () => {\r\n    stream.play();\r\n});\r\nconsole.log(nt);\r\nlet pt = new _SLPract__WEBPACK_IMPORTED_MODULE_7__[\"SLPract\"](nt, tabEditor, beep);\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZGVtby50cy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovL1tuYW1lXS8uL3NyYy9kZW1vLnRzPzJjY2QiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgc2VjdGlvbiwgbm90ZSB9IGZyb20gXCIuL1NsaW1UYWJWMlR5cGVzXCJcbmltcG9ydCB7IFNMVGFiIH0gZnJvbSBcIi4vU2xpbVRhYlYyXCI7XG5pbXBvcnQgeyBEYXRhQWRhcHRlciB9IGZyb20gXCIuL0RhdGFBZGFwdGVyXCJcbmltcG9ydCB7IExpQ0FQIH0gZnJvbSBcIi4vTGlDQVBcIlxuaW1wb3J0IHsgTWV0cm9ub21lIH0gZnJvbSBcIi4vTWV0cm9ub21lXCJcbmltcG9ydCB7IGluc3RydW1lbnRDb3JyZWN0aW9uIH0gZnJvbSBcIi4vaW5zdHJ1bWVudENvcnJlY3Rpb25cIlxuaW1wb3J0IHsgU0xFZGl0b3IgfSBmcm9tIFwiLi9TbGltVGFiVjJFZGl0b3JcIlxuaW1wb3J0IHsgTGlDQVBTdHJlYW0gfSBmcm9tIFwiLi9MaUNBUFN0cmVhbVwiXG5pbXBvcnQge1NMUHJhY3R9IGZyb20gXCIuL1NMUHJhY3RcIlxubGV0IG50ID0gbmV3IFNMVGFiKCk7XG5sZXQgZGF0YTogc2VjdGlvbltdID0gW1xuICAgIFsvLyBzZWN0aW9uXG4gICAgICAgIC8vIFs0LCBbMywgLTEsIC0xLCA0LCAtMSwgLTFdLCBudWxsXSwvLyBub3RlIGxlbmd0aCwgW2Jsb2NrIG51bWJlciwgaW5kZXggaXMgc3RyaW5nIG51bWJlcixdLCB1c2VyIGRhdGFcbiAgICAgICAgXG4gICAgXSxcbl07XG5udC5zZXREYXRhKGRhdGEpO1xubGV0IHRhYkVkaXRvciA9IG5ldyBTTEVkaXRvcihudCk7XG5udC5hdHRhY2goZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzbGltdGFiXCIpKTtcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsKGUpID0+IHtcbiAgICBsZXQga2EgPSBbMzIsIDM3LCAzOCwgMzksIDQwXTsgLy9zcGFjZTogMzIsIGxlZnQ6IDM3LCB1cDogMzgsIHJpZ2h0OiAzOSwgZG93bjogNDAsXG4gICAgZm9yKGxldCBpID0gMDsgaSA8IGthLmxlbmd0aDsgaSsrKXsvLyB3aHkgaXMgdGhlcmUgbm8gXCJpbmNsdWRlc1wiIG1ldGhvZHMgaW4gdHlwZXNjcmlwdCA9ID0/XG4gICAgICAgIGlmKGthW2ldID09PSBlLmtleUNvZGUpe1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgZS5yZXR1cm5WYWx1ZSA9IGZhbHNlOyAgXG4gICAgICAgIH1cbiAgICB9XG59KTtcbm50LnJlbmRlcigpO1xuXG5sZXQgZGEgPSBuZXcgRGF0YUFkYXB0ZXIoKTtcbkxpQ0FQLmVudW1lcmF0ZSgpLnRoZW4oKGRldnMpPT57XG4gICAgaWYoZGV2cy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGRldnNbMF0ub24oXCJwaWNrXCIsIGRhLnJlY2VpdmVEYXRhLmJpbmQoZGEpKTtcbiAgICB9XG59KTtcblxuZGEuYWRkRGF0YUxpc3RlbmVyKChkYXRhOiBub3RlKT0+e250Lmluc3RydW1lbnROb3RlSW5wdXQoaW5zdHJ1bWVudENvcnJlY3Rpb24sZGF0YSl9KTtcblxuXG5sZXQgYmVlcDogTWV0cm9ub21lID0gbmV3IE1ldHJvbm9tZSgxMjApO1xubGV0IGJzID0gMDtcbmxldCBiZWVwRWxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJtZXRyb25vbWVcIik7XG5iZWVwRWxlLm9uY2xpY2sgPSBmdW5jdGlvbihldmVudCl7XG4gICAgaWYoYnMgPT0gMCl7XG4gICAgICAgIGJlZXAuc3RhcnRUaWNrKCk7XG4gICAgICAgIGJlZXBFbGUuc3R5bGUuYmFja2dyb3VuZCA9IFwiI2U5OTQxNVwiO1xuICAgICAgICBicyA9IDE7XG4gICAgfWVsc2V7XG4gICAgICAgIGJlZXAuc3RvcFRpY2soKTtcbiAgICAgICAgYmVlcEVsZS5zdHlsZS5iYWNrZ3JvdW5kID0gXCJcIjtcbiAgICAgICAgYnMgPSAwO1xuICAgIH1cbn1cbiBsZXQgd2luID0gd2luZG93O1xuIGxldCBzOiBhbnk7XG4gKHdpbmRvdyBhcyBhbnkpLmdnID0gKCkgPT4ge3MgPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpe250Lmluc3RydW1lbnROb3RlSW5wdXQoaW5zdHJ1bWVudENvcnJlY3Rpb24sWzgsIFstMSwgLTEsIC0xLCA0LCAtMSwgNl0sIG51bGxdKX0sIDEwMCk7fTtcbiAod2luZG93IGFzIGFueSkuZ3ggPSAoKSA9PiB7Y2xlYXJJbnRlcnZhbChzKTt9XG4vL3M9IHNldEludGVydmFsKGZ1bmN0aW9uKCl7bnQuaW5zdHJ1bWVudE5vdGVJbnB1dChpbnN0cnVtZW50Q29ycmVjdGlvbixbOCwgWy0xLCAtMSwgLTEsIDQsIC0xLCA2XSwgbnVsbF0pfSwgMTAwKTtcbi8vbnQuaW5zdHJ1bWVudE5vdGVJbnB1dChpbnN0cnVtZW50Q29ycmVjdGlvbixbNCwgWy0xLCAtMSwgLTEsIDQsIC0xLCA2XSwgbnVsbF0pO1xuLy9udC5pbnN0cnVtZW50Tm90ZUlucHV0KGluc3RydW1lbnRDb3JyZWN0aW9uLFs0LCBbLTEsIC0xLCAtMSwgNCwgLTEsIDZdLCBudWxsXSwgMCwgMik7XG5cblxuZnVuY3Rpb24gcGFkKG51bTogc3RyaW5nLCBzaXplOiBudW1iZXIpeyByZXR1cm4gKCcwMDAwMDAwMDAnICsgbnVtKS5zdWJzdHIoLXNpemUpOyB9XG5cbm50Lm9uKFwibm90ZWNsaWNrXCIsIChzZWN0aW9uSWR4LCBub3RlSWR4LCBzdHJpbmdJZHgpID0+IHtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNlY3Rpb24taWR4XCIpLmlubmVyVGV4dCA9IHBhZChTdHJpbmcoc2VjdGlvbklkeCsxKSwgMykgKyBcIi5cIjtcbn0pXG5cblxubGV0IHN0cmVhbSA9IG5ldyBMaUNBUFN0cmVhbSgpO1xuXG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGxheXN0cmVhbScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgIHN0cmVhbS5wbGF5KCk7XG59KVxuY29uc29sZS5sb2cobnQpXG5sZXQgcHQgPSBuZXcgU0xQcmFjdChudCwgdGFiRWRpdG9yLCBiZWVwKTsiXSwibWFwcGluZ3MiOiJBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUVBO0FBQ0E7QUFDQTtBQUdBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/demo.ts\n");

/***/ }),

/***/ "./src/instrumentCorrection.ts":
/*!*************************************!*\
  !*** ./src/instrumentCorrection.ts ***!
  \*************************************/
/*! exports provided: instrumentCorrection */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"instrumentCorrection\", function() { return instrumentCorrection; });\nconst instrumentCorrection = function (sltab, addData, section, note) {\r\n    sltab.notes[section] = sltab.notes[section].slice(0, note + 1);\r\n    let stackLength = 0; // unit in beat\r\n    for (let i = 0; i <= note; i++) {\r\n        stackLength += sltab.lengthPerBeat / sltab.notes[section][i][0];\r\n    }\r\n    if (stackLength >= sltab.beatPerSection) {\r\n        sltab.notes.splice(section + 1, 0, []);\r\n        sltab.notes[section + 1].push(addData);\r\n    }\r\n    else if (stackLength + sltab.lengthPerBeat / addData[0] > sltab.beatPerSection) {\r\n        let restLength = sltab.beatPerSection - stackLength;\r\n        let addLength = sltab.lengthPerBeat / (sltab.lengthPerBeat / addData[0] - restLength);\r\n        restLength = sltab.lengthPerBeat / restLength;\r\n        sltab.notes[section].push([restLength, addData[1], \"linkStart\"]);\r\n        sltab.notes.splice(section + 1, 0, []);\r\n        sltab.notes[section + 1].push([addLength, addData[1], \"linkEnd\"]);\r\n    }\r\n    else {\r\n        let noteRestLength = 1 - stackLength % 1; // unit in beat\r\n        if (noteRestLength >= sltab.lengthPerBeat / addData[0]) {\r\n            sltab.notes[section].push(addData);\r\n        }\r\n        else {\r\n            let noteAddLength = sltab.lengthPerBeat / addData[0] - noteRestLength;\r\n            sltab.notes[section].push([sltab.lengthPerBeat / noteRestLength, addData[1], \"linkStart\"]);\r\n            sltab.notes[section].push([sltab.lengthPerBeat / noteAddLength, addData[1], \"linkEnd\"]);\r\n        }\r\n    }\r\n};\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvaW5zdHJ1bWVudENvcnJlY3Rpb24udHMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvaW5zdHJ1bWVudENvcnJlY3Rpb24udHM/MzlhZCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb3JyZWN0aW9uIH0gZnJvbSBcIi4vU2xpbVRhYlYySW50ZXJmYWNlXCJcbmltcG9ydCB7IG5vdGUsIHNlY3Rpb24gfSBmcm9tIFwiLi9TbGltVGFiVjJUeXBlc1wiXG5pbXBvcnQgeyBTTFRhYiB9IGZyb20gXCIuL1NsaW1UYWJWMlwiXG5jb25zdCBpbnN0cnVtZW50Q29ycmVjdGlvbjogQ29ycmVjdGlvbiA9IGZ1bmN0aW9uKHNsdGFiOiBTTFRhYiwgYWRkRGF0YTogbm90ZSwgc2VjdGlvbjogbnVtYmVyLCBub3RlOiBudW1iZXIpOiB2b2lkIHtcbiAgICBzbHRhYi5ub3Rlc1tzZWN0aW9uXSA9IHNsdGFiLm5vdGVzW3NlY3Rpb25dLnNsaWNlKDAsIG5vdGUgKyAxKTtcbiAgICBsZXQgc3RhY2tMZW5ndGggPSAwOy8vIHVuaXQgaW4gYmVhdFxuICAgIGZvcihsZXQgaSA9IDA7IGkgPD0gbm90ZTsgaSsrKXtcbiAgICAgICAgc3RhY2tMZW5ndGggKz0gc2x0YWIubGVuZ3RoUGVyQmVhdCAvIHNsdGFiLm5vdGVzW3NlY3Rpb25dW2ldWzBdO1xuICAgIH1cbiAgICBpZihzdGFja0xlbmd0aCA+PSBzbHRhYi5iZWF0UGVyU2VjdGlvbil7XG4gICAgICAgIHNsdGFiLm5vdGVzLnNwbGljZShzZWN0aW9uICsgMSwgMCwgW10pO1xuICAgICAgICBzbHRhYi5ub3Rlc1tzZWN0aW9uICsgMV0ucHVzaChhZGREYXRhKTtcbiAgICB9ZWxzZSBpZihzdGFja0xlbmd0aCArIHNsdGFiLmxlbmd0aFBlckJlYXQgLyBhZGREYXRhWzBdID4gc2x0YWIuYmVhdFBlclNlY3Rpb24pe1xuICAgICAgICBsZXQgcmVzdExlbmd0aCA9IHNsdGFiLmJlYXRQZXJTZWN0aW9uIC0gc3RhY2tMZW5ndGg7XG4gICAgICAgIGxldCBhZGRMZW5ndGggPSBzbHRhYi5sZW5ndGhQZXJCZWF0IC8gKHNsdGFiLmxlbmd0aFBlckJlYXQgLyBhZGREYXRhWzBdIC0gcmVzdExlbmd0aCk7XG4gICAgICAgIHJlc3RMZW5ndGggPSBzbHRhYi5sZW5ndGhQZXJCZWF0IC8gcmVzdExlbmd0aDtcbiAgICAgICAgc2x0YWIubm90ZXNbc2VjdGlvbl0ucHVzaChbcmVzdExlbmd0aCwgYWRkRGF0YVsxXSwgXCJsaW5rU3RhcnRcIl0pO1xuICAgICAgICBzbHRhYi5ub3Rlcy5zcGxpY2Uoc2VjdGlvbiArIDEsIDAsIFtdKTtcbiAgICAgICAgc2x0YWIubm90ZXNbc2VjdGlvbiArIDFdLnB1c2goW2FkZExlbmd0aCwgYWRkRGF0YVsxXSwgXCJsaW5rRW5kXCJdKTsgICBcbiAgICB9ZWxzZXtcbiAgICAgICAgbGV0IG5vdGVSZXN0TGVuZ3RoID0gMSAtIHN0YWNrTGVuZ3RoICUgMTsgLy8gdW5pdCBpbiBiZWF0XG4gICAgICAgIGlmKG5vdGVSZXN0TGVuZ3RoID49IHNsdGFiLmxlbmd0aFBlckJlYXQgLyBhZGREYXRhWzBdKXtcbiAgICAgICAgICAgIHNsdGFiLm5vdGVzW3NlY3Rpb25dLnB1c2goYWRkRGF0YSk7XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgICAgbGV0IG5vdGVBZGRMZW5ndGggPSBzbHRhYi5sZW5ndGhQZXJCZWF0IC8gYWRkRGF0YVswXSAtIG5vdGVSZXN0TGVuZ3RoO1xuICAgICAgICAgICAgc2x0YWIubm90ZXNbc2VjdGlvbl0ucHVzaChbc2x0YWIubGVuZ3RoUGVyQmVhdCAvIG5vdGVSZXN0TGVuZ3RoLCBhZGREYXRhWzFdLCBcImxpbmtTdGFydFwiXSk7XG4gICAgICAgICAgICBzbHRhYi5ub3Rlc1tzZWN0aW9uXS5wdXNoKFtzbHRhYi5sZW5ndGhQZXJCZWF0IC8gbm90ZUFkZExlbmd0aCwgYWRkRGF0YVsxXSwgXCJsaW5rRW5kXCJdKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbmV4cG9ydCB7IGluc3RydW1lbnRDb3JyZWN0aW9uIH07Il0sIm1hcHBpbmdzIjoiQUFHQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/instrumentCorrection.ts\n");

/***/ }),

/***/ "./src/utils.ts":
/*!**********************!*\
  !*** ./src/utils.ts ***!
  \**********************/
/*! exports provided: utils, Callbacks */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"utils\", function() { return utils; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Callbacks\", function() { return Callbacks; });\nvar utils;\r\n(function (utils) {\r\n    function setAttributes(el, attr) {\r\n        for (let k in attr) {\r\n            el.setAttribute(k, attr[k]);\r\n        }\r\n    }\r\n    utils.setAttributes = setAttributes;\r\n    function setStyle(el, style) {\r\n        for (let k in style) {\r\n            el.style.setProperty(k, style[k]);\r\n        }\r\n    }\r\n    utils.setStyle = setStyle;\r\n    const noteNumber = { \"C\": 0, \"C#\": 1, \"D\": 2, \"D#\": 3, \"E\": 4, \"F\": 5, \"F#\": 6, \"G\": 7, \"G#\": 8, \"A\": 9, \"A#\": 10, \"B\": 11 };\r\n    const regex = /^([CDEFGAB]#?)([0-9])$/;\r\n    function noteToDecimal(note) {\r\n        let groups = regex.exec(note);\r\n        if (groups.length != 3)\r\n            return -1;\r\n        return noteNumber[groups[1]] + (Number(groups[2]) + 1) * 12;\r\n    }\r\n    utils.noteToDecimal = noteToDecimal;\r\n})(utils || (utils = {}));\r\nclass ArrayFunction {\r\n    constructor() {\r\n        this.funcs = [];\r\n    }\r\n    callAll(...args) {\r\n        this.funcs.forEach((func) => {\r\n            func(...args);\r\n        });\r\n    }\r\n    push(cbk) {\r\n        this.funcs.push(cbk);\r\n    }\r\n}\r\n;\r\nclass Callbacks {\r\n    constructor(eventType) {\r\n        eventType.forEach(element => {\r\n            this[element] = new ArrayFunction();\r\n        });\r\n    }\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvdXRpbHMudHMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvdXRpbHMudHM/N2RkYSJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgbmFtZXNwYWNlIHV0aWxzIHtcbiAgICBleHBvcnQgZnVuY3Rpb24gc2V0QXR0cmlidXRlcyhlbDogRWxlbWVudCwgYXR0cjp7W2tleTogc3RyaW5nXTogc3RyaW5nfSl7XG4gICAgICAgIGZvcihsZXQgayBpbiBhdHRyKXtcbiAgICAgICAgICAgIGVsLnNldEF0dHJpYnV0ZShrLCBhdHRyW2tdKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBleHBvcnQgZnVuY3Rpb24gc2V0U3R5bGUoZWw6IEhUTUxFbGVtZW50LCBzdHlsZTp7W2tleTogc3RyaW5nXTogc3RyaW5nfSl7XG4gICAgICAgIGZvcihsZXQgayBpbiBzdHlsZSl7XG4gICAgICAgICAgICBlbC5zdHlsZS5zZXRQcm9wZXJ0eShrLCBzdHlsZVtrXSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBub3RlTnVtYmVyID0ge1wiQ1wiOiAwLCBcIkMjXCI6IDEsIFwiRFwiOiAyLCBcIkQjXCI6IDMsIFwiRVwiOiA0LCBcIkZcIjogNSwgXCJGI1wiOiA2LCBcIkdcIjogNywgXCJHI1wiOiA4LCBcIkFcIjogOSwgXCJBI1wiOiAxMCwgXCJCXCI6IDExfTtcbiAgICBjb25zdCByZWdleCA9IC9eKFtDREVGR0FCXSM/KShbMC05XSkkLztcbiAgICBleHBvcnQgZnVuY3Rpb24gbm90ZVRvRGVjaW1hbChub3RlOiBzdHJpbmcpIHtcbiAgICAgICAgbGV0IGdyb3VwcyA9IHJlZ2V4LmV4ZWMobm90ZSk7XG4gICAgICAgIGlmKGdyb3Vwcy5sZW5ndGggIT0gMylcbiAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgcmV0dXJuIG5vdGVOdW1iZXJbZ3JvdXBzWzFdIGFzIGtleW9mIHR5cGVvZiBub3RlTnVtYmVyXSsoTnVtYmVyKGdyb3Vwc1syXSkrMSkqMTI7XG4gICAgfVxufVxuXG5cbmNsYXNzIEFycmF5RnVuY3Rpb24ge1xuICAgIHByaXZhdGUgZnVuY3M6IEFycmF5PEZ1bmN0aW9uPiA9IFtdO1xuICAgIGNhbGxBbGwoLi4uYXJnczogYW55W10pIHtcbiAgICAgICAgdGhpcy5mdW5jcy5mb3JFYWNoKChmdW5jKSA9PiB7XG4gICAgICAgICAgICBmdW5jKC4uLmFyZ3MpO1xuICAgICAgICB9KVxuICAgIH1cblxuICAgIHB1c2goY2JrOiAoLi4uYXJnczogYW55W10pID0+IHZvaWQpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5mdW5jcy5wdXNoKGNiayk7XG4gICAgfVxufTtcblxuZXhwb3J0IGNsYXNzIENhbGxiYWNrcyB7XG4gICAgW2tleTogc3RyaW5nXTogQXJyYXlGdW5jdGlvbjtcbiAgICBjb25zdHJ1Y3RvcihldmVudFR5cGU6IEFycmF5PHN0cmluZz4pIHtcbiAgICAgICAgZXZlbnRUeXBlLmZvckVhY2goZWxlbWVudCA9PiB7XG4gICAgICAgICAgICB0aGlzW2VsZW1lbnRdID0gbmV3IEFycmF5RnVuY3Rpb24oKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuXG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTEE7QUFNQTtBQUdBO0FBQUE7QUFDQTtBQVVBO0FBVEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/utils.ts\n");

/***/ })

/******/ });